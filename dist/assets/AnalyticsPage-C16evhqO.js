var e=Object.defineProperty,t=(t,a,r)=>((t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r)(t,"symbol"!=typeof a?a+"":a,r);import{c as a,d as r,q as n,w as s,h as d,m as o}from"./main-BTanfOAJ.js";import i from"./perf--GZdtUOV.js";import"./vendor-7JQXQzuE.js";const l=class e{static async fetchTransactionsForPeriod(t,o,i){try{const l=`${t}_${o}_${i}`,c=e._cache.get(l);if(c&&Date.now()-c.timestamp<e._cacheTimeout)return c.data;const g=a(r,"transactions"),v=n(g,s("budgetId","==",t)),x=await d(v),m=x.docs.map(e=>({id:e.id,...e.data()})).filter(t=>{const a=e.txToDate(t);return a&&a>=o&&a<=i});return e._cache.set(l,{data:m,timestamp:Date.now()}),m}catch(l){return[]}}static clearCache(){e._cache.clear()}static txToDate(e){try{let t=e?.dataEfetivacao||e?.dataLancamento||e?.data||e?.date||e?.createdAt;if(!t)return null;if(t&&"function"==typeof t.toDate)return t.toDate();if("string"==typeof t){const e=t.trim(),a=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(a)return new Date(parseInt(a[1],10),parseInt(a[2],10)-1,parseInt(a[3],10));const r=new Date(e);return isNaN(r.getTime())?null:r}if("number"==typeof t){const e=new Date(t<1e12?1e3*t:t);return isNaN(e.getTime())?null:e}if(t instanceof Date)return t;const a=new Date(t);return isNaN(a.getTime())?null:a}catch{return null}}static async getGastosPorCategoria(t,o,i){try{if(!t)throw new Error("ID do orçamento não fornecido");if(!o||!i){const e=new Date;o=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0)}let l=[],c=[];if(window.appState?.transactions&&window.appState?.categories){if(l=window.appState.transactions.filter(a=>{if(a.budgetId!==t)return!1;const r=e.txToDate(a);return r&&r>=o&&r<=i}),c=window.appState.categories.filter(e=>e.budgetId===t),!l||0===l.length){const a=await e.fetchTransactionsForPeriod(t,o,i);a.length>0&&(l=a)}}else{l=await e.fetchTransactionsForPeriod(t,o,i);const g=a(r,"categories"),v=n(g,s("budgetId","==",t));c=(await d(v)).docs.map(e=>({id:e.id,...e.data()}))}const g=c.map(e=>{const t=l.filter(t=>t.categoriaId===e.id),a=t.reduce((e,t)=>e+parseFloat(t.valor),0);return{categoria:e,totalGasto:a,transacoes:t,percentual:0}}),v=g.reduce((e,t)=>e+t.totalGasto,0);return g.forEach(e=>{e.percentual=v>0?e.totalGasto/v*100:0}),g.sort((e,t)=>t.totalGasto-e.totalGasto),g}catch(l){throw l}}static async getEvolucaoSaldo(t,o=6){try{if(!t)throw new Error("ID do orçamento não fornecido");const i=new Date,l=[];for(let e=0;e<o;e++){const t=i.getMonth()-e,a=i.getFullYear()+Math.floor(t/12),r=(t%12+12)%12,n=new Date(a,r,1),s=new Date(a,r+1,0);l.push({ano:a,mes:r+1,nome:n.toLocaleString("pt-BR",{month:"long"}),startDate:n,endDate:s,receitas:0,despesas:0,saldo:0})}for(const o of l){let i=[];if(window.appState?.transactions)i=window.appState.transactions.filter(a=>{if(a.budgetId!==t)return!1;const r=e.txToDate(a);return r&&r>=o.startDate&&r<=o.endDate});else{const l=a(r,"transactions"),c=n(l,s("budgetId","==",t)),g=await d(c);i=g.docs.map(e=>({id:e.id,...e.data()})).filter(t=>{const a=e.txToDate(t);return a&&a>=o.startDate&&a<=o.endDate})}for(const e of i){const t=parseFloat(e.valor);"receita"===e.tipo?o.receitas+=t:o.despesas+=t}o.saldo=o.receitas-o.despesas}return l.sort((e,t)=>e.ano!==t.ano?t.ano-e.ano:t.mes-e.mes),l}catch(i){throw i}}static async getPrevisaoGastos(e,t=3,a=3){try{if(!e)throw new Error("ID do orçamento não fornecido");const r=await this.getEvolucaoSaldo(e,t),n=r.reduce((e,t)=>e+t.receitas,0)/r.length,s=r.reduce((e,t)=>e+t.despesas,0)/r.length,d=new Date,o=[];for(let e=1;e<=a;e++){const t=d.getMonth()+e,a=d.getFullYear()+Math.floor(t/12),r=t%12,i=new Date(a,r,1),l=1+.01*e;o.push({ano:a,mes:r+1,nome:i.toLocaleString("pt-BR",{month:"long"}),receitas:n*l,despesas:s*l,saldo:(n-s)*l,isPrevisto:!0})}return o}catch(r){throw r}}static renderizarGraficoCategorias(e,t){try{const a=document.getElementById(e);if(!a)throw new Error(`Elemento com ID ${e} não encontrado`);if(a.innerHTML="",!t||0===t.length)return void(a.innerHTML='\n          <div class="text-center py-4">\n            <p class="text-gray-500 dark:text-gray-400">Sem dados para exibir</p>\n          </div>\n        ');const r=`\n        <div class="analytics-chart">\n          <h3 class="text-lg font-medium mb-4">Gastos por Categoria</h3>\n          <div class="space-y-3">\n            ${t.map(e=>`\n              <div class="chart-item">\n                <div class="flex justify-between mb-1">\n                  <span class="text-sm font-medium text-gray-700 dark:text-gray-300">\n                    ${e.categoria.nome}\n                  </span>\n                  <span class="text-sm text-gray-600 dark:text-gray-400">\n                    R$ ${e.totalGasto.toFixed(2)} (${e.percentual.toFixed(1)}%)\n                  </span>\n                </div>\n                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">\n                  <div class="h-2.5 rounded-full" \n                       style="width: ${e.percentual}%; background-color: ${e.categoria.cor||"#4F46E5"}"></div>\n                </div>\n              </div>\n            `).join("")}\n          </div>\n        </div>\n      `;a.innerHTML=r}catch(a){throw a}}static renderizarGraficoEvolucao(e,t){try{const a=document.getElementById(e);if(!a)throw new Error(`Elemento com ID ${e} não encontrado`);if(a.innerHTML="",!t||0===t.length)return void(a.innerHTML='\n          <div class="text-center py-4">\n            <p class="text-gray-500 dark:text-gray-400">Sem dados para exibir</p>\n          </div>\n        ');const r=Math.max(...t.map(e=>e.receitas)),n=Math.max(...t.map(e=>e.despesas)),s=1.1*Math.max(r,n),d=`\n        <div class="analytics-chart">\n          <h3 class="text-lg font-medium mb-4">Evolução Financeira</h3>\n          \n          <div class="relative h-64 mt-4 pl-12 pr-4">\n            \x3c!-- Linhas de grade --\x3e\n            <div class="absolute inset-0 grid grid-rows-4 w-full h-full">\n              ${[0,1,2,3].map(e=>`\n                <div class="border-t border-gray-200 dark:border-gray-700 relative">\n                  <span class="absolute -top-3 -left-16 text-xs text-gray-500 dark:text-gray-400">\n                    R$ ${(s/4*(4-e)).toFixed(0)}\n                  </span>\n                </div>\n              `).join("")}\n            </div>\n            \n            \x3c!-- Gráfico de barras --\x3e\n            <div class="absolute inset-0 flex items-end justify-between gap-1">\n              ${t.map((e,t)=>{const a=Math.max(e.receitas/s*100,2),r=Math.max(e.despesas/s*100,2),n=e.isPrevisto;return`\n                  <div class="flex flex-col items-center justify-end flex-1 min-w-0">\n                    \x3c!-- Barra de receita --\x3e\n                    <div class="w-full flex justify-center mb-1">\n                      <div class="w-3 ${n?"bg-green-300/50":"bg-green-500"} rounded-t transition-all duration-300 hover:w-4" \n                           style="height: ${a}%"></div>\n                    </div>\n                    \n                    \x3c!-- Barra de despesa --\x3e\n                    <div class="w-full flex justify-center mb-1">\n                      <div class="w-3 ${n?"bg-red-300/50":"bg-red-500"} rounded-t transition-all duration-300 hover:w-4" \n                           style="height: ${r}%"></div>\n                    </div>\n                    \n                    \x3c!-- Rótulo do mês --\x3e\n                    <div class="text-xs text-gray-600 dark:text-gray-400 mt-1 ${n?"italic":""} text-center truncate w-full">\n                      ${e.nome.substring(0,3)}\n                      ${n?"*":""}\n                    </div>\n                  </div>\n                `}).join("")}\n            </div>\n          </div>\n          \n          \x3c!-- Legenda --\x3e\n          <div class="flex justify-center mt-4 space-x-4 text-xs">\n            <div class="flex items-center">\n              <div class="w-3 h-3 bg-green-500 rounded-full mr-1"></div>\n              <span class="text-gray-600 dark:text-gray-400">Receitas</span>\n            </div>\n            <div class="flex items-center">\n              <div class="w-3 h-3 bg-red-500 rounded-full mr-1"></div>\n              <span class="text-gray-600 dark:text-gray-400">Despesas</span>\n            </div>\n            ${t.some(e=>e.isPrevisto)?'\n              <div class="flex items-center">\n                <span class="text-gray-600 dark:text-gray-400 italic">* Previsto</span>\n              </div>\n            ':""}\n          </div>\n        </div>\n      `;a.innerHTML=d}catch(a){throw a}}static async gerarRelatorioCompleto(t,a,r){try{if(!t)throw new Error("ID do orçamento não fornecido");if(!window.appState?.currentUser)throw new Error("Usuário não autenticado");const[n,s,d]=await Promise.all([this.getGastosPorCategoria(t,a,r),this.getEvolucaoSaldo(t,6),this.getPrevisaoGastos(t,3,3)]);let o=0,i=0;if(a&&r){let n=[];window.appState?.transactions&&(n=window.appState.transactions.filter(n=>{if(n.budgetId!==t)return!1;const s=e.txToDate(n);return s&&s>=a&&s<=r})),n&&0!==n.length||(n=await e.fetchTransactionsForPeriod(t,a,r)),o=n.filter(e=>"receita"===e.tipo).reduce((e,t)=>e+parseFloat(t.valor||0),0),i=n.filter(e=>"despesa"===e.tipo).reduce((e,t)=>e+parseFloat(t.valor||0),0)}return{gastosPorCategoria:n,evolucaoSaldo:s,previsaoGastos:d,resumo:{saldoAtual:o-i,receitasMes:o,despesasMes:i,tendencia:d[0]?.saldo>=0?"positiva":"negativa",categoriasMaioresGastos:n.slice(0,3)}}}catch(n){throw n}}};t(l,"_cache",new Map),t(l,"_cacheTimeout",3e5);let c=l;function g(e,{year:t,month:a}={}){try{let r=function(){const e=u?.value||"__all__",t=parseFloat(y?.value||"0")||0,a=parseFloat(b?.value||"")||0;let r=o;if("__all__"!==e&&(r=r.filter(t=>t.event===e)),r=r.filter(e=>"number"!=typeof e.durationMs||e.durationMs>=t),a>0){const e=Date.now()-6e4*a;r=r.filter(t=>("number"==typeof t.ts?t.ts:0)>=e)}return r},n=function(){const e=r(),t=e.filter(e=>"number"==typeof e.durationMs).slice(0,20),a=t.map(e=>e.durationMs||0).sort((e,t)=>e-t),n=t.length?a.reduce((e,t)=>e+t,0)/t.length:0,s=a.length?Math.ceil(.95*a.length)-1:-1,d=s>=0?a[s]:0;x.textContent=String(e.length),m.textContent=`${n.toFixed(1)} ms`,m.className="text-2xl font-bold "+(n>50?"text-red-600":"text-green-600"),p&&(p.textContent=`${d.toFixed(1)} ms`,p.className="text-2xl font-bold "+(d>120?"text-red-600":"text-amber-600"));const o=e.slice(0,$);v.innerHTML=o.map(e=>{const t=new Date(e.ts).toLocaleTimeString("pt-BR");return`<tr class="border-t border-gray-100 dark:border-gray-800">\n          <td class="py-2 pr-4 text-gray-900 dark:text-gray-100">${e.event}</td>\n          <td class="py-2 pr-4 ${e.durationMs>50?"text-red-600":"text-gray-700 dark:text-gray-300"}">${(e.durationMs||0).toFixed(1)} ms</td>\n          <td class="py-2 text-gray-500 dark:text-gray-400">${t}</td>\n        </tr>`}).join(""),k&&(k.style.display=e.length>$?"":"none")},s=function(e){const t=e=>'"'+String(e??"").replaceAll('"','""')+'"';return["ts,event,durationMs,meta"].concat(e.map(e=>{const{ts:a,event:r,durationMs:n,...s}=e||{},d=Object.keys(s).length?JSON.stringify(s):"";return[a,r,n??""].map(t).concat(t(d)).join(",")})).join("\r\n")},d=function(){const e=r(),n=s(e);try{window.__lastExportCsv=n}catch{}try{const e=new Blob(["\ufeff"+n],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(e),s=document.createElement("a");s.href=r,s.download=`telemetria_${t||(new Date).getFullYear()}-${String(a||(new Date).getMonth()+1).padStart(2,"0")}.csv`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}catch{}};if(!i?.isEnabled||!i.isEnabled())return;const o=i.getLog&&i.getLog()||[],l=Array.from(new Set(o.map(e=>e.event))).filter(Boolean).sort(),c=document.createElement("div");c.className="mb-8",c.innerHTML=`\n      <div class="flex items-center gap-2 mb-4">\n        <div class="w-1 h-6 bg-gradient-to-b from-gray-500 to-gray-700 rounded-full"></div>\n        <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">⏱️ Telemetria Local</h2>\n      </div>\n      <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">\n        <div class="p-4 flex flex-col md:flex-row md:items-end gap-3 border-b border-gray-200 dark:border-gray-700">\n          <label class="text-sm text-gray-700 dark:text-gray-300">\n            Evento\n            <select id="telem-event-filter" data-testid="telem-event-filter" class="ml-2 p-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">\n              <option value="__all__">Todos</option>\n              ${l.map(e=>`<option value="${e}">${e}</option>`).join("")}\n            </select>\n          </label>\n          <label class="text-sm text-gray-700 dark:text-gray-300">\n            Min ms\n            <input id="telem-min-duration" data-testid="telem-min-duration" type="number" min="0" step="1" value="0" class="ml-2 w-24 p-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800" />\n          </label>\n          <label class="text-sm text-gray-700 dark:text-gray-300">\n            Últimos (min)\n            <input id="telem-last-min" data-testid="telem-last-min" type="number" min="0" step="1" value="" placeholder="todos" class="ml-2 w-28 p-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800" />\n          </label>\n          <div class="flex-1"></div>\n          <button id="telem-clear" class="btn btn-outline btn-sm">Limpar</button>\n          <button id="telem-export" data-testid="telem-export" class="btn btn-primary btn-sm">Exportar CSV</button>\n          <button id="telem-copy" data-testid="telem-copy" class="btn btn-primary btn-sm">Copiar CSV</button>\n        </div>\n        <div class="p-4 grid grid-cols-2 md:grid-cols-5 gap-4">\n          <div class="text-center">\n            <div class="text-sm text-gray-500 dark:text-gray-400">Eventos</div>\n            <div id="telem-count" class="text-2xl font-bold text-gray-900 dark:text-gray-100">${o.length}</div>\n          </div>\n          <div class="text-center">\n            <div class="text-sm text-gray-500 dark:text-gray-400">Média recente</div>\n            <div id="telem-avg" class="text-2xl font-bold text-green-600">0.0 ms</div>\n          </div>\n          <div class="text-center">\n            <div class="text-sm text-gray-500 dark:text-gray-400">p95 recente</div>\n            <div id="telem-p95" class="text-2xl font-bold text-amber-600">0.0 ms</div>\n          </div>\n          <div class="text-center col-span-2 hidden md:block">\n            <div class="text-sm text-gray-500 dark:text-gray-400">Período selecionado</div>\n            <div class="text-lg font-semibold text-gray-900 dark:text-gray-100">${String(a||(new Date).getMonth()+1).padStart(2,"0")}/${t||(new Date).getFullYear()}</div>\n          </div>\n        </div>\n        <div class="px-4 pb-4 overflow-x-auto">\n          <table class="min-w-full text-xs md:text-sm">\n            <thead>\n              <tr class="text-left text-gray-500 dark:text-gray-400">\n                <th class="py-2 pr-4">Evento</th>\n                <th class="py-2 pr-4">Duração</th>\n                <th class="py-2">Quando</th>\n              </tr>\n            </thead>\n            <tbody id="telem-tbody"></tbody>\n          </table>\n          <div class="mt-3">\n            <button id="telem-more" data-testid="telem-more" class="btn btn-outline btn-sm">Mostrar mais</button>\n          </div>\n        </div>\n      </div>\n    `,e.appendChild(c);const g=e=>c.querySelector(e),v=g("#telem-tbody"),x=g("#telem-count"),m=g("#telem-avg"),p=g("#telem-p95"),u=g("#telem-event-filter"),y=g("#telem-min-duration"),b=g("#telem-last-min"),f=g("#telem-clear"),h=g("#telem-export"),w=g("#telem-copy"),k=g("#telem-more");let $=8;async function M(){const e=r(),t=s(e);try{window.__lastExportCsv=t}catch{}try{if(navigator?.clipboard?.writeText){await navigator.clipboard.writeText(t);try{window.__csvCopied=!0}catch{}}}catch{}}u?.addEventListener("change",n),y?.addEventListener("input",n),f?.addEventListener("click",()=>{u&&(u.value="__all__"),y&&(y.value="0"),b&&(b.value=""),$=8,n()}),h?.addEventListener("click",d),w?.addEventListener("click",M),b?.addEventListener("input",()=>{$=8,n()}),k?.addEventListener("click",()=>{$+=8,n()}),n()}catch{}}window.Analytics=c;class v{static async render(e){const t=document.createElement("div");try{const e=window?.matchMedia&&window.matchMedia("(max-width: 480px)").matches;t.className="analytics-page"+(e?" analytics-compact":"")}catch{t.className="analytics-page"}const a=document.createElement("div");a.className="flex justify-center items-center py-12",a.innerHTML='\n      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>\n    ',t.appendChild(a);try{const n=e||window?.appState?.currentBudget?.id;if(!n){t.contains(a)&&t.removeChild(a);const e=document.createElement("div");return e.className="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6",e.innerHTML='\n          <div class="flex items-start gap-3">\n            <div class="text-2xl">📌</div>\n            <div>\n              <div class="font-semibold text-gray-900 dark:text-gray-100 mb-1">Nenhum orçamento ativo</div>\n              <div class="text-sm text-gray-700 dark:text-gray-300">Entre em um orçamento nas Configurações para visualizar as análises.</div>\n              <div class="mt-4 flex gap-2">\n                <button class="btn btn-primary" onclick="window.location.hash = \'#/settings\'">Ir para Configurações</button>\n                <button class="btn btn-outline" onclick="window.location.hash = \'#/dashboard\'">Voltar ao Dashboard</button>\n              </div>\n            </div>\n          </div>',t.appendChild(e),t}const s=n,d="function"==typeof o?o():{year:window.appState?.selectedYear||(new Date).getFullYear(),month:window.appState?.selectedMonth||(new Date).getMonth()+1},i=d.year,l=d.month,v=new Date(i,l-1,1),x=new Date(i,l,0),m=await c.gerarRelatorioCompleto(s,v,x);t.contains(a)&&t.removeChild(a);const p=!(m&&(0!==Number(m?.resumo?.receitasMes||0)||0!==Number(m?.resumo?.despesasMes||0)||Array.isArray(m?.evolucaoSaldo)&&0!==m.evolucaoSaldo.length||Array.isArray(m?.gastosPorCategoria)&&0!==m.gastosPorCategoria.length));if(t.innerHTML='\n        <div class="tab-container">\n          <div class="tab-header">\n            <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-sm border border-gray-200 dark:border-gray-600">\n              <div class="flex items-center justify-between w-full gap-4">\n                <div class="flex items-center gap-3">\n                  <div class="flex items-center gap-2">\n                    <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center">\n                      <span class="text-white text-sm">📊</span>\n                    </div>\n                    <div>\n                      <h1 class="text-2xl font-semibold text-gray-900 leading-tight">Análises</h1>\n                      <div class="flex items-center gap-1">\n                        <span class="text-purple-600 dark:text-purple-400 text-xs">Inteligente</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div id="analytics-period-indicator"></div>\n              </div>\n            </div>\n          </div>\n          <div class="tab-content">\n            <div class="content-spacing">\n              <div id="analytics-sections"></div>\n            </div>\n          </div>\n        </div>\n      ',p){const e=t.querySelector("#analytics-sections")||t,a=document.createElement("div");return a.className="empty-state",a.innerHTML='\n          <div class="empty-icon">📊</div>\n          <div class="empty-text">Sem dados para este período</div>\n          <div class="empty-description">Registre sua primeira transação para ver gráficos e tendências.</div>\n          <div class="mt-2"><button class="btn btn-primary" onclick="window.showAddTransactionModal && window.showAddTransactionModal()">Adicionar primeira transação</button></div>\n        ',e.appendChild(a),t}const u=document.createElement("div");u.className="mb-4";const y=m.evolucaoSaldo&&m.evolucaoSaldo.length>1?m.resumo.saldoAtual-m.evolucaoSaldo[1].saldo:null;u.innerHTML=`\n        <div class="flex items-center gap-2 mb-4">\n          <div class="w-1 h-6 bg-gradient-to-b from-blue-500 to-purple-600 rounded-full"></div>\n          <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">📊 Resumo</h2>\n        </div>\n        \n        <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-800 dark:via-gray-700 dark:to-gray-800 rounded-2xl shadow-lg border border-blue-200 dark:border-gray-600 p-4 mb-6">\n          \x3c!-- Header Compacto --\x3e\n          <div class="flex items-center justify-between mb-4 gap-4">\n            <div>\n              <h3 class="text-lg font-bold text-gray-800 dark:text-gray-200 flex items-center gap-2">\n                <span class="text-xl">📊</span>\n                Análises Financeiras\n              </h3>\n              <p class="text-sm text-gray-600 dark:text-gray-400">Período: ${String(l).padStart(2,"0")}/${i}</p>\n            </div>\n            <div class="text-right">\n              <div class="text-lg font-bold ${m.resumo.saldoAtual>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}">\n                R$ ${m.resumo.saldoAtual.toFixed(2)}\n              </div>\n              <p class="text-xs text-gray-500 dark:text-gray-400">Saldo</p>\n            </div>\n          </div>\n          \n          \x3c!-- Métricas Compactas --\x3e\n          <div class="grid grid-cols-3 gap-3 mb-4">\n            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center shadow-sm border border-gray-200 dark:border-gray-600">\n              <div class="text-lg mb-1">📈</div>\n              <div class="text-lg font-bold text-green-600 dark:text-green-400">R$ ${m.resumo.receitasMes.toFixed(2)}</div>\n              <div class="text-xs text-gray-600 dark:text-gray-400">Receitas</div>\n            </div>\n            \n            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center shadow-sm border border-gray-200 dark:border-gray-600">\n              <div class="text-lg mb-1">📉</div>\n              <div class="text-lg font-bold text-red-600 dark:text-red-400">R$ ${m.resumo.despesasMes.toFixed(2)}</div>\n              <div class="text-xs text-gray-600 dark:text-gray-400">Despesas</div>\n            </div>\n            \n            <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center shadow-sm border border-gray-200 dark:border-gray-600">\n              <div class="text-lg mb-1">📊</div>\n              <div class="text-lg font-bold ${"positiva"===m.resumo.tendencia?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}">\n                ${"positiva"===m.resumo.tendencia?"↗":"↘"}\n              </div>\n              <div class="text-xs text-gray-600 dark:text-gray-400">Tendência</div>\n            </div>\n          </div>\n\n          \x3c!-- Resumo Financeiro Compacto --\x3e\n          <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border border-gray-200 dark:border-gray-600">\n            <h5 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-1">\n              <span>📈</span>\n              Resumo Financeiro\n            </h5>\n            <div class="space-y-1">\n              <div class="flex justify-between text-xs">\n                <span class="text-gray-600 dark:text-gray-400">Receitas:</span>\n                <span class="font-medium text-green-600 dark:text-green-400">R$ ${m.resumo.receitasMes.toFixed(2)}</span>\n              </div>\n              <div class="flex justify-between text-xs">\n                <span class="text-gray-600 dark:text-gray-400">Despesas:</span>\n                <span class="font-medium text-red-600 dark:text-red-400">R$ ${m.resumo.despesasMes.toFixed(2)}</span>\n              </div>\n              <div class="flex justify-between text-xs border-t border-gray-200 dark:border-gray-600 pt-1">\n                <span class="text-gray-600 dark:text-gray-400">Saldo:</span>\n                <span class="font-bold ${m.resumo.saldoAtual>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}">\n                  R$ ${m.resumo.saldoAtual.toFixed(2)}\n                </span>\n              </div>\n              ${null!==y?`\n                <div class="flex justify-between text-xs border-t border-gray-200 dark:border-gray-600 pt-1">\n                  <span class="text-gray-600 dark:text-gray-400">vs Mês Anterior:</span>\n                  <span class="font-medium ${y>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}">\n                    ${y>=0?"+":""}R$ ${Math.abs(y).toFixed(2)}\n                  </span>\n                </div>\n              `:""}\n            </div>\n          </div>\n        </div>\n      `;const b=t.querySelector("#analytics-sections")||t;b.appendChild(u);const f=document.createElement("button");f.id="analytics-advanced-toggle",f.className="btn btn-outline btn-sm w-full mt-4",f.textContent="Mostrar análises avançadas",b.appendChild(f);const h=document.createElement("div");h.id="analytics-advanced";try{const e="undefined"!=typeof localStorage?localStorage.getItem("analytics.advancedVisible"):null;e&&"1"===e||h.classList.add("hidden")}catch{h.classList.add("hidden")}b.appendChild(h);try{const e=e=>{const t=parseFloat(String(e??"").toString().replace(",","."));return isNaN(t)?0:t};let t=0;const a=window?.appState?.currentBudget||null;a&&e(a.valorTotal)>0?t=e(a.valorTotal):Array.isArray(window?.appState?.categories)&&(t=(window.appState.categories||[]).filter(e=>e&&"despesa"===(e.tipo||"despesa")).reduce((t,a)=>t+(e(a.limite)>0?e(a.limite):0),0));const r=e(m?.resumo?.despesasMes||0);if(t>0&&r>=0){const e=Math.max(0,Math.min(100,r/t*100)),a=new Date,n=i===a.getFullYear()&&l===a.getMonth()+1,s=new Date(i,l,0).getDate(),d=n?a.getDate():s,o=n?Math.min(100,d/s*100):100,c=t*o/100,g=c>0?r/c:0,v=g<=1.05?"ok":g<=1.2?"warn":"bad",x=96,m=42,p=2*Math.PI*m,u=e/100*p,y=document.createElement("div");y.className="mb-8",y.innerHTML=`\n            <div class="flex items-center gap-2 mb-4">\n              <div class="w-1 h-6 bg-gradient-to-b from-teal-500 to-emerald-500 rounded-full"></div>\n              <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">🏁 Progresso do Mês</h2>\n            </div>\n            <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">\n              <div class="p-4 md:p-6 grid grid-cols-1 md:grid-cols-3 gap-6 items-center">\n                \x3c!-- Donut --\x3e\n                <div class="flex justify-center">\n                  <svg width="${x}" height="${x}" viewBox="0 0 100 100" class="-rotate-90">\n                    <circle cx="50" cy="50" r="${m}" stroke="var(--tw-prose-borders, #e5e7eb)" stroke-width="12" fill="none" class="text-gray-200 dark:text-gray-700"></circle>\n                    <circle cx="50" cy="50" r="${m}" stroke="${e>100?"#ef4444":"#10b981"}" stroke-width="12" stroke-linecap="round" fill="none"\n                      stroke-dasharray="${u} ${p}" />\n                  </svg>\n                  <div class="absolute mt-10 md:mt-0 md:static -rotate-90 md:rotate-0"></div>\n                </div>\n                \n                \x3c!-- KPIs --\x3e\n                <div class="md:col-span-2 grid grid-cols-2 sm:grid-cols-4 gap-4">\n                  <div class="u-card p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">\n                    <div class="text-xs text-gray-500 dark:text-gray-400">Orçado</div>\n                    <div class="text-lg font-bold text-gray-900 dark:text-gray-100">R$ ${t.toFixed(2)}</div>\n                  </div>\n                  <div class="u-card p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">\n                    <div class="text-xs text-gray-500 dark:text-gray-400">Gasto no mês</div>\n                    <div class="text-lg font-bold ${r>t?"text-red-600":"text-gray-900 dark:text-gray-100"}">R$ ${r.toFixed(2)}</div>\n                  </div>\n                  <div class="u-card p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">\n                    <div class="text-xs text-gray-500 dark:text-gray-400">Progresso</div>\n                    <div class="text-lg font-bold ${e>100?"text-red-600":e>90?"text-yellow-600":"text-green-600"}">${e.toFixed(1)}%</div>\n                  </div>\n                  <div class="u-card p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">\n                    <div class="text-xs text-gray-500 dark:text-gray-400">Burn rate ${n?"(até hoje)":"(final)"}</div>\n                    <div class="text-lg font-bold ${"ok"===v?"text-green-600":"warn"===v?"text-yellow-600":"text-red-600"}">${(100*g).toFixed(0)}%</div>\n                  </div>\n                </div>\n                \n                <div class="md:col-span-3 text-xs text-gray-500 dark:text-gray-400">${n?`Você consumiu <span class="font-medium text-gray-900 dark:text-gray-100">${e.toFixed(1)}%</span> do orçamento. O esperado para hoje seria <span class="font-medium">${o.toFixed(1)}%</span>.`:`Resumo do mês selecionado: consumo total de <span class="font-medium">${e.toFixed(1)}%</span> do orçamento.`}</div>\n              </div>\n            </div>\n          `,b.appendChild(y)}}catch(r){}const w=document.createElement("div");w.className="mb-8",w.innerHTML='\n        <div class="flex items-center gap-2 mb-4">\n          <div class="w-1 h-6 bg-gradient-to-b from-green-500 to-teal-500 rounded-full"></div>\n          <h2 class="text-2xl font-semibold text-gray-900 leading-tight">📊 Gráficos & Análises</h2>\n        </div>\n        \n        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">\n          \x3c!-- Gráfico de Evolução --\x3e\n          <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">\n            <div class="bg-gradient-to-r from-green-50 to-teal-50 dark:from-gray-800 dark:to-gray-800 p-4 border-b border-gray-200 dark:border-gray-700">\n              <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100">📈 Evolução do Saldo</h3>\n            </div>\n            <div class="p-4" id="evolucao-chart">\n              <div class="flex justify-center items-center py-8">\n                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"></div>\n              </div>\n            </div>\n          </div>\n          \n          \x3c!-- Gráfico de Categorias --\x3e\n          <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">\n            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-800 p-4 border-b border-gray-200 dark:border-gray-700">\n              <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100">🎯 Gastos por Categoria</h3>\n            </div>\n            <div class="p-4" id="categorias-chart">\n              <div class="flex justify-center items-center py-8">\n                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      ',h.appendChild(w);const k=document.createElement("div");k.className="mb-8",k.innerHTML=`\n        <div class="flex items-center gap-2 mb-4">\n          <div class="w-1 h-6 bg-gradient-to-b from-purple-500 to-pink-500 rounded-full"></div>\n          <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">🔮 Previsões & Tendências</h2>\n        </div>\n        \n        <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">\n          <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-800 p-4 border-b border-gray-200 dark:border-gray-700">\n            <div class="flex justify-between items-center gap-4">\n              <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100">📅 Previsão para os Próximos Meses</h3>\n              <div class="text-xs text-gray-500 dark:text-gray-400 bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded-full">\n                IA Predict\n              </div>\n            </div>\n          </div>\n          \n          <div class="p-4">\n            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">\n              ${m.previsaoGastos.slice(0,4).map((e,t)=>`\n                <div class="bg-gradient-to-br ${0===t?"from-purple-500 to-pink-500":1===t?"from-blue-500 to-indigo-500":2===t?"from-green-500 to-teal-500":"from-orange-500 to-red-500"} rounded-xl p-4 text-white">\n                  <div class="text-center">\n                    <div class="text-lg font-bold mb-1">${e.nome} ${e.ano}</div>\n                    <div class="text-2xl font-bold mb-2">R$ ${e.saldo.toFixed(2)}</div>\n                    <div class="text-xs opacity-90">Saldo Previsto</div>\n                    <div class="flex justify-between text-xs mt-2">\n                      <span>📈 R$ ${e.receitas.toFixed(2)}</span>\n                      <span>📉 R$ ${e.despesas.toFixed(2)}</span>\n                    </div>\n                  </div>\n                </div>\n              `).join("")}\n            </div>\n            \n            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4">\n              <div class="flex items-center gap-2 mb-2">\n                <div class="w-2 h-2 bg-purple-500 rounded-full"></div>\n                <span class="text-sm font-medium text-gray-900 dark:text-gray-100">Metodologia de Previsão</span>\n              </div>\n              <p class="text-xs text-gray-600 dark:text-gray-400">\n                Baseada na média dos últimos 3 meses com tendência de crescimento de 1% ao mês, \n                considerando sazonalidade e padrões históricos.\n              </p>\n            </div>\n          </div>\n        </div>\n      `,h.appendChild(k),g(h,{year:i,month:l});try{const e=(await c.fetchTransactionsForPeriod(s,v,x)||[]).filter(e=>"despesa"===(e?.tipo||"despesa")),t=Array.isArray(window?.appState?.categories)?window.appState.categories:[],a=new Map(t.map(e=>[e.id,e])),r=e=>{try{return new Date(e).toLocaleDateString("pt-BR")}catch{return""}},n=e.map(e=>({...e,_date:c.txToDate(e),_cat:a.get(e.categoriaId)||e.categoria||null,_valor:parseFloat(e.valor||0)}));n.sort((e,t)=>(t._valor||0)-(e._valor||0));const d=n.slice(0,5);if(d.length){const e=document.createElement("div");e.className="mb-8",e.innerHTML=`\n            <div class="flex items-center gap-2 mb-4">\n              <div class="w-1 h-6 bg-gradient-to-b from-rose-500 to-red-500 rounded-full"></div>\n              <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">📌 Maiores Transações (mês)</h2>\n            </div>\n            <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">\n              <div class="divide-y divide-gray-100 dark:divide-gray-800">\n                ${d.map(e=>`\n                  <div class="p-4 flex items-center justify-between gap-4 hover:bg-gray-50 dark:hover:bg-gray-800">\n                    <div class="flex items-center gap-3 min-w-0">\n                      <div class="w-9 h-9 rounded-full flex items-center justify-center text-sm font-bold text-white" style="background-color: ${e._cat?.cor||"#EF4444"}">\n                        ${(e._cat?.nome||"?").slice(0,1).toUpperCase()}\n                      </div>\n                      <div class="min-w-0">\n                        <div class="font-medium text-gray-900 dark:text-gray-100 truncate">${e.descricao||e.titulo||e._cat?.nome||"Despesa"}</div>\n                        <div class="text-xs text-gray-500 dark:text-gray-400 truncate">${r(e._date)} • ${e._cat?.nome||"Sem categoria"}</div>\n                      </div>\n                    </div>\n                    <div class="text-right">\n                      <div class="font-bold text-red-600">R$ ${(e._valor||0).toFixed(2)}</div>\n                      <a href="#/transactions" class="text-xs text-indigo-600 hover:underline">ver no extrato</a>\n                    </div>\n                  </div>\n                `).join("")}\n              </div>\n            </div>\n          `,b.appendChild(e)}}catch{}try{const e=Array.isArray(window?.appState?.categories)?window.appState.categories:[],t=new Map(e.map(e=>[e.id,parseFloat(e.limite||0)])),a=(m.gastosPorCategoria||[]).map(e=>{const a=t.get(e?.categoria?.id)||0,r=parseFloat(e.totalGasto||0),n=a>0?r/a*100:0;return{nome:e?.categoria?.nome||"Categoria",cor:e?.categoria?.cor||"#F59E0B",gasto:r,lim:a,pct:n}}).filter(e=>e.lim>0&&e.pct>=90).sort((e,t)=>t.pct-e.pct);if(a.length){const e=document.createElement("div");e.className="mb-8",e.innerHTML=`\n            <div class="flex items-center gap-2 mb-4">\n              <div class="w-1 h-6 bg-gradient-to-b from-amber-500 to-orange-500 rounded-full"></div>\n              <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">🚨 Categorias em Alerta</h2>\n            </div>\n            <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">\n              <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">\n                ${a.slice(0,6).map(e=>`\n                  <div class="p-4 rounded-xl border border-gray-100 dark:border-gray-800 bg-gray-50 dark:bg-gray-800">\n                    <div class="flex items-center justify-between gap-4">\n                      <div class="flex items-center gap-3">\n                        <div class="w-3 h-3 rounded-full" style="background-color:${e.cor}"></div>\n                        <div>\n                          <div class="font-medium text-gray-900 dark:text-gray-100">${e.nome}</div>\n                          <div class="text-xs text-gray-500 dark:text-gray-400">Limite: R$ ${e.lim.toFixed(2)}</div>\n                        </div>\n                      </div>\n                      <div class="text-sm font-bold ${e.pct>=100?"text-red-600":"text-amber-600"}">${Math.min(e.pct,999).toFixed(1)}%</div>\n                    </div>\n                    <div class="mt-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">\n                      <div class="h-2 rounded-full ${e.pct>=100?"bg-red-500":"bg-amber-500"}" style="width:${Math.min(e.pct,100)}%"></div>\n                    </div>\n                    <div class="mt-1 text-xs text-gray-600 dark:text-gray-400">Gasto: R$ ${e.gasto.toFixed(2)}</div>\n                  </div>\n                `).join("")}\n              </div>\n            </div>\n          `,b.appendChild(e)}}catch{}const $=document.createElement("div");$.className="mb-8",$.innerHTML=`\n        <div class="flex items-center gap-2 mb-4">\n          <div class="w-1 h-6 bg-gradient-to-b from-orange-500 to-red-500 rounded-full"></div>\n          <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">🎯 Análise Detalhada</h2>\n        </div>\n        \n        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">\n          \x3c!-- Maiores Gastos por Categoria --\x3e\n          <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">\n            <div class="bg-gradient-to-r from-orange-50 to-red-50 dark:from-gray-800 dark:to-gray-800 p-4 border-b border-gray-200 dark:border-gray-700">\n              <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100">🔥 Maiores Gastos</h3>\n            </div>\n            <div class="p-4">\n              <div class="space-y-4">\n                ${m.gastosPorCategoria.slice(0,5).map((e,t)=>`\n                  <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200">\n                    <div class="flex items-center gap-3">\n                      <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-white" style="background-color: ${e.categoria.cor||"#4F46E5"}">\n                        ${t+1}\n                      </div>\n                      <div>\n                        <div class="font-medium text-gray-900 dark:text-gray-100">${e.categoria.nome}</div>\n                        <div class="text-sm text-gray-500 dark:text-gray-400">${e.percentual.toFixed(1)}% do total</div>\n                      </div>\n                    </div>\n                    <div class="text-right">\n                      <div class="font-bold text-gray-900 dark:text-gray-100">R$ ${e.totalGasto.toFixed(2)}</div>\n                      <div class="w-20 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-1">\n                        <div class="h-2 rounded-full" style="width: ${e.percentual}%; background-color: ${e.categoria.cor||"#4F46E5"}"></div>\n                      </div>\n                    </div>\n                  </div>\n                `).join("")}\n              </div>\n            </div>\n          </div>\n          \n          \x3c!-- Insights e Recomendações --\x3e\n          <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden">\n            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-800 p-4 border-b border-gray-200 dark:border-gray-700">\n              <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100">💡 Insights & Recomendações</h3>\n            </div>\n            <div class="p-4">\n              <div class="space-y-4">\n                ${function(e){const t=[];e.resumo.saldoAtual>=0?t.push({type:"positive",icon:"✅",title:"Saldo Positivo",description:"Seu saldo está positivo! Continue mantendo essa disciplina financeira."}):t.push({type:"warning",icon:"⚠️",title:"Saldo Negativo",description:"Seu saldo está negativo. Considere reduzir despesas ou aumentar receitas."});"positiva"===e.resumo.tendencia?t.push({type:"positive",icon:"📈",title:"Tendência Positiva",description:"Sua situação financeira está melhorando! Mantenha o foco."}):t.push({type:"warning",icon:"📉",title:"Tendência Negativa",description:"Sua situação financeira está piorando. Revise seus gastos."});if(e.gastosPorCategoria.length>0){const a=e.gastosPorCategoria[0];a.percentual>30&&t.push({type:"warning",icon:"🔥",title:"Gasto Concentrado",description:`${a.categoria.nome} representa ${a.percentual.toFixed(1)}% dos seus gastos. Considere diversificar.`})}if(e.evolucaoSaldo.length>1){const a=e.resumo.saldoAtual-e.evolucaoSaldo[1].saldo;a>0?t.push({type:"positive",icon:"🎯",title:"Melhoria Mensal",description:`Seu saldo melhorou R$ ${a.toFixed(2)} em relação ao mês anterior.`}):t.push({type:"warning",icon:"📊",title:"Redução Mensal",description:`Seu saldo diminuiu R$ ${Math.abs(a).toFixed(2)} em relação ao mês anterior.`})}if(e.previsaoGastos.length>0){e.previsaoGastos[0].saldo<0?t.push({type:"warning",icon:"🔮",title:"Previsão Negativa",description:"Para o próximo mês, a previsão indica saldo negativo. Planeje com antecedência."}):t.push({type:"positive",icon:"🔮",title:"Previsão Positiva",description:"Para o próximo mês, a previsão indica saldo positivo. Continue assim!"})}if(e.gastosPorCategoria.length>0){e.gastosPorCategoria.slice(0,3).reduce((e,t)=>e+t.percentual,0)>70&&t.push({type:"info",icon:"💡",title:"Gastos Concentrados",description:"As 3 maiores categorias representam mais de 70% dos seus gastos. Considere diversificar."})}return t.slice(0,4)}(m).map(e=>`\n                  <div class="bg-gradient-to-r ${"positive"===e.type?"from-green-50 to-emerald-50 dark:from-green-900 dark:to-emerald-900":"warning"===e.type?"from-yellow-50 to-orange-50 dark:from-yellow-900 dark:to-orange-900":"from-blue-50 to-indigo-50 dark:from-blue-900 dark:to-indigo-900"} border ${"positive"===e.type?"border-green-200 dark:border-green-800":"warning"===e.type?"border-yellow-200 dark:border-yellow-800":"border-blue-200 dark:border-blue-800"} rounded-xl p-4">\n                    <div class="flex items-start gap-3">\n                      <div class="text-2xl">${e.icon}</div>\n                      <div>\n                        <div class="font-medium text-gray-900 dark:text-gray-100 mb-1">${e.title}</div>\n                        <div class="text-sm text-gray-600 dark:text-gray-400">${e.description}</div>\n                      </div>\n                    </div>\n                  </div>\n                `).join("")}\n              </div>\n            </div>\n          </div>\n        </div>\n      `,h.appendChild($);const M=(e=1,t=5)=>{const a=document.getElementById("evolucao-chart"),r=document.getElementById("categorias-chart");if(a&&r)try{if(m.evolucaoSaldo&&m.evolucaoSaldo.length>0){const e=[...m.evolucaoSaldo];m.previsaoGastos&&m.previsaoGastos.length>0&&e.push(...m.previsaoGastos),c.renderizarGraficoEvolucao("evolucao-chart",e)}m.gastosPorCategoria&&m.gastosPorCategoria.length>0&&c.renderizarGraficoCategorias("categorias-chart",m.gastosPorCategoria)}catch(n){a&&(a.innerHTML=`\n                <div class="text-center py-8">\n                  <div class="text-4xl mb-4">📊</div>\n                  <p class="text-gray-500 dark:text-gray-400">Erro ao carregar gráfico</p>\n                  <p class="text-xs text-gray-400 mt-2">${n.message}</p>\n                </div>\n              `),r&&(r.innerHTML=`\n                <div class="text-center py-8">\n                  <div class="text-4xl mb-4">📊</div>\n                  <p class="text-gray-500 dark:text-gray-400">Erro ao carregar gráfico</p>\n                  <p class="text-xs text-gray-400 mt-2">${n.message}</p>\n                </div>\n              `)}else if(e<t)setTimeout(()=>M(e+1,t),100*e);else{const e=document.getElementById("evolucao-chart"),t=document.getElementById("categorias-chart");e&&(e.innerHTML='\n              <div class="text-center py-8">\n                <div class="text-4xl mb-4">⚠️</div>\n                <p class="text-gray-500 dark:text-gray-400">Elemento não encontrado</p>\n                <p class="text-xs text-gray-400 mt-2">Tente recarregar a página</p>\n              </div>\n            '),t&&(t.innerHTML='\n              <div class="text-center py-8">\n                <div class="text-4xl mb-4">⚠️</div>\n                <p class="text-gray-500 dark:text-gray-400">Elemento não encontrado</p>\n                <p class="text-xs text-gray-400 mt-2">Tente recarregar a página</p>\n              </div>\n            ')}};setTimeout(()=>M(),100);try{const e=t.querySelector("#analytics-advanced-toggle"),a=t.querySelector("#analytics-advanced");if(e&&a){const t=()=>{const t=a.classList.contains("hidden");e.textContent=t?"Mostrar análises avançadas":"Ocultar análises avançadas"};t(),e.addEventListener("click",()=>{a.classList.toggle("hidden"),t();try{localStorage.setItem("analytics.advancedVisible",a.classList.contains("hidden")?"0":"1")}catch{}})}}catch{}}catch(n){t.contains(a)&&t.removeChild(a);const e=document.createElement("div");e.className="bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded relative mb-6",e.innerHTML=`\n        <strong class="font-bold">Erro!</strong>\n        <span class="block sm:inline"> Não foi possível carregar os dados de análise. Tente novamente mais tarde.</span>\n        <p class="text-sm mt-2">${n.message}</p>\n      `,t.appendChild(e)}return t}}window.AnalyticsPage=v;export{v as AnalyticsPage,g as renderTelemetrySection};

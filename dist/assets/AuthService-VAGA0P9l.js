const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-BTanfOAJ.js","assets/vendor-7JQXQzuE.js","assets/main-Dc-JefT-.css"])))=>i.map(i=>d[i]);
import{G as t,z as e,a,S as o,_ as n,A as i,B as s,C as r,i as d}from"./main-BTanfOAJ.js";import"./vendor-7JQXQzuE.js";function c(){if(window.Capacitor&&window.Capacitor.isNativePlatform&&window.Capacitor.isNativePlatform())return;let r=document.getElementById("google-login-btn");const d=document.getElementById("demo-btn"),c=document.getElementById("guest-btn");if(r){try{const t=r.cloneNode(!0);r.replaceWith(t),r=document.getElementById("google-login-btn")}catch{}if("1"===r.dataset.bound)return;r.dataset.bound="1",r.style.pointerEvents="auto",r.disabled=!1,r.tabIndex=0,r.addEventListener("click",async s=>{try{s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation&&s.stopImmediatePropagation()}catch{}if(!window.Capacitor||!window.Capacitor.isNativePlatform())try{"function"==typeof window.showLoading&&window.showLoading(!0);const s=await async function(){try{const o=new t;o.addScope("profile"),o.addScope("email");const n=window.Capacitor?.isNativePlatform();if(n){localStorage.setItem("authInProgress","google"),localStorage.setItem("authTimestamp",Date.now().toString());const t=await e(a,o);return localStorage.removeItem("authInProgress"),localStorage.removeItem("authTimestamp"),t.user}return(await e(a,o)).user}catch(n){throw localStorage.removeItem("authInProgress"),localStorage.removeItem("authTimestamp"),"auth/cancelled-popup-request"===n.code?o({message:"Login cancelado. Tente novamente.",type:"info"}):"auth/popup-blocked"===n.code?o({message:"Popup bloqueado. Permita popups e tente novamente.",type:"error"}):"auth/popup-closed-by-user"===n.code?o({message:"Login cancelado pelo usuário.",type:"info"}):o({message:"Erro ao fazer login: "+n.message,type:"error"}),n}}();if(s){try{const{ensureUserProfile:t}=await n(async()=>{const{ensureUserProfile:t}=await import("./main-BTanfOAJ.js").then(t=>t.ad);return{ensureUserProfile:t}},__vite__mapDeps([0,1,2]));await t(s)}catch(r){}window.appState=window.appState||{},window.appState.currentUser=s,w(!1);try{const t=document.querySelector(".app-container");t&&(t.style.display="flex");const e=document.getElementById("loading-page");e&&(e.style.display="none");const a=document.getElementById("login-page");a&&(a.style.display="none");const o=document.getElementById("app-content");o&&!o.firstChild&&(o.innerHTML='<div style="padding:12px;color:#6b7280;">Carregando dashboard…</div>')}catch(d){}try{await i(s);try{window.dispatchEvent(new Event("auth:login-ui"))}catch{}}catch(c){}try{const{renderPage:t}=await n(async()=>{const{renderPage:t}=await import("./main-BTanfOAJ.js").then(t=>t.af);return{renderPage:t}},__vite__mapDeps([0,1,2]));window.location.hash="#/dashboard",await t("/dashboard")}catch{window.location.hash="#/dashboard"}}}catch(c){"function"==typeof window.showLoading&&window.showLoading(!1)}})}d&&"1"!==d.dataset.bound&&(d.dataset.bound="1",d.addEventListener("click",async t=>{try{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation()}catch{}const e=d;e.disabled=!0,e.classList.add("loading");try{"function"==typeof window.showLoading&&window.showLoading(!0);const t=(await s(a)).user;if(t){try{const{ensureUserProfile:e}=await n(async()=>{const{ensureUserProfile:t}=await import("./main-BTanfOAJ.js").then(t=>t.ad);return{ensureUserProfile:t}},__vite__mapDeps([0,1,2]));await e(t)}catch{}window.appState||(window.appState={}),window.appState.currentUser=t,w(!1),setTimeout(()=>{window.location.hash="#/dashboard"},100)}}catch(o){try{alert("Erro ao iniciar demonstração. Tente novamente.")}catch{}}finally{e.disabled=!1,e.classList.remove("loading"),"function"==typeof window.showLoading&&window.showLoading(!1)}})),c&&"1"!==c.dataset.bound&&(c.dataset.bound="1",c.addEventListener("click",async t=>{try{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation()}catch{}const e=c;e.disabled=!0,e.classList.add("loading");try{"function"==typeof window.showLoading&&window.showLoading(!0);const t=(await s(a)).user;if(t){try{const{ensureUserProfile:e}=await n(async()=>{const{ensureUserProfile:t}=await import("./main-BTanfOAJ.js").then(t=>t.ad);return{ensureUserProfile:t}},__vite__mapDeps([0,1,2]));await e(t)}catch{}window.appState||(window.appState={}),window.appState.currentUser=t,w(!1),setTimeout(()=>{window.location.hash="#/dashboard"},100)}}catch(o){try{alert("Erro no login. Tente novamente.")}catch{}}finally{e.disabled=!1,e.classList.remove("loading"),"function"==typeof window.showLoading&&window.showLoading(!1)}}))}function l(){return new Promise(t=>{let e=!0,o=!1;const n="google"===localStorage.getItem("authInProgress"),i=setTimeout(()=>{o||(o=!0,window.appState.currentUser=null,w(!0),t(!1))},n?1e4:3e3);r(a,a=>{o||(clearTimeout(i),o=!0),a?(window.appState=window.appState||{},window.appState.currentUser=a,w(!1),e?(e=!1,t(!0)):w(!1)):(window.appState=window.appState||{},window.appState.currentUser=null,"function"==typeof window.stopAllListeners&&window.stopAllListeners(),window.appState&&(window.appState.currentBudget=null,window.appState.transactions=[],window.appState.categories=[],window.appState.recorrentes=[],window.appState.notifications=[]),w(!0),e&&(e=!1,t(!1)))})})}async function p(){try{await d(a)}catch(t){}}function w(t){const e=document.getElementById("login-page"),a=document.getElementById("app-content"),o=document.querySelector(".app-container"),n=document.getElementById("loading-page");t?(e&&(e.style.display="flex",e.style.visibility="visible"),a&&(a.style.display="none"),o&&(o.style.display="none"),n&&(n.style.display="none")):(e&&(e.style.display="none",e.style.visibility="hidden"),n&&(n.style.display="none",n.style.visibility="hidden"),o&&(o.style.display="flex",o.style.visibility="visible"),a&&(a.style.display="block"),setTimeout(()=>{try{window.location.hash="#/dashboard"}catch(t){}},100))}window.toggleLoginPage=w;export{l as checkAuthState,p as logout,c as setupLoginButton,w as toggleLoginPage};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-BVWxnpqW.js","assets/main-DLXVHLmp.css","assets/notificationsRepo-BiEwFjPf.js"])))=>i.map(i=>d[i]);
import{_ as c,e as h}from"./main-BVWxnpqW.js";async function N(l,a,o){try{const{serverTimestamp:m}=await c(async()=>{const{serverTimestamp:t}=await import("./main-BVWxnpqW.js").then(s=>s.P);return{serverTimestamp:t}},__vite__mapDeps([0,1])),{getById:i}=await c(async()=>{const{getById:t}=await import("./main-BVWxnpqW.js").then(s=>s.S);return{getById:t}},__vite__mapDeps([0,1])),e=await i(l);if(!e){console.log("Orçamento não encontrado para notificação");return}if(!e.usuariosPermitidos||e.usuariosPermitidos.length===0){console.log("Orçamento não compartilhado, não enviando notificação");return}const w=await E(a),n=w?.displayName||w?.email||"Usuário";let d="Sem categoria",f=null,r=null;if(o.categoriaId){const{getById:t}=await c(async()=>{const{getById:p}=await import("./main-BVWxnpqW.js").then(I=>I.V);return{getById:p}},__vite__mapDeps([0,1])),s=await t(o.categoriaId);s&&(d=s.nome,f=s.tipo??null,r=s.limite??null)}const y={budgetId:l,budgetName:e.nome||"Orçamento",senderUid:a,senderName:n,transactionId:o.id,transactionDescricao:o.descricao,transactionValor:o.valor,transactionCategoria:d,transactionTipo:o.tipo||"despesa",transactionCategoriaTipo:f,transactionCategoriaLimite:r,recorrenteId:o.recorrenteId??null,recorrenteParcelaAtual:o.recorrenteParcelaAtual??null,recorrenteParcelasTotal:o.recorrenteParcelasTotal??null,createdAt:m(),read:!1,type:"new_transaction"},_=[...e.usuariosPermitidos||[]];e.criadoPor&&!_.includes(e.criadoPor)&&_.push(e.criadoPor);const u=_.filter((t,s)=>!!t&&_.indexOf(t)===s&&t!==a),{create:v}=await c(async()=>{const{create:t}=await import("./notificationsRepo-BiEwFjPf.js");return{create:t}},__vite__mapDeps([2,0,1])),g=u.map(async t=>{try{await v({...y,recipientUid:t}),console.log(`📧 Notificação enviada para usuário: ${t}`)}catch(s){console.error(`Erro ao enviar notificação para ${t}:`,s)}});await Promise.all(g),console.log("✅ Notificações enviadas com sucesso")}catch(m){console.error("Erro ao enviar notificações:",m)}}async function b(l,a,o){try{const{serverTimestamp:m}=await c(async()=>{const{serverTimestamp:t}=await import("./main-BVWxnpqW.js").then(s=>s.P);return{serverTimestamp:t}},__vite__mapDeps([0,1])),{getById:i}=await c(async()=>{const{getById:t}=await import("./main-BVWxnpqW.js").then(s=>s.S);return{getById:t}},__vite__mapDeps([0,1])),e=await i(l);if(!e){console.log("Orçamento não encontrado para notificação de exclusão");return}if(!e.usuariosPermitidos||e.usuariosPermitidos.length===0){console.log("Orçamento não compartilhado, não enviando notificação de exclusão");return}const w=await E(a),n=w?.displayName||w?.email||"Usuário";let d="Sem categoria",f=null,r=null;if(o?.categoriaId){const{getById:t}=await c(async()=>{const{getById:p}=await import("./main-BVWxnpqW.js").then(I=>I.V);return{getById:p}},__vite__mapDeps([0,1])),s=await t(o.categoriaId);s&&(d=s.nome,f=s.tipo??null,r=s.limite??null)}const y={budgetId:l,budgetName:e.nome||"Orçamento",senderUid:a,senderName:n,transactionId:o?.id,transactionDescricao:o?.descricao,transactionValor:o?.valor,transactionCategoria:d,transactionTipo:o?.tipo||"despesa",transactionCategoriaTipo:f,transactionCategoriaLimite:r,createdAt:m(),read:!1,type:"deleted_transaction"},_=[...e.usuariosPermitidos||[]];e.criadoPor&&!_.includes(e.criadoPor)&&_.push(e.criadoPor);const u=_.filter((t,s)=>!!t&&_.indexOf(t)===s&&t!==a),{create:v}=await c(async()=>{const{create:t}=await import("./notificationsRepo-BiEwFjPf.js");return{create:t}},__vite__mapDeps([2,0,1])),g=u.map(async t=>{try{await v({...y,recipientUid:t}),console.log(`📧 Notificação de exclusão enviada para usuário: ${t}`)}catch(s){console.error(`Erro ao enviar notificação de exclusão para ${t}:`,s)}});await Promise.all(g),console.log("✅ Notificações de exclusão enviadas com sucesso")}catch(m){console.error("Erro ao enviar notificações de exclusão:",m)}}async function O(l,a,o){try{const{serverTimestamp:m}=await c(async()=>{const{serverTimestamp:p}=await import("./main-BVWxnpqW.js").then(I=>I.P);return{serverTimestamp:p}},__vite__mapDeps([0,1])),{getById:i}=await c(async()=>{const{getById:p}=await import("./main-BVWxnpqW.js").then(I=>I.S);return{getById:p}},__vite__mapDeps([0,1])),e=await i(l);if(!e||!e.usuariosPermitidos||e.usuariosPermitidos.length===0)return;const w=await E(a),n=w?.displayName||w?.email||"Usuário";let d="Sem categoria",f=null,r=null,y=null;if(o?.categoriaId){const{getById:p}=await c(async()=>{const{getById:P}=await import("./main-BVWxnpqW.js").then(B=>B.V);return{getById:P}},__vite__mapDeps([0,1])),I=await p(o.categoriaId);I&&(d=I.nome,f=I.tipo??null,r=I.limite??null)}if(o?.prev?.categoriaId)try{const{getById:p}=await c(async()=>{const{getById:P}=await import("./main-BVWxnpqW.js").then(B=>B.V);return{getById:P}},__vite__mapDeps([0,1])),I=await p(o.prev.categoriaId);I?.nome&&(y=I.nome)}catch{}const _={},u=o?.changeSet||{};u.valor&&u.valor.from!==u.valor.to&&(_.valor={from:u.valor.from,to:u.valor.to}),u.descricao&&u.descricao.from!==u.descricao.to&&(_.descricao={from:u.descricao.from,to:u.descricao.to}),u.tipo&&u.tipo.from!==u.tipo.to&&(_.tipo={from:u.tipo.from,to:u.tipo.to}),u.categoriaId&&u.categoriaId.from!==u.categoriaId.to&&(_.categoria={from:y||o.prev?.categoriaId||null,to:d||u.categoriaId.to});const v={budgetId:l,budgetName:e.nome||"Orçamento",senderUid:a,senderName:n,transactionId:o?.id,transactionDescricao:o?.descricao,transactionValor:o?.valor,transactionCategoria:d,transactionTipo:o?.tipo||"despesa",transactionCategoriaTipo:f,transactionCategoriaLimite:r,changes:_,prev:o?.prev?{descricao:o.prev.descricao??null,valor:o.prev.valor??null,categoria:y??null,tipo:o.prev.tipo??null}:null,createdAt:m(),read:!1,type:"updated_transaction"},g=[...e.usuariosPermitidos||[]];e.criadoPor&&!g.includes(e.criadoPor)&&g.push(e.criadoPor);const t=g.filter((p,I)=>!!p&&g.indexOf(p)===I&&p!==a),{create:s}=await c(async()=>{const{create:p}=await import("./notificationsRepo-BiEwFjPf.js");return{create:p}},__vite__mapDeps([2,0,1]));await Promise.all(t.map(async p=>{try{await s({...v,recipientUid:p}),console.log(`📧 Notificação de atualização enviada para usuário: ${p}`)}catch(I){console.error(`Erro ao enviar notificação de atualização para ${p}:`,I)}}))}catch(m){console.error("Erro ao enviar notificações de atualização:",m)}}async function S(l,a,o,m,i=null){try{const{serverTimestamp:e}=await c(async()=>{const{serverTimestamp:g}=await import("./main-BVWxnpqW.js").then(t=>t.P);return{serverTimestamp:g}},__vite__mapDeps([0,1])),{getById:w}=await c(async()=>{const{getById:g}=await import("./main-BVWxnpqW.js").then(t=>t.S);return{getById:g}},__vite__mapDeps([0,1])),n=await w(l);if(!n||!n.usuariosPermitidos||n.usuariosPermitidos.length===0)return;const d=await E(a),f=d?.displayName||d?.email||"Usuário",r={};i&&(i.nome!==o?.nome&&(r.nome={from:i.nome??null,to:o?.nome??null}),i.tipo!==o?.tipo&&(r.tipo={from:i.tipo??null,to:o?.tipo??null}),i.limite!==o?.limite&&(r.limite={from:i.limite??null,to:o?.limite??null}));const y={budgetId:l,budgetName:n.nome||"Orçamento",senderUid:a,senderName:f,categoryId:o?.id,categoryNome:o?.nome,categoryTipo:o?.tipo,categoryLimite:o?.limite,changes:r,prev:i?{nome:i.nome??null,tipo:i.tipo??null,limite:i.limite??null}:null,createdAt:e(),read:!1,type:m},_=[...n.usuariosPermitidos||[]];n.criadoPor&&!_.includes(n.criadoPor)&&_.push(n.criadoPor);const u=_.filter((g,t)=>!!g&&_.indexOf(g)===t&&g!==a),{create:v}=await c(async()=>{const{create:g}=await import("./notificationsRepo-BiEwFjPf.js");return{create:g}},__vite__mapDeps([2,0,1]));await Promise.all(u.map(async g=>{try{await v({...y,recipientUid:g}),console.log(`📧 Notificação de categoria (${m}) enviada para usuário: ${g}`)}catch(t){console.error(`Erro ao enviar notificação de categoria para ${g}:`,t)}}))}catch(e){console.error("Erro ao enviar notificações de categoria:",e)}}async function A(l){try{const{updateDoc:a,doc:o,arrayRemove:m}=await c(async()=>{const{updateDoc:n,doc:d,arrayRemove:f}=await import("./main-BVWxnpqW.js").then(r=>r.P);return{updateDoc:n,doc:d,arrayRemove:f}},__vite__mapDeps([0,1])),{db:i}=await c(async()=>{const{db:n}=await import("./main-BVWxnpqW.js").then(d=>d.Q);return{db:n}},__vite__mapDeps([0,1])),e=window.appState.currentUser;if(!e){console.error("Usuário não autenticado");return}const w=o(i,"budgets",l);await a(w,{usuariosPermitidos:m(e.uid)}),console.log("✅ Usuário removido do orçamento compartilhado"),window.Snackbar&&window.Snackbar({message:"✅ Saída do orçamento realizada com sucesso",type:"success"})}catch(a){console.error("Erro ao sair do orçamento:",a),window.Snackbar&&window.Snackbar({message:"❌ Erro ao sair do orçamento",type:"error"})}}async function R(l,a){try{const{updateDoc:o,doc:m,arrayRemove:i}=await c(async()=>{const{updateDoc:d,doc:f,arrayRemove:r}=await import("./main-BVWxnpqW.js").then(y=>y.P);return{updateDoc:d,doc:f,arrayRemove:r}},__vite__mapDeps([0,1])),{db:e}=await c(async()=>{const{db:d}=await import("./main-BVWxnpqW.js").then(f=>f.Q);return{db:d}},__vite__mapDeps([0,1]));if(!window.appState.currentUser){console.error("Usuário não autenticado");return}const n=m(e,"budgets",l);await o(n,{usuariosPermitidos:i(a)}),console.log("✅ Usuário removido do orçamento compartilhado"),window.Snackbar&&window.Snackbar({message:"✅ Usuário removido com sucesso",type:"success"})}catch(o){console.error("Erro ao remover usuário:",o),window.Snackbar&&window.Snackbar({message:"❌ Erro ao remover usuário",type:"error"})}}async function E(l){try{const{getDoc:a,doc:o}=await c(async()=>{const{getDoc:e,doc:w}=await import("./main-BVWxnpqW.js").then(n=>n.P);return{getDoc:e,doc:w}},__vite__mapDeps([0,1])),{db:m}=await c(async()=>{const{db:e}=await import("./main-BVWxnpqW.js").then(w=>w.Q);return{db:e}},__vite__mapDeps([0,1])),i=await a(o(m,"users",l));return i.exists()?i.data():{displayName:"Usuário desconhecido",email:"email@desconhecido.com"}}catch(a){return console.error("Erro ao buscar informações do usuário:",a),{displayName:"Erro ao carregar",email:"erro@carregar.com"}}}async function V(l,a){try{const{serverTimestamp:o}=await c(async()=>{const{serverTimestamp:r}=await import("./main-BVWxnpqW.js").then(y=>y.P);return{serverTimestamp:r}},__vite__mapDeps([0,1])),{getById:m}=await c(async()=>{const{getById:r}=await import("./main-BVWxnpqW.js").then(y=>y.S);return{getById:r}},__vite__mapDeps([0,1])),{create:i}=await c(async()=>{const{create:r}=await import("./notificationsRepo-BiEwFjPf.js");return{create:r}},__vite__mapDeps([2,0,1])),e=await m(l);if(!e)throw new Error("Orçamento não encontrado");const w=e.criadoPor||e.userId;if(!w)throw new Error("Dono do orçamento não encontrado");const n=await E(a),d=n?.displayName||n?.email||"Usuário";if(w===a){try{window.Snackbar&&window.Snackbar.info?window.Snackbar.info("Você é o dono deste orçamento",2500):h.emit("snackbar:show",{message:"Você é o dono deste orçamento",type:"info",duration:2500})}catch{}return}const f={type:"test_notification",budgetId:l,budgetName:e.nome||"Orçamento",senderUid:a,senderName:d,message:"Mensagem de teste enviada para o dono do orçamento",createdAt:o(),read:!1,recipientUid:w};await i(f);try{window.Snackbar&&window.Snackbar.success?window.Snackbar.success("Notificação de teste enviada ao dono",2500):h.emit("snackbar:show",{message:"Notificação de teste enviada ao dono",type:"success",duration:2500})}catch{}}catch(o){console.error("Erro ao enviar notificação de teste (dono):",o);try{window.Snackbar&&window.Snackbar.error?window.Snackbar.error("Erro ao enviar teste para dono",2500):h.emit("snackbar:show",{message:"Erro ao enviar teste para dono",type:"error",duration:2500})}catch{}}}async function L(l,a){try{const{serverTimestamp:o}=await c(async()=>{const{serverTimestamp:r}=await import("./main-BVWxnpqW.js").then(y=>y.P);return{serverTimestamp:r}},__vite__mapDeps([0,1])),{getById:m}=await c(async()=>{const{getById:r}=await import("./main-BVWxnpqW.js").then(y=>y.S);return{getById:r}},__vite__mapDeps([0,1])),{create:i}=await c(async()=>{const{create:r}=await import("./notificationsRepo-BiEwFjPf.js");return{create:r}},__vite__mapDeps([2,0,1])),e=await m(l);if(!e)throw new Error("Orçamento não encontrado");const w=Array.isArray(e.usuariosPermitidos)?e.usuariosPermitidos.slice():[],n=Array.from(new Set(w.filter(Boolean))).filter(r=>r!==a);if(!n.length){try{window.Snackbar&&window.Snackbar.info?window.Snackbar.info("Nenhum usuário compartilhado para notificar",2500):h.emit("snackbar:show",{message:"Nenhum usuário compartilhado para notificar",type:"info",duration:2500})}catch{}return}const d=await E(a),f=d?.displayName||d?.email||"Usuário";await Promise.all(n.map(r=>i({type:"test_notification",budgetId:l,budgetName:e.nome||"Orçamento",senderUid:a,senderName:f,message:"Mensagem de teste enviada para usuários compartilhados",createdAt:o(),read:!1,recipientUid:r})));try{window.Snackbar&&window.Snackbar.success?window.Snackbar.success("Notificação de teste enviada aos compartilhados",2500):h.emit("snackbar:show",{message:"Notificação de teste enviada aos compartilhados",type:"success",duration:2500})}catch{}}catch(o){console.error("Erro ao enviar notificação de teste (compartilhados):",o);try{window.Snackbar&&window.Snackbar.error?window.Snackbar.error("Erro ao enviar teste para compartilhados",2500):h.emit("snackbar:show",{message:"Erro ao enviar teste para compartilhados",type:"error",duration:2500})}catch{}}}export{E as getUserInfo,A as leaveSharedBudget,R as removeUserFromBudget,S as sendCategoryChangeNotification,V as sendTestNotificationToOwner,L as sendTestNotificationToShared,b as sendTransactionDeletedNotification,N as sendTransactionNotification,O as sendTransactionUpdatedNotification};

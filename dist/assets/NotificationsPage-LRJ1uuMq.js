const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/userSettingsRepo-DAw0TtCo.js","assets/main-OjaIp7EQ.js","assets/vendor-7JQXQzuE.js","assets/main-CJ6DwGSY.css"])))=>i.map(i=>d[i]);
import{m as t,H as e,I as a,J as n,x as i,K as o,L as r,_ as s,k as d,M as c}from"./main-OjaIp7EQ.js";import{mountPeriodIndicator as l}from"./PeriodIndicator-CGknNJvc.js";import{getNotificationModal as g}from"./NotificationModal-B7R6h_Eo.js";import"./vendor-7JQXQzuE.js";function p(t){const e="deleted_transaction"===t.type?"bg-red-100 dark:bg-red-900":"updated_transaction"===t.type?"bg-yellow-100 dark:bg-yellow-900":t.type&&t.type.startsWith("category_")?"bg-purple-100 dark:bg-purple-900":"test_notification"===t.type?"bg-emerald-100 dark:bg-emerald-900":"bg-blue-100 dark:bg-blue-900",a="deleted_transaction"===t.type?"ğŸ—‘ï¸":"updated_transaction"===t.type?"âœï¸":t.type&&t.type.startsWith("category_")?"ğŸ“‚":"test_notification"===t.type?"ğŸ“£":"ğŸ’°",n=("deleted_transaction"===t.type?"TransaÃ§Ã£o ExcluÃ­da":"updated_transaction"===t.type&&"TransaÃ§Ã£o Atualizada")||"new_transaction"===t.type&&"Nova TransaÃ§Ã£o"||"category_added"===t.type&&"Categoria Criada"||"category_updated"===t.type&&"Categoria Atualizada"||"category_deleted"===t.type&&"Categoria ExcluÃ­da"||"test_notification"===t.type&&"NotificaÃ§Ã£o de Teste"||"NotificaÃ§Ã£o",i=t.createdAt?.toDate?t.createdAt.toDate().toLocaleString("pt-BR"):"Data nÃ£o disponÃ­vel",o=t=>{if("number"!=typeof t)return t??"-";try{return t.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}catch{return String(t)}},r=t.changes||{},s=Object.keys(r).length>0?`\n    <div class="mt-3 p-3 rounded-xl bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800">\n      <div class="font-semibold mb-2 text-yellow-800 dark:text-yellow-200">AlteraÃ§Ãµes</div>\n      <ul class="text-sm space-y-1 text-gray-800 dark:text-gray-200">\n        ${r.descricao?`<li>âœï¸ DescriÃ§Ã£o: <span class="line-through opacity-60">${r.descricao.from||"-"}</span> â†’ <span class="font-medium">${r.descricao.to||"-"}</span></li>`:""}\n        ${r.valor?`<li>ğŸ’µ Valor: <span class="line-through opacity-60">${o(r.valor.from)}</span> â†’ <span class="font-medium">${o(r.valor.to)}</span></li>`:""}\n        ${r.categoria?`<li>ğŸ“‚ Categoria: <span class="line-through opacity-60">${r.categoria.from||"-"}</span> â†’ <span class="font-medium">${r.categoria.to||"-"}</span></li>`:""}\n        ${r.tipo?`<li>ğŸ” Tipo: <span class="line-through opacity-60">${r.tipo.from||"-"}</span> â†’ <span class="font-medium">${r.tipo.to||"-"}</span></li>`:""}\n      </ul>\n    </div>\n  `:"",d=!(!r||!(r.nome||r.tipo||r.limite))?`\n    <div class="mt-3 p-3 rounded-xl bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800">\n      <div class="font-semibold mb-2 text-yellow-800 dark:text-yellow-200">AlteraÃ§Ãµes da Categoria</div>\n      <ul class="text-sm space-y-1 text-gray-800 dark:text-gray-200">\n        ${r.nome?`<li>ğŸ·ï¸ Nome: <span class="line-through opacity-60">${r.nome.from||"-"}</span> â†’ <span class="font-medium">${r.nome.to||"-"}</span></li>`:""}\n        ${r.tipo?`<li>ğŸ” Tipo: <span class="line-through opacity-60">${r.tipo.from||"-"}</span> â†’ <span class="font-medium">${r.tipo.to||"-"}</span></li>`:""}\n        ${r.limite?`<li>ğŸ“ Limite: <span class="line-through opacity-60">${o(r.limite.from)}</span> â†’ <span class="font-medium">${o(r.limite.to)}</span></li>`:""}\n      </ul>\n    </div>\n  `:"",c="new_transaction"===t.type||"deleted_transaction"===t.type||"updated_transaction"===t.type?`\n    <div class="mt-3 p-3 rounded-xl bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700">\n      <div class="font-semibold mb-2 text-gray-800 dark:text-gray-200">Resumo</div>\n      <ul class="text-sm space-y-1 text-gray-800 dark:text-gray-200">\n        <li>ğŸ“ DescriÃ§Ã£o: <span class="font-medium">${t.transactionDescricao||"-"}</span></li>\n        <li>ğŸ’µ Valor: <span class="font-medium">${o(t.transactionValor)}</span></li>\n        <li>ğŸ“‚ Categoria: <span class="font-medium">${t.transactionCategoria||"-"}</span></li>\n        <li>ğŸ” Tipo: <span class="font-medium">${"receita"===(t.transactionTipo||"despesa")?"Receita":"Despesa"}</span></li>\n  <li>ğŸ“ Limite da categoria: <span class="font-medium">${null!==t.transactionCategoriaLimite&&void 0!==t.transactionCategoriaLimite?o(t.transactionCategoriaLimite):"-"}</span></li>\n  ${t.recorrenteParcelaAtual&&t.recorrenteParcelasTotal?`<li>ğŸ“… Parcela: <span class="font-medium">${t.recorrenteParcelaAtual}/${t.recorrenteParcelasTotal}</span></li>`:""}\n      </ul>\n    </div>\n  `:"";return`\n  <div class="u-card bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-2xl transition-all duration-300 group ${t.read?"":"ring-2 ring-blue-200 dark:ring-blue-800"}">\n      <div class="bg-gradient-to-r ${t.read?"from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-800":"from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-800"} p-4 border-b border-gray-200 dark:border-gray-700">\n        <div class="flex items-center justify-between">\n          <div class="flex items-center gap-3">\n            <div class="w-12 h-12 rounded-full ${e} flex items-center justify-center text-xl">${a}</div>\n            <div>\n              <h3 class="font-bold text-gray-900 dark:text-gray-100">${n}</h3>\n              <p class="text-sm text-gray-500 dark:text-gray-400">OrÃ§amento: ${t.budgetName||"OrÃ§amento"}</p>\n            </div>\n          </div>\n          <div class="text-right">${t.read?'<div class="text-2xl">âœ…</div>':'<div class="text-2xl">ğŸ“¬</div>'}</div>\n        </div>\n      </div>\n\n      <div class="p-4">\n        <div class="space-y-3">\n          <div class="flex items-center justify-between">\n            <span class="text-sm text-gray-600 dark:text-gray-400">Enviado por:</span>\n            <span class="font-medium text-gray-900 dark:text-gray-100">${t.senderName||"UsuÃ¡rio"}</span>\n          </div>\n          ${t.type&&t.type.startsWith("category_")?`\n            <div class="flex items-center justify-between">\n              <span class="text-sm text-gray-600 dark:text-gray-400">Categoria:</span>\n              <span class="font-medium text-gray-900 dark:text-gray-100">${t.categoryNome||"Categoria"}</span>\n            </div>\n            <div class="flex items-center justify-between">\n              <span class="text-sm text-gray-600 dark:text-gray-400">Tipo:</span>\n              <span class="font-medium ${"receita"===(t.categoryTipo||"despesa")?"text-green-600":"text-red-600"}">${"receita"===(t.categoryTipo||"despesa")?"Receita":"Despesa"}</span>\n            </div>\n            <div class="flex items-center justify-between">\n              <span class="text-sm text-gray-600 dark:text-gray-400">Limite:</span>\n              <span class="font-medium text-gray-900 dark:text-gray-100">${null!==t.categoryLimite&&void 0!==t.categoryLimite?o(t.categoryLimite):"-"}</span>\n            </div>\n          `:"test_notification"===t.type?`\n            <div class="flex items-center justify-between">\n              <span class="text-sm text-gray-600 dark:text-gray-400">Mensagem:</span>\n              <span class="font-medium text-gray-900 dark:text-gray-100">${t.message||"Mensagem de teste"}</span>\n            </div>\n          `:`\n            <div class="flex items-center justify-between">\n              <span class="text-sm text-gray-600 dark:text-gray-400">Tipo:</span>\n              ${"deleted_transaction"===t.type?'<span class="font-medium text-red-600">excluÃ­da</span>':`<span class="font-medium ${"receita"===(t.transactionTipo||"despesa")?"text-green-600":"text-red-600"}">${t.transactionTipo||"TransaÃ§Ã£o"}</span>`}\n            </div>\n          `}\n          <div class="flex items-center justify-between">\n            <span class="text-sm text-gray-600 dark:text-gray-400">Data:</span>\n            <span class="text-sm text-gray-500 dark:text-gray-400">${i}</span>\n          </div>\n          ${c}\n          ${"updated_transaction"===t.type?s:""}\n          ${"category_updated"===t.type?d:""}\n        </div>\n      </div>\n\n      <div class="bg-gray-50 dark:bg-gray-800 p-4 border-t border-gray-200 dark:border-gray-700">\n        <div class="flex flex-wrap gap-2">\n          ${t.read?"":`\n          <button onclick="window.showConfirmationModal({\n            title: 'Marcar como Lida',\n            message: 'Deseja marcar esta notificaÃ§Ã£o como lida?',\n            confirmText: 'Sim, Marcar',\n            confirmColor: 'bg-blue-500 hover:bg-blue-600',\n            onConfirm: () => window.markNotificationAsRead && window.markNotificationAsRead('${t.id}')\n          })" class="flex-1 btn btn-primary btn-sm flex items-center justify-center gap-2">âœ… Marcar como lida</button>\n          `}\n          <button onclick="window.__pinNotification && window.__pinNotification('${t.id}', ${!t.pinned})" class="flex-1 btn ${t.pinned?"btn-danger":"btn-outline"} btn-sm flex items-center justify-center gap-2">${t.pinned?"ğŸ“Œ Desfixar":"ğŸ“ Fixar"}</button>\n          <button onclick="window.__archiveNotification && window.__archiveNotification('${t.id}', ${!t.archivedAt})" class="flex-1 btn btn-outline btn-sm flex items-center justify-center gap-2">${t.archivedAt?"ğŸ“‚ Restaurar":"ğŸ—ƒï¸ Arquivar"}</button>\n          <button onclick="window.openNotificationTarget && window.openNotificationTarget('${t.id}','${t.type||""}')" class="flex-1 btn btn-outline btn-sm flex items-center justify-center gap-2">ğŸ”— Ver no app</button>\n        </div>\n      </div>\n    </div>\n  `}function y(t,e){return`\n    <div class="mb-12">\n      <div class="flex items-center gap-2 mb-4">\n        <div class="w-1 h-6 bg-gradient-to-b from-purple-500 to-pink-500 rounded-full"></div>\n        <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">${t}</h2>\n      </div>\n      <div class="space-y-6">\n        ${e.map(t=>`\n          <div>\n            <div class="text-sm font-semibold text-gray-600 dark:text-gray-300 mb-2">${t.label}</div>\n            <div class="space-y-4">${t.items.map(p).join("")}</div>\n          </div>\n        `).join("")}\n      </div>\n    </div>\n  `}const f="notif_filters_v1",u=["new_transaction","updated_transaction","deleted_transaction","category_added","category_updated","category_deleted","test_notification"],w="function"==typeof window.renderFAB?window.renderFAB:()=>{};function m(){if("function"==typeof window.getNotifFilters)return window.getNotifFilters();try{const t=localStorage.getItem(f);if(t){const e=JSON.parse(t);return{types:Array.isArray(e.types)&&e.types.length?e.types:u.slice(),period:e.period||"all",unreadOnly:void 0===e.unreadOnly||!!e.unreadOnly}}}catch(t){}return{types:u.slice(),period:"all",unreadOnly:!0}}function b(e,a){return"function"==typeof window.applyNotificationFilters?window.applyNotificationFilters(e,a):function(e,a){const n=new Date,i={all:null,today:new Date(n.getFullYear(),n.getMonth(),n.getDate()),"7d":new Date(n.getTime()-6048e5),"30d":new Date(n.getTime()-2592e6)}[a?.period||"all"];let o=null,r=null;try{const e="function"==typeof t?t():null;!i&&e&&e.year&&e.month&&(o=new Date(e.year,e.month-1,1,0,0,0,0),r=new Date(e.year,e.month,0,23,59,59,999))}catch{}return(e||[]).filter(t=>{if(a?.unreadOnly&&t.read)return!1;if(a?.types&&!a.types.includes(t.type))return!1;const e=t.createdAt?.toDate?t.createdAt.toDate():t.createdAt?.seconds?new Date(1e3*t.createdAt.seconds):new Date(t.createdAt);return i?e>=i:!o||!r||e>=o&&e<=r})}(e,a)}function x(t){return"function"==typeof window.groupNotificationsByDay?window.groupNotificationsByDay(t):function(t){const e={};return(t||[]).forEach(t=>{const a=(t.createdAt?.toDate?t.createdAt.toDate():new Date(t.createdAt)).toDateString();e[a]||(e[a]=[]),e[a].push(t)}),Object.keys(e).sort((t,e)=>new Date(e)-new Date(t)).map(t=>({label:t,items:e[t]}))}(t)}async function v(){try{const t=window.appState?.currentUser?.uid;if(!t)return{};const{getByUser:e}=await s(async()=>{const{getByUser:t}=await import("./userSettingsRepo-DAw0TtCo.js");return{getByUser:t}},__vite__mapDeps([0,1,2,3])),a=await e(t);return a?.notificationPrefs||{}}catch{return{}}}async function h(t,e){try{const a=await v(),n=a.byBudget||{},i=n[t]||{allow:{}},o={...i.allow||{}};o[e]=!(!1!==o[e]),n[t]={...i,allow:o};const r={...a,byBudget:n};await async function(t){try{const e=window.appState?.currentUser?.uid;if(!e)return!1;const{setNotificationPrefs:a}=await s(async()=>{const{setNotificationPrefs:t}=await import("./userSettingsRepo-DAw0TtCo.js");return{setNotificationPrefs:t}},__vite__mapDeps([0,1,2,3]));return await a(e,t||{}),!0}catch{return!1}}(r);try{d.emit("snackbar:show",{message:"PreferÃªncia salva",type:"success",duration:2e3})}catch{}}catch{}}let k=null,_=!1,N=null;function $(){return k||(k=window.__notifFilters||m()),k}function A(){try{k||(k=m()),k||(k={types:u.slice(),period:"all",unreadOnly:!0}),window.__notifFilters=k;const t={types:Array.isArray(k.types)?k.types:[],period:k.period||"all",unreadOnly:!!k.unreadOnly};localStorage.setItem(f,JSON.stringify(t))}catch(t){}}function T(){k={types:u.slice(),period:"all",unreadOnly:!0},A();try{d.emit("snackbar:show",{message:"Filtros redefinidos para padrÃ£o",type:"success",duration:2e3})}catch{}C(!0)}function S(t){let e=30;try{if("number"==typeof t&&Number.isFinite(t))e=t;else{const t=parseInt(localStorage.getItem("notif_retention_days")||"30",10);Number.isFinite(t)&&(e=t)}}catch{}if(!e||e<=0){try{d.emit("snackbar:show",{message:"RetenÃ§Ã£o desativada",type:"info",duration:2e3})}catch{}return!1}const a=Date.now()-24*e*60*60*1e3,n=Array.isArray(window.appState?.notifications)?window.appState.notifications:[],i=n.length,o=n.filter(t=>(t.createdAt?.toDate?t.createdAt.toDate().getTime():new Date(t.createdAt).getTime())>=a);window.appState.notifications=o;const r=Math.max(0,i-o.length);try{d.emit("notifications:updated",o)}catch{}if(r>0)try{d.emit("snackbar:show",{message:`NotificaÃ§Ãµes antigas removidas: ${r}`,type:"success",duration:2500})}catch{}return r>0}async function C(c=!1){if(!_||c)if(N&&(clearTimeout(N),N=null),c){_=!0;try{const c=document.getElementById("app-content");if(!c)return;await D(!0);const f=window.appState.notifications||[],h=m();void 0===h.unreadOnly&&(h.unreadOnly=!0,A());const k=f.filter(t=>!t.read&&!t.archivedAt).length,N={new_transaction:"Nova Tx",updated_transaction:"Tx Atualizada",deleted_transaction:"Tx ExcluÃ­da",category_added:"Cat Criada",category_updated:"Cat Atualizada",category_deleted:"Cat ExcluÃ­da",test_notification:"Teste"},$=u.map(t=>`<button onclick="window.toggleNotificationTypeFilter && window.toggleNotificationTypeFilter('${t}')" class="px-3 py-1 rounded-full text-xs font-medium ${h.types.includes(t)?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}">${N[t]}</button>`).join(""),T=["all","today","7d","30d"].map(t=>{const e="all"===t?"Tudo":"today"===t?"Hoje":"7d"===t?"7 dias":"30 dias";return`<button onclick="window.setNotificationPeriod && window.setNotificationPeriod('${t}')" class="px-3 py-1 rounded-full text-xs font-medium ${h.period===t?"bg-indigo-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}">${e}</button>`}).join(""),S=b(f,h),O=S.filter(t=>!t.read&&!t.archivedAt),j=S.filter(t=>t.read&&!t.archivedAt),F=[...O,...j],R=F.filter(t=>!!t.pinned&&!t.archivedAt),B=F.filter(t=>!t.pinned&&!t.archivedAt),M=F.filter(t=>!!t.archivedAt),P=x(B),L=x(R),U=x(M),E="function"==typeof t?t():null,I=new Date,V=E&&E.year||window.appState?.selectedYear||I.getFullYear(),H=E&&E.month||window.appState?.selectedMonth||I.getMonth()+1,q=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][(H-1)%12]||"",z=S.length,J=S.filter(t=>!t.read&&!t.archivedAt).length,W=z-J,Y=S.filter(t=>{const e=t.createdAt?.toDate?t.createdAt.toDate():new Date(t.createdAt),a=new Date;return e.toDateString()===a.toDateString()}).length;window.renderNotificationCard||(window.renderNotificationCard=p);const G=J>0?`<span class="header-unread-badge inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-200" aria-live="polite" aria-atomic="true">${J}</span>`:"",K=J>0?"text-yellow-200":"text-green-200",Q=B.length?y("ğŸ“¬ Inbox",P):'\n            <div class="mb-12">\n              <div class="flex items-center gap-2 mb-4">\n                <div class="w-1 h-6 bg-gradient-to-b from-purple-500 to-pink-500 rounded-full"></div>\n                <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">ğŸ“¬ Inbox</h2>\n              </div>\n        <div class="u-card bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden p-4">\n                <div class="empty-state">\n                  <div class="empty-icon">âœ…</div>\n                  <div class="empty-text">ğŸ‰ Todas as notificaÃ§Ãµes foram lidas!</div>\n                  <div class="empty-description">VocÃª estÃ¡ em dia com suas notificaÃ§Ãµes. NÃ£o hÃ¡ nada novo para ver.</div>\n          <div class="mt-2 flex gap-2">\n            <button onclick="window.renderNotifications()" class="btn btn-primary btn-sm">ğŸ”„ Atualizar</button>\n            <button onclick="window.toggleUnreadOnly && window.toggleUnreadOnly()" class="btn btn-outline btn-sm">ğŸ‘ï¸ Ver todas</button>\n          </div>\n                </div>\n              </div>\n            </div>\n          ',X=R.length?y("ğŸ“Œ Fixadas",L):"",Z=M.length?y("ğŸ—ƒï¸ Arquivadas",U):"";c.innerHTML=`\n    <div class="tab-container">\n      <div class="tab-header">\n        <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-sm border border-gray-200 dark:border-gray-600">\n          <div class="flex items-center justify-between w-full">\n            <div class="flex items-center gap-3">\n              <div class="flex items-center gap-2">\n                <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center">\n                  <span class="text-white text-sm">ğŸ””</span>\n                </div>\n                <div>\n                  <h2 class="text-gray-800 dark:text-white font-semibold text-base">NotificaÃ§Ãµes ${G}</h2>\n                  <div class="flex items-center gap-1">\n                    <span class="text-orange-600 dark:text-orange-400 text-xs">${k>0?`${k} nÃ£o lidas`:"Todas lidas"}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n        <div id="notif-period-indicator"></div>\n          </div>\n        </div>\n      </div>\n      <div class="tab-content">\n        <div class="content-spacing">\n\n          <div class="mb-12">\n            <div class="flex items-center gap-2 mb-4">\n              <div class="w-1 h-6 bg-gradient-to-b from-blue-500 to-indigo-500 rounded-full"></div>\n              <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">ğŸ”” Resumo</h2>\n            </div>\n            \n            <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-800 dark:via-gray-700 dark:to-gray-800 rounded-2xl shadow-lg border border-blue-200 dark:border-gray-600 p-4 mb-6">\n              \x3c!-- Header Compacto --\x3e\n              <div class="flex items-center justify-between mb-4">\n                <div>\n                  <h3 class="text-lg font-bold text-gray-800 dark:text-gray-200 flex items-center gap-2">\n                    <span class="text-xl">ğŸ””</span>\n                    Centro de NotificaÃ§Ãµes\n                  </h3>\n                  <p class="text-sm text-gray-600 dark:text-gray-400">${z} notificaÃ§Ãµes â€¢ ${q}/${V}</p>\n                </div>\n                <div class="text-right">\n                  <div class="text-lg font-bold ${K}">${J}</div>\n                  <p class="text-xs text-gray-500 dark:text-gray-400">${J>0?"NÃ£o lidas":"Todas lidas"}</p>\n                </div>\n              </div>\n              \n              \x3c!-- MÃ©tricas Compactas --\x3e\n              <div class="grid grid-cols-4 gap-3 mb-4">\n                <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center shadow-sm border border-gray-200 dark:border-gray-600">\n                  <div class="text-lg mb-1">ğŸ“§</div>\n                  <div class="text-lg font-bold text-gray-800 dark:text-gray-200">${z}</div>\n                  <div class="text-xs text-gray-600 dark:text-gray-400">Total</div>\n                </div>\n                \n                <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center shadow-sm border border-gray-200 dark:border-gray-600">\n                  <div class="text-lg mb-1">ğŸ“¬</div>\n                  <div class="text-lg font-bold text-orange-600 dark:text-orange-400">${J}</div>\n                  <div class="text-xs text-gray-600 dark:text-gray-400">NÃ£o lidas</div>\n                </div>\n                \n                <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center shadow-sm border border-gray-200 dark:border-gray-600">\n                  <div class="text-lg mb-1">âœ…</div>\n                  <div class="text-lg font-bold text-green-600 dark:text-green-400">${W}</div>\n                  <div class="text-xs text-gray-600 dark:text-gray-400">Lidas</div>\n                </div>\n                \n                <div class="bg-white dark:bg-gray-800 rounded-lg p-3 text-center shadow-sm border border-gray-200 dark:border-gray-600">\n                  <div class="text-lg mb-1">ğŸ“…</div>\n                  <div class="text-lg font-bold text-blue-600 dark:text-blue-400">${Y}</div>\n                  <div class="text-xs text-gray-600 dark:text-gray-400">Hoje</div>\n                </div>\n              </div>\n\n              \x3c!-- Resumo de Status Compacto --\x3e\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border border-gray-200 dark:border-gray-600">\n                <h5 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-1">\n                  <span>ğŸ“Š</span>\n                  Status das NotificaÃ§Ãµes\n                </h5>\n                <div class="space-y-1">\n                  <div class="flex justify-between text-xs">\n                    <span class="text-gray-600 dark:text-gray-400">Total:</span>\n                    <span class="font-medium text-gray-800 dark:text-gray-200">${z}</span>\n                  </div>\n                  <div class="flex justify-between text-xs">\n                    <span class="text-gray-600 dark:text-gray-400">NÃ£o lidas:</span>\n                    <span class="font-medium text-orange-600 dark:text-orange-400">${J}</span>\n                  </div>\n                  <div class="flex justify-between text-xs border-t border-gray-200 dark:border-gray-600 pt-1">\n                    <span class="text-gray-600 dark:text-gray-400">Lidas:</span>\n                    <span class="font-bold text-green-600 dark:text-green-400">${W}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class="mb-12">\n            <div class="flex items-center gap-2 mb-4">\n              <div class="w-1 h-6 bg-gradient-to-b from-green-500 to-teal-500 rounded-full"></div>\n              <h2 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">ğŸ”§ AÃ§Ãµes & Controles</h2>\n            </div>\n            \n            <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-800 dark:via-gray-700 dark:to-gray-800 rounded-2xl shadow-lg border border-blue-200 dark:border-gray-600 p-4 mb-6">\n              \x3c!-- Header Compacto --\x3e\n              <div class="flex items-center justify-between mb-4">\n                <div>\n                  <h3 class="text-lg font-bold text-gray-800 dark:text-gray-200 flex items-center gap-2">\n                    <span class="text-xl">ğŸ”§</span>\n                    Gerenciar NotificaÃ§Ãµes\n                  </h3>\n                  <p class="text-sm text-gray-600 dark:text-gray-400">AÃ§Ãµes rÃ¡pidas e filtros</p>\n                  </div>\n                <div class="text-right">\n                  <div class="text-lg font-bold text-blue-600 dark:text-blue-400">${z}</div>\n                  <p class="text-xs text-gray-500 dark:text-gray-400">Total</p>\n                </div>\n              </div>\n              \n              \x3c!-- AÃ§Ãµes Principais --\x3e\n              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4">\n                <button onclick="window.showConfirmationModal({ title: 'Marcar como Lidas', message: 'Deseja marcar todas as notificaÃ§Ãµes como lidas?', confirmText: 'Sim, Marcar', confirmColor: 'bg-blue-500 hover:bg-blue-600', onConfirmFn: 'markAllNotificationsAsRead' })" class="btn btn-primary btn-sm">âœ… Marcar lidas</button>\n                <button onclick="window.showConfirmationModal({ title: 'Arquivar notificaÃ§Ãµes lidas', message: 'Deseja arquivar todas as notificaÃ§Ãµes lidas? VocÃª poderÃ¡ restaurÃ¡-las depois.', confirmText: 'Sim, Arquivar', confirmColor: 'bg-indigo-500 hover:bg-indigo-600', onConfirmFn: 'archiveAllReadNotifications' })" class="btn btn-outline btn-sm">ğŸ—ƒï¸ Arquivar</button>\n                <button onclick="window.showConfirmationModal({ title: 'Apagar notificaÃ§Ãµes lidas', message: 'Deseja apagar todas as notificaÃ§Ãµes lidas? Esta aÃ§Ã£o nÃ£o pode ser desfeita.', confirmText: 'Sim, Apagar', confirmColor: 'bg-red-500 hover:bg-red-600', onConfirmFn: 'deleteAllReadNotifications' })" class="btn btn-danger btn-sm">ğŸ—‘ï¸ Apagar</button>\n                <button onclick="window.renderNotifications()" class="btn btn-outline btn-sm">ğŸ”„ Atualizar</button>\n              </div>\n\n              \x3c!-- Filtros --\x3e\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border border-gray-200 dark:border-gray-600 mb-4">\n                <h5 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-1">\n                  <span>ğŸ”</span>\n                  Filtros\n                </h5>\n                <div class="space-y-3">\n                  <div class="flex flex-wrap gap-2 items-center">\n                    <span class="text-xs text-gray-600 dark:text-gray-400 mr-1">Tipos:</span>\n                    ${$}\n                  </div>\n                  <div class="flex flex-wrap gap-2 items-center">\n                    <span class="text-xs text-gray-600 dark:text-gray-400 mr-1">PerÃ­odo:</span>\n                    ${T}\n                  </div>\n                  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">\n                    <label class="inline-flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400" title="Atalho: U">\n                      <input type="checkbox" ${h.unreadOnly?"checked":""} onchange="window.toggleUnreadOnly && window.toggleUnreadOnly()" />\n                      Apenas nÃ£o lidas\n                    </label>\n                    <div class="flex gap-2 flex-wrap">\n                      <button onclick="window.resetNotificationFilters && window.resetNotificationFilters()" class="btn btn-ghost btn-sm">â™»ï¸ Reset</button>\n                      <button onclick="window.loadUnreadNotifications && window.loadUnreadNotifications()" class="btn btn-primary btn-sm">ğŸ“¬ NÃ£o lidas</button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              \x3c!-- Ferramentas de Desenvolvimento (colapsÃ¡vel) --\x3e\n              <details class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border border-gray-200 dark:border-gray-600">\n                <summary class="text-sm font-semibold text-gray-700 dark:text-gray-300 cursor-pointer flex items-center gap-1">\n                  <span>ğŸ› ï¸</span>\n                  Ferramentas de Desenvolvimento\n                </summary>\n                <div class="mt-3 grid grid-cols-2 md:grid-cols-3 gap-2">\n                  <button onclick="window.__sendTestToOwner && window.__sendTestToOwner()" class="btn btn-outline btn-sm">ğŸ“£ Teste Dono</button>\n                  <button onclick="window.__sendTestToShared && window.__sendTestToShared()" class="btn btn-outline btn-sm">ğŸ“£ Teste Compartilhados</button>\n                  <button onclick="window.__testNotificationModal && window.__testNotificationModal()" class="btn btn-outline btn-sm">ğŸ“± Testar Modal</button>\n                  <button onclick="window.debugNotificationSystem && window.debugNotificationSystem()" class="btn btn-outline btn-sm">ğŸ” Debug Sistema</button>\n                  <button onclick="window.debugSharedNotificationTest && window.debugSharedNotificationTest()" class="btn btn-outline btn-sm">ğŸ§ª Debug Compartilhados</button>\n                  <button onclick="window.debugCheckOtherUserNotifications && window.debugCheckOtherUserNotifications()" class="btn btn-outline btn-sm">ğŸ‘¥ Ver Outros</button>\n                </div>\n              </details>\n\n              \x3c!-- Link para ConfiguraÃ§Ãµes --\x3e\n              <div class="mt-4 p-3 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-600">\n                <div class="text-xs text-gray-600 dark:text-gray-400 mb-2">\n                  ğŸ’¡ <strong>Dica:</strong> As preferÃªncias de notificaÃ§Ãµes foram movidas para <strong>ConfiguraÃ§Ãµes</strong> para manter esta aba focada em consultar notificaÃ§Ãµes.\n                </div>\n                <a href="#/settings" class="inline-flex items-center gap-2 text-xs px-3 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">\n                  âš™ï¸ Abrir ConfiguraÃ§Ãµes\n                </a>\n              </div>\n            </div>\n          </div>\n\n          ${Q}\n\n          ${X}\n          ${Z}\n\n        </div>\n      </div>\n    </div>\n  `,w();try{l("#notif-period-indicator")}catch{}try{const t=window.__prevNotifHeaderCount||0,e=(Array.isArray(window.appState?.notifications)?window.appState.notifications.filter(t=>!t.read&&!t.archivedAt).length:0)||0,a=document.querySelector(".header-unread-badge"),n="function"==typeof window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;a&&e>0&&e!==t&&!n&&(a.style.transform="scale(1.05)",setTimeout(()=>{try{a.style.transform=""}catch{}},180)),window.__prevNotifHeaderCount=e}catch{}try{if(!window.__notifUIBound){window.__notifUIBound=!0,window.markAllNotificationsAsRead=async()=>{try{await e()}catch{}},window.deleteAllReadNotifications=async()=>{try{await a()}catch{}},window.archiveAllReadNotifications=async()=>{try{await n()}catch{}},window.markNotificationAsRead=async t=>{try{await i(t)}catch{}},window.__pinNotification=async(t,e)=>{try{await o(t,e)}catch{}},window.__archiveNotification=async(t,e)=>{try{await r(t,e)}catch{}};(async()=>{const{sendTestNotificationToOwner:t,sendTestNotificationToShared:e}=await s(async()=>{const{sendTestNotificationToOwner:t,sendTestNotificationToShared:e}=await import("./main-OjaIp7EQ.js").then(t=>t.ab);return{sendTestNotificationToOwner:t,sendTestNotificationToShared:e}},__vite__mapDeps([1,2,3]));window.__sendTestToOwner=async()=>{try{const e=window.appState?.currentBudget?.id||window.appState?.currentBudgetId,a=window.appState?.currentUser?.uid;if(!e||!a)return;await t(e,a)}catch(e){}},window.__sendTestToShared=async()=>{try{const t=window.appState?.currentBudget?.id||window.appState?.currentBudgetId,a=window.appState?.currentUser?.uid;if(!t||!a)return;await e(t,a)}catch(t){}},window.__testNotificationModal=()=>{try{const t=g(),e={id:"test-modal-"+Date.now(),type:"test_notification",message:"Esta Ã© uma notificaÃ§Ã£o de teste para demonstrar o modal!",details:"O modal aparece automaticamente quando novas notificaÃ§Ãµes chegam.",read:!1,createdAt:{toDate:()=>new Date}};t.show(e)}catch(t){}}})()}}catch{}try{const t=await v(),e=Array.isArray(window.appState?.budgets)?window.appState.budgets:Array.isArray(window.appState?.orÃ§amentos)?window.appState.orÃ§amentos:[],a=document.getElementById("notif-budget-prefs");if(a&&Array.isArray(e)){const n=u;a.innerHTML=e.map(e=>{const a=t.byBudget||{},i=a[e.id]?.allow||{},o=n.map(t=>{const a=!1!==i[t],n=N[t];return`<label class="inline-flex items-center gap-1 text-xs mr-2"><input type="checkbox" ${a?"checked":""} onchange="window.__toggleBudgetTypePref && window.__toggleBudgetTypePref('${e.id}','${t}', this.checked)"/>${n}</label>`}).join("");return`<div class="text-xs text-gray-700 dark:text-gray-300"><div class="font-semibold mb-1">${e.nome||e.name||"OrÃ§amento"}</div><div>${o}</div></div>`}).join("")}}catch{}try{window.__notifPeriodListenerBound||(window.__notifPeriodListenerBound=!0,d.on("period:changed",t=>window.queueMicrotask(()=>{const e=(window.location.hash||"").split("?")[0];if("#/notifications"===e){try{const a=t?.year||window.getSelectedPeriod&&window.getSelectedPeriod().year,n=t?.month||window.getSelectedPeriod&&window.getSelectedPeriod().month;if(a&&n){const t=`${a}-${String(n).padStart(2,"0")}`,i=new URL(window.location.href);i.hash=`${e}?ym=${t}`,window.history.replaceState(null,"",i.toString())}}catch{}C()}}))),window.__notifUpdatesListenerBound||(window.__notifUpdatesListenerBound=!0,d.on("notifications:updated",()=>{try{"#/notifications"!==(window.location.hash||"").split("?")[0]||_||C()}catch{}}))}catch{}try{window.__notifHotkeysBound||(window.__notifHotkeysBound=!0,document.addEventListener("keydown",t=>{try{const e=t.target&&(t.target.tagName||"").toLowerCase()||"";if("input"===e||"textarea"===e||"select"===e||t.target&&t.target.isContentEditable)return;"#/notifications"===(window.location.hash||"").split("?")[0]&&("u"!==t.key&&"U"!==t.key||(t.preventDefault(),"function"==typeof window.toggleUnreadOnly&&window.toggleUnreadOnly()))}catch{}}))}catch{}}finally{_=!1}}else N=setTimeout(()=>{C(!0)},100)}async function D(t=!1){try{const a=window.appState?.currentUser;if(a?.uid){await c(a.uid);const n=window.appState?.notifications||[];n.filter(t=>!t.read&&!t.archivedAt).length;if(!t)try{d.emit("notifications:updated",n)}catch(e){}}}catch(a){}}async function O(){try{await D(!0);m().unreadOnly=!0,A(),await C(!0)}catch(t){}}async function j(){return await C()}window.renderNotifications||(window.renderNotifications=C),window.toggleNotificationTypeFilter||(window.toggleNotificationTypeFilter=function(t){k=$();const e=new Set(k.types||[]);e.has(t)?e.delete(t):e.add(t),k.types=Array.from(e),A(),C(!0)}),window.setNotificationPeriod||(window.setNotificationPeriod=function(t){k=$(),k.period=t,A(),C(!0)}),window.toggleUnreadOnly||(window.toggleUnreadOnly=function(){k=$(),k.unreadOnly=!k.unreadOnly,A(),C(!0)}),window.resetNotificationFilters||(window.resetNotificationFilters=T),window.runNotificationAutoClean||(window.runNotificationAutoClean=function(){try{const t=S();return C(!0),t}catch(t){}}),window.markAllNotificationsAsRead||(window.markAllNotificationsAsRead=function(){e().catch(()=>{})}),window.deleteAllReadNotifications||(window.deleteAllReadNotifications=function(){a().then(()=>C(!0)).catch(()=>{})}),window.markNotificationAsRead||(window.markNotificationAsRead=function(t){i(t).then(()=>C(!0)).catch(()=>{})}),window.__pinNotification||(window.__pinNotification=function(t,e){o(t,e).then(()=>C(!0)).catch(()=>{})}),window.__archiveNotification||(window.__archiveNotification=function(t,e){r(t,e).then(()=>C(!0)).catch(()=>{})}),window.archiveAllReadNotifications||(window.archiveAllReadNotifications=function(){n().then(()=>C(!0)).catch(()=>{})}),window.openNotificationTarget||(window.openNotificationTarget=function(t,e){window.location.hash="#/dashboard"}),window.showConfirmationModal||(window.showConfirmationModal=function(t){const e=confirm(t?.message||"Confirmar?");if(e&&t?.onConfirm)try{"function"==typeof t.onConfirm&&t.onConfirm()}catch(a){}if(e&&t?.onConfirmFn&&"string"==typeof t.onConfirmFn)try{const e=window[t.onConfirmFn];"function"==typeof e&&e()}catch{}}),window.__toggleBudgetTypePref||(window.__toggleBudgetTypePref=function(t,e){h(t,e)}),window.loadUnreadNotifications||(window.loadUnreadNotifications=O),window.testNotificationsPage=async function(){const t=window.appState?.currentUser;window.appState,m(),localStorage.getItem(f);try{const{listByRecipient:e}=await s(async()=>{const{listByRecipient:t}=await import("./main-OjaIp7EQ.js").then(t=>t.ac);return{listByRecipient:t}},__vite__mapDeps([1,2,3]));(await e(t?.uid)).length}catch(e){}try{await C(!0)}catch(a){}};export{b as __applyNotificationFiltersForTest,S as __clearOldNotificationsWithToastForTest,m as __getNotifFiltersForTest,T as __resetNotificationFiltersForTest,j as default,O as loadUnreadNotifications,C as renderNotifications};

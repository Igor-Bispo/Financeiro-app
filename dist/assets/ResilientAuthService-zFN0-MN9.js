import e from"./networkHandler-Dd825SpE.js";const t=new class{constructor(){this.auth=null,this.currentUser=null,this.authStateListeners=[],this.retryAttempts=3,this.isInitialized=!1}async initialize(e){try{this.auth=e,this.setupAuthStateListener(),this.isInitialized=!0}catch(t){throw t}}setupAuthStateListener(){this.auth.onAuthStateChanged(e=>{this.currentUser=e,this.authStateListeners.forEach(t=>{try{t(e)}catch(r){}})})}onAuthStateChanged(e){return this.authStateListeners.push(e),null!==this.currentUser&&e(this.currentUser),()=>{const t=this.authStateListeners.indexOf(e);t>-1&&this.authStateListeners.splice(t,1)}}async signInWithCredential(t){return e.retryOperation(async()=>{try{const e=await this.auth.signInWithCredential(t);if(e.user)return this.currentUser=e.user,await this.ensureUserProfile(e.user),e;throw new Error("Nenhum usuário retornado do Firebase Auth")}catch(e){throw this.handleAuthError(e)}},"login com credencial")}async ensureUserProfile(e){try{if(window.ResilientFirebaseClient){await window.ResilientFirebaseClient.getDocument("usuarios",e.uid)||await window.ResilientFirebaseClient.addDocument("usuarios",{id:e.uid,email:e.email,displayName:e.displayName||e.email,photoURL:e.photoURL,createdAt:new Date,updatedAt:new Date})}}catch(t){}}async signOut(){return e.retryOperation(async()=>{try{await this.auth.signOut(),this.currentUser=null}catch(e){throw this.handleAuthError(e)}},"logout")}async getCurrentUser(){return new Promise(e=>{if(null!==this.currentUser)return void e(this.currentUser);const t=this.auth.onAuthStateChanged(r=>{t(),e(r)})})}handleAuthError(e){const t=e.code,r=e.message;switch(t){case"auth/network-request-failed":return new Error("Erro de conexão. Verifique sua internet e tente novamente.");case"auth/too-many-requests":return new Error("Muitas tentativas de login. Aguarde alguns minutos e tente novamente.");case"auth/user-disabled":return new Error("Esta conta foi desabilitada. Entre em contato com o suporte.");case"auth/user-not-found":return new Error("Usuário não encontrado. Verifique suas credenciais.");case"auth/wrong-password":return new Error("Senha incorreta. Tente novamente.");case"auth/invalid-credential":return new Error("Credenciais inválidas. Tente fazer login novamente.");case"auth/account-exists-with-different-credential":return new Error("Já existe uma conta com este email usando um método diferente de login.");case"auth/credential-already-in-use":return new Error("Esta credencial já está sendo usada por outra conta.");case"auth/operation-not-allowed":return new Error("Método de login não permitido. Entre em contato com o suporte.");case"auth/weak-password":return new Error("A senha é muito fraca. Escolha uma senha mais forte.");case"auth/email-already-in-use":return new Error("Este email já está sendo usado por outra conta.");case"auth/invalid-email":return new Error("Email inválido. Verifique o formato do email.");case"auth/popup-closed-by-user":return new Error("Login cancelado. Tente novamente.");case"auth/popup-blocked":return new Error("Pop-up bloqueado pelo navegador. Permita pop-ups para este site.");case"auth/cancelled-popup-request":return new Error("Solicitação de login cancelada.");case"auth/internal-error":return new Error("Erro interno. Tente novamente em alguns minutos.");default:return new Error(`Erro de autenticação: ${r}`)}}isAuthenticated(){return null!==this.currentUser}async getCurrentUserToken(){if(!this.currentUser)throw new Error("Usuário não autenticado");return e.retryOperation(async()=>await this.currentUser.getIdToken(),"obter token do usuário")}async updateProfile(t){if(!this.currentUser)throw new Error("Usuário não autenticado");return e.retryOperation(async()=>{await this.currentUser.updateProfile(t)},"atualizar perfil")}};window.ResilientAuthService=t;export{t as default};

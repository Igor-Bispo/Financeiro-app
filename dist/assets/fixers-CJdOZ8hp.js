const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-wFw2yV6N.js","assets/main-CF1rWTKC.css"])))=>i.map(i=>d[i]);
import{g as f,q as l,c as b,d as m,w as p,u as g,s as w,l as k,_ as A}from"./main-wFw2yV6N.js";function h(){const e=window.appState?.currentUser,r=window.appState?.currentBudget;return{user:e,budget:r}}async function y(e,r){try{const[o,u,c]=await Promise.all([A(()=>import("./main-wFw2yV6N.js").then(n=>n.a0),__vite__mapDeps([0,1])),A(()=>import("./main-wFw2yV6N.js").then(n=>n.a2),__vite__mapDeps([0,1])),A(()=>import("./main-wFw2yV6N.js").then(n=>n.a3),__vite__mapDeps([0,1]))]);await Promise.all([o.loadTransactions(e,r),u.loadCategories(e),c.loadRecorrentes()])}catch(o){console.warn("Fixers: failed to reload stores:",o)}}async function B(e={}){try{const{user:r,budget:o}=h();if(!r||!o)return!e.silent&&window.Snackbar&&window.Snackbar({message:"Faça login e selecione um orçamento.",type:"error"}),{corrigidas:0};const u=Array.isArray(window.appState?.budgets)&&window.appState.budgets.length>1,c=await f(l(b(m,"categories"),p("userId","==",r.uid)));let n=0;for(const s of c.docs)if(!(s.data()||{}).budgetId){if(u)continue;await g(s.ref,{budgetId:o.id,updatedAt:w()}),n++}if(await y(o.id,r.uid),!e.silent&&window.Snackbar){const s=Array.isArray(window.appState?.budgets)&&window.appState.budgets.length>1&&n===0?"Categorias antigas sem budgetId foram mantidas (múltiplos orçamentos).":`${n} categorias corrigidas com budgetId`;window.Snackbar({message:s,type:"success"})}return{corrigidas:n}}catch(r){return console.error("Erro ao corrigir categorias sem budgetId:",r),!e.silent&&window.Snackbar&&window.Snackbar({message:"Erro ao corrigir categorias",type:"error"}),{corrigidas:0,error:r}}}async function C(e={}){try{const{user:r,budget:o}=h();if(!r||!o)return!e.silent&&window.Snackbar&&window.Snackbar({message:"Faça login e selecione um orçamento.",type:"error"}),{corrigidas:0};const u=Array.isArray(window.appState?.budgets)&&window.appState.budgets.length>1;let c=new Map;try{const d=await k({userId:r.uid});for(const a of d||[])a.id&&a.budgetId&&c.set(a.id,a.budgetId)}catch{}const n=await f(l(b(m,"transactions"),p("userId","==",r.uid)));let s=0;for(const d of n.docs){const a=d.data()||{};if(!a.budgetId)if(u){const t=a.categoryId||a.categoriaId,i=t?c.get(t):null;i&&(await g(d.ref,{budgetId:i,updatedAt:w()}),s++)}else await g(d.ref,{budgetId:o.id,updatedAt:w()}),s++}if(await y(o.id,r.uid),!e.silent&&window.Snackbar){const d=u&&s===0?"Transações antigas sem budgetId foram mantidas (múltiplos orçamentos).":`${s} transações corrigidas com budgetId`;window.Snackbar({message:d,type:"success"})}return{corrigidas:s}}catch(r){return console.error("Erro ao corrigir transações sem budgetId:",r),!e.silent&&window.Snackbar&&window.Snackbar({message:"Erro ao corrigir transações",type:"error"}),{corrigidas:0,error:r}}}async function _(e={}){try{const{user:r,budget:o}=h();if(!r||!o)return!e.silent&&window.Snackbar&&window.Snackbar({message:"Faça login e selecione um orçamento.",type:"error"}),{corrigidas:0};const u=Array.isArray(window.appState?.budgets)&&window.appState.budgets.length>1;let c=new Map;try{const d=await k({userId:r.uid});for(const a of d||[])a.id&&a.budgetId&&c.set(a.id,a.budgetId)}catch{}const n=await f(l(b(m,"recorrentes"),p("userId","==",r.uid)));let s=0;for(const d of n.docs){const a=d.data()||{};if(!a.budgetId)if(u){const t=a.categoryId||a.categoriaId,i=t?c.get(t):null;i&&(await g(d.ref,{budgetId:i,updatedAt:w()}),s++)}else await g(d.ref,{budgetId:o.id,updatedAt:w()}),s++}if(await y(o.id,r.uid),!e.silent&&window.Snackbar){const d=u&&s===0?"Recorrentes antigas sem budgetId foram mantidas (múltiplos orçamentos).":`${s} recorrentes corrigidas com budgetId`;window.Snackbar({message:d,type:"success"})}return{corrigidas:s}}catch(r){return console.error("Erro ao corrigir recorrentes sem budgetId:",r),!e.silent&&window.Snackbar&&window.Snackbar({message:"Erro ao corrigir recorrentes",type:"error"}),{corrigidas:0,error:r}}}async function x(e={}){try{!e.silent&&window.Snackbar&&window.Snackbar({message:"Iniciando correção de dados antigos...",type:"info"});const r=await B({silent:!!e.silent}),o=await C({silent:!!e.silent}),u=await _({silent:!!e.silent});return!e.silent&&window.Snackbar&&window.Snackbar({message:"Correção concluída.",type:"success"}),{categorias:r.corrigidas,transacoes:o.corrigidas,recorrentes:u.corrigidas}}catch(r){return console.error("Erro ao executar correções:",r),!e.silent&&window.Snackbar&&window.Snackbar({message:"Erro ao executar correções",type:"error"}),{categorias:0,transacoes:0,recorrentes:0,error:r}}}async function E(e={}){try{const r=window.appState?.currentUser||window.appState?.user;if(!r?.uid)return{tx:0,rec:0};const o=window.appState?.budgets||[];if(!(Array.isArray(o)&&o.length>1))return{tx:0,rec:0};const c=new Map;try{const t=await k({userId:r.uid});for(const i of t||[])i.id&&i.budgetId&&c.set(i.id,i.budgetId)}catch{}let n=0,s=0;const d=await f(l(b(m,"transactions"),p("userId","==",r.uid)));for(const t of d.docs){const i=t.data()||{};if(!i.budgetId){const S=i.categoryId||i.categoriaId,I=S?c.get(S):null;I&&(await g(t.ref,{budgetId:I,updatedAt:w()}),n++)}}const a=await f(l(b(m,"recorrentes"),p("userId","==",r.uid)));for(const t of a.docs){const i=t.data()||{};if(!i.budgetId){const S=i.categoryId||i.categoriaId,I=S?c.get(S):null;I&&(await g(t.ref,{budgetId:I,updatedAt:w()}),s++)}}try{const t=window.appState?.currentBudget?.id,i=r.uid;t&&await y(t,i)}catch{}return!e.silent&&window.Snackbar&&window.Snackbar({message:`Migração: ${n} transações e ${s} recorrentes atribuídas por categoria`,type:"success"}),{tx:n,rec:s}}catch(r){return console.warn("Migração global por categoria falhou:",r),!e.silent&&window.Snackbar&&window.Snackbar({message:"Erro na migração global",type:"error"}),{tx:0,rec:0,error:r}}}async function O(e={}){try{const{user:r,budget:o}=h();if(!r?.uid||!o?.id)return!e.silent&&window.Snackbar&&window.Snackbar({message:"Faça login e selecione um orçamento.",type:"error"}),{tx:0,rec:0};const u=new Set;try{const a=await k({userId:r.uid});for(const t of a||[])t.id&&t.budgetId===o.id&&u.add(t.id)}catch{}let c=0,n=0;const s=await f(l(b(m,"transactions"),p("userId","==",r.uid)));for(const a of s.docs){const t=a.data()||{};if(!t.budgetId){const i=t.categoryId||t.categoriaId;i&&u.has(i)&&(await g(a.ref,{budgetId:o.id,updatedAt:w()}),c++)}}const d=await f(l(b(m,"recorrentes"),p("userId","==",r.uid)));for(const a of d.docs){const t=a.data()||{};if(!t.budgetId){const i=t.categoryId||t.categoriaId;i&&u.has(i)&&(await g(a.ref,{budgetId:o.id,updatedAt:w()}),n++)}}try{await y(o.id,r.uid)}catch{}return!e.silent&&window.Snackbar&&window.Snackbar({message:`Correção do orçamento: ${c} transações e ${n} recorrentes atribuídas`,type:"success"}),{tx:c,rec:n}}catch(r){return console.warn("Correção por orçamento falhou:",r),!e.silent&&window.Snackbar&&window.Snackbar({message:"Erro na correção do orçamento",type:"error"}),{tx:0,rec:0,error:r}}}typeof window<"u"&&(typeof window.corrigirCategoriasSemBudget!="function"&&(window.corrigirCategoriasSemBudget=e=>B(e)),typeof window.corrigirTransacoesSemBudget!="function"&&(window.corrigirTransacoesSemBudget=e=>C(e)),typeof window.corrigirRecorrentesSemBudget!="function"&&(window.corrigirRecorrentesSemBudget=e=>_(e)),typeof window.corrigirTudoSemBudget!="function"&&(window.corrigirTudoSemBudget=e=>x(e)),typeof window.migrarOrfaosPorCategoria!="function"&&(window.migrarOrfaosPorCategoria=e=>E(e)),typeof window.corrigirOrfaosDoOrcamento!="function"&&(window.corrigirOrfaosDoOrcamento=e=>O(e)));export{B as corrigirCategoriasSemBudget,O as corrigirOrfaosDoOrcamento,_ as corrigirRecorrentesSemBudget,C as corrigirTransacoesSemBudget,x as corrigirTudoSemBudget,E as migrarOrfaosPorCategoria};

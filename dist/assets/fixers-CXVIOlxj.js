const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-OjaIp7EQ.js","assets/vendor-7JQXQzuE.js","assets/main-CJ6DwGSY.css"])))=>i.map(i=>d[i]);
import{h as r,q as t,c as e,d as a,w as o,u as n,j as i,l as s,_ as d}from"./main-OjaIp7EQ.js";import"./vendor-7JQXQzuE.js";function c(){const r=window.appState?.currentUser,t=window.appState?.currentBudget;return{user:r,budget:t}}async function u(r,t){try{const[e,a,o]=await Promise.all([d(()=>import("./main-OjaIp7EQ.js").then(r=>r.a5),__vite__mapDeps([0,1,2])),d(()=>import("./main-OjaIp7EQ.js").then(r=>r.a6),__vite__mapDeps([0,1,2])),d(()=>import("./main-OjaIp7EQ.js").then(r=>r.a7),__vite__mapDeps([0,1,2]))]);await Promise.all([e.loadTransactions(r,t),a.loadCategories(r),o.loadRecorrentes()])}catch(e){}}async function w(s={}){try{const{user:d,budget:w}=c();if(!d||!w)return!s.silent&&window.Snackbar&&window.Snackbar({message:"Faça login e selecione um orçamento.",type:"error"}),{corrigidas:0};const g=Array.isArray(window.appState?.budgets)&&window.appState.budgets.length>1,f=await r(t(e(a,"categories"),o("userId","==",d.uid)));let b=0;for(const r of f.docs){if(!(r.data()||{}).budgetId){if(g)continue;await n(r.ref,{budgetId:w.id,updatedAt:i()}),b++}}if(await u(w.id,d.uid),!s.silent&&window.Snackbar){const r=Array.isArray(window.appState?.budgets)&&window.appState.budgets.length>1&&0===b?"Categorias antigas sem budgetId foram mantidas (múltiplos orçamentos).":`${b} categorias corrigidas com budgetId`;window.Snackbar({message:r,type:"success"})}return{corrigidas:b}}catch(d){return!s.silent&&window.Snackbar&&window.Snackbar({message:"Erro ao corrigir categorias",type:"error"}),{corrigidas:0,error:d}}}async function g(d={}){try{const{user:w,budget:g}=c();if(!w||!g)return!d.silent&&window.Snackbar&&window.Snackbar({message:"Faça login e selecione um orçamento.",type:"error"}),{corrigidas:0};const f=Array.isArray(window.appState?.budgets)&&window.appState.budgets.length>1;let b=new Map;try{const r=await s({userId:w.uid});for(const t of r||[])t.id&&t.budgetId&&b.set(t.id,t.budgetId)}catch{}const p=await r(t(e(a,"transactions"),o("userId","==",w.uid)));let l=0;for(const r of p.docs){const t=r.data()||{};if(!t.budgetId)if(f){const e=t.categoryId||t.categoriaId,a=e?b.get(e):null;a&&(await n(r.ref,{budgetId:a,updatedAt:i()}),l++)}else await n(r.ref,{budgetId:g.id,updatedAt:i()}),l++}if(await u(g.id,w.uid),!d.silent&&window.Snackbar){const r=f&&0===l?"Transações antigas sem budgetId foram mantidas (múltiplos orçamentos).":`${l} transações corrigidas com budgetId`;window.Snackbar({message:r,type:"success"})}return{corrigidas:l}}catch(w){return!d.silent&&window.Snackbar&&window.Snackbar({message:"Erro ao corrigir transações",type:"error"}),{corrigidas:0,error:w}}}async function f(d={}){try{const{user:w,budget:g}=c();if(!w||!g)return!d.silent&&window.Snackbar&&window.Snackbar({message:"Faça login e selecione um orçamento.",type:"error"}),{corrigidas:0};const f=Array.isArray(window.appState?.budgets)&&window.appState.budgets.length>1;let b=new Map;try{const r=await s({userId:w.uid});for(const t of r||[])t.id&&t.budgetId&&b.set(t.id,t.budgetId)}catch{}const p=await r(t(e(a,"recorrentes"),o("userId","==",w.uid)));let l=0;for(const r of p.docs){const t=r.data()||{};if(!t.budgetId)if(f){const e=t.categoryId||t.categoriaId,a=e?b.get(e):null;a&&(await n(r.ref,{budgetId:a,updatedAt:i()}),l++)}else await n(r.ref,{budgetId:g.id,updatedAt:i()}),l++}if(await u(g.id,w.uid),!d.silent&&window.Snackbar){const r=f&&0===l?"Recorrentes antigas sem budgetId foram mantidas (múltiplos orçamentos).":`${l} recorrentes corrigidas com budgetId`;window.Snackbar({message:r,type:"success"})}return{corrigidas:l}}catch(w){return!d.silent&&window.Snackbar&&window.Snackbar({message:"Erro ao corrigir recorrentes",type:"error"}),{corrigidas:0,error:w}}}async function b(r={}){try{!r.silent&&window.Snackbar&&window.Snackbar({message:"Iniciando correção de dados antigos...",type:"info"});const t=await w({silent:!!r.silent}),e=await g({silent:!!r.silent}),a=await f({silent:!!r.silent});return!r.silent&&window.Snackbar&&window.Snackbar({message:"Correção concluída.",type:"success"}),{categorias:t.corrigidas,transacoes:e.corrigidas,recorrentes:a.corrigidas}}catch(t){return!r.silent&&window.Snackbar&&window.Snackbar({message:"Erro ao executar correções",type:"error"}),{categorias:0,transacoes:0,recorrentes:0,error:t}}}async function p(d={}){try{const c=window.appState?.currentUser||window.appState?.user;if(!c?.uid)return{tx:0,rec:0};const w=window.appState?.budgets||[];if(!(Array.isArray(w)&&w.length>1))return{tx:0,rec:0};const g=new Map;try{const r=await s({userId:c.uid});for(const t of r||[])t.id&&t.budgetId&&g.set(t.id,t.budgetId)}catch{}let f=0,b=0;const p=await r(t(e(a,"transactions"),o("userId","==",c.uid)));for(const r of p.docs){const t=r.data()||{};if(!t.budgetId){const e=t.categoryId||t.categoriaId,a=e?g.get(e):null;a&&(await n(r.ref,{budgetId:a,updatedAt:i()}),f++)}}const l=await r(t(e(a,"recorrentes"),o("userId","==",c.uid)));for(const r of l.docs){const t=r.data()||{};if(!t.budgetId){const e=t.categoryId||t.categoriaId,a=e?g.get(e):null;a&&(await n(r.ref,{budgetId:a,updatedAt:i()}),b++)}}try{const r=window.appState?.currentBudget?.id,t=c.uid;r&&await u(r,t)}catch{}return!d.silent&&window.Snackbar&&window.Snackbar({message:`Migração: ${f} transações e ${b} recorrentes atribuídas por categoria`,type:"success"}),{tx:f,rec:b}}catch(c){return!d.silent&&window.Snackbar&&window.Snackbar({message:"Erro na migração global",type:"error"}),{tx:0,rec:0,error:c}}}async function l(d={}){try{const{user:w,budget:g}=c();if(!w?.uid||!g?.id)return!d.silent&&window.Snackbar&&window.Snackbar({message:"Faça login e selecione um orçamento.",type:"error"}),{tx:0,rec:0};const f=new Set;try{const r=await s({userId:w.uid});for(const t of r||[])t.id&&t.budgetId===g.id&&f.add(t.id)}catch{}let b=0,p=0;const l=await r(t(e(a,"transactions"),o("userId","==",w.uid)));for(const r of l.docs){const t=r.data()||{};if(!t.budgetId){const e=t.categoryId||t.categoriaId;e&&f.has(e)&&(await n(r.ref,{budgetId:g.id,updatedAt:i()}),b++)}}const m=await r(t(e(a,"recorrentes"),o("userId","==",w.uid)));for(const r of m.docs){const t=r.data()||{};if(!t.budgetId){const e=t.categoryId||t.categoriaId;e&&f.has(e)&&(await n(r.ref,{budgetId:g.id,updatedAt:i()}),p++)}}try{await u(g.id,w.uid)}catch{}return!d.silent&&window.Snackbar&&window.Snackbar({message:`Correção do orçamento: ${b} transações e ${p} recorrentes atribuídas`,type:"success"}),{tx:b,rec:p}}catch(w){return!d.silent&&window.Snackbar&&window.Snackbar({message:"Erro na correção do orçamento",type:"error"}),{tx:0,rec:0,error:w}}}"undefined"!=typeof window&&("function"!=typeof window.corrigirCategoriasSemBudget&&(window.corrigirCategoriasSemBudget=r=>w(r)),"function"!=typeof window.corrigirTransacoesSemBudget&&(window.corrigirTransacoesSemBudget=r=>g(r)),"function"!=typeof window.corrigirRecorrentesSemBudget&&(window.corrigirRecorrentesSemBudget=r=>f(r)),"function"!=typeof window.corrigirTudoSemBudget&&(window.corrigirTudoSemBudget=r=>b(r)),"function"!=typeof window.migrarOrfaosPorCategoria&&(window.migrarOrfaosPorCategoria=r=>p(r)),"function"!=typeof window.corrigirOrfaosDoOrcamento&&(window.corrigirOrfaosDoOrcamento=r=>l(r)));export{w as corrigirCategoriasSemBudget,l as corrigirOrfaosDoOrcamento,f as corrigirRecorrentesSemBudget,g as corrigirTransacoesSemBudget,b as corrigirTudoSemBudget,p as migrarOrfaosPorCategoria};

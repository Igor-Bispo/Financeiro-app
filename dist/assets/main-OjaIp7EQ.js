const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CategoriesPage-CbUTxUMT.js","assets/PeriodIndicator-CGknNJvc.js","assets/vendor-7JQXQzuE.js","assets/ConfigService-DR3aZRGY.js","assets/RecorrentesPage-BviOzZF0.js","assets/NotificationModal-B7R6h_Eo.js","assets/userSettingsRepo-DAw0TtCo.js","assets/resilientClient-DTyPV8Bx.js","assets/networkHandler-Dd825SpE.js","assets/ResilientAuthService-zFN0-MN9.js","assets/fixers-CXVIOlxj.js","assets/settings.service-y0DMkajC.js","assets/AuthService-DCnUDsIo.js","assets/index-DT_9SM3O.js","assets/TransactionsPage-Bz69yW2z.js","assets/perf--GZdtUOV.js","assets/NotificationsPage-LRJ1uuMq.js","assets/VoiceService-Di9ZePZc.js","assets/AnalyticsPage-BuldFbzh.js","assets/SettingsPage-YyPZEyRR.js"])))=>i.map(i=>d[i]);
import{o as e}from"./vendor-7JQXQzuE.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const t={},n=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),a=r?.nonce||r?.getAttribute("nonce");i=e(n.map(e=>{if((e=function(e){return"/"+e}(e))in t)return;t[e]=!0;const n=e.endsWith(".css"),r=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const i=document.createElement("link");return i.rel=n?"stylesheet":"modulepreload",n||(i.as="script"),i.crossOrigin="",i.href=e,a&&i.setAttribute("nonce",a),document.head.appendChild(i),n?new Promise((t,n)=>{i.addEventListener("load",t),i.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return i.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};var r={};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],a=i+1<e.length,o=a?e[i+1]:0,s=i+2<e.length,c=s?e[i+2]:0,d=t>>2,l=(3&t)<<4|o>>4;let u=(15&o)<<2|c>>6,h=63&c;s||(h=64,a||(u=64)),r.push(n[d],n[l],n[u],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){const a=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{const a=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&a)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],a=i<e.length?n[e.charAt(i)]:0;++i;const s=i<e.length?n[e.charAt(i)]:64;++i;const c=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==a||null==s||null==c)throw new o;const d=t<<2|a>>4;if(r.push(d),64!==s){const e=a<<4&240|s>>2;if(r.push(e),64!==c){const e=s<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(e){return function(e){const t=i(e);return a.encodeByteArray(t,!0)}(e).replace(/\./g,"")},c=function(e){try{return a.decodeString(e,!0)}catch(t){}return null};
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const d=()=>
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,l=()=>{try{return d()||(()=>{if("undefined"==typeof process)return;const e=r.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&c(e[1]);return t&&JSON.parse(t)})()}catch(e){return}},u=e=>l()?.emulatorHosts?.[e],h=()=>l()?.config,p=e=>l()?.[`_${e}`];
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class m{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function g(e){return(await fetch(e,{credentials:"include"})).ok}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w={};let y=!1;function v(e,t){if("undefined"==typeof window||"undefined"==typeof document||!f(window.location.host)||w[e]===t||w[e]||y)return;function n(e){return`__firebase__banner__${e}`}w[e]=t;const r="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(w))w[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function a(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{y=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),o=document.getElementById(t)||document.createElement("span"),s=n("learnmore"),c=document.getElementById(s)||document.createElement("a"),d=n("preprendIcon"),l=document.getElementById(d)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(c,s);const n=a();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(l,d),t.append(l,o,c,n),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",l.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(l.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function _(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function I(){return!function(){const e=l()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function E(){try{return"object"==typeof indexedDB}catch(e){return!1}}function T(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(n){t(n)}})}class S extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,k.prototype.create)}}class k{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],a=i?function(e,t){return e.replace(A,(e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error",o=`${this.serviceName}: ${a} (${r}).`;return new S(r,o,n)}}const A=/\{\$([^}]+)}/g;function C(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],a=t[i];if(x(n)&&x(a)){if(!C(n,a))return!1}else if(n!==a)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function x(e){return null!==e&&"object"==typeof e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function P(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function N(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class R{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=O),void 0===r.error&&(r.error=O),void 0===r.complete&&(r.complete=O);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function O(){}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M(e){return e&&e._delegate?e._delegate:e}class U{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new m;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(n)return null;throw r}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:V})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(e=V){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=V){return this.instances.has(e)}getOptions(e=V){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,a]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&a.resolve(r)}return r}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);const i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===V?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var r;return n||null}normalizeInstanceIdentifier(e=V){return this.component?this.component.multipleInstances?e:V:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class B{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new F(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var j,$;($=j||(j={}))[$.DEBUG=0]="DEBUG",$[$.VERBOSE=1]="VERBOSE",$[$.INFO=2]="INFO",$[$.WARN=3]="WARN",$[$.ERROR=4]="ERROR",$[$.SILENT=5]="SILENT";const q={debug:j.DEBUG,verbose:j.VERBOSE,info:j.INFO,warn:j.WARN,error:j.ERROR,silent:j.SILENT},z=j.INFO,H={[j.DEBUG]:"log",[j.VERBOSE]:"log",[j.INFO]:"info",[j.WARN]:"warn",[j.ERROR]:"error"},G=(e,t,...n)=>{if(t<e.logLevel)return;(new Date).toISOString();if(!H[t])throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};let W=class{constructor(e){this.name=e,this._logLevel=z,this._logHandler=G,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in j))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?q[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,j.DEBUG,...e),this._logHandler(this,j.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,j.VERBOSE,...e),this._logHandler(this,j.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,j.INFO,...e),this._logHandler(this,j.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,j.WARN,...e),this._logHandler(this,j.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,j.ERROR,...e),this._logHandler(this,j.ERROR,...e)}};
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===t?.type}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const Q="@firebase/app",Y="0.14.0",J=new W("@firebase/app"),X="@firebase/app-compat",Z="@firebase/analytics-compat",ee="@firebase/analytics",te="@firebase/app-check-compat",ne="@firebase/app-check",re="@firebase/auth",ie="@firebase/auth-compat",ae="@firebase/database",oe="@firebase/data-connect",se="@firebase/database-compat",ce="@firebase/functions",de="@firebase/functions-compat",le="@firebase/installations",ue="@firebase/installations-compat",he="@firebase/messaging",pe="@firebase/messaging-compat",me="@firebase/performance",fe="@firebase/performance-compat",ge="@firebase/remote-config",we="@firebase/remote-config-compat",ye="@firebase/storage",ve="@firebase/storage-compat",be="@firebase/firestore",_e="@firebase/ai",Ie="@firebase/firestore-compat",Ee="firebase",Te="[DEFAULT]",Se={[Q]:"fire-core",[X]:"fire-core-compat",[ee]:"fire-analytics",[Z]:"fire-analytics-compat",[ne]:"fire-app-check",[te]:"fire-app-check-compat",[re]:"fire-auth",[ie]:"fire-auth-compat",[ae]:"fire-rtdb",[oe]:"fire-data-connect",[se]:"fire-rtdb-compat",[ce]:"fire-fn",[de]:"fire-fn-compat",[le]:"fire-iid",[ue]:"fire-iid-compat",[he]:"fire-fcm",[pe]:"fire-fcm-compat",[me]:"fire-perf",[fe]:"fire-perf-compat",[ge]:"fire-rc",[we]:"fire-rc-compat",[ye]:"fire-gcs",[ve]:"fire-gcs-compat",[be]:"fire-fst",[Ie]:"fire-fst-compat",[_e]:"fire-vertex","fire-js":"fire-js",[Ee]:"fire-js-all"},ke=new Map,Ae=new Map,Ce=new Map;function xe(e,t){try{e.container.addComponent(t)}catch(n){J.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function De(e){const t=e.name;if(Ce.has(t))return J.debug(`There were multiple attempts to register component ${t}.`),!1;Ce.set(t,e);for(const n of ke.values())xe(n,e);for(const n of Ae.values())xe(n,e);return!0}function Pe(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Ne(e){return null!=e&&void 0!==e.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Re=new k("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Oe{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new U("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Re.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Le="12.0.0";function Me(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const r={name:Te,automaticDataCollectionEnabled:!0,...t},i=r.name;if("string"!=typeof i||!i)throw Re.create("bad-app-name",{appName:String(i)});if(n||(n=h()),!n)throw Re.create("no-options");const a=ke.get(i);if(a){if(C(n,a.options)&&C(r,a.config))return a;throw Re.create("duplicate-app",{appName:i})}const o=new B(i);for(const c of Ce.values())o.addComponent(c);const s=new Oe(n,r,o);return ke.set(i,s),s}function Ue(e=Te){const t=ke.get(e);if(!t&&e===Te&&h())return Me();if(!t)throw Re.create("no-app",{appName:e});return t}function Ve(e,t,n){let r=Se[e]??e;n&&(r+=`-${n}`);const i=r.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const e=[`Unable to register library "${r}" with version "${t}":`];return i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void J.warn(e.join(" "))}De(new U(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fe="firebase-heartbeat-store";let Be=null;function je(){return Be||(Be=e("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Fe)}catch(n){}}}).catch(e=>{throw Re.create("idb-open",{originalErrorMessage:e.message})})),Be}async function $e(e,t){try{const n=(await je()).transaction(Fe,"readwrite"),r=n.objectStore(Fe);await r.put(t,qe(e)),await n.done}catch(n){if(n instanceof S)J.warn(n.message);else{const e=Re.create("idb-set",{originalErrorMessage:n?.message});J.warn(e.message)}}}function qe(e){return`${e.name}!${e.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ze{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ge(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=He();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){J.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const e=He(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),We(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),We(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=s(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return J.warn(e),""}}}function He(){return(new Date).toISOString().substring(0,10)}class Ge{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!E()&&T().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await je()).transaction(Fe),n=await t.objectStore(Fe).get(qe(e));return await t.done,n}catch(t){if(t instanceof S)J.warn(t.message);else{const e=Re.create("idb-get",{originalErrorMessage:t?.message});J.warn(e.message)}}}(this.app);return e?.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return $e(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return $e(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function We(e){return s(JSON.stringify({version:2,heartbeats:e})).length}var Ke;Ke="",De(new U("platform-logger",e=>new K(e),"PRIVATE")),De(new U("heartbeat",e=>new ze(e),"PRIVATE")),Ve(Q,Y,Ke),Ve(Q,Y,"esm2020"),Ve("fire-js","");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Ve("firebase","12.0.0","app");function Qe(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Ye=
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}},Je=Qe,Xe=new k("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ze=new W("@firebase/auth");function et(e,...t){Ze.logLevel<=j.ERROR&&Ze.error(`Auth (${Le}): ${e}`,...t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tt(e,...t){throw ot(e,...t)}function nt(e,...t){return ot(e,...t)}function rt(e,t,n){const r={...Je(),[t]:n};return new k("auth","Firebase",r).create(t,{appName:e.name})}function it(e){return rt(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function at(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&tt(e,"argument-error"),rt(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ot(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Xe.create(e,...t)}function st(e,t,...n){if(!e)throw ot(t,...n)}function ct(e){const t="INTERNAL ASSERTION FAILED: "+e;throw et(t),new Error(t)}function dt(e,t){e||ct(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lt(){return"undefined"!=typeof self&&self.location?.href||""}function ut(){return"http:"===ht()||"https:"===ht()}function ht(){return"undefined"!=typeof self&&self.location?.protocol||null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class pt{constructor(e,t){this.shortDelay=e,this.longDelay=t,dt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(b())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ut()||_()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mt(e,t){dt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void ct("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void ct("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void ct("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},wt=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],yt=new pt(3e4,6e4);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vt(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function bt(e,t,n,r,i={}){return _t(e,i,async()=>{let i={},a={};r&&("GET"===t?a=r:i={body:JSON.stringify(r)});const o=D({key:e.config.apiKey,...a}).slice(1),s=await e._getAdditionalHeaders();s["Content-Type"]="application/json",e.languageCode&&(s["X-Firebase-Locale"]=e.languageCode);const c={method:t,headers:s,...i};return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&f(e.emulatorConfig.host)&&(c.credentials="include"),ft.fetch()(await Et(e,e.config.apiHost,n,o),c)})}async function _t(e,t,n){e._canInitEmulator=!1;const r={...gt,...t};try{const t=new St(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw kt(e,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const t=i.ok?a.errorMessage:a.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw kt(e,"credential-already-in-use",a);if("EMAIL_EXISTS"===n)throw kt(e,"email-already-in-use",a);if("USER_DISABLED"===n)throw kt(e,"user-disabled",a);const s=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw rt(e,s,o);tt(e,s)}}catch(i){if(i instanceof S)throw i;tt(e,"network-request-failed",{message:String(i)})}}async function It(e,t,n,r,i={}){const a=await bt(e,t,n,r,i);return"mfaPendingCredential"in a&&tt(e,"multi-factor-auth-required",{_serverResponse:a}),a}async function Et(e,t,n,r){const i=`${t}${n}?${r}`,a=e,o=a.config.emulator?mt(e.config,i):`${e.config.apiScheme}://${i}`;if(wt.includes(n)&&(await a._persistenceManagerAvailable,"COOKIE"===a._getPersistenceType())){return a._getPersistence()._getFinalTarget(o).toString()}return o}function Tt(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class St{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(nt(this.auth,"network-request-failed")),yt.get())})}}function kt(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=nt(e,t,r);return i.customData._tokenResponse=n,i}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function At(e){return void 0!==e&&void 0!==e.getResponse}function Ct(e){return void 0!==e&&void 0!==e.enterprise}class xt{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Tt(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dt(e,t){return bt(e,"GET","/v2/recaptchaConfig",vt(e,t))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pt(e,t){return bt(e,"POST","/v1/accounts:lookup",t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rt(e,t=!1){const n=M(e),r=await n.getIdToken(t),i=Lt(r);st(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const a="object"==typeof i.firebase?i.firebase:void 0,o=a?.sign_in_provider;return{claims:i,token:r,authTime:Nt(Ot(i.auth_time)),issuedAtTime:Nt(Ot(i.iat)),expirationTime:Nt(Ot(i.exp)),signInProvider:o||null,signInSecondFactor:a?.sign_in_second_factor||null}}function Ot(e){return 1e3*Number(e)}function Lt(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return et("JWT malformed, contained fewer than 3 sections"),null;try{const e=c(n);return e?JSON.parse(e):(et("Failed to decode base64 JWT payload"),null)}catch(i){return et("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Mt(e){const t=Lt(e);return st(t,"internal-error"),st(void 0!==t.exp,"internal-error"),st(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ut(e,t,n=!1){if(n)return t;try{return await t}catch(r){throw r instanceof S&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}class Vt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e?.code&&this.schedule(!0))}this.schedule()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Nt(this.lastLoginAt),this.creationTime=Nt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bt(e){const t=e.auth,n=await e.getIdToken(),r=await Ut(e,Pt(t,{idToken:n}));st(r?.users.length,t,"internal-error");const i=r.users[0];e._notifyReloadListener(i);const a=i.providerUserInfo?.length?$t(i.providerUserInfo):[],o=(s=e.providerData,c=a,[...s.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var s,c;const d=e.isAnonymous,l=!(e.email&&i.passwordHash||o?.length),u=!!d&&l,h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Ft(i.createdAt,i.lastLoginAt),isAnonymous:u};Object.assign(e,h)}async function jt(e){const t=M(e);await Bt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function $t(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class qt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){st(e.idToken,"internal-error"),st(void 0!==e.idToken,"internal-error"),st(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Mt(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){st(0!==e.length,"internal-error");const t=Mt(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(st(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await _t(e,{},async()=>{const n=D({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,a=await Et(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const s={method:"POST",headers:o,body:n};return e.emulatorConfig&&f(e.emulatorConfig.host)&&(s.credentials="include"),ft.fetch()(a,s)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,a=new qt;return n&&(st("string"==typeof n,"internal-error",{appName:e}),a.refreshToken=n),r&&(st("string"==typeof r,"internal-error",{appName:e}),a.accessToken=r),i&&(st("number"==typeof i,"internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new qt,this.toJSON())}_performRefresh(){return ct("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zt(e,t){st("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Ht{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new Vt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Ft(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Ut(this,this.stsTokenManager.getToken(this.auth,e));return st(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Rt(this,e)}reload(){return jt(this)}_assign(e){this!==e&&(st(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ht({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){st(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Bt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ne(this.auth.app))return Promise.reject(it(this.auth));const e=await this.getIdToken();return await Ut(this,async function(e,t){return bt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,o=t.tenantId??void 0,s=t._redirectEventId??void 0,c=t.createdAt??void 0,d=t.lastLoginAt??void 0,{uid:l,emailVerified:u,isAnonymous:h,providerData:p,stsTokenManager:m}=t;st(l&&m,e,"internal-error");const f=qt.fromJSON(this.name,m);st("string"==typeof l,e,"internal-error"),zt(n,e.name),zt(r,e.name),st("boolean"==typeof u,e,"internal-error"),st("boolean"==typeof h,e,"internal-error"),zt(i,e.name),zt(a,e.name),zt(o,e.name),zt(s,e.name),zt(c,e.name),zt(d,e.name);const g=new Ht({uid:l,auth:e,email:r,emailVerified:u,displayName:n,isAnonymous:h,photoURL:a,phoneNumber:i,tenantId:o,stsTokenManager:f,createdAt:c,lastLoginAt:d});return p&&Array.isArray(p)&&(g.providerData=p.map(e=>({...e}))),s&&(g._redirectEventId=s),g}static async _fromIdTokenResponse(e,t,n=!1){const r=new qt;r.updateFromServerResponse(t);const i=new Ht({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Bt(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];st(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?$t(r.providerUserInfo):[],a=!(r.email&&r.passwordHash||i?.length),o=new qt;o.updateFromIdToken(n);const s=new Ht({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:a}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Ft(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||i?.length)};return Object.assign(s,c),s}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gt=new Map;function Wt(e){dt(e instanceof Function,"Expected a class definition");let t=Gt.get(e);return t?(dt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Gt.set(e,t),t)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Kt.type="NONE";const Qt=Kt;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yt(e,t,n){return`firebase:${e}:${t}:${n}`}class Jt{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Yt(this.userKey,r.apiKey,i),this.fullPersistenceKey=Yt("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await Pt(this.auth,{idToken:e}).catch(()=>{});return t?Ht._fromGetAccountInfoResponse(this.auth,t,e):null}return Ht._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Jt(Wt(Qt),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||Wt(Qt);const a=Yt(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const t=await c._get(a);if(t){let n;if("string"==typeof t){const r=await Pt(e,{idToken:t}).catch(()=>{});if(!r)break;n=await Ht._fromGetAccountInfoResponse(e,r,t)}else n=Ht._fromJSON(e,t);c!==i&&(o=n),i=c;break}}catch{}const s=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&s.length?(i=s[0],o&&await i._set(a,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(a)}catch{}})),new Jt(i,e,n)):new Jt(i,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(nn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Zt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(an(t))return"Blackberry";if(on(t))return"Webos";if(en(t))return"Safari";if((t.includes("chrome/")||tn(t))&&!t.includes("edge/"))return"Chrome";if(rn(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===n?.length)return n[1]}return"Other"}function Zt(e=b()){return/firefox\//i.test(e)}function en(e=b()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function tn(e=b()){return/crios\//i.test(e)}function nn(e=b()){return/iemobile/i.test(e)}function rn(e=b()){return/android/i.test(e)}function an(e=b()){return/blackberry/i.test(e)}function on(e=b()){return/webos/i.test(e)}function sn(e=b()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function cn(){return function(){const e=b();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function dn(e=b()){return sn(e)||rn(e)||on(e)||an(e)||/windows phone/i.test(e)||nn(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ln(e,t=[]){let n;switch(e){case"Browser":n=Xt(b());break;case"Worker":n=`${Xt(b())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Le}/${r}`}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(i){r(i)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new fn(this),this.idTokenSubscription=new fn(this),this.beforeStateQueue=new un(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Xe,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Wt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Jt.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(n){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Pt(this,{idToken:e}),n=await Ht._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ne(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const t=this.redirectUser?._redirectEventId,i=n?._redirectEventId,a=await this.tryRedirectSignIn(e);t&&t!==i||!a?.user||(n=a.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(i){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return st(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Bt(e)}catch(t){if("auth/network-request-failed"!==t?.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ne(this.app))return Promise.reject(it(this));const t=e?M(e):null;return t&&st(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&st(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ne(this.app)?Promise.reject(it(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ne(this.app)?Promise.reject(it(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Wt(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return bt(e,"GET","/v2/passwordPolicy",vt(e,t))}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this),t=new hn(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new k("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return bt(e,"POST","/v2/accounts:revokeToken",vt(e,t))}(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Wt(e)||this._popupRedirectResolver;st(t,this,"argument-error"),this.redirectPersistenceManager=await Jt.create(this,[Wt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(st(o,this,"internal-error"),o.then(()=>{a||i(this.currentUser)}),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{a=!0,i()}}{const n=e.addObserver(t);return()=>{a=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return st(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ln(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await(this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(Ne(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken());return e?.error&&function(e,...t){Ze.logLevel<=j.WARN&&Ze.warn(`Auth (${Le}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}function mn(e){return M(e)}class fn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new R(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return st(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gn={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function wn(e){return gn.loadJS(e)}function yn(e){return`__${e}${Math.floor(1e6*Math.random())}`}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vn=1e12;class bn{constructor(e){this.auth=e,this.counter=vn,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new En(e,this.auth.name,t||{})),this.counter++,n}reset(e){const t=e||vn;this._widgets.get(t)?.delete(),this._widgets.delete(t)}getResponse(e){const t=e||vn;return this._widgets.get(t)?.getResponse()||""}async execute(e){const t=e||vn;return this._widgets.get(t)?.execute(),""}}class _n{constructor(){this.enterprise=new In}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class In{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class En{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;st(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Tn="NO_RECAPTCHA";class Sn{constructor(e){this.type="recaptcha-enterprise",this.auth=mn(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;Ct(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(Tn)})}):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new _n).execute("siteKey",{action:"verify"})}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Dt(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new xt(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(i=>{if(!t&&Ct(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=gn.recaptchaEnterpriseScript;0!==t.length&&(t+=i),wn(t).then(()=>{n(i,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function kn(e,t,n,r=!1,i=!1){const a=new Sn(e);let o;if(i)o=Tn;else try{o=await a.verify(n)}catch(c){o=await a.verify(n,!0)}const s={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return s}return r?Object.assign(s,{captchaResp:o}):Object.assign(s,{captchaResponse:o}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function An(e,t,n,r,i){if("EMAIL_PASSWORD_PROVIDER"===i){if(e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await kn(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch(async i=>{if("auth/missing-recaptcha-token"===i.code){const i=await kn(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)})}if("PHONE_PROVIDER"===i){if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){const i=await kn(e,t,n);return r(e,i).catch(async i=>{if("AUDIT"===e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){const i=await kn(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{const i=await kn(e,t,n,!1,!0);return r(e,i)}}return Promise.reject(i+" provider is not supported.")}async function Cn(e){const t=mn(e),n=await Dt(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new xt(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new Sn(t).verify()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(e,t){const n=Pe(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(C(n.getOptions(),t??{}))return e;tt(e,"already-initialized")}return n.initialize({options:t})}function Dn(e,t,n){const r=mn(e);st(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!n?.disableWarnings,a=Pn(t),{host:o,port:s}=function(e){const t=Pn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Nn(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Nn(t)}}}(t),c=null===s?"":`:${s}`,d={url:`${a}//${o}${c}/`},l=Object.freeze({host:o,port:s,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return st(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void st(C(d,r.config.emulator)&&C(l,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=d,r.emulatorConfig=l,r.settings.appVerificationDisabledForTesting=!0,f(o)?(g(`${a}//${o}${c}`),v("Auth",!0)):i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&console.info;"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */()}function Pn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Nn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Rn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ct("not implemented")}_getIdTokenResponse(e){return ct("not implemented")}_linkToIdToken(e,t){return ct("not implemented")}_getReauthenticationResolver(e){return ct("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function On(e,t){return bt(e,"POST","/v1/accounts:resetPassword",vt(e,t))}async function Ln(e,t){return bt(e,"POST","/v1/accounts:signUp",t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function Mn(e,t){return It(e,"POST","/v1/accounts:signInWithPassword",vt(e,t))}async function Un(e,t){return bt(e,"POST","/v1/accounts:sendOobCode",vt(e,t))}async function Vn(e,t){return Un(e,t)}async function Fn(e,t){return Un(e,t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Bn extends Rn{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Bn(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Bn(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return An(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Mn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
return async function(e,t){return It(e,"POST","/v1/accounts:signInWithEmailLink",vt(e,t))}(e,{email:this._email,oobCode:this._password});default:tt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return An(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ln,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return It(e,"POST","/v1/accounts:signInWithEmailLink",vt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:tt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jn(e,t){return It(e,"POST","/v1/accounts:signInWithIdp",vt(e,t))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n extends Rn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new $n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,...i}=t;if(!n||!r)return null;const a=new $n(n,r);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){return jn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,jn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,jn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=D(t)}return e}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qn(e,t){return bt(e,"POST","/v1/accounts:sendVerificationCode",vt(e,t))}const zn={USER_NOT_FOUND:"user-not-found"};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Hn extends Rn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Hn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Hn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return It(e,"POST","/v1/accounts:signInWithPhoneNumber",vt(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await It(e,"POST","/v1/accounts:signInWithPhoneNumber",vt(e,t));if(n.temporaryProof)throw kt(e,"account-exists-with-different-credential",n);return n}(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return async function(e,t){return It(e,"POST","/v1/accounts:signInWithPhoneNumber",vt(e,{...t,operation:"REAUTH"}),zn)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Hn({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(e){const t=P(N(e)),n=t.apiKey??null,r=t.oobCode??null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);st(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=function(e){const t=P(N(e)).link,n=t?P(N(t)).deep_link_id:null,r=P(N(e)).deep_link_id;return(r?P(N(r)).link:null)||r||n||t||e}(e);try{return new Gn(t)}catch{return null}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Wn{constructor(){this.providerId=Wn.PROVIDER_ID}static credential(e,t){return Bn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Gn.parseLink(t);return st(n,"argument-error"),Bn._fromEmailAndCode(e,n.code,n.tenantId)}}Wn.PROVIDER_ID="password",Wn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Wn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Kn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn extends Kn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Yn extends Qn{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return st("providerId"in t&&"signInMethod"in t,"argument-error"),$n._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return st(e.idToken||e.accessToken,"argument-error"),$n._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return Yn.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Yn.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:a,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new Yn(o)._credential({idToken:t,accessToken:n,nonce:a,pendingToken:i})}catch(s){return null}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn extends Qn{constructor(){super("facebook.com")}static credential(e){return $n._fromParams({providerId:Jn.PROVIDER_ID,signInMethod:Jn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Jn.credentialFromTaggedObject(e)}static credentialFromError(e){return Jn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Jn.credential(e.oauthAccessToken)}catch{return null}}}Jn.FACEBOOK_SIGN_IN_METHOD="facebook.com",Jn.PROVIDER_ID="facebook.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Xn extends Qn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return $n._fromParams({providerId:Xn.PROVIDER_ID,signInMethod:Xn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Xn.credentialFromTaggedObject(e)}static credentialFromError(e){return Xn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Xn.credential(t,n)}catch{return null}}}Xn.GOOGLE_SIGN_IN_METHOD="google.com",Xn.PROVIDER_ID="google.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Zn extends Qn{constructor(){super("github.com")}static credential(e){return $n._fromParams({providerId:Zn.PROVIDER_ID,signInMethod:Zn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zn.credentialFromTaggedObject(e)}static credentialFromError(e){return Zn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Zn.credential(e.oauthAccessToken)}catch{return null}}}Zn.GITHUB_SIGN_IN_METHOD="github.com",Zn.PROVIDER_ID="github.com";class er extends Rn{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return jn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,jn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,jn(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new er(n,i):null}static _create(e,t){return new er(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr extends Kn{constructor(e){st(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return tr.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return tr.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=er.fromJSON(e);return st(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return er._create(n,t)}catch(r){return null}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr extends Qn{constructor(){super("twitter.com")}static credential(e,t){return $n._fromParams({providerId:nr.PROVIDER_ID,signInMethod:nr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return nr.credentialFromTaggedObject(e)}static credentialFromError(e){return nr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return nr.credential(t,n)}catch{return null}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function rr(e,t){return It(e,"POST","/v1/accounts:signUp",vt(e,t))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nr.TWITTER_SIGN_IN_METHOD="twitter.com",nr.PROVIDER_ID="twitter.com";class ir{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Ht._fromIdTokenResponse(e,n,r),a=ar(n);return new ir({user:i,providerId:a,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=ar(n);return new ir({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function ar(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function or(e){if(Ne(e.app))return Promise.reject(it(e));const t=mn(e);if(await t._initializationPromise,t.currentUser?.isAnonymous)return new ir({user:t.currentUser,providerId:null,operationType:"signIn"});const n=await rr(t,{returnSecureToken:!0}),r=await ir._fromIdTokenResponse(t,"signIn",n,!0);return await t._updateCurrentUser(r.user),r}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr extends S{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,sr.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new sr(e,t,n,r)}}function cr(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw sr._fromErrorAndOperation(e,n,t,r);throw n})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dr(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lr(e,t,n=!1){const r=await Ut(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ir._forOperation(e,"link",r)}async function ur(e,t,n){await Bt(t);const r=!1===e?"provider-already-linked":"no-such-provider";st(dr(t.providerData).has(n)===e,t.auth,r)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hr(e,t,n=!1){const{auth:r}=e;if(Ne(r.app))return Promise.reject(it(r));const i="reauthenticate";try{const a=await Ut(e,cr(r,i,t,e),n);st(a.idToken,r,"internal-error");const o=Lt(a.idToken);st(o,r,"internal-error");const{sub:s}=o;return st(e.uid===s,r,"user-mismatch"),ir._forOperation(e,i,a)}catch(a){throw"auth/user-not-found"===a?.code&&tt(r,"user-mismatch"),a}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pr(e,t,n=!1){if(Ne(e.app))return Promise.reject(it(e));const r="signIn",i=await cr(e,r,t),a=await ir._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(a.user),a}async function mr(e,t){return pr(mn(e),t)}async function fr(e,t){const n=M(e);return await ur(!1,n,t.providerId),lr(n,t)}async function gr(e,t){return hr(M(e),t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class wr{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?yr._fromServerResponse(e,t):"totpInfo"in t?vr._fromServerResponse(e,t):tt(e,"internal-error")}}class yr extends wr{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new yr(t)}}class vr extends wr{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new vr(t)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function br(e,t,n){st(n.url?.length>0,e,"invalid-continue-uri"),st(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),st(void 0===n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(st(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(st(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _r(e){const t=mn(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Ir(e,t){const n=M(e),r=await On(n,{oobCode:t}),i=r.requestType;switch(st(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":st(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":st(r.mfaInfo,n,"internal-error");default:st(r.email,n,"internal-error")}let a=null;return r.mfaInfo&&(a=wr._fromServerResponse(mn(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:a},operation:i}}async function Er(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const a=await Ut(e,async function(e,t){return bt(e,"POST","/v1/accounts:update",t)}(r,i));await e._updateTokensIfNecessary(a,!0)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Sr extends Tr{constructor(e,t,n,r){super(e,t,n),this.username=r}}class kr extends Tr{constructor(e,t){super(e,"facebook.com",t)}}class Ar extends Sr{constructor(e,t){super(e,"github.com",t,"string"==typeof t?.login?t?.login:null)}}class Cr extends Tr{constructor(e,t){super(e,"google.com",t)}}class xr extends Sr{constructor(e,t,n){super(e,"twitter.com",t,n)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Dr(e,t){return M(e).setPersistence(t)}function Pr(e,t,n,r){return M(e).onIdTokenChanged(t,n,r)}function Nr(e,t,n){return M(e).beforeAuthStateChanged(t,n)}function Rr(e,t,n,r){return M(e).onAuthStateChanged(t,n,r)}function Or(e){return M(e).signOut()}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Lr{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new Lr("enroll",e,t)}static _fromMfaPendingCredential(e){return new Lr("signin",e)}toJSON(){const e="enroll"===this.type?"idToken":"pendingCredential";return{multiFactorSession:{[e]:this.credential}}}static fromJSON(e){if(e?.multiFactorSession){if(e.multiFactorSession?.pendingCredential)return Lr._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(e.multiFactorSession?.idToken)return Lr._fromIdtoken(e.multiFactorSession.idToken)}return null}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mr{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=mn(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map(e=>wr._fromServerResponse(n,e));st(r.mfaPendingCredential,n,"internal-error");const a=Lr._fromMfaPendingCredential(r.mfaPendingCredential);return new Mr(a,i,async e=>{const i=await e._process(n,a);delete r.mfaInfo,delete r.mfaPendingCredential;const o={...r,idToken:i.idToken,refreshToken:i.refreshToken};switch(t.operationType){case"signIn":const e=await ir._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return st(t.user,n,"internal-error"),ir._forOperation(t.user,t.operationType,o);default:tt(n,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ur(e,t){return bt(e,"POST","/v2/accounts/mfaEnrollment:start",vt(e,t))}class Vr{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>wr._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new Vr(e)}async getSession(){return Lr._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const n=e,r=await this.getSession(),i=await Ut(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await Ut(this.user,(r=this.user.auth,i={idToken:n,mfaEnrollmentId:t},bt(r,"POST","/v2/accounts/mfaEnrollment:withdraw",vt(r,i))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(a){throw a}var r,i}}const Fr=new WeakMap;const Br="__sak";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Br,"1"),this.storage.removeItem(Br),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r extends jr{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=dn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);cn()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}$r.type="LOCAL";const qr=$r;
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zr(e){const t=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),n=RegExp(`${t}=([^;]+)`);return document.cookie.match(n)?.[1]??null}function Hr(e){return`${"http:"===window.location.protocol?"__dev_":"__HOST-"}FIREBASE_${e.split(":")[3]}`}class Gr{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return!("boolean"==typeof isSecureContext&&!isSecureContext)&&("undefined"!=typeof navigator&&"undefined"!=typeof document&&(navigator.cookieEnabled??!0))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=Hr(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return e?.value}return zr(t)}async _remove(e){if(!this._isAvailable())return;if(!(await this._get(e)))return;const t=Hr(e);document.cookie=`${t}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const n=Hr(e);if(window.cookieStore){const e=e=>{const r=e.changed.find(e=>e.name===n);r&&t(r.value);e.deleted.find(e=>e.name===n)&&t(null)},r=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,r),window.cookieStore.addEventListener("change",e)}let r=zr(n);const i=setInterval(()=>{const e=zr(n);e!==r&&(t(e),r=e)},1e3);this.listenerUnsubscribes.set(t,()=>clearInterval(i))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}Gr.type="COOKIE";const Wr=Gr;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr extends jr{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Kr.type="SESSION";const Qr=Kr;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Yr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new Yr(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,a=this.handlersMap[r];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(a).map(async e=>e(t.origin,i)),s=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:s})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Jr(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Yr.receivers=[];class Xr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,a;return new Promise((o,s)=>{const c=Jr("",20);r.port1.start();const d=setTimeout(()=>{s(new Error("unsupported_event"))},n);a={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{s(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(d),clearTimeout(i),s(new Error("invalid_response"))}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zr(){return window}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ei(){return void 0!==Zr().WorkerGlobalScope&&"function"==typeof Zr().importScripts}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ti="firebaseLocalStorageDb",ni="firebaseLocalStorage",ri="fbase_key";class ii{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ai(e,t){return e.transaction([ni],t?"readwrite":"readonly").objectStore(ni)}function oi(){const e=indexedDB.open(ti,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(ni,{keyPath:ri})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(ni)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(ti);return new ii(e).toPromise()}(),t(await oi()))})})}async function si(e,t,n){const r=ai(e,!0).put({[ri]:t,value:n});return new ii(r).toPromise()}function ci(e,t){const n=ai(e,!0).delete(t);return new ii(n).toPromise()}class di{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await oi()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ei()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Yr._getInstance(ei()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await async function(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new Xr(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await oi();return await si(e,Br,"1"),await ci(e,Br),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>si(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=ai(e,!1).get(t),r=await new ii(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ci(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=ai(e,!1).getAll();return new ii(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}di.type="LOCAL";const li=di;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ui(e,t){return bt(e,"POST","/v2/accounts/mfaSignIn:start",vt(e,t))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const hi=yn("rcb"),pi=new pt(3e4,6e4);class mi{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!Zr().grecaptcha?.render}load(e,t=""){return st(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)&&At(Zr().grecaptcha)?Promise.resolve(Zr().grecaptcha):new Promise((n,r)=>{const i=Zr().setTimeout(()=>{r(nt(e,"network-request-failed"))},pi.get());Zr()[hi]=()=>{Zr().clearTimeout(i),delete Zr()[hi];const a=Zr().grecaptcha;if(!a||!At(a))return void r(nt(e,"internal-error"));const o=a.render;a.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(a)};wn(`${gn.recaptchaV2Script}?${D({onload:hi,render:"explicit",hl:t})}`).catch(()=>{clearTimeout(i),r(nt(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!Zr().grecaptcha?.render&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class fi{async load(e){return new bn(e)}clearedOneInstance(){}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gi="recaptcha",wi={theme:"light",type:"image"};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class yi{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Hn._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function vi(e,t,n){if(!e._getRecaptchaConfig())try{await Cn(e)}catch(r){}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){st("enroll"===t.type,e,"internal-error");const i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},a=An(e,i,"mfaSmsEnrollment",async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===Tn){st(n?.type===gi,e,"argument-error");return Ur(e,await bi(e,t,n))}return Ur(e,t)},"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{st("signin"===t.type,e,"internal-error");const i=r.multiFactorHint?.uid||r.multiFactorUid;st(i,e,"missing-multi-factor-info");const a={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=An(e,a,"mfaSmsSignIn",async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===Tn){st(n?.type===gi,e,"argument-error");return ui(e,await bi(e,t,n))}return ui(e,t)},"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t={phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=An(e,t,"sendVerificationCode",async(e,t)=>{if(t.captchaResponse===Tn){st(n?.type===gi,e,"argument-error");return qn(e,await bi(e,t,n))}return qn(e,t)},"PHONE_PROVIDER");return(await i.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function bi(e,t,n){st(n.type===gi,e,"argument-error");const r=await n.verify();st("string"==typeof r,e,"argument-error");const i={...t};if("phoneEnrollmentInfo"in i){const e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,a=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:a}}),i}if("phoneSignInInfo"in i){const e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:r}),i}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e){this.providerId=_i.PROVIDER_ID,this.auth=mn(e)}verifyPhoneNumber(e,t){return vi(this.auth,e,M(t))}static credential(e,t){return Hn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return _i.credentialFromTaggedObject(t)}static credentialFromError(e){return _i.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Hn._fromTokenResponse(t,n):null}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ii(e,t){return t?Wt(t):(st(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_i.PROVIDER_ID="phone",_i.PHONE_SIGN_IN_METHOD="phone";class Ei extends Rn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return jn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return jn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return jn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Ti(e){return pr(e.auth,new Ei(e),e.bypassAuthState)}function Si(e){const{auth:t,user:n}=e;return st(n,t,"internal-error"),hr(n,new Ei(e),e.bypassAuthState)}async function ki(e){const{auth:t,user:n}=e;return st(n,t,"internal-error"),lr(n,new Ei(e),e.bypassAuthState)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:a,type:o}=e;if(a)return void this.reject(a);const s={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(s))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ti;case"linkViaPopup":case"linkViaRedirect":return ki;case"reauthViaPopup":case"reauthViaRedirect":return Si;default:tt(this.auth,"internal-error")}}resolve(e){dt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){dt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ci=new pt(2e3,1e4);async function xi(e,t,n){if(Ne(e.app))return Promise.reject(nt(e,"operation-not-supported-in-this-environment"));const r=mn(e);at(e,t,Kn);const i=Ii(r,n);return new Di(r,"signInViaPopup",t,i).executeNotNull()}class Di extends Ai{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Di.currentPopupAction&&Di.currentPopupAction.cancel(),Di.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return st(e,this.auth,"internal-error"),e}async onExecution(){dt(1===this.filter.length,"Popup operations only handle one event");const e=Jr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(nt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(nt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Di.currentPopupAction=null}pollUserCancellation(){const e=()=>{this.authWindow?.window?.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(nt(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Ci.get())};e()}}Di.currentPopupAction=null;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Pi=new Map;class Ni extends Ai{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Pi.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Mi(t),r=Li(e);if(!(await r._isAvailable()))return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Pi.set(this.auth._key(),e)}return this.bypassAuthState||Pi.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Ri(e,t){return Li(e)._set(Mi(t),"true")}function Oi(e,t){Pi.set(e._key(),t)}function Li(e){return Wt(e._redirectPersistence)}function Mi(e){return Yt("pendingRedirect",e.config.apiKey,e.name)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ui(e,t,n=!1){if(Ne(e.app))return Promise.reject(it(e));const r=mn(e),i=Ii(r,t),a=new Ni(r,i,n),o=await a.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function Vi(e){const t=Jr(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ji(e);default:return!1}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!ji(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(nt(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Bi(e))}saveEventToCache(e){this.cachedEventUids.add(Bi(e)),this.lastProcessedEventTime=Date.now()}}function Bi(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function ji({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===t?.code}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const $i=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qi=/^https?/;async function zi(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return bt(e,"GET","/v1/projects",t)}(e);for(const n of t)try{if(Hi(n))return}catch{}tt(e,"unauthorized-domain")}function Hi(e){const t=lt(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!qi.test(n))return!1;if($i.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gi=new pt(3e4,6e4);function Wi(){const e=Zr().___jsl;if(e?.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Ki(e){return new Promise((t,n)=>{function r(){Wi(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Wi(),n(nt(e,"network-request-failed"))},timeout:Gi.get()})}if(Zr().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else{if(!Zr().gapi?.load){const t=yn("iframefcb");return Zr()[t]=()=>{gapi.load?r():n(nt(e,"network-request-failed"))},wn(`${gn.gapiScript}?onload=${t}`).catch(e=>n(e))}r()}}).catch(e=>{throw Qi=null,e})}let Qi=null;
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Yi=new pt(5e3,15e3),Ji={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Xi=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Zi(e){const t=e.config;st(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?mt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:Le},i=Xi.get(e.config.apiHost);i&&(r.eid=i);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${D(r).slice(1)}`}async function ea(e){const t=await function(e){return Qi=Qi||Ki(e),Qi}(e),n=Zr().gapi;return st(n,e,"internal-error"),t.open({where:document.body,url:Zi(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ji,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=nt(e,"network-request-failed"),a=Zr().setTimeout(()=>{r(i)},Yi.get());function o(){Zr().clearTimeout(a),n(t)}t.ping(o).then(o,()=>{r(i)})}))}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ta={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class na{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function ra(e,t,n,r=500,i=600){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let s="";const c={...ta,width:r.toString(),height:i.toString(),top:a,left:o},d=b().toLowerCase();n&&(s=tn(d)?"_blank":n),Zt(d)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=b()){return sn(e)&&!!window.navigator?.standalone}(d)&&"_self"!==s)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t||"",s),new na(null);const u=window.open(t||"",s,l);st(u,e,"popup-blocked");try{u.focus()}catch(h){}return new na(u)}const ia="__/auth/handler",aa="emulator/auth/handler",oa=encodeURIComponent("fac");async function sa(e,t,n,r,i,a){st(e.config.authDomain,e,"auth-domain-config-required"),st(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Le,eventId:i};if(t instanceof Kn){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))o[e]=t}if(t instanceof Qn){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const s=o;for(const l of Object.keys(s))void 0===s[l]&&delete s[l];const c=await e._getAppCheckToken(),d=c?`#${oa}=${encodeURIComponent(c)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${ia}`;return mt(e,aa)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)}?${D(s).slice(1)}${d}`}const ca="webStorageSupport";const da=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Qr,this._completeRedirectFn=Ui,this._overrideRedirectResult=Oi}async _openPopup(e,t,n,r){dt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");return ra(e,await sa(e,t,n,lt(),r),Jr())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){Zr().location.href=e}(await sa(e,t,n,lt(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(dt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await ea(e),n=new Fi(e);return t.register("authEvent",t=>{st(t?.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ca,{type:ca},n=>{const r=n?.[0]?.[ca];void 0!==r&&t(!!r),tt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=zi(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return dn()||en()||sn()}};class la{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return ct("unexpected MultiFactorSessionType")}}}class ua extends la{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new ua(e)}_finalizeEnroll(e,t,n){return function(e,t){return bt(e,"POST","/v2/accounts/mfaEnrollment:finalize",vt(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return bt(e,"POST","/v2/accounts/mfaSignIn:finalize",vt(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class ha{constructor(){}static assertion(e){return ua._fromCredential(e)}}ha.FACTOR_ID="phone";class pa{static assertionForEnrollment(e,t){return ma._fromSecret(e,t)}static assertionForSignIn(e,t){return ma._fromEnrollmentId(e,t)}static async generateSecret(e){const t=e;st(void 0!==t.user?.auth,"internal-error");const n=await(r=t.user.auth,i={idToken:t.credential,totpEnrollmentInfo:{}},bt(r,"POST","/v2/accounts/mfaEnrollment:start",vt(r,i)));var r,i;return fa._fromStartTotpMfaEnrollmentResponse(n,t.user.auth)}}pa.FACTOR_ID="totp";class ma extends la{constructor(e,t,n){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=n}static _fromSecret(e,t){return new ma(t,void 0,e)}static _fromEnrollmentId(e,t){return new ma(t,e)}async _finalizeEnroll(e,t,n){return st(void 0!==this.secret,e,"argument-error"),function(e,t){return bt(e,"POST","/v2/accounts/mfaEnrollment:finalize",vt(e,t))}(e,{idToken:t,displayName:n,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){st(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");const n={verificationCode:this.otp};return function(e,t){return bt(e,"POST","/v2/accounts/mfaSignIn:finalize",vt(e,t))}(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:n})}}class fa{constructor(e,t,n,r,i,a,o){this.sessionInfo=a,this.auth=o,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=n,this.codeIntervalSeconds=r,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new fa(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){let n=!1;return(ga(e)||ga(t))&&(n=!0),n&&(ga(e)&&(e=this.auth.currentUser?.email||"unknownuser"),ga(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function ga(e){return void 0===e||0===e?.length}var wa="@firebase/auth",ya="1.11.0";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class va{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){st(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ba=p("authIdTokenMaxAge")||300;let _a=null;function Ia(e=Ue()){const t=Pe(e,"auth");if(t.isInitialized())return t.getImmediate();const n=xn(e,{popupRedirectResolver:da,persistence:[li,qr,Qr]}),r=p("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>ba)return;const r=t?.token;_a!==r&&(_a=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});Nr(n,t,()=>t(n.currentUser)),Pr(n,e=>t(e))}}var i;const a=u("auth");return a&&Dn(n,`http://${a}`),n}var Ea;gn={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=nt("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Ea="Browser",De(new U("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;st(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const s={apiKey:a,authDomain:o,clientPlatform:Ea,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ln(Ea)},c=new pn(n,r,i,s);return function(e,t){const n=t?.persistence||[],r=(Array.isArray(n)?n:[n]).map(Wt);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,t?.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),De(new U("auth-internal",e=>{const t=mn(e.getProvider("auth").getImmediate());return new va(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ve(wa,ya,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Ea)),Ve(wa,ya,"esm2020");const Ta=Object.freeze(Object.defineProperty({__proto__:null,ActionCodeOperation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"},ActionCodeURL:Gn,AuthCredential:Rn,AuthErrorCodes:{ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"},EmailAuthCredential:Bn,EmailAuthProvider:Wn,FacebookAuthProvider:Jn,FactorId:{PHONE:"phone",TOTP:"totp"},GithubAuthProvider:Zn,GoogleAuthProvider:Xn,OAuthCredential:$n,OAuthProvider:Yn,OperationType:{LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},PhoneAuthCredential:Hn,PhoneAuthProvider:_i,PhoneMultiFactorGenerator:ha,ProviderId:{FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},RecaptchaVerifier:class{constructor(e,t,n={...wi}){this.parameters=n,this.type=gi,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=mn(e),this.isInvisible="invisible"===this.parameters.size,st("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof t?document.getElementById(t):t;st(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new fi:new mi,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise(n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){st(!this.parameters.sitekey,this.auth,"argument-error"),st(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),st("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof e)e(t);else if("string"==typeof e){const n=Zr()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){st(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){st(ut()&&!ei(),this.auth,"internal-error"),await function(){let e=null;return new Promise(t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()}).catch(t=>{throw e&&window.removeEventListener("load",e),t})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await bt(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);st(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return st(this.recaptcha,this.auth,"internal-error"),this.recaptcha}},SAMLAuthProvider:tr,SignInMethod:{EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},TotpMultiFactorGenerator:pa,TotpSecret:fa,TwitterAuthProvider:nr,applyActionCode:async function(e,t){await async function(e,t){return bt(e,"POST","/v1/accounts:update",vt(e,t))}(M(e),{oobCode:t})},beforeAuthStateChanged:Nr,browserCookiePersistence:Wr,browserLocalPersistence:qr,browserPopupRedirectResolver:da,browserSessionPersistence:Qr,checkActionCode:Ir,confirmPasswordReset:async function(e,t,n){await On(M(e),{oobCode:t,newPassword:n}).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&_r(e),t})},connectAuthEmulator:Dn,createUserWithEmailAndPassword:async function(e,t,n){if(Ne(e.app))return Promise.reject(it(e));const r=mn(e),i=An(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rr,"EMAIL_PASSWORD_PROVIDER"),a=await i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&_r(e),t}),o=await ir._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(o.user),o},debugErrorMap:Ye,deleteUser:async function(e){return M(e).delete()},fetchSignInMethodsForEmail:
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(e,t){const n={identifier:t,continueUri:ut()?lt():"http://localhost"},{signinMethods:r}=
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */await async function(e,t){return bt(e,"POST","/v1/accounts:createAuthUri",vt(e,t))}(M(e),n);return r||[]},getAdditionalUserInfo:function(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;const{providerId:t}=e,n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&e?.idToken){const t=Lt(e.idToken)?.firebase?.sign_in_provider;if(t)return new Tr(r,"anonymous"!==t&&"custom"!==t?t:null)}if(!t)return null;switch(t){case"facebook.com":return new kr(r,n);case"github.com":return new Ar(r,n);case"google.com":return new Cr(r,n);case"twitter.com":return new xr(r,n,e.screenName||null);case"custom":case"anonymous":return new Tr(r,null);default:return new Tr(r,t,n)}}(n)},getAuth:Ia,getIdToken:function(e,t=!1){return M(e).getIdToken(t)},getIdTokenResult:Rt,getMultiFactorResolver:function(e,t){const n=M(e),r=t;return st(t.customData.operationType,n,"argument-error"),st(r.customData._serverResponse?.mfaPendingCredential,n,"argument-error"),Mr._fromError(n,r)},getRedirectResult:async function(e,t){return await mn(e)._initializationPromise,Ui(e,t,!1)},inMemoryPersistence:Qt,indexedDBLocalPersistence:li,initializeAuth:xn,initializeRecaptchaConfig:function(e){return Cn(e)},isSignInWithEmailLink:function(e,t){const n=Gn.parseLink(t);return"EMAIL_SIGNIN"===n?.operation},linkWithCredential:fr,linkWithPhoneNumber:async function(e,t,n){const r=M(e);await ur(!1,r,"phone");const i=await vi(r.auth,t,M(n));return new yi(i,e=>fr(r,e))},linkWithPopup:async function(e,t,n){const r=M(e);at(r.auth,t,Kn);const i=Ii(r.auth,n);return new Di(r.auth,"linkViaPopup",t,i,r).executeNotNull()},linkWithRedirect:function(e,t,n){return async function(e,t,n){const r=M(e);at(r.auth,t,Kn),await r.auth._initializationPromise;const i=Ii(r.auth,n);await ur(!1,r,t.providerId),await Ri(i,r.auth);const a=await Vi(r);return i._openRedirect(r.auth,t,"linkViaRedirect",a)}(e,t,n)},multiFactor:function(e){const t=M(e);return Fr.has(t)||Fr.set(t,Vr._fromUser(t)),Fr.get(t)},onAuthStateChanged:Rr,onIdTokenChanged:Pr,parseActionCodeURL:function(e){return Gn.parseLink(e)},prodErrorMap:Je,reauthenticateWithCredential:gr,reauthenticateWithPhoneNumber:async function(e,t,n){const r=M(e);if(Ne(r.auth.app))return Promise.reject(it(r.auth));const i=await vi(r.auth,t,M(n));return new yi(i,e=>gr(r,e))},reauthenticateWithPopup:async function(e,t,n){const r=M(e);if(Ne(r.auth.app))return Promise.reject(nt(r.auth,"operation-not-supported-in-this-environment"));at(r.auth,t,Kn);const i=Ii(r.auth,n);return new Di(r.auth,"reauthViaPopup",t,i,r).executeNotNull()},reauthenticateWithRedirect:function(e,t,n){return async function(e,t,n){const r=M(e);if(at(r.auth,t,Kn),Ne(r.auth.app))return Promise.reject(it(r.auth));await r.auth._initializationPromise;const i=Ii(r.auth,n);await Ri(i,r.auth);const a=await Vi(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",a)}(e,t,n)},reload:jt,revokeAccessToken:function(e,t){return mn(e).revokeAccessToken(t)},sendEmailVerification:async function(e,t){const n=M(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&br(n.auth,r,t);const{email:i}=await async function(e,t){return Un(e,t)}(n.auth,r);i!==e.email&&await e.reload()},sendPasswordResetEmail:async function(e,t,n){const r=mn(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&br(r,i,n),await An(r,i,"getOobCode",Vn,"EMAIL_PASSWORD_PROVIDER")},sendSignInLinkToEmail:
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(e,t,n){const r=mn(e),i={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};var a,o;a=i,st((o=n).handleCodeInApp,r,"argument-error"),o&&br(r,a,o),await An(r,i,"getOobCode",Fn,"EMAIL_PASSWORD_PROVIDER")},setPersistence:Dr,signInAnonymously:or,signInWithCredential:mr,signInWithCustomToken:
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(e,t){if(Ne(e.app))return Promise.reject(it(e));const n=mn(e),r=await async function(e,t){return It(e,"POST","/v1/accounts:signInWithCustomToken",vt(e,t))}(n,{token:t,returnSecureToken:!0}),i=await ir._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i},signInWithEmailAndPassword:function(e,t,n){return Ne(e.app)?Promise.reject(it(e)):mr(M(e),Wn.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&_r(e),t})},signInWithEmailLink:async function(e,t,n){if(Ne(e.app))return Promise.reject(it(e));const r=M(e),i=Wn.credentialWithLink(t,n||lt());return st(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),mr(r,i)},signInWithPhoneNumber:async function(e,t,n){if(Ne(e.app))return Promise.reject(it(e));const r=mn(e),i=await vi(r,t,M(n));return new yi(i,e=>mr(r,e))},signInWithPopup:xi,signInWithRedirect:function(e,t,n){return async function(e,t,n){if(Ne(e.app))return Promise.reject(it(e));const r=mn(e);at(e,t,Kn),await r._initializationPromise;const i=Ii(r,n);return await Ri(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)},signOut:Or,unlink:async function(e,t){const n=M(e);await ur(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return bt(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),i=dr(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n},updateCurrentUser:function(e,t){return M(e).updateCurrentUser(t)},updateEmail:function(e,t){const n=M(e);return Ne(n.auth.app)?Promise.reject(it(n.auth)):Er(n,t,null)},updatePassword:function(e,t){return Er(M(e),null,t)},updatePhoneNumber:async function(e,t){const n=M(e);if(Ne(n.auth.app))return Promise.reject(it(n.auth));await lr(n,t)},updateProfile:
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=M(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},a=await Ut(r,
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(e,t){return bt(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;const o=r.providerData.find(({providerId:e})=>"password"===e);o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)},useDeviceLanguage:function(e){M(e).useDeviceLanguage()},validatePassword:async function(e,t){return mn(e).validatePassword(t)},verifyBeforeUpdateEmail:async function(e,t,n){const r=M(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&br(r.auth,i,n);const{email:a}=await async function(e,t){return Un(e,t)}(r.auth,i);a!==e.email&&await e.reload()},verifyPasswordResetCode:async function(e,t){const{data:n}=await Ir(M(e),t);return n.email}},Symbol.toStringTag,{value:"Module"}));var Sa,ka,Aa="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/(function(){var e;
/** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  */function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var a=e.g[3],o=t+(a^n&(i^a))+r[0]+3614090360&4294967295;o=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=n+(o<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^a&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^a)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~a))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~a))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~a))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((a=(t=n+((o=t+(i^(n|~a))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=a+((o=i+(t^(a|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+a&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var a=0|e[i];r&&a==t||(n[i]=a,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,a=this.h,o=0;o<t;){if(0==a)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[a++]=e.charCodeAt(o++),a==this.blockSize){n(this,i),a=0;break}}else for(;o<t;)if(i[a++]=e[o++],a==this.blockSize){n(this,i),a=0;break}}this.h=a,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i={};function a(e){return-128<=e&&128>e?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new r([0|e],0>e?-1:0)}):new r([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return s;if(0>e)return h(o(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var s=a(0),c=a(1),d=a(16777216);function l(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function u(e){return-1==e.h}function h(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(c)}function p(e,t){return e.add(h(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function f(e,t){this.g=e,this.h=t}function g(e,t){if(l(t))throw Error("division by zero");if(l(e))return new f(s,s);if(u(e))return t=g(h(e),t),new f(h(t.g),h(t.h));if(u(t))return t=g(e,h(t)),new f(h(t.g),t.h);if(30<e.g.length){if(u(e)||u(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;0>=r.l(e);)n=w(n),r=w(r);var i=y(n,1),a=y(r,1);for(r=y(r,2),n=y(n,2);!l(r);){var d=a.add(r);0>=d.l(e)&&(i=i.add(n),a=d),r=y(r,1),n=y(n,1)}return t=p(e,i.j(t)),new f(i,t)}for(i=s;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),d=(a=o(n)).j(t);u(d)||0<d.l(e);)d=(a=o(n-=r)).j(t);l(a)&&(a=c),i=i.add(a),e=p(e,d)}return new f(i,e)}function w(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function y(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,a=[],o=0;o<i;o++)a[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new r(a,e.h)}(e=r.prototype).m=function(){if(u(this))return-h(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(u(this))return"-"+h(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,r="";;){var i=g(n,t).g,a=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(l(n=i))return a+r;for(;6>a.length;)a="0"+a;r=a+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return u(e=p(this,e))?-1:l(e)?0:1},e.abs=function(){return u(this)?h(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,a=0;a<=t;a++){var o=i+(65535&this.i(a))+(65535&e.i(a)),s=(o>>>16)+(this.i(a)>>>16)+(e.i(a)>>>16);i=s>>>16,o&=65535,s&=65535,n[a]=s<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return s;if(u(this))return u(e)?h(this).j(h(e)):h(h(this).j(e));if(u(e))return h(this.j(h(e)));if(0>this.l(d)&&0>e.l(d))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var a=0;a<e.g.length;a++){var c=this.i(i)>>>16,p=65535&this.i(i),f=e.i(a)>>>16,g=65535&e.i(a);n[2*i+2*a]+=p*g,m(n,2*i+2*a),n[2*i+2*a+1]+=c*g,m(n,2*i+2*a+1),n[2*i+2*a+1]+=p*f,m(n,2*i+2*a+1),n[2*i+2*a+2]+=c*f,m(n,2*i+2*a+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,ka=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return h(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=s,a=0;a<t.length;a+=8){var c=Math.min(8,t.length-a),d=parseInt(t.substring(a,a+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(d))):i=(i=i.j(r)).add(o(d))}return i},Sa=r}).apply(void 0!==Aa?Aa:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Ca,xa,Da,Pa,Na,Ra,Oa,La,Ma="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ma&&Ma];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var a=0;a<e.length-1;a++){var o=e[a];if(!(o in i))break e;i=i[o]}(r=r(a=i[e=e[e.length-1]]))!=a&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return t})}});
/** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  */
var r=r||{},i=this||self;function a(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function s(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function d(e,t,n){return(d=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?s:c).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function h(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function p(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(a(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function m(e){return/^[\s\xa0]*$/.test(e)}function f(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var w=!(-1==f().indexOf("Gecko")||-1!=f().toLowerCase().indexOf("webkit")&&-1==f().indexOf("Edge")||-1!=f().indexOf("Trident")||-1!=f().indexOf("MSIE")||-1!=f().indexOf("Edge"));function y(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function v(e){const t={};for(const n in e)t[n]=e[n];return t}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<b.length;t++)n=b[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function I(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function E(e){i.setTimeout(()=>{throw e},0)}function T(){var e=x;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new k,e=>e.reset());class k{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let A,C=!1,x=new class{constructor(){this.h=this.g=null}add(e,t){const n=S.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},D=()=>{const e=i.Promise.resolve(void 0);A=()=>{e.then(P)}};var P=()=>{for(var e;e=T();){try{e.h.call(e.g)}catch(n){E(n)}var t=S;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}C=!1};function N(){this.s=this.s,this.C=this.C}function R(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.s=!1,N.prototype.ma=function(){this.s||(this.s=!0,this.N())},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},R.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function L(e,t){if(R.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(w){e:{try{g(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:M[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&L.aa.h.call(this)}}u(L,R);var M={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),V=0;function F(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++V,this.da=this.fa=!1}function B(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function j(e){this.src=e,this.g={},this.h=0}function $(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=Array.prototype.indexOf.call(i,t,void 0);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(B(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function q(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.da&&a.listener==t&&a.capture==!!n&&a.ha==r)return i}return-1}j.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var o=q(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new F(t,this.src,a,!!r,i)).fa=n,e.push(t)),t};var z="closure_lm_"+(1e6*Math.random()|0),H={};function G(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)G(e,t[a],n,r,i);return null}return n=Z(n),e&&e[U]?e.K(t,n,!!o(r)&&!!r.capture,i):function(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var s=o(i)?!!i.capture:!!i,c=J(e);if(c||(e[z]=c=new j(e)),n=c.add(t,n,r,s,a),n.proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=Y;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)O||(i=s),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Q(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}(e,t,n,!1,r,i)}function W(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)W(e,t[a],n,r,i);else r=o(r)?!!r.capture:!!r,n=Z(n),e&&e[U]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=q(a=e.g[t],n,r,i))&&(B(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--)))):e&&(e=J(e))&&(t=e.g[t.toString()],e=-1,t&&(e=q(t,n,r,i)),(n=-1<e?t[e]:null)&&K(n))}function K(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[U])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Q(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=J(t))?($(n,e),0==n.h&&(n.src=null,t[z]=null)):B(e)}}}function Q(e){return e in H?H[e]:H[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new L(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&K(e),e=n.call(r,t)}return e}function J(e){return(e=e[z])instanceof j?e:null}var X="__closure_events_fn_"+(1e9*Math.random()>>>0);function Z(e){return"function"==typeof e?e:(e[X]||(e[X]=function(t){return e.handleEvent(t)}),e[X])}function ee(){N.call(this),this.i=new j(this),this.M=this,this.F=null}function te(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new R(t,e);else if(t instanceof R)t.target=t.target||e;else{var i=t;_(t=new R(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var o=t.g=n[a];i=ne(o,r,!0,t)&&i}if(i=ne(o=t.g=e,r,!0,t)&&i,i=ne(o,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=ne(o=t.g=n[a],r,!1,t)&&i}function ne(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.da&&o.capture==n){var s=o.listener,c=o.ha||o.src;o.fa&&$(e.i,o),i=!1!==s.call(c,r)&&i}}return i&&!r.defaultPrevented}function re(e,t,n){if("function"==typeof e)n&&(e=d(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=d(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function ie(e){e.g=re(()=>{e.g=null,e.i&&(e.i=!1,ie(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(ee,N),ee.prototype[U]=!0,ee.prototype.removeEventListener=function(e,t,n,r){W(this,e,t,n,r)},ee.prototype.N=function(){if(ee.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)B(n[r]);delete t.g[e],t.h--}}this.F=null},ee.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ee.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ae extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ie(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function oe(e){N.call(this),this.h=e,this.g={}}u(oe,N);var se=[];function ce(e){y(e.g,function(e,t){this.g.hasOwnProperty(t)&&K(e)},e),e.g={}}oe.prototype.N=function(){oe.aa.N.call(this),ce(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=i.JSON.stringify,le=i.JSON.parse,ue=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function he(){}function pe(e){return e.h||(e.h=e.i())}function me(){}he.prototype.h=null;var fe={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ge(){R.call(this,"d")}function we(){R.call(this,"c")}u(ge,R),u(we,R);var ye={},ve=null;function be(){return ve=ve||new ee}function _e(e){R.call(this,ye.La,e)}function Ie(e){const t=be();te(t,new _e(t))}function Ee(e,t){R.call(this,ye.STAT_EVENT,e),this.stat=t}function Te(e){const t=be();te(t,new Ee(t,e))}function Se(e,t){R.call(this,ye.Ma,e),this.size=t}function ke(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Ae(){this.g=!0}function Ce(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var o=1;o<i.length;o++)i[o]=""}}}return de(n)}catch(s){return t}}(e,n)+(r?" "+r:"")})}ye.La="serverreachability",u(_e,R),ye.STAT_EVENT="statevent",u(Ee,R),ye.Ma="timingevent",u(Se,R),Ae.prototype.xa=function(){this.g=!1},Ae.prototype.info=function(){};var xe,De={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Ne(){}function Re(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new oe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Oe}function Oe(){this.i=null,this.g="",this.h=!1}u(Ne,he),Ne.prototype.g=function(){return new XMLHttpRequest},Ne.prototype.i=function(){return{}},xe=new Ne;var Le={},Me={};function Ue(e,t,n){e.L=1,e.v=dt(it(t)),e.m=n,e.P=!0,Ve(e,null)}function Ve(e,t){e.F=Date.now(),je(e),e.A=it(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),It(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Oe,e.g=ln(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ae(d(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(se[0]=i.toString()),i=se);for(var a=0;a<i.length;a++){var o=G(n,i[a],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?v(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ie(),function(e,t,n,r,i,a){e.info(function(){if(e.g)if(a)for(var o="",s=a.split("&"),c=0;c<s.length;c++){var d=s[c].split("=");if(1<d.length){var l=d[0];d=d[1];var u=l.split("_");o=2<=u.length&&"type"==u[1]?o+(l+"=")+d+"&":o+(l+"=redacted&")}}else o=null;else o=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Fe(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Be(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Me:(n=Number(t.substring(n,r)),isNaN(n)?Le:(r+=1)+n>t.length?Me:(t=t.slice(r,r+n),e.C=r+n,t))}function je(e){e.S=Date.now()+e.I,$e(e,e.I)}function $e(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=ke(d(e.ba,e),t)}function qe(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function ze(e){0==e.j.G||e.J||an(e.j,e)}function He(e){qe(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ce(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Ge(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Je(n.h,e)))if(!e.K&&Je(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(l){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;rn(n),Wt(n)}en(n),Te(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=ke(d(n.Za,n),6e3));if(1>=Ye(n.h)&&n.ca){try{n.ca()}catch(l){}n.ca=void 0}}else sn(n,11)}else if((e.K||n.g==e)&&rn(n),!m(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let d=i[t];if(n.T=d[0],d=d[1],2==n.G)if("c"==d[0]){n.K=d[1],n.ia=d[2];const t=d[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=d[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const l=d[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var a=r.h;a.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(a.j=a.l,a.g=new Set,a.h&&(Xe(a,a.h),a.h=null))}if(r.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,ct(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=dn(r,r.J?r.ia:null,r.W),o.K){Ze(r.h,o);var s=o,c=r.L;c&&(s.I=c),s.B&&(qe(s),je(s)),r.g=o}else Zt(r);0<n.i.length&&Qt(n)}else"stop"!=d[0]&&"close"!=d[0]||sn(n,7);else 3==n.G&&("stop"==d[0]||"close"==d[0]?"stop"==d[0]?sn(n,7):Gt(n):"noop"!=d[0]&&n.l&&n.l.ta(d),n.v=0)}Ie()}catch(l){}}Re.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==$t(e)?t.j():this.Y(e)},Re.prototype.Y=function(e){try{if(e==this.g)e:{const h=$t(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||qt(this.g)))){this.J||4!=h||7==t||Ie(),qe(this);var n=this.g.Z();this.X=n;t:if(Fe(this)){var r=qt(this.g);e="";var a=r.length,o=4==$t(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){He(this),ze(this);var s="";break t}this.h.i=new i.TextDecoder}for(t=0;t<a;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(o&&t==a-1)});r.length=0,this.h.g+=e,this.C=0,s=this.h.g}else s=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,a,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+o})}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,d=this.g;if((c=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(c)){var l=c;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,Te(12),He(this),ze(this);break e}Ce(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ge(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<s.length;){if(e=Be(this,s),e==Me){4==h&&(this.s=4,Te(14),n=!1),Ce(this.i,this.l,null,"[Incomplete Response]");break}if(e==Le){this.s=4,Te(15),Ce(this.i,this.l,s,"[Invalid Chunk]"),n=!1;break}Ce(this.i,this.l,e,null),Ge(this,e)}if(Fe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=s.length||this.h.h||(this.s=1,Te(16),n=!1),this.o=this.o&&n,n){if(0<s.length&&!this.W){this.W=!0;var u=this.j;u.g==this&&u.ba&&!u.M&&(u.j.info("Great, no buffering proxy detected. Bytes received: "+s.length),tn(u),u.M=!0,Te(11))}}else Ce(this.i,this.l,s,"[Invalid Chunked Response]"),He(this),ze(this)}else Ce(this.i,this.l,s,null),Ge(this,s);4==h&&He(this),this.o&&!this.J&&(4==h?an(this.j,this):(this.o=!1,je(this)))}else(function(e){const t={};e=(e.g&&2<=$t(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(m(e[r]))continue;var n=I(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const a=t[i]||[];t[i]=a,a.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<s.indexOf("Unknown SID")?(this.s=3,Te(12)):(this.s=0,Te(13)),He(this),ze(this)}}}catch(h){}},Re.prototype.cancel=function(){this.J=!0,He(this)},Re.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Ie(),Te(17)),He(this),this.s=2,ze(this)):$e(this,this.S-e)};var We=class{constructor(e,t){this.g=e,this.map=t}};function Ke(e){this.l=e||10,i.PerformanceNavigationTiming?e=0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ye(e){return e.h?1:e.g?e.g.size:0}function Je(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Xe(e,t){e.g?e.g.add(t):e.h=t}function Ze(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function et(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return h(e.i)}function tt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(a(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(a(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(a(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}Ke.prototype.cancel=function(){if(this.i=et(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var nt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof rt){this.h=e.h,at(this,e.j),this.o=e.o,this.g=e.g,ot(this,e.s),this.l=e.l;var t=e.i,n=new yt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),st(this,n),this.m=e.m}else e&&(t=String(e).match(nt))?(this.h=!1,at(this,t[1]||"",!0),this.o=lt(t[2]||""),this.g=lt(t[3]||"",!0),ot(this,t[4]),this.l=lt(t[5]||"",!0),st(this,t[6]||"",!0),this.m=lt(t[7]||"")):(this.h=!1,this.i=new yt(null,this.h))}function it(e){return new rt(e)}function at(e,t,n){e.j=n?lt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ot(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function st(e,t,n){t instanceof yt?(e.i=t,function(e,t){t&&!e.j&&(vt(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(bt(this,t),It(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=ut(t,gt)),e.i=new yt(t,e.h))}function ct(e,t,n){e.i.set(t,n)}function dt(e){return ct(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function lt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ut(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ht),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ht(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}rt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ut(t,pt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ut(t,pt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ut(n,"/"==n.charAt(0)?ft:mt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ut(n,wt)),e.join("")};var pt=/[#\/\?@]/g,mt=/[#\?:]/g,ft=/[#\?]/g,gt=/[#\?@]/g,wt=/#/g;function yt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function vt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function bt(e,t){vt(e),t=Et(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function _t(e,t){return vt(e),t=Et(e,t),e.g.has(t)}function It(e,t,n){bt(e,t),0<n.length&&(e.i=null,e.g.set(Et(e,t),h(n)),e.h+=n.length)}function Et(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Tt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(a){}}function St(){this.g=new ue}function kt(e,t,n){const r=n||"";try{tt(e,function(e,n){let i=e;o(e)&&(i=de(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function At(e){this.l=e.Ub||null,this.j=e.eb||!1}function Ct(e,t){ee.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function xt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Dt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Pt(e)}function Pt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Nt(e){let t="";return y(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Rt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Nt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ct(e,t,n))}function Ot(e){ee.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=yt.prototype).add=function(e,t){vt(this),this.i=null,e=Et(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){vt(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.na=function(){vt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){vt(this);let t=[];if("string"==typeof e)_t(this,e)&&(t=t.concat(this.g.get(Et(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return vt(this),this.i=null,_t(this,e=Et(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const a=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=a;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")},u(At,he),At.prototype.g=function(){return new Ct(this.l,this.j)},At.prototype.i=function(e){return function(){return e}}({}),u(Ct,ee),(e=Ct.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Pt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Dt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Pt(this)),this.g&&(this.readyState=3,Pt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;xt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Dt(this):Pt(this),3==this.readyState&&xt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Dt(this))},e.Qa=function(e){this.g&&(this.response=e,Dt(this))},e.ga=function(){this.g&&Dt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Ct.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Ot,ee);var Lt=/^https?$/i,Mt=["POST","PUT"];function Ut(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Vt(e),Bt(e)}function Vt(e){e.A||(e.A=!0,te(e,"complete"),te(e,"error"))}function Ft(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=$t(e)||2!=e.Z()))if(e.u&&4==$t(e))re(e.Ea,0,e);else if(te(e,"readystatechange"),4==$t(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var a;if(a=0===r){var o=String(e.D).match(nt)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),a=!Lt.test(o?o.toLowerCase():"")}n=a}if(n)te(e,"complete"),te(e,"success");else{e.m=6;try{var s=2<$t(e)?e.g.statusText:""}catch(c){s=""}e.l=s+" ["+e.Z()+"]",Vt(e)}}finally{Bt(e)}}}function Bt(e,t){if(e.g){jt(e);const r=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||te(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function jt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function $t(e){return e.g?e.g.readyState:0}function qt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function zt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ht(e){this.Aa=0,this.i=[],this.j=new Ae,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=zt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=zt("baseRetryDelayMs",5e3,e),this.cb=zt("retryDelaySeedMs",1e4,e),this.Wa=zt("forwardChannelMaxRetries",2,e),this.wa=zt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Ke(e&&e.concurrentRequestLimit),this.Da=new St,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Gt(e){if(Kt(e),3==e.G){var t=e.U++,n=it(e.I);if(ct(n,"SID",e.K),ct(n,"RID",t),ct(n,"TYPE","terminate"),Jt(e,n),(t=new Re(e,e.j,t)).L=2,t.v=dt(it(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=ln(t.j,null),t.g.ea(t.v)),t.F=Date.now(),je(t)}cn(e)}function Wt(e){e.g&&(tn(e),e.g.cancel(),e.g=null)}function Kt(e){Wt(e),e.u&&(i.clearTimeout(e.u),e.u=null),rn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Qt(e){if(!Qe(e.h)&&!e.s){e.s=!0;var t=e.Ga;A||D(),C||(A(),C=!0),x.add(t,e),e.B=0}}function Yt(e,t){var n;n=t?t.l:e.U++;const r=it(e.I);ct(r,"SID",e.K),ct(r,"RID",n),ct(r,"AID",e.T),Jt(e,r),e.m&&e.o&&Rt(r,e.m,e.o),n=new Re(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=Xt(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),Xe(e.h,n),Ue(n,r,t)}function Jt(e,t){e.H&&y(e.H,function(e,n){ct(t,n,e)}),e.l&&tt({},function(e,n){ct(t,n,e)})}function Xt(e,t,n){n=Math.min(e.i.length,n);var r=e.l?d(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let s=0;s<n;s++){let n=i[s].g;const c=i[s].map;if(n-=t,0>n)t=Math.max(0,i[s].g-100),o=!1;else try{kt(c,e,"req"+n+"_")}catch(a){r&&r(c)}}if(o){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function Zt(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;A||D(),C||(A(),C=!0),x.add(t,e),e.v=0}}function en(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=ke(d(e.Fa,e),on(e,e.v)),e.v++,!0)}function tn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function nn(e){e.g=new Re(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=it(e.qa);ct(t,"RID","rpc"),ct(t,"SID",e.K),ct(t,"AID",e.T),ct(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ct(t,"TO",e.ja),ct(t,"TYPE","xmlhttp"),Jt(e,t),e.m&&e.o&&Rt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=dt(it(t)),n.m=null,n.P=!0,Ve(n,e)}function rn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function an(e,t){var n=null;if(e.g==t){rn(e),tn(e),e.g=null;var r=2}else{if(!Je(e.h,t))return;n=t.D,Ze(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;te(r=be(),new Se(r,n)),Qt(e)}else Zt(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(Ye(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=ke(d(e.Ga,e,t),on(e,e.B)),e.B++,0)))}(e,t)||2==r&&en(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:sn(e,5);break;case 4:sn(e,10);break;case 3:sn(e,6);break;default:sn(e,2)}}function on(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function sn(e,t){if(e.j.info("Error code "+t),2==t){var n=d(e.fb,e),r=e.Xa;const t=!r;r=new rt(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||at(r,"https"),dt(r),t?function(e,t){const n=new Ae;if(i.Image){const r=new Image;r.onload=l(Tt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=l(Tt,n,"TestLoadImage: error",!1,t,r),r.onabort=l(Tt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=l(Tt,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ae;const n=new AbortController,r=setTimeout(()=>{n.abort(),Tt(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?Tt(0,0,!0,t):Tt(0,0,!1,t)}).catch(()=>{clearTimeout(r),Tt(0,0,!1,t)})}(r.toString(),n)}else Te(2);e.G=0,e.l&&e.l.sa(t),cn(e),Kt(e)}function cn(e){if(e.G=0,e.ka=[],e.l){const t=et(e.h);0==t.length&&0==e.i.length||(p(e.ka,t),p(e.ka,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.ra()}}function dn(e,t,n){var r=n instanceof rt?it(n):new rt(n);if(""!=r.g)t&&(r.g=t+"."+r.g),ot(r,r.s);else{var a=i.location;r=a.protocol,t=t?t+"."+a.hostname:a.hostname,a=+a.port;var o=new rt(null);r&&at(o,r),t&&(o.g=t),a&&ot(o,a),n&&(o.l=n),r=o}return n=e.D,t=e.ya,n&&t&&ct(r,n,t),ct(r,"VER",e.la),Jt(e,r),r}function ln(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Ot(new At({eb:n})):new Ot(e.pa)).Ha(e.J),t}function un(){}function hn(){}function pn(e,t){ee.call(this),this.g=new Ht(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!m(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!m(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new gn(this)}function mn(e){ge.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function fn(){we.call(this),this.status=1}function gn(e){this.g=e}(e=Ot.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xe.g(),this.v=this.o?pe(this.o):pe(xe),this.g.onreadystatechange=d(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Ut(this,o)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var a in r)n.set(a,r[a]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),a=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Mt,t,void 0))||r||a||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,s]of n)this.g.setRequestHeader(i,s);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{jt(this),this.u=!0,this.g.send(e),this.u=!1}catch(o){Ut(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,te(this,"complete"),te(this,"abort"),Bt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Bt(this,!0)),Ot.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Ft(this):this.bb())},e.bb=function(){Ft(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<$t(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),le(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Ht.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Te(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=dn(this,null,this.W),Qt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Re(this,this.j,e);let a=this.o;if(this.S&&(a?(a=v(a),_(a,this.S)):a=this.S),null!==this.m||this.O||(i.H=a,a=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Xt(this,i,t),ct(n=it(this.I),"RID",e),ct(n,"CVER",22),this.D&&ct(n,"X-HTTP-Session-Id",this.D),Jt(this,n),a&&(this.O?t="headers="+encodeURIComponent(String(Nt(a)))+"&"+t:this.m&&Rt(n,this.m,a)),Xe(this.h,i),this.Ua&&ct(n,"TYPE","init"),this.P?(ct(n,"$req",t),ct(n,"SID","null"),i.T=!0,Ue(i,n,null)):Ue(i,n,t),this.G=2}}else 3==this.G&&(e?Yt(this,e):0==this.i.length||Qe(this.h)||Yt(this))},e.Fa=function(){if(this.u=null,nn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=ke(d(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Te(10),Wt(this),nn(this))},e.Za=function(){null!=this.C&&(this.C=null,Wt(this),en(this),Te(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Te(2)):(this.j.info("Failed to ping google.com"),Te(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=un.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},hn.prototype.g=function(e,t){return new pn(e,t)},u(pn,ee),pn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},pn.prototype.close=function(){Gt(this.g)},pn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=de(e),e=n);t.i.push(new We(t.Ya++,e)),3==t.G&&Qt(t)},pn.prototype.N=function(){this.g.l=null,delete this.j,Gt(this.g),delete this.g,pn.aa.N.call(this)},u(mn,ge),u(fn,we),u(gn,un),gn.prototype.ua=function(){te(this.g,"a")},gn.prototype.ta=function(e){te(this.g,new mn(e))},gn.prototype.sa=function(e){te(this.g,new fn)},gn.prototype.ra=function(){te(this.g,"b")},hn.prototype.createWebChannel=hn.prototype.g,pn.prototype.send=pn.prototype.o,pn.prototype.open=pn.prototype.m,pn.prototype.close=pn.prototype.close,La=function(){return new hn},Oa=function(){return be()},Ra=ye,Na={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},De.NO_ERROR=0,De.TIMEOUT=8,De.HTTP_ERROR=6,Pa=De,Pe.COMPLETE="complete",Da=Pe,me.EventType=fe,fe.OPEN="a",fe.CLOSE="b",fe.ERROR="c",fe.MESSAGE="d",ee.prototype.listen=ee.prototype.K,xa=me,Ot.prototype.listenOnce=Ot.prototype.L,Ot.prototype.getLastError=Ot.prototype.Ka,Ot.prototype.getLastErrorCode=Ot.prototype.Ba,Ot.prototype.getStatus=Ot.prototype.Z,Ot.prototype.getResponseJson=Ot.prototype.Oa,Ot.prototype.getResponseText=Ot.prototype.oa,Ot.prototype.send=Ot.prototype.ea,Ot.prototype.setWithCredentials=Ot.prototype.Ha,Ca=Ot}).apply(void 0!==Ma?Ma:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Ua="@firebase/firestore",Va="4.9.0";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Fa.UNAUTHENTICATED=new Fa(null),Fa.GOOGLE_CREDENTIALS=new Fa("google-credentials-uid"),Fa.FIRST_PARTY=new Fa("first-party-uid"),Fa.MOCK_USER=new Fa("mock-user");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let Ba="12.0.0";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ja=new W("@firebase/firestore");function $a(){return ja.logLevel}function qa(e,...t){if(ja.logLevel<=j.DEBUG){const n=t.map(Ga);ja.debug(`Firestore (${Ba}): ${e}`,...n)}}function za(e,...t){if(ja.logLevel<=j.ERROR){const n=t.map(Ga);ja.error(`Firestore (${Ba}): ${e}`,...n)}}function Ha(e,...t){if(ja.logLevel<=j.WARN){const n=t.map(Ga);ja.warn(`Firestore (${Ba}): ${e}`,...n)}}function Ga(e){if("string"==typeof e)return e;try{
/**
    * @license
    * Copyright 2020 Google LLC
    *
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    *   http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    */
return t=e,JSON.stringify(t)}catch(n){return e}var t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wa(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,Ka(e,r,n)}function Ka(e,t,n){let r=`FIRESTORE (${Ba}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(i){r+=" CONTEXT: "+n}throw za(r),new Error(r)}function Qa(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||Ka(t,i,r)}function Ya(e,t){return e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ja={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Xa extends S{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class to{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Fa.UNAUTHENTICATED))}shutdown(){}}class no{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ro{constructor(e){this.t=e,this.currentUser=Fa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Qa(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Za;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Za,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{qa("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(qa("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Za)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(qa("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Qa("string"==typeof t.accessToken,31837,{l:t}),new eo(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Qa(null===e||"string"==typeof e,2055,{h:e}),new Fa(e)}}class io{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Fa.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ao{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new io(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Fa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class oo{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class so{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ne(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Qa(void 0===this.o,3512);const n=e=>{null!=e.error&&qa("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,qa("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{qa("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):qa("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new oo(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Qa("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new oo(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function co(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=co(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function uo(e,t){return e<t?-1:e>t?1:0}function ho(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.charAt(r),i=t.charAt(r);if(n!==i)return fo(n)===fo(i)?uo(n,i):fo(n)?1:-1}return uo(e.length,t.length)}const po=55296,mo=57343;function fo(e){const t=e.charCodeAt(0);return t>=po&&t<=mo}function go(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wo="__name__";class yo{constructor(e,t,n){void 0===t?t=0:t>e.length&&Wa(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&Wa(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===yo.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof yo?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=yo.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return uo(e.length,t.length)}static compareSegments(e,t){const n=yo.isNumericId(e),r=yo.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?yo.extractNumericId(e).compare(yo.extractNumericId(t)):ho(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Sa.fromString(e.substring(4,e.length-2))}}class vo extends yo{construct(e,t,n){return new vo(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Xa(Ja.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new vo(t)}static emptyPath(){return new vo([])}}const bo=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class _o extends yo{construct(e,t,n){return new _o(e,t,n)}static isValidIdentifier(e){return bo.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),_o.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===wo}static keyField(){return new _o([wo])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Xa(Ja.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Xa(Ja.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Xa(Ja.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(a=!a,r++):"."!==t||a?(n+=t,r++):(i(),r++)}if(i(),a)throw new Xa(Ja.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new _o(t)}static emptyPath(){return new _o([])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(e){this.path=e}static fromPath(e){return new Io(vo.fromString(e))}static fromName(e){return new Io(vo.fromString(e).popFirst(5))}static empty(){return new Io(vo.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===vo.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return vo.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Io(new vo(e.slice()))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eo(e,t,n){if(!n)throw new Xa(Ja.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function To(e,t,n,r){if(!0===t&&!0===r)throw new Xa(Ja.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function So(e){if(!Io.isDocumentKey(e))throw new Xa(Ja.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ko(e){if(Io.isDocumentKey(e))throw new Xa(Ja.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ao(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function Co(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":Wa(12329,{type:typeof e})}function xo(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Xa(Ja.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Co(e);throw new Xa(Ja.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Do(e,t){const n={typeString:e};return t&&(n.value=t),n}function Po(e,t){if(!Ao(e))throw new Xa(Ja.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const i=t[r].typeString,a="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}const o=e[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==a&&o!==a.value){n=`Expected '${r}' field to equal '${a.value}'`;break}}if(n)throw new Xa(Ja.INVALID_ARGUMENT,n);return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const No=-62135596800,Ro=1e6;class Oo{static now(){return Oo.fromMillis(Date.now())}static fromDate(e){return Oo.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Ro);return new Oo(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Xa(Ja.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Xa(Ja.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<No)throw new Xa(Ja.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Xa(Ja.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ro}_compareTo(e){return this.seconds===e.seconds?uo(this.nanoseconds,e.nanoseconds):uo(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Oo._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Po(e,Oo._jsonSchema))return new Oo(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-No;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Oo._jsonSchemaVersion="firestore/timestamp/1.0",Oo._jsonSchema={type:Do("string",Oo._jsonSchemaVersion),seconds:Do("number"),nanoseconds:Do("number")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Lo{static fromTimestamp(e){return new Lo(e)}static min(){return new Lo(new Oo(0,0))}static max(){return new Lo(new Oo(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mo(e){return new Uo(e.readTime,e.key,-1)}class Uo{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Uo(Lo.min(),Io.empty(),-1)}static max(){return new Uo(Lo.max(),Io.empty(),-1)}}function Vo(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Io.comparator(e.documentKey,t.documentKey),0!==n?n:uo(e.largestBatchId,t.largestBatchId)
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)}class Fo{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bo(e){if(e.code!==Ja.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;qa("LocalStore","Unexpectedly lost primary lease")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Wa(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new jo((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof jo?t:jo.resolve(t)}catch(t){return jo.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):jo.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):jo.reject(t)}static resolve(e){return new jo((t,n)=>{t(e)})}static reject(e){return new jo((t,n)=>{n(e)})}static waitFor(e){return new jo((t,n)=>{let r=0,i=0,a=!1;e.forEach(e=>{++r,e.next(()=>{++i,a&&i===r&&t()},e=>n(e))}),a=!0,i===r&&t()})}static or(e){let t=jo.resolve(!1);for(const n of e)t=t.next(e=>e?jo.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new jo((n,r)=>{const i=e.length,a=new Array(i);let o=0;for(let s=0;s<i;s++){const c=s;t(e[c]).next(e=>{a[c]=e,++o,o===i&&n(a)},e=>r(e))}})}static doWhile(e,t){return new jo((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function $o(e){return"IndexedDbTransactionError"===e.name}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}qo.ce=-1;function zo(e){return null==e}function Ho(e){return 0===e&&1/e==-1/0}function Go(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="";break;case"":n+="";break;default:n+=t}}return n}function Wo(e){return e+""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ko(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Qo(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Yo(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e,t){this.comparator=e,this.root=t||Zo.EMPTY}insert(e,t){return new Jo(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Zo.BLACK,null,null))}remove(e){return new Jo(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Zo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Xo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Xo(this.root,e,this.comparator,!1)}getReverseIterator(){return new Xo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Xo(this.root,e,this.comparator,!0)}}class Xo{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Zo{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Zo.RED,this.left=null!=r?r:Zo.EMPTY,this.right=null!=i?i:Zo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Zo(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Zo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Zo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Zo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Zo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Wa(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Wa(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Wa(27949);return e+(this.isRed()?0:1)}}Zo.EMPTY=null,Zo.RED=!0,Zo.BLACK=!1,Zo.EMPTY=new class{constructor(){this.size=0}get key(){throw Wa(57766)}get value(){throw Wa(16141)}get color(){throw Wa(16727)}get left(){throw Wa(29726)}get right(){throw Wa(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new Zo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class es{constructor(e){this.comparator=e,this.data=new Jo(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ts(this.data.getIterator())}getIteratorFrom(e){return new ts(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof es))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new es(this.comparator);return t.data=e,t}}class ts{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ns{constructor(e){this.fields=e,e.sort(_o.comparator)}static empty(){return new ns([])}unionWith(e){let t=new es(_o.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new ns(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return go(this.fields,e.fields,(e,t)=>e.isEqual(t))}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rs extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new rs("Invalid base64 string: "+t):t}}(e);return new is(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new is(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return uo(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}is.EMPTY_BYTE_STRING=new is("");const as=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function os(e){if(Qa(!!e,39018),"string"==typeof e){let t=0;const n=as.exec(e);if(Qa(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ss(e.seconds),nanos:ss(e.nanos)}}function ss(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function cs(e){return"string"==typeof e?is.fromBase64String(e):is.fromUint8Array(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ds="server_timestamp",ls="__type__",us="__previous_value__",hs="__local_write_time__";function ps(e){const t=(e?.mapValue?.fields||{})[ls]?.stringValue;return t===ds}function ms(e){const t=e.mapValue.fields[us];return ps(t)?ms(t):t}function fs(e){const t=os(e.mapValue.fields[hs].timestampValue);return new Oo(t.seconds,t.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e,t,n,r,i,a,o,s,c,d){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=s,this.useFetchStreams=c,this.isUsingEmulator=d}}const ws="(default)";class ys{constructor(e,t){this.projectId=e,this.database=t||ws}static empty(){return new ys("","")}get isDefaultDatabase(){return this.database===ws}isEqual(e){return e instanceof ys&&e.projectId===this.projectId&&e.database===this.database}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vs="__type__",bs="__max__",_s={},Is="__vector__",Es="value";function Ts(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ps(e)?4:function(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===bs}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)?9007199254740991:function(e){const t=(e?.mapValue?.fields||{})[vs]?.stringValue;return t===Is}(e)?10:11:Wa(28295,{value:e})}function Ss(e,t){if(e===t)return!0;const n=Ts(e);if(n!==Ts(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return fs(e).isEqual(fs(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=os(e.timestampValue),r=os(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,cs(e.bytesValue).isEqual(cs(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return ss(e.geoPointValue.latitude)===ss(t.geoPointValue.latitude)&&ss(e.geoPointValue.longitude)===ss(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ss(e.integerValue)===ss(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=ss(e.doubleValue),r=ss(t.doubleValue);return n===r?Ho(n)===Ho(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return go(e.arrayValue.values||[],t.arrayValue.values||[],Ss);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Ko(n)!==Ko(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ss(n[i],r[i])))return!1;return!0}(e,t);default:return Wa(52216,{left:e})}var r}function ks(e,t){return void 0!==(e.values||[]).find(e=>Ss(e,t))}function As(e,t){if(e===t)return 0;const n=Ts(e),r=Ts(t);if(n!==r)return uo(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return uo(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=ss(e.integerValue||e.doubleValue),r=ss(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Cs(e.timestampValue,t.timestampValue);case 4:return Cs(fs(e),fs(t));case 5:return ho(e.stringValue,t.stringValue);case 6:return function(e,t){const n=cs(e),r=cs(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=uo(n[i],r[i]);if(0!==e)return e}return uo(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=uo(ss(e.latitude),ss(t.latitude));return 0!==n?n:uo(ss(e.longitude),ss(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return xs(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=t.fields||{},i=n[Es]?.arrayValue,a=r[Es]?.arrayValue,o=uo(i?.values?.length||0,a?.values?.length||0);return 0!==o?o:xs(i,a)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===_s&&t===_s)return 0;if(e===_s)return 1;if(t===_s)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(let o=0;o<r.length&&o<a.length;++o){const e=ho(r[o],a[o]);if(0!==e)return e;const t=As(n[r[o]],i[a[o]]);if(0!==t)return t}return uo(r.length,a.length)}(e.mapValue,t.mapValue);default:throw Wa(23264,{he:n})}}function Cs(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return uo(e,t);const n=os(e),r=os(t),i=uo(n.seconds,r.seconds);return 0!==i?i:uo(n.nanos,r.nanos)}function xs(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=As(n[i],r[i]);if(e)return e}return uo(n.length,r.length)}function Ds(e){return Ps(e)}function Ps(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=os(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?cs(e.bytesValue).toBase64():"referenceValue"in e?function(e){return Io.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Ps(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Ps(e.fields[i])}`;return n+"}"}(e.mapValue):Wa(61005,{value:e})}function Ns(e){switch(Ts(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=ms(e);return t?16+Ns(t):16;case 5:return 2*e.stringValue.length;case 6:return cs(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+Ns(t),0);case 10:case 11:return function(e){let t=0;return Qo(e.fields,(e,n)=>{t+=e.length+Ns(n)}),t}(e.mapValue);default:throw Wa(13486,{value:e})}}function Rs(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Os(e){return!!e&&"integerValue"in e}function Ls(e){return!!e&&"arrayValue"in e}function Ms(e){return!!e&&"nullValue"in e}function Us(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Vs(e){return!!e&&"mapValue"in e}function Fs(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return Qo(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Fs(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Fs(e.arrayValue.values[n]);return t}return{...e}}class Bs{constructor(e){this.value=e}static empty(){return new Bs({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Vs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Fs(t)}setAll(e){let t=_o.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Fs(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Vs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ss(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Vs(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Qo(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new Bs(Fs(this.value))}}function js(e){const t=[];return Qo(e.fields,(e,n)=>{const r=new _o([e]);if(Vs(n)){const e=js(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new ns(t)
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class $s{constructor(e,t,n,r,i,a,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=a,this.documentState=o}static newInvalidDocument(e){return new $s(e,0,Lo.min(),Lo.min(),Lo.min(),Bs.empty(),0)}static newFoundDocument(e,t,n,r){return new $s(e,1,t,Lo.min(),n,r,0)}static newNoDocument(e,t){return new $s(e,2,t,Lo.min(),Lo.min(),Bs.empty(),0)}static newUnknownDocument(e,t){return new $s(e,3,t,Lo.min(),Lo.min(),Bs.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Lo.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Bs.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Bs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Lo.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof $s&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $s(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(e,t){this.position=e,this.inclusive=t}}function zs(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const a=t[i],o=e.position[i];if(r=a.field.isKeyField()?Io.comparator(Io.fromName(o.referenceValue),n.key):As(o,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function Hs(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ss(e.position[n],t.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ws(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{}class Qs extends Ks{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new nc(e,t,n):"array-contains"===t?new oc(e,n):"in"===t?new sc(e,n):"not-in"===t?new cc(e,n):"array-contains-any"===t?new dc(e,n):new Qs(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new rc(e,n):new ic(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(As(t,this.value)):null!==t&&Ts(this.value)===Ts(t)&&this.matchesComparison(As(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Wa(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ys extends Ks{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ys(e,t)}matches(e){return Js(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Js(e){return"and"===e.op}function Xs(e){return function(e){for(const t of e.filters)if(t instanceof Ys)return!1;return!0}(e)&&Js(e)}function Zs(e){if(e instanceof Qs)return e.field.canonicalString()+e.op.toString()+Ds(e.value);if(Xs(e))return e.filters.map(e=>Zs(e)).join(",");{const t=e.filters.map(e=>Zs(e)).join(",");return`${e.op}(${t})`}}function ec(e,t){return e instanceof Qs?(n=e,(r=t)instanceof Qs&&n.op===r.op&&n.field.isEqual(r.field)&&Ss(n.value,r.value)):e instanceof Ys?function(e,t){return t instanceof Ys&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&ec(n,t.filters[r]),!0)}(e,t):void Wa(19439);var n,r}function tc(e){return e instanceof Qs?`${(t=e).field.canonicalString()} ${t.op} ${Ds(t.value)}`:e instanceof Ys?function(e){return e.op.toString()+" {"+e.getFilters().map(tc).join(" ,")+"}"}(e):"Filter";var t}class nc extends Qs{constructor(e,t,n){super(e,t,n),this.key=Io.fromName(n.referenceValue)}matches(e){const t=Io.comparator(e.key,this.key);return this.matchesComparison(t)}}class rc extends Qs{constructor(e,t){super(e,"in",t),this.keys=ac("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ic extends Qs{constructor(e,t){super(e,"not-in",t),this.keys=ac("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ac(e,t){return(t.arrayValue?.values||[]).map(e=>Io.fromName(e.referenceValue))}class oc extends Qs{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ls(t)&&ks(t.arrayValue,this.value)}}class sc extends Qs{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&ks(this.value.arrayValue,t)}}class cc extends Qs{constructor(e,t){super(e,"not-in",t)}matches(e){if(ks(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!ks(this.value.arrayValue,t)}}class dc extends Qs{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ls(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>ks(this.value.arrayValue,e))}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(e,t=null,n=[],r=[],i=null,a=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=a,this.endAt=o,this.Te=null}}function uc(e,t=null,n=[],r=[],i=null,a=null,o=null){return new lc(e,t,n,r,i,a,o)}function hc(e){const t=Ya(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Zs(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),zo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Ds(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Ds(e)).join(",")),t.Te=e}return t.Te}function pc(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Ws(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!ec(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Hs(e.startAt,t.startAt)&&Hs(e.endAt,t.endAt)}function mc(e){return Io.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc{constructor(e,t=null,n=[],r=[],i=null,a="F",o=null,s=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=a,this.startAt=o,this.endAt=s,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function gc(e){return new fc(e)}function wc(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function yc(e){return null!==e.collectionGroup}function vc(e){const t=Ya(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const r of t.explicitOrderBy)t.Ie.push(r),e.add(r.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new es(_o.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new Gs(r,n))}),e.has(_o.keyField().canonicalString())||t.Ie.push(new Gs(_o.keyField(),n))}return t.Ie}function bc(e){const t=Ya(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return uc(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Gs(e.field,t)});const n=e.endAt?new qs(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new qs(e.startAt.position,e.startAt.inclusive):null;return uc(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,vc(e))),t.Ee}function _c(e,t){const n=e.filters.concat([t]);return new fc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Ic(e,t,n){return new fc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Ec(e,t){return pc(bc(e),bc(t))&&e.limitType===t.limitType}function Tc(e){return`${hc(bc(e))}|lt:${e.limitType}`}function Sc(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>tc(e)).join(", ")}]`),zo(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Ds(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Ds(e)).join(",")),`Target(${t})`}(bc(e))}; limitType=${e.limitType})`}function kc(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Io.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of vc(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(r=t,!((n=e).startAt&&!function(e,t,n){const r=zs(e,t,n);return e.inclusive?r<=0:r<0}(n.startAt,vc(n),r)||n.endAt&&!function(e,t,n){const r=zs(e,t,n);return e.inclusive?r>=0:r>0}(n.endAt,vc(n),r)));var n,r}function Ac(e){return(t,n)=>{let r=!1;for(const i of vc(e)){const e=Cc(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Cc(e,t,n){const r=e.field.isKeyField()?Io.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?As(r,i):Wa(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Wa(19790,{direction:e.dir})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Qo(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return Yo(this.inner)}size(){return this.innerSize}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dc=new Jo(Io.comparator);function Pc(){return Dc}const Nc=new Jo(Io.comparator);function Rc(...e){let t=Nc;for(const n of e)t=t.insert(n.key,n);return t}function Oc(e){let t=Nc;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Lc(){return Uc()}function Mc(){return Uc()}function Uc(){return new xc(e=>e.toString(),(e,t)=>e.isEqual(t))}const Vc=new Jo(Io.comparator),Fc=new es(Io.comparator);function Bc(...e){let t=Fc;for(const n of e)t=t.add(n);return t}const jc=new es(uo);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function $c(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ho(t)?"-0":t}}function qc(e){return{integerValue:""+e}}function zc(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Ho(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)?qc(t):$c(e,t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(){this._=void 0}}function Gc(e,t,n){return e instanceof Qc?function(e,t){const n={fields:{[ls]:{stringValue:ds},[hs]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ps(t)&&(t=ms(t)),t&&(n.fields[us]=t),{mapValue:n}}(n,t):e instanceof Yc?Jc(e,t):e instanceof Xc?Zc(e,t):function(e,t){const n=Kc(e,t),r=td(n)+td(e.Ae);return Os(n)&&Os(e.Ae)?qc(r):$c(e.serializer,r)}(e,t)}function Wc(e,t,n){return e instanceof Yc?Jc(e,t):e instanceof Xc?Zc(e,t):n}function Kc(e,t){return e instanceof ed?Os(n=t)||(r=n)&&"doubleValue"in r?t:{integerValue:0}:null;var n,r}class Qc extends Hc{}class Yc extends Hc{constructor(e){super(),this.elements=e}}function Jc(e,t){const n=nd(t);for(const r of e.elements)n.some(e=>Ss(e,r))||n.push(r);return{arrayValue:{values:n}}}class Xc extends Hc{constructor(e){super(),this.elements=e}}function Zc(e,t){let n=nd(t);for(const r of e.elements)n=n.filter(e=>!Ss(e,r));return{arrayValue:{values:n}}}class ed extends Hc{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function td(e){return ss(e.integerValue||e.doubleValue)}function nd(e){return Ls(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e,t){this.field=e,this.transform=t}}class id{constructor(e,t){this.version=e,this.transformResults=t}}class ad{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ad}static exists(e){return new ad(void 0,e)}static updateTime(e){return new ad(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function od(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class sd{}function cd(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new yd(e.key,ad.none()):new pd(e.key,e.data,ad.none());{const n=e.data,r=Bs.empty();let i=new es(_o.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new md(e.key,r,new ns(i.toArray()),ad.none())}}function dd(e,t,n){var r;e instanceof pd?function(e,t,n){const r=e.value.clone(),i=gd(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof md?function(e,t,n){if(!od(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=gd(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(fd(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):(r=n,t.convertToNoDocument(r.version).setHasCommittedMutations())}function ld(e,t,n,r){return e instanceof pd?function(e,t,n,r){if(!od(e.precondition,t))return n;const i=e.value.clone(),a=wd(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof md?function(e,t,n,r){if(!od(e.precondition,t))return n;const i=wd(e.fieldTransforms,r,t),a=t.data;return a.setAll(fd(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(i=t,a=n,od(e.precondition,i)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):a);var i,a}function ud(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Kc(r.transform,e||null);null!=i&&(null===n&&(n=Bs.empty()),n.set(r.field,i))}return n||null}function hd(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&go(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof Yc&&r instanceof Yc||n instanceof Xc&&r instanceof Xc?go(n.elements,r.elements,Ss):n instanceof ed&&r instanceof ed?Ss(n.Ae,r.Ae):n instanceof Qc&&r instanceof Qc);var n,r}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class pd extends sd{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class md extends sd{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function fd(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function gd(e,t,n){const r=new Map;Qa(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let i=0;i<n.length;i++){const a=e[i],o=a.transform,s=t.data.field(a.field);r.set(a.field,Wc(o,s,n[i]))}return r}function wd(e,t,n){const r=new Map;for(const i of e){const e=i.transform,a=n.data.field(i.field);r.set(i.field,Gc(e,a,t))}return r}class yd extends sd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class vd extends sd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&dd(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ld(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ld(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Mc();return this.mutations.forEach(r=>{const i=e.get(r.key),a=i.overlayedDocument;let o=this.applyToLocalView(a,i.mutatedFields);o=t.has(r.key)?null:o;const s=cd(a,o);null!==s&&n.set(r.key,s),a.isValidDocument()||a.convertToNoDocument(Lo.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Bc())}isEqual(e){return this.batchId===e.batchId&&go(this.mutations,e.mutations,(e,t)=>hd(e,t))&&go(this.baseMutations,e.baseMutations,(e,t)=>hd(e,t))}}class _d{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Qa(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=function(){return Vc}();const i=e.mutations;for(let a=0;a<i.length;a++)r=r.insert(i[a].key,n[a].version);return new _d(e,t,n,r)}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{constructor(e,t){this.count=e,this.unchangedNames=t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Td,Sd;function kd(e){if(void 0===e)return za("GRPC error has no .code"),Ja.UNKNOWN;switch(e){case Td.OK:return Ja.OK;case Td.CANCELLED:return Ja.CANCELLED;case Td.UNKNOWN:return Ja.UNKNOWN;case Td.DEADLINE_EXCEEDED:return Ja.DEADLINE_EXCEEDED;case Td.RESOURCE_EXHAUSTED:return Ja.RESOURCE_EXHAUSTED;case Td.INTERNAL:return Ja.INTERNAL;case Td.UNAVAILABLE:return Ja.UNAVAILABLE;case Td.UNAUTHENTICATED:return Ja.UNAUTHENTICATED;case Td.INVALID_ARGUMENT:return Ja.INVALID_ARGUMENT;case Td.NOT_FOUND:return Ja.NOT_FOUND;case Td.ALREADY_EXISTS:return Ja.ALREADY_EXISTS;case Td.PERMISSION_DENIED:return Ja.PERMISSION_DENIED;case Td.FAILED_PRECONDITION:return Ja.FAILED_PRECONDITION;case Td.ABORTED:return Ja.ABORTED;case Td.OUT_OF_RANGE:return Ja.OUT_OF_RANGE;case Td.UNIMPLEMENTED:return Ja.UNIMPLEMENTED;case Td.DATA_LOSS:return Ja.DATA_LOSS;default:return Wa(39323,{code:e})}}(Sd=Td||(Td={}))[Sd.OK=0]="OK",Sd[Sd.CANCELLED=1]="CANCELLED",Sd[Sd.UNKNOWN=2]="UNKNOWN",Sd[Sd.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Sd[Sd.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Sd[Sd.NOT_FOUND=5]="NOT_FOUND",Sd[Sd.ALREADY_EXISTS=6]="ALREADY_EXISTS",Sd[Sd.PERMISSION_DENIED=7]="PERMISSION_DENIED",Sd[Sd.UNAUTHENTICATED=16]="UNAUTHENTICATED",Sd[Sd.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Sd[Sd.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Sd[Sd.ABORTED=10]="ABORTED",Sd[Sd.OUT_OF_RANGE=11]="OUT_OF_RANGE",Sd[Sd.UNIMPLEMENTED=12]="UNIMPLEMENTED",Sd[Sd.INTERNAL=13]="INTERNAL",Sd[Sd.UNAVAILABLE=14]="UNAVAILABLE",Sd[Sd.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ad=new Sa([4294967295,4294967295],0);function Cd(e){const t=(new TextEncoder).encode(e),n=new ka;return n.update(t),new Uint8Array(n.digest())}function xd(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new Sa([n,r],0),new Sa([i,a],0)]}class Dd{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Pd(`Invalid padding: ${t}`);if(n<0)throw new Pd(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Pd(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Pd(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Sa.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(Sa.fromNumber(n)));return 1===r.compare(Ad)&&(r=new Sa([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Cd(e),[n,r]=xd(t);for(let i=0;i<this.hashCount;i++){const e=this.ye(n,r,i);if(!this.we(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new Dd(i,r,t);return n.forEach(e=>a.insert(e)),a}insert(e){if(0===this.ge)return;const t=Cd(e),[n,r]=xd(t);for(let i=0;i<this.hashCount;i++){const e=this.ye(n,r,i);this.Se(e)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Pd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Rd.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Nd(Lo.min(),r,new Jo(uo),Pc(),Bc())}}class Rd{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Rd(n,t,Bc(),Bc(),Bc())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Od{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class Ld{constructor(e,t){this.targetId=e,this.Ce=t}}class Md{constructor(e,t,n=is.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Ud{constructor(){this.ve=0,this.Fe=Bd(),this.Me=is.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Bc(),t=Bc(),n=Bc();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Wa(38017,{changeType:i})}}),new Rd(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=Bd()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Qa(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Vd{constructor(e){this.Ge=e,this.ze=new Map,this.je=Pc(),this.Je=Fd(),this.He=Fd(),this.Ye=new Jo(uo)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:Wa(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(mc(i))if(0===n){const e=new Io(i.path);this.et(t,e,$s.newNoDocument(e,Lo.min()))}else Qa(1===n,20013,{expectedCount:n});else{const r=this._t(t);if(r!==n){const n=this.ut(e),i=n?this.ct(n,e,r):1;if(0!==i){this.it(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let a,o;try{a=cs(n).toUint8Array()}catch(s){if(s instanceof rs)return Ha("Decoding the base64 bloom filter in existence filter failed ("+s.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw s}try{o=new Dd(a,r,i)}catch(s){return Ha(s instanceof Pd?"BloomFilter error: ":"Applying bloom filter failed: ",s),null}return 0===o.ge?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const i=this.Ge.ht(),a=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(a)||(this.et(t,n,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((n,r)=>{const i=this.ot(r);if(i){if(n.current&&mc(i.target)){const t=new Io(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,$s.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=Bc();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const r=new Nd(e,t,this.Ye,this.je,n);return this.je=Pc(),this.Je=Fd(),this.He=Fd(),this.Ye=new Jo(uo),r}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Ud,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new es(uo),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new es(uo),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||qa("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ud),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Fd(){return new Jo(Io.comparator)}function Bd(){return new Jo(Io.comparator)}const jd=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),$d=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),qd=(()=>({and:"AND",or:"OR"}))();class zd{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Hd(e,t){return e.useProto3Json||zo(t)?t:{value:t}}function Gd(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Wd(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Kd(e,t){return Gd(e,t.toTimestamp())}function Qd(e){return Qa(!!e,49232),Lo.fromTimestamp(function(e){const t=os(e);return new Oo(t.seconds,t.nanos)}(e))}function Yd(e,t){return Jd(e,t).canonicalString()}function Jd(e,t){const n=(r=e,new vo(["projects",r.projectId,"databases",r.database])).child("documents");var r;return void 0===t?n:n.child(t)}function Xd(e){const t=vo.fromString(e);return Qa(gl(t),10190,{key:t.toString()}),t}function Zd(e,t){return Yd(e.databaseId,t.path)}function el(e,t){const n=Xd(t);if(n.get(1)!==e.databaseId.projectId)throw new Xa(Ja.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Xa(Ja.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Io(rl(n))}function tl(e,t){return Yd(e.databaseId,t)}function nl(e){return new vo(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function rl(e){return Qa(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function il(e,t,n){return{name:Zd(e,t),fields:n.value.mapValue.fields}}function al(e,t){return{documents:[tl(e,t.path)]}}function ol(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=tl(e,i);const a=function(e){if(0!==e.length)return ml(Ys.create(e,"and"))}(t.filters);a&&(n.structuredQuery.where=a);const o=function(e){if(0!==e.length)return e.map(e=>{return{field:hl((t=e).field),direction:dl(t.dir)};var t})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const s=Hd(e,t.limit);return null!==s&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt={before:(c=t.startAt).inclusive,values:c.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:i};var c}function sl(e){let t=function(e){const t=Xd(e);return 4===t.length?vo.emptyPath():rl(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Qa(1===r,65062);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let a=[];n.where&&(a=function(e){const t=cl(e);return t instanceof Ys&&Xs(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new Gs(pl((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let s=null;n.limit&&(s=function(e){let t;return t="object"==typeof e?e.value:e,zo(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new qs(n,t)}(n.startAt));let d=null;return n.endAt&&(d=function(e){const t=!e.before,n=e.values||[];return new qs(n,t)}(n.endAt)),function(e,t,n,r,i,a,o,s){return new fc(e,t,n,r,i,a,o,s)}(t,i,o,a,s,"F",c,d)}function cl(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=pl(e.unaryFilter.field);return Qs.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=pl(e.unaryFilter.field);return Qs.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=pl(e.unaryFilter.field);return Qs.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=pl(e.unaryFilter.field);return Qs.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Wa(61313);default:return Wa(60726)}}(e):void 0!==e.fieldFilter?(t=e,Qs.create(pl(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Wa(58110);default:return Wa(50506)}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return Ys.create(e.compositeFilter.filters.map(e=>cl(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Wa(1026)}}(e.compositeFilter.op))}(e):Wa(30097,{filter:e});var t}function dl(e){return jd[e]}function ll(e){return $d[e]}function ul(e){return qd[e]}function hl(e){return{fieldPath:e.canonicalString()}}function pl(e){return _o.fromServerFormat(e.fieldPath)}function ml(e){return e instanceof Qs?function(e){if("=="===e.op){if(Us(e.value))return{unaryFilter:{field:hl(e.field),op:"IS_NAN"}};if(Ms(e.value))return{unaryFilter:{field:hl(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Us(e.value))return{unaryFilter:{field:hl(e.field),op:"IS_NOT_NAN"}};if(Ms(e.value))return{unaryFilter:{field:hl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:hl(e.field),op:ll(e.op),value:e.value}}}(e):e instanceof Ys?function(e){const t=e.getFilters().map(e=>ml(e));return 1===t.length?t[0]:{compositeFilter:{op:ul(e.op),filters:t}}}(e):Wa(54877,{filter:e})}function fl(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function gl(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wl{constructor(e,t,n,r,i=Lo.min(),a=Lo.min(),o=is.EMPTY_BYTE_STRING,s=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=s}withSequenceNumber(e){return new wl(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new wl(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new wl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new wl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl{constructor(e){this.yt=e}}function vl(e){const t=sl({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ic(t,t.limit,"L"):t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl{constructor(){this.Cn=new _l}addToCollectionParentIndex(e,t){return this.Cn.add(t),jo.resolve()}getCollectionParents(e,t){return jo.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return jo.resolve()}deleteFieldIndex(e,t){return jo.resolve()}deleteAllFieldIndexes(e){return jo.resolve()}createTargetIndexes(e,t){return jo.resolve()}getDocumentsMatchingTarget(e,t){return jo.resolve(null)}getIndexType(e,t){return jo.resolve(0)}getFieldIndexes(e,t){return jo.resolve([])}getNextCollectionGroupToUpdate(e){return jo.resolve(null)}getMinOffset(e,t){return jo.resolve(Uo.min())}getMinOffsetFromCollectionGroup(e,t){return jo.resolve(Uo.min())}updateCollectionGroup(e,t,n){return jo.resolve()}updateIndexEntries(e,t){return jo.resolve()}}class _l{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new es(vo.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new es(vo.comparator)).toArray()}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},El=41943040;class Tl{static withCacheSize(e){return new Tl(e,Tl.DEFAULT_COLLECTION_PERCENTILE,Tl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Tl.DEFAULT_COLLECTION_PERCENTILE=10,Tl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Tl.DEFAULT=new Tl(El,Tl.DEFAULT_COLLECTION_PERCENTILE,Tl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Tl.DISABLED=new Tl(-1,0,0);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Sl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Sl(0)}static cr(){return new Sl(-1)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kl="LruGarbageCollector";function Al([e,t],[n,r]){const i=uo(e,n);return 0===i?uo(t,r):i}class Cl{constructor(e){this.Ir=e,this.buffer=new es(Al),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Al(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class xl{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){qa(kl,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){$o(e)?qa(kl,"Ignoring IndexedDB error during garbage collection: ",e):await Bo(e)}await this.Vr(3e5)})}}class Dl{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return jo.resolve(qo.ce);const n=new Cl(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(qa("LruGarbageCollector","Garbage collection skipped; disabled"),jo.resolve(Il)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(qa("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Il):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,i,a,o,s,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(qa("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,s=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(c=Date.now(),$a()<=j.DEBUG&&qa("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-d}ms\n\tDetermined least recently used ${r} in `+(o-a)+`ms\n\tRemoved ${i} targets in `+(s-o)+`ms\n\tRemoved ${e} documents in `+(c-s)+`ms\nTotal Duration: ${c-d}ms`),jo.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Pl{constructor(){this.changes=new xc(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$s.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?jo.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ld(n.mutation,e,ns.empty(),Oo.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Bc()).next(()=>t))}getLocalViewOfDocuments(e,t,n=Bc()){const r=Lc();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=Rc();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Lc();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Bc()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=Pc();const a=Uc(),o=Uc();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof md)?i=i.insert(t.key,t):void 0!==o?(a.set(t.key,o.mutation.getFieldMask()),ld(o.mutation,t,o.mutation.getFieldMask(),Oo.now())):a.set(t.key,ns.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>o.set(e,new Nl(t,a.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){const n=Uc();let r=new Jo((e,t)=>e-t),i=Bc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const a=t.get(e);if(null===a)return;let o=n.get(e)||ns.empty();o=i.applyToLocalView(a,o),n.set(e,o);const s=(r.get(i.batchId)||Bc()).add(e);r=r.insert(i.batchId,s)})}).next(()=>{const a=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),s=r.key,c=r.value,d=Mc();c.forEach(e=>{if(!i.has(e)){const r=cd(t.get(e),n.get(e));null!==r&&d.set(e,r),i=i.add(e)}}),a.push(this.documentOverlayCache.saveOverlays(e,s,d))}return jo.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return i=t,Io.isDocumentKey(i.path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):yc(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r);var i}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const a=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):jo.resolve(Lc());let o=-1,s=i;return a.next(t=>jo.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?jo.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{s=s.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,s,t,Bc())).next(e=>({batchId:o,changes:Oc(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Io(t)).next(e=>{let t=Rc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let a=Rc();return this.indexManager.getCollectionParents(e,i).next(o=>jo.forEach(o,o=>{const s=(c=t,d=o.child(i),new fc(d,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,d;return this.getDocumentsMatchingCollectionQuery(e,s,n,r).next(e=>{e.forEach((e,t)=>{a=a.insert(e,t)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,$s.newInvalidDocument(r)))});let n=Rc();return e.forEach((e,r)=>{const a=i.get(e);void 0!==a&&ld(a.mutation,r,ns.empty(),Oo.now()),kc(t,r)&&(n=n.insert(e,r))}),n})}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return jo.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(n=t).id,version:n.version,createTime:Qd(n.createTime)}),jo.resolve();var n}getNamedQuery(e,t){return jo.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(n=t).name,query:vl(n.bundledQuery),readTime:Qd(n.readTime)}),jo.resolve();var n}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ll{constructor(){this.overlays=new Jo(Io.comparator),this.qr=new Map}getOverlay(e,t){return jo.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Lc();return jo.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),jo.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),jo.resolve()}getOverlaysForCollection(e,t,n){const r=Lc(),i=t.length+1,a=new Io(t.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const e=o.getNext().value,a=e.getKey();if(!t.isPrefixOf(a.path))break;a.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return jo.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Jo((e,t)=>e-t);const a=this.overlays.getIterator();for(;a.hasNext();){const e=a.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Lc(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Lc(),s=i.getIterator();for(;s.hasNext()&&(s.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return jo.resolve(o)}St(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Id(t,n));let i=this.qr.get(t);void 0===i&&(i=Bc(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml{constructor(){this.sessionToken=is.EMPTY_BYTE_STRING}getSessionToken(e){return jo.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,jo.resolve()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(){this.Qr=new es(Vl.$r),this.Ur=new es(Vl.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new Vl(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new Vl(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new Io(new vo([])),n=new Vl(t,e),r=new Vl(t,e+1),i=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Io(new vo([])),n=new Vl(t,e),r=new Vl(t,e+1);let i=Bc();return this.Ur.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new Vl(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Vl{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Io.comparator(e.key,t.key)||uo(e.Yr,t.Yr)}static Kr(e,t){return uo(e.Yr,t.Yr)||Io.comparator(e.key,t.key)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new es(Vl.$r)}checkEmpty(e){return jo.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new bd(i,t,n,r);this.mutationQueue.push(a);for(const o of r)this.Zr=this.Zr.add(new Vl(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return jo.resolve(a)}lookupMutationBatch(e,t){return jo.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ei(n),i=r<0?0:r;return jo.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return jo.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return jo.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Vl(t,0),r=new Vl(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,r],e=>{const t=this.Xr(e.Yr);i.push(t)}),jo.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new es(uo);return t.forEach(e=>{const t=new Vl(e,0),r=new Vl(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),jo.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Io.isDocumentKey(i)||(i=i.child(""));const a=new Vl(new Io(i),0);let o=new es(uo);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Yr)),!0)},a),jo.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){Qa(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return jo.forEach(t.mutations,r=>{const i=new Vl(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new Vl(t,0),r=this.Zr.firstAfterOrEqual(n);return jo.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,jo.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bl{constructor(e){this.ri=e,this.docs=new Jo(Io.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return jo.resolve(n?n.document.mutableCopy():$s.newInvalidDocument(t))}getEntries(e,t){let n=Pc();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():$s.newInvalidDocument(e))}),jo.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Pc();const a=t.path,o=new Io(a.child("__id-9223372036854775808__")),s=this.docs.getIteratorFrom(o);for(;s.hasNext();){const{key:e,value:{document:o}}=s.getNext();if(!a.isPrefixOf(e.path))break;e.path.length>a.length+1||Vo(Mo(o),n)<=0||(r.has(o.key)||kc(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return jo.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Wa(9500)}ii(e,t){return jo.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new jl(this)}getSize(e){return jo.resolve(this.size)}}class jl extends Pl{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),jo.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(e){this.persistence=e,this.si=new xc(e=>hc(e),pc),this.lastRemoteSnapshotVersion=Lo.min(),this.highestTargetId=0,this.oi=0,this._i=new Ul,this.targetCount=0,this.ai=Sl.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),jo.resolve()}getLastRemoteSnapshotVersion(e){return jo.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return jo.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),jo.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),jo.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Sl(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,jo.resolve()}updateTargetData(e,t){return this.Pr(t),jo.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,jo.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.si.forEach((a,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),jo.waitFor(i).next(()=>r)}getTargetCount(e){return jo.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return jo.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),jo.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),jo.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),jo.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return jo.resolve(n)}containsKey(e,t){return jo.resolve(this._i.containsKey(t))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e,t){this.ui={},this.overlays={},this.ci=new qo(0),this.li=!1,this.li=!0,this.hi=new Ml,this.referenceDelegate=e(this),this.Pi=new $l(this),this.indexManager=new bl,this.remoteDocumentCache=new Bl(e=>this.referenceDelegate.Ti(e)),this.serializer=new yl(t),this.Ii=new Ol(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ll,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new Fl(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){qa("MemoryPersistence","Starting transaction:",e);const r=new zl(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return jo.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class zl extends Fo{constructor(e){super(),this.currentSequenceNumber=e}}class Hl{constructor(e){this.persistence=e,this.Ri=new Ul,this.Vi=null}static mi(e){return new Hl(e)}get fi(){if(this.Vi)return this.Vi;throw Wa(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),jo.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),jo.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),jo.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return jo.forEach(this.fi,n=>{const r=Io.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,Lo.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return jo.or([()=>jo.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Gl{constructor(e,t){this.persistence=e,this.pi=new xc(e=>function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Wo(t)),t=Go(e.get(n),t);return Wo(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new Dl(e,t)}(this,t)}static mi(e,t){return new Gl(e,t)}Ei(){}di(e){return jo.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return jo.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?jo.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,i.removeEntry(r,Lo.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),jo.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),jo.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),jo.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),jo.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ns(e.data.value)),t}br(e,t,n){return jo.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return jo.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wl{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=Bc(),r=Bc();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Wl(e,t.fromCache,n,r)}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kl{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=I()?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}(b())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const n=new Kl;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>i.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?($a()<=j.DEBUG&&qa("QueryEngine","SDK will not create cache indexes for query:",Sc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),jo.resolve()):($a()<=j.DEBUG&&qa("QueryEngine","Query:",Sc(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?($a()<=j.DEBUG&&qa("QueryEngine","The SDK decides to create cache indexes for query:",Sc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,bc(t))):jo.resolve())}ys(e,t){if(wc(t))return jo.resolve(null);let n=bc(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Ic(t,null,"F"),n=bc(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const i=Bc(...r);return this.ps.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const a=this.Ds(t,r);return this.Cs(t,a,i,n.readTime)?this.ys(e,Ic(t,null,"F")):this.vs(e,a,t,n)}))})))}ws(e,t,n,r){return wc(t)||r.isEqual(Lo.min())?jo.resolve(null):this.ps.getDocuments(e,n).next(i=>{const a=this.Ds(t,i);return this.Cs(t,a,n,r)?jo.resolve(null):($a()<=j.DEBUG&&qa("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Sc(t)),this.vs(e,a,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Lo.fromTimestamp(1e9===r?new Oo(n+1,0):new Oo(n,r));return new Uo(i,Io.empty(),t)}(r,-1)).next(e=>e))})}Ds(e,t){let n=new es(Ac(e));return t.forEach((t,r)=>{kc(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return $a()<=j.DEBUG&&qa("QueryEngine","Using full collection scan to execute query:",Sc(t)),this.ps.getDocumentsMatchingQuery(e,t,Uo.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yl="LocalStore";class Jl{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new Jo(uo),this.xs=new xc(e=>hc(e),pc),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Rl(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function Xl(e,t){const n=Ya(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],a=[];let o=Bc();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){a.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:a}))})})}function Zl(e){const t=Ya(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function eu(e,t){const n=Ya(e),r=t.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const a=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const o=[];t.targetChanges.forEach((a,s)=>{const c=i.get(s);if(!c)return;o.push(n.Pi.removeMatchingKeys(e,a.removedDocuments,s).next(()=>n.Pi.addMatchingKeys(e,a.addedDocuments,s)));let d=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(s)?d=d.withResumeToken(is.EMPTY_BYTE_STRING,Lo.min()).withLastLimboFreeSnapshotVersion(Lo.min()):a.resumeToken.approximateByteSize()>0&&(d=d.withResumeToken(a.resumeToken,r)),i=i.insert(s,d),function(e,t,n){if(0===e.resumeToken.approximateByteSize())return!0;if(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8)return!0;return n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,d,a)&&o.push(n.Pi.updateTargetData(e,d))});let s=Pc(),c=Bc();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(function(e,t,n){let r=Bc(),i=Bc();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=Pc();return n.forEach((n,a)=>{const o=e.get(n);a.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(Lo.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!o.isValidDocument()||a.version.compareTo(o.version)>0||0===a.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):qa(Yl,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",a.version)}),{ks:r,qs:i}})}(e,a,t.documentUpdates).next(e=>{s=e.ks,c=e.qs})),!r.isEqual(Lo.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return jo.waitFor(o).next(()=>a.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,s,c)).next(()=>s)}).then(e=>(n.Ms=i,e))}function tu(e,t){const n=Ya(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}async function nu(e,t,n){const r=Ya(e),i=r.Ms.get(t),a=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",a,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(o){if(!$o(o))throw o;qa(Yl,`Failed to update sequence numbers for target ${t}: ${o}`)}r.Ms=r.Ms.remove(t),r.xs.delete(i.target)}function ru(e,t,n){const r=Ya(e);let i=Lo.min(),a=Bc();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=Ya(e),i=r.xs.get(n);return void 0!==i?jo.resolve(r.Ms.get(i)):r.Pi.getTargetData(t,n)}(r,e,bc(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{a=e})}).next(()=>r.Fs.getDocumentsMatchingQuery(e,t,n?i:Lo.min(),n?a:Bc())).next(e=>(function(e,t,n){let r=e.Os.get(t)||Lo.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Os.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Qs:a})))}class iu{constructor(){this.activeTargetIds=jc}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class au{constructor(){this.Mo=new iu,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new iu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou{Oo(e){}shutdown(){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const su="ConnectivityMonitor";class cu{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){qa(su,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){qa(su,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let du=null;function lu(){return null===du?du=268435456+Math.round(2147483648*Math.random()):du++,"0x"+du.toString(16)
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}const uu="RestConnection",hu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class pu{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===ws?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,i){const a=lu(),o=this.zo(e,t.toUriEncodedString());qa(uu,`Sending RPC '${e}' ${a}:`,o,n);const s={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(s,r,i);const{host:c}=new URL(o),d=f(c);return this.Jo(e,o,s,n,d).then(t=>(qa(uu,`Received RPC '${e}' ${a}: `,t),t),t=>{throw Ha(uu,`RPC '${e}' ${a} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,r,i,a){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ba,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=hu[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mu{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fu="WebChannelConnection";class gu extends pu{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){const a=lu();return new Promise((i,o)=>{const s=new Ca;s.setWithCredentials(!0),s.listenOnce(Da.COMPLETE,()=>{try{switch(s.getLastErrorCode()){case Pa.NO_ERROR:const t=s.getResponseJson();qa(fu,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(t)),i(t);break;case Pa.TIMEOUT:qa(fu,`RPC '${e}' ${a} timed out`),o(new Xa(Ja.DEADLINE_EXCEEDED,"Request time out"));break;case Pa.HTTP_ERROR:const n=s.getStatus();if(qa(fu,`RPC '${e}' ${a} failed with status:`,n,"response text:",s.getResponseText()),n>0){let e=s.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=e?.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Ja).indexOf(t)>=0?t:Ja.UNKNOWN}(t.status);o(new Xa(e,t.message))}else o(new Xa(Ja.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Xa(Ja.UNAVAILABLE,"Connection failed."));break;default:Wa(9055,{l_:e,streamId:a,h_:s.getLastErrorCode(),P_:s.getLastError()})}}finally{qa(fu,`RPC '${e}' ${a} completed.`)}});const c=JSON.stringify(r);qa(fu,`RPC '${e}' ${a} sending request:`,r),s.send(t,"POST",c,n,15)})}T_(e,t,n){const r=lu(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=La(),o=Oa(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(s.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(s.useFetchStreams=!0),this.jo(s.initMessageHeaders,t,n),s.encodeInitMessageHeaders=!0;const d=i.join("");qa(fu,`Creating RPC '${e}' stream ${r}: ${d}`,s);const l=a.createWebChannel(d,s);this.I_(l);let u=!1,h=!1;const p=new mu({Yo:t=>{h?qa(fu,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(u||(qa(fu,`Opening RPC '${e}' stream ${r} transport.`),l.open(),u=!0),qa(fu,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},Zo:()=>l.close()}),m=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return m(l,xa.EventType.OPEN,()=>{h||(qa(fu,`RPC '${e}' stream ${r} transport opened.`),p.o_())}),m(l,xa.EventType.CLOSE,()=>{h||(h=!0,qa(fu,`RPC '${e}' stream ${r} transport closed`),p.a_(),this.E_(l))}),m(l,xa.EventType.ERROR,t=>{h||(h=!0,Ha(fu,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),p.a_(new Xa(Ja.UNAVAILABLE,"The operation could not be completed")))}),m(l,xa.EventType.MESSAGE,t=>{if(!h){const n=t.data[0];Qa(!!n,16349);const i=n,a=i?.error||i[0]?.error;if(a){qa(fu,`RPC '${e}' stream ${r} received error:`,a);const t=a.status;let n=function(e){const t=Td[e];if(void 0!==t)return kd(t)}(t),i=a.message;void 0===n&&(n=Ja.INTERNAL,i="Unknown error status: "+t+" with message "+a.message),h=!0,p.a_(new Xa(n,i)),l.close()}else qa(fu,`RPC '${e}' stream ${r} received:`,n),p.u_(n)}}),m(o,Ra.STAT_EVENT,t=>{t.stat===Na.PROXY?qa(fu,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Na.NOPROXY&&qa(fu,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{p.__()},0),p}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function wu(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yu(e){return new zd(e,!0)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vu{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&qa("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bu="PersistentStream";class _u{constructor(e,t,n,r,i,a,o,s){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new vu(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===Ja.RESOURCE_EXHAUSTED?(za(t.toString()),za("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Ja.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{const e=new Xa(Ja.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return qa(bu,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(qa(bu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Iu extends _u{constructor(e,t,n,r,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:Wa(39313,{state:r}),a=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(Qa(void 0===t||"string"==typeof t,58123),is.fromBase64String(t||"")):(Qa(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),is.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),s=t.targetChange.cause,c=s&&function(e){const t=void 0===e.code?Ja.UNKNOWN:kd(e.code);return new Xa(t,e.message||"")}(s);n=new Md(i,a,o,c||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=el(e,r.document.name),a=Qd(r.document.updateTime),o=r.document.createTime?Qd(r.document.createTime):Lo.min(),s=new Bs({mapValue:{fields:r.document.fields}}),c=$s.newFoundDocument(i,a,o,s),d=r.targetIds||[],l=r.removedTargetIds||[];n=new Od(d,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=el(e,r.document),a=r.readTime?Qd(r.readTime):Lo.min(),o=$s.newNoDocument(i,a),s=r.removedTargetIds||[];n=new Od([],s,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=el(e,r.document),a=r.removedTargetIds||[];n=new Od([],a,i,null)}else{if(!("filter"in t))return Wa(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,a=new Ed(r,i),o=e.targetId;n=new Ld(o,a)}}var r;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Lo.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Lo.min():t.readTime?Qd(t.readTime):Lo.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=nl(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=mc(r)?{documents:al(e,r)}:{query:ol(e,r).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Wd(e,t.resumeToken);const r=Hd(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Lo.min())>0){n.readTime=Gd(e,t.snapshotVersion.toTimestamp());const r=Hd(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Wa(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=nl(this.serializer),t.removeTarget=e,this.q_(t)}}class Eu extends _u{constructor(e,t,n,r,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Qa(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Qa(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){Qa(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(Qa(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?Qd(e.updateTime):Qd(t);return n.isEqual(Lo.min())&&(n=Qd(t)),new id(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Qd(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=nl(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof pd)n={update:il(e,t.key,t.value)};else if(t instanceof yd)n={delete:Zd(e,t.key)};else if(t instanceof md)n={update:il(e,t.key,t.data),updateMask:fl(t.fieldMask)};else{if(!(t instanceof vd))return Wa(16599,{Vt:t.type});n={verify:Zd(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Qc)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Yc)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Xc)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ed)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw Wa(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=(r=e,void 0!==(i=t.precondition).updateTime?{updateTime:Kd(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:Wa(27497))),n;var r,i}(this.serializer,e))};this.q_(t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu{}class Su extends Tu{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new Xa(Ja.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Go(e,Jd(t,n),r,i,a)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Ja.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Xa(Ja.UNKNOWN,e.toString())})}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Ho(e,Jd(t,n),r,a,o,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Ja.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Xa(Ja.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class ku{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(za(t),this.aa=!1):qa("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Au="RemoteStore";class Cu{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{Uu(this)&&(qa(Au,"Restarting streams for network reachability change."),await async function(e){const t=Ya(e);t.Ea.add(4),await Du(t),t.Ra.set("Unknown"),t.Ea.delete(4),await xu(t)}(this))})}),this.Ra=new ku(n,r)}}async function xu(e){if(Uu(e))for(const t of e.da)await t(!0)}async function Du(e){for(const t of e.da)await t(!1)}function Pu(e,t){const n=Ya(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),Mu(n)?Lu(n):th(n).O_()&&Ru(n,t))}function Nu(e,t){const n=Ya(e),r=th(n);n.Ia.delete(t),r.O_()&&Ou(n,t),0===n.Ia.size&&(r.O_()?r.L_():Uu(n)&&n.Ra.set("Unknown"))}function Ru(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Lo.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}th(e).Y_(t)}function Ou(e,t){e.Va.Ue(t),th(e).Z_(t)}function Lu(e){e.Va=new Vd({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),th(e).start(),e.Ra.ua()}function Mu(e){return Uu(e)&&!th(e).x_()&&e.Ia.size>0}function Uu(e){return 0===Ya(e).Ea.size}function Vu(e){e.Va=void 0}async function Fu(e){e.Ra.set("Online")}async function Bu(e){e.Ia.forEach((t,n)=>{Ru(e,t)})}async function ju(e,t){Vu(e),Mu(e)?(e.Ra.ha(t),Lu(e)):e.Ra.set("Unknown")}async function $u(e,t,n){if(e.Ra.set("Online"),t instanceof Md&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(r){qa(Au,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await qu(e,r)}else if(t instanceof Od?e.Va.Ze(t):t instanceof Ld?e.Va.st(t):e.Va.tt(t),!n.isEqual(Lo.min()))try{const t=await Zl(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(is.EMPTY_BYTE_STRING,r.snapshotVersion)),Ou(e,t);const i=new wl(r.target,t,n,r.sequenceNumber);Ru(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(i){qa(Au,"Failed to raise snapshot:",i),await qu(e,i)}}async function qu(e,t,n){if(!$o(t))throw t;e.Ea.add(1),await Du(e),e.Ra.set("Offline"),n||(n=()=>Zl(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{qa(Au,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await xu(e)})}function zu(e,t){return t().catch(n=>qu(e,n,t))}async function Hu(e){const t=Ya(e),n=nh(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:-1;for(;Gu(t);)try{const e=await tu(t.localStore,r);if(null===e){0===t.Ta.length&&n.L_();break}r=e.batchId,Wu(t,e)}catch(i){await qu(t,i)}Ku(t)&&Qu(t)}function Gu(e){return Uu(e)&&e.Ta.length<10}function Wu(e,t){e.Ta.push(t);const n=nh(e);n.O_()&&n.X_&&n.ea(t.mutations)}function Ku(e){return Uu(e)&&!nh(e).x_()&&e.Ta.length>0}function Qu(e){nh(e).start()}async function Yu(e){nh(e).ra()}async function Ju(e){const t=nh(e);for(const n of e.Ta)t.ea(n.mutations)}async function Xu(e,t,n){const r=e.Ta.shift(),i=_d.from(r,t,n);await zu(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await Hu(e)}async function Zu(e,t){t&&nh(e).X_&&await async function(e,t){if(function(e){switch(e){case Ja.OK:return Wa(64938);case Ja.CANCELLED:case Ja.UNKNOWN:case Ja.DEADLINE_EXCEEDED:case Ja.RESOURCE_EXHAUSTED:case Ja.INTERNAL:case Ja.UNAVAILABLE:case Ja.UNAUTHENTICATED:return!1;case Ja.INVALID_ARGUMENT:case Ja.NOT_FOUND:case Ja.ALREADY_EXISTS:case Ja.PERMISSION_DENIED:case Ja.FAILED_PRECONDITION:case Ja.ABORTED:case Ja.OUT_OF_RANGE:case Ja.UNIMPLEMENTED:case Ja.DATA_LOSS:return!0;default:return Wa(15467,{code:e})}}(n=t.code)&&n!==Ja.ABORTED){const n=e.Ta.shift();nh(e).B_(),await zu(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Hu(e)}var n}(e,t),Ku(e)&&Qu(e)}async function eh(e,t){const n=Ya(e);n.asyncQueue.verifyOperationInProgress(),qa(Au,"RemoteStore received new credentials");const r=Uu(n);n.Ea.add(3),await Du(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await xu(n)}function th(e){return e.ma||(e.ma=function(e,t,n){const r=Ya(e);return r.sa(),new Iu(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:Fu.bind(null,e),t_:Bu.bind(null,e),r_:ju.bind(null,e),H_:$u.bind(null,e)}),e.da.push(async t=>{t?(e.ma.B_(),Mu(e)?Lu(e):e.Ra.set("Unknown")):(await e.ma.stop(),Vu(e))})),e.ma}function nh(e){return e.fa||(e.fa=function(e,t,n){const r=Ya(e);return r.sa(),new Eu(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:Yu.bind(null,e),r_:Zu.bind(null,e),ta:Ju.bind(null,e),na:Xu.bind(null,e)}),e.da.push(async t=>{t?(e.fa.B_(),await Hu(e)):(await e.fa.stop(),e.Ta.length>0&&(qa(Au,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class rh{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Za,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const a=Date.now()+n,o=new rh(e,t,a,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Xa(Ja.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ih(e,t){if(za("AsyncQueue",`${t}: ${e}`),$o(e))return new Xa(Ja.UNAVAILABLE,`${t}: ${e}`);throw e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah{static emptySet(e){return new ah(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Io.comparator(t.key,n.key):(e,t)=>Io.comparator(e.key,t.key),this.keyedMap=Rc(),this.sortedSet=new Jo(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ah))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new ah;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(){this.ga=new Jo(Io.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Wa(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class sh{constructor(e,t,n,r,i,a,o,s,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=s,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const a=[];return t.forEach(e=>{a.push({type:0,doc:e})}),new sh(e,t,ah.emptySet(t),a,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ec(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class dh{constructor(){this.queries=lh(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=Ya(e),r=n.queries;n.queries=lh(),r.forEach((e,n)=>{for(const r of n.Sa)r.onError(t)})}(this,new Xa(Ja.ABORTED,"Firestore shutting down"))}}function lh(){return new xc(e=>Tc(e),Ec)}async function uh(e,t){const n=Ya(e);let r=3;const i=t.query;let a=n.queries.get(i);a?!a.ba()&&t.Da()&&(r=2):(a=new ch,r=t.Da()?0:1);try{switch(r){case 0:a.wa=await n.onListen(i,!0);break;case 1:a.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(o){const e=ih(o,`Initialization of query '${Sc(t.query)}' failed`);return void t.onError(e)}n.queries.set(i,a),a.Sa.push(t),t.va(n.onlineState),a.wa&&t.Fa(a.wa)&&fh(n)}async function hh(e,t){const n=Ya(e),r=t.query;let i=3;const a=n.queries.get(r);if(a){const e=a.Sa.indexOf(t);e>=0&&(a.Sa.splice(e,1),0===a.Sa.length?i=t.Da()?0:1:!a.ba()&&t.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function ph(e,t){const n=Ya(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.Sa)e.Fa(i)&&(r=!0);t.wa=i}}r&&fh(n)}function mh(e,t,n){const r=Ya(e),i=r.queries.get(t);if(i)for(const a of i.Sa)a.onError(n);r.queries.delete(t)}function fh(e){e.Ca.forEach(e=>{e.next()})}var gh,wh;(wh=gh||(gh={})).Ma="default",wh.Cache="cache";class yh{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new sh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=sh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==gh.Cache}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(e){this.key=e}}class bh{constructor(e){this.key=e}}class _h{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Bc(),this.mutatedKeys=Bc(),this.eu=Ac(e),this.tu=new ah(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new oh,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=r,o=!1;const s="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const d=r.get(e),l=kc(this.query,t)?t:null,u=!!d&&this.mutatedKeys.has(d.key),h=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let p=!1;d&&l?d.data.isEqual(l.data)?u!==h&&(n.track({type:3,doc:l}),p=!0):this.su(d,l)||(n.track({type:2,doc:l}),p=!0,(s&&this.eu(l,s)>0||c&&this.eu(l,c)<0)&&(o=!0)):!d&&l?(n.track({type:0,doc:l}),p=!0):d&&!l&&(n.track({type:1,doc:d}),p=!0,(s||c)&&(o=!0)),p&&(l?(a=a.add(l),i=h?i.add(e):i.delete(e)):(a=a.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const e="F"===this.query.limitType?a.last():a.first();a=a.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:a,iu:n,Cs:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Wa(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),r=r??!1;const o=t&&!r?this._u():[],s=0===this.Xa.size&&this.current&&!r?1:0,c=s!==this.Za;return this.Za=s,0!==a.length||c?{snapshot:new sh(this.query,e.tu,i,a,e.mutatedKeys,0===s,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new oh,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Bc(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new bh(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new vh(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=Bc();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return sh.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const Ih="SyncEngine";class Eh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Th{constructor(e){this.key=e,this.hu=!1}}class Sh{constructor(e,t,n,r,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new xc(e=>Tc(e),Ec),this.Iu=new Map,this.Eu=new Set,this.du=new Jo(Io.comparator),this.Au=new Map,this.Ru=new Ul,this.Vu={},this.mu=new Map,this.fu=Sl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function kh(e,t,n=!0){const r=Wh(e);let i;const a=r.Tu.get(t);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.lu()):i=await Ch(r,t,n,!0),i}async function Ah(e,t){const n=Wh(e);await Ch(n,t,!0,!1)}async function Ch(e,t,n,r){const i=await function(e,t){const n=Ya(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Pi.getTargetData(e,t).next(i=>i?(r=i,jo.resolve(r)):n.Pi.allocateTargetId(e).next(i=>(r=new wl(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.Ms.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e})}(e.localStore,bc(t)),a=i.targetId,o=e.sharedClientState.addLocalQueryTarget(a,n);let s;return r&&(s=await async function(e,t,n,r,i){e.pu=(t,n,r)=>async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await ru(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));const a=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),s=t.view.applyChanges(i,e.isPrimaryClient,a,o);return jh(e,t.targetId,s.au),s.snapshot}(e,t,n,r);const a=await ru(e.localStore,t,!0),o=new _h(t,a.Qs),s=o.ru(a.documents),c=Rd.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),d=o.applyChanges(s,e.isPrimaryClient,c);jh(e,n,d.au);const l=new Eh(t,n,o);return e.Tu.set(t,l),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),d.snapshot}(e,t,a,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&Pu(e.remoteStore,i),s}async function xh(e,t,n){const r=Ya(e),i=r.Tu.get(t),a=r.Iu.get(i.targetId);if(a.length>1)return r.Iu.set(i.targetId,a.filter(e=>!Ec(e,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await nu(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Nu(r.remoteStore,i.targetId),Fh(r,i.targetId)}).catch(Bo)):(Fh(r,i.targetId),await nu(r.localStore,i.targetId,!0))}async function Dh(e,t){const n=Ya(e),r=n.Tu.get(t),i=n.Iu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Nu(n.remoteStore,r.targetId))}async function Ph(e,t,n){const r=function(e){const t=Ya(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Lh.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Mh.bind(null,t),t}(e);try{const e=await function(e,t){const n=Ya(e),r=Oo.now(),i=t.reduce((e,t)=>e.add(t.key),Bc());let a,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let s=Pc(),c=Bc();return n.Ns.getEntries(e,i).next(e=>{s=e,s.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,s)).next(i=>{a=i;const o=[];for(const e of t){const t=ud(e,a.get(e.key).overlayedDocument);null!=t&&o.push(new md(e.key,t,js(t.value.mapValue),ad.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(a,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:Oc(a)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Vu[e.currentUser.toKey()];r||(r=new Jo(uo)),r=r.insert(t,n),e.Vu[e.currentUser.toKey()]=r}(r,e.batchId,n),await zh(r,e.changes),await Hu(r.remoteStore)}catch(i){const e=ih(i,"Failed to persist write");n.reject(e)}}async function Nh(e,t){const n=Ya(e);try{const e=await eu(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Au.get(t);r&&(Qa(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?Qa(r.hu,14607):e.removedDocuments.size>0&&(Qa(r.hu,42227),r.hu=!1))}),await zh(n,e,t)}catch(r){await Bo(r)}}function Rh(e,t,n){const r=Ya(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Tu.forEach((n,r)=>{const i=r.view.va(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=Ya(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.Sa)i.va(t)&&(r=!0)}),r&&fh(n)}(r.eventManager,t),e.length&&r.Pu.H_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Oh(e,t,n){const r=Ya(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Au.get(t),a=i&&i.key;if(a){let e=new Jo(Io.comparator);e=e.insert(a,$s.newNoDocument(a,Lo.min()));const n=Bc().add(a),i=new Nd(Lo.min(),new Map,new Jo(uo),e,n);await Nh(r,i),r.du=r.du.remove(a),r.Au.delete(t),qh(r)}else await nu(r.localStore,t,!1).then(()=>Fh(r,t,n)).catch(Bo)}async function Lh(e,t){const n=Ya(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Ya(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,a=i.keys();let o=jo.resolve();return a.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const a=n.docVersions.get(e);Qa(null!==a,48541),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Bc();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);Vh(n,r,null),Uh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await zh(n,e)}catch(i){await Bo(i)}}async function Mh(e,t,n){const r=Ya(e);try{const e=await function(e,t){const n=Ya(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(Qa(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);Vh(r,t,n),Uh(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await zh(r,e)}catch(i){await Bo(i)}}function Uh(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function Vh(e,t,n){const r=Ya(e);let i=r.Vu[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Vu[r.currentUser.toKey()]=i}}function Fh(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||Bh(e,t)})}function Bh(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(Nu(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),qh(e))}function jh(e,t,n){for(const r of n)r instanceof vh?(e.Ru.addReference(r.key,t),$h(e,r)):r instanceof bh?(qa(Ih,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||Bh(e,r.key)):Wa(19791,{wu:r})}function $h(e,t){const n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(qa(Ih,"New document in limbo: "+n),e.Eu.add(r),qh(e))}function qh(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new Io(vo.fromString(t)),r=e.fu.next();e.Au.set(r,new Th(n)),e.du=e.du.insert(n,r),Pu(e.remoteStore,new wl(bc(gc(n.path)),r,"TargetPurposeLimboResolution",qo.ce))}}async function zh(e,t,n){const r=Ya(e),i=[],a=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((e,s)=>{o.push(r.pu(s,t,n).then(e=>{if((e||n)&&r.isPrimaryClient){const t=e?!e.fromCache:n?.targetChanges.get(s.targetId)?.current;r.sharedClientState.updateQueryState(s.targetId,t?"current":"not-current")}if(e){i.push(e);const t=Wl.As(s.targetId,e);a.push(t)}}))}),await Promise.all(o),r.Pu.H_(i),await async function(e,t){const n=Ya(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>jo.forEach(t,t=>jo.forEach(t.Es,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>jo.forEach(t.ds,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(r){if(!$o(r))throw r;qa(Yl,"Failed to update sequence numbers: "+r)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.Ms.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(e,i)}}}(r.localStore,a))}async function Hh(e,t){const n=Ya(e);if(!n.currentUser.isEqual(t)){qa(Ih,"User change. New user:",t.toKey());const e=await Xl(n.localStore,t);n.currentUser=t,i="'waitForPendingWrites' promise is rejected due to a user change.",(r=n).mu.forEach(e=>{e.forEach(e=>{e.reject(new Xa(Ja.CANCELLED,i))})}),r.mu.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await zh(n,e.Ls)}var r,i}function Gh(e,t){const n=Ya(e),r=n.Au.get(t);if(r&&r.hu)return Bc().add(r.key);{let e=Bc();const r=n.Iu.get(t);if(!r)return e;for(const t of r){const r=n.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function Wh(e){const t=Ya(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Nh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gh.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Oh.bind(null,t),t.Pu.H_=ph.bind(null,t.eventManager),t.Pu.yu=mh.bind(null,t.eventManager),t}class Kh{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=yu(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return function(e,t,n,r){return new Jl(e,t,n,r)}(this.persistence,new Ql,e.initialUser,this.serializer)}Cu(e){return new ql(Hl.mi,this.serializer)}Du(e){return new au}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Kh.provider={build:()=>new Kh};class Qh extends Kh{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Qa(this.persistence.referenceDelegate instanceof Gl,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new xl(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Tl.withCacheSize(this.cacheSizeBytes):Tl.DEFAULT;return new ql(e=>Gl.mi(e,t),this.serializer)}}class Yh{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Rh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Hh.bind(null,this.syncEngine),await async function(e,t){const n=Ya(e);t?(n.Ea.delete(2),await xu(n)):t||(n.Ea.add(2),await Du(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new dh}createDatastore(e){const t=yu(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new gu(r));var r;return function(e,t,n,r){return new Su(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Rh(this.syncEngine,e,0),a=cu.v()?new cu:new ou,new Cu(t,n,r,i,a);var t,n,r,i,a}createSyncEngine(e,t){return function(e,t,n,r,i,a,o){const s=new Sh(e,t,n,r,i,a);return o&&(s.gu=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){const t=Ya(e);qa(Au,"RemoteStore shutting down."),t.Ea.add(5),await Du(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Yh.provider={build:()=>new Yh};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Jh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):za("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xh="FirestoreClient";class Zh{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Fa.UNAUTHENTICATED,this.clientId=lo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{qa(Xh,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(qa(Xh,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Za;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=ih(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function ep(e,t){e.asyncQueue.verifyOperationInProgress(),qa(Xh,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await Xl(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function tp(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){qa(Xh,"Using user provided OfflineComponentProvider");try{await ep(e,e._uninitializedComponentsProvider._offline)}catch(t){const i=t;if(!("FirebaseError"===(n=i).name?n.code===Ja.FAILED_PRECONDITION||n.code===Ja.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw i;Ha("Error using user provided cache. Falling back to memory cache: "+i),await ep(e,new Kh)}}else qa(Xh,"Using default OfflineComponentProvider"),await ep(e,new Qh(void 0));var n;return e._offlineComponents}(e);qa(Xh,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>eh(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>eh(t.remoteStore,n)),e._onlineComponents=t}async function np(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(qa(Xh,"Using user provided OnlineComponentProvider"),await tp(e,e._uninitializedComponentsProvider._online)):(qa(Xh,"Using default OnlineComponentProvider"),await tp(e,new Yh))),e._onlineComponents}async function rp(e){const t=await np(e),n=t.eventManager;return n.onListen=kh.bind(null,t.syncEngine),n.onUnlisten=xh.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Ah.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Dh.bind(null,t.syncEngine),n}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ip(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}const ap=new Map,op="firestore.googleapis.com",sp=!0;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new Xa(Ja.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=op,this.ssl=sp}else this.host=e.host,this.ssl=e.ssl??sp;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=El;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Xa(Ja.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}To("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ip(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Xa(Ja.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Xa(Ja.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Xa(Ja.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class dp{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cp({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Xa(Ja.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Xa(Ja.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cp(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new to;switch(e.type){case"firstParty":return new ao(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Xa(Ja.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ap.get(e);t&&(qa("ComponentProvider","Removing Datastore"),ap.delete(e),t.terminate())}(this),Promise.resolve()}}function lp(e,t,n,r={}){e=xo(e,dp);const i=f(t),a=e._getSettings(),o={...a,emulatorOptions:e._getEmulatorOptions()},c=`${t}:${n}`;i&&(g(`https://${c}`),v("Firestore",!0)),a.host!==op&&a.host!==c&&Ha("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d={...a,host:c,ssl:i,emulatorOptions:r};if(!C(d,o)&&(e._setSettings(d),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Fa.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(a)),""].join(".")}(r.mockUserToken,e._app?.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Xa(Ja.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Fa(i)}e._authCredentials=new no(new eo(t,n))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class up{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new up(this.firestore,e,this._query)}}class hp{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pp(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hp(this.firestore,e,this._key)}toJSON(){return{type:hp._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Po(t,hp._jsonSchema))return new hp(e,n||null,new Io(vo.fromString(t.referencePath)))}}hp._jsonSchemaVersion="firestore/documentReference/1.0",hp._jsonSchema={type:Do("string",hp._jsonSchemaVersion),referencePath:Do("string")};class pp extends up{constructor(e,t,n){super(e,t,gc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new hp(this.firestore,null,new Io(e))}withConverter(e){return new pp(this.firestore,e,this._path)}}function mp(e,t,...n){if(e=M(e),Eo("collection","path",t),e instanceof dp){const r=vo.fromString(t,...n);return ko(r),new pp(e,null,r)}{if(!(e instanceof hp||e instanceof pp))throw new Xa(Ja.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(vo.fromString(t,...n));return ko(r),new pp(e.firestore,null,r)}}function fp(e,t,...n){if(e=M(e),1===arguments.length&&(t=lo.newId()),Eo("doc","path",t),e instanceof dp){const r=vo.fromString(t,...n);return So(r),new hp(e,null,new Io(r))}{if(!(e instanceof hp||e instanceof pp))throw new Xa(Ja.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(vo.fromString(t,...n));return So(r),new hp(e.firestore,e instanceof pp?e.converter:null,new Io(r))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gp="AsyncQueue";class wp{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new vu(this,"async_queue_retry"),this._c=()=>{const e=wu();e&&qa(gp,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=wu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=wu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Za;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!$o(e))throw e;qa(gp,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,za("INTERNAL UNHANDLED ERROR: ",yp(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=rh.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&Wa(47125,{Pc:yp(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function yp(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}function vp(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class bp extends dp{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new wp,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new wp(e),this._firestoreClient=void 0,await e}}}function _p(e,t){const n="object"==typeof e?e:Ue(),r="string"==typeof e?e:ws,i=Pe(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const e=(e=>{const t=u(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]})("firestore");e&&lp(i,...e)}return i}function Ip(e){if(e._terminated)throw new Xa(Ja.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){const t=e._freezeSettings(),n=(r=e._databaseId,i=e._app?.options.appId||"",a=e._persistenceKey,o=t,new gs(r,i,a,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,ip(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator));var r,i,a,o;e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new Zh(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function(e){const t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e),e._firestoreClient}class Ep{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ep(is.fromBase64String(e))}catch(t){throw new Xa(Ja.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ep(is.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ep._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Po(e,Ep._jsonSchema))return Ep.fromBase64String(e.bytes)}}Ep._jsonSchemaVersion="firestore/bytes/1.0",Ep._jsonSchema={type:Do("string",Ep._jsonSchemaVersion),bytes:Do("string")};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Tp{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Xa(Ja.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _o(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sp{constructor(e){this._methodName=e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Xa(Ja.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Xa(Ja.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return uo(this._lat,e._lat)||uo(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:kp._jsonSchemaVersion}}static fromJSON(e){if(Po(e,kp._jsonSchema))return new kp(e.latitude,e.longitude)}}kp._jsonSchemaVersion="firestore/geoPoint/1.0",kp._jsonSchema={type:Do("string",kp._jsonSchemaVersion),latitude:Do("number"),longitude:Do("number")};
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ap{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ap._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Po(e,Ap._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Ap(e.vectorValues);throw new Xa(Ja.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ap._jsonSchemaVersion="firestore/vectorValue/1.0",Ap._jsonSchema={type:Do("string",Ap._jsonSchemaVersion),vectorValues:Do("object")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Cp=/^__.*__$/;class xp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new md(e,this.data,this.fieldMask,t,this.fieldTransforms):new pd(e,this.data,t,this.fieldTransforms)}}class Dp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new md(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Pp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Wa(40011,{Ac:e})}}class Np{constructor(e,t,n,r,i,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Np({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Yp(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(Pp(this.Ac)&&Cp.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Rp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||yu(e)}Cc(e,t,n,r=!1){return new Np({Ac:e,methodName:t,Dc:n,path:_o.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Op(e){const t=e._freezeSettings(),n=yu(e._databaseId);return new Rp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Lp(e,t,n,r,i,a={}){const o=e.Cc(a.merge||a.mergeFields?2:0,t,n,i);Gp("Data must be an object, but it was:",o,r);const s=zp(r,o);let c,d;if(a.merge)c=new ns(o.fieldMask),d=o.fieldTransforms;else if(a.mergeFields){const e=[];for(const r of a.mergeFields){const i=Wp(t,r,n);if(!o.contains(i))throw new Xa(Ja.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Jp(e,i)||e.push(i)}c=new ns(e),d=o.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,d=o.fieldTransforms;return new xp(new Bs(s),c,d)}class Mp extends Sp{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Mp}}function Up(e,t,n){return new Np({Ac:3,Dc:t.settings.Dc,methodName:e._methodName,fc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Vp extends Sp{_toFieldTransform(e){return new rd(e.path,new Qc)}isEqual(e){return e instanceof Vp}}class Fp extends Sp{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Up(this,e,!0),n=this.vc.map(e=>qp(e,t)),r=new Yc(n);return new rd(e.path,r)}isEqual(e){return e instanceof Fp&&C(this.vc,e.vc)}}class Bp extends Sp{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=Up(this,e,!0),n=this.vc.map(e=>qp(e,t)),r=new Xc(n);return new rd(e.path,r)}isEqual(e){return e instanceof Bp&&C(this.vc,e.vc)}}function jp(e,t,n,r){const i=e.Cc(1,t,n);Gp("Data must be an object, but it was:",i,r);const a=[],o=Bs.empty();Qo(r,(e,r)=>{const s=Qp(t,e,n);r=M(r);const c=i.yc(s);if(r instanceof Mp)a.push(s);else{const e=qp(r,c);null!=e&&(a.push(s),o.set(s,e))}});const s=new ns(a);return new Dp(o,s,i.fieldTransforms)}function $p(e,t,n,r,i,a){const o=e.Cc(1,t,n),s=[Wp(t,r,n)],c=[i];if(a.length%2!=0)throw new Xa(Ja.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<a.length;h+=2)s.push(Wp(t,a[h])),c.push(a[h+1]);const d=[],l=Bs.empty();for(let h=s.length-1;h>=0;--h)if(!Jp(d,s[h])){const e=s[h];let t=c[h];t=M(t);const n=o.yc(e);if(t instanceof Mp)d.push(e);else{const r=qp(t,n);null!=r&&(d.push(e),l.set(e,r))}}const u=new ns(d);return new Dp(l,u,o.fieldTransforms)}function qp(e,t){if(Hp(e=M(e)))return Gp("Unsupported field value:",t,e),zp(e,t);if(e instanceof Sp)return function(e,t){if(!Pp(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=qp(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=M(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return zc(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Oo.fromDate(e);return{timestampValue:Gd(t.serializer,n)}}if(e instanceof Oo){const n=new Oo(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Gd(t.serializer,n)}}if(e instanceof kp)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ep)return{bytesValue:Wd(t.serializer,e._byteString)};if(e instanceof hp){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Yd(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Ap)return n=e,r=t,{mapValue:{fields:{[vs]:{stringValue:Is},[Es]:{arrayValue:{values:n.toArray().map(e=>{if("number"!=typeof e)throw r.Sc("VectorValues must only contain numeric values.");return $c(r.serializer,e)})}}}}};var n,r;throw t.Sc(`Unsupported field value: ${Co(e)}`)}(e,t)}function zp(e,t){const n={};return Yo(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Qo(e,(e,r)=>{const i=qp(r,t.mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function Hp(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Oo||e instanceof kp||e instanceof Ep||e instanceof hp||e instanceof Sp||e instanceof Ap)}function Gp(e,t,n){if(!Hp(n)||!Ao(n)){const r=Co(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function Wp(e,t,n){if((t=M(t))instanceof Tp)return t._internalPath;if("string"==typeof t)return Qp(e,t);throw Yp("Field path arguments must be of type string or ",e,!1,void 0,n)}const Kp=new RegExp("[~\\*/\\[\\]]");function Qp(e,t,n){if(t.search(Kp)>=0)throw Yp(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Tp(...t.split("."))._internalPath}catch(r){throw Yp(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Yp(e,t,n,r,i){const a=r&&!r.isEmpty(),o=void 0!==i;let s=`Function ${t}() called with invalid data`;n&&(s+=" (via `toFirestore()`)"),s+=". ";let c="";return(a||o)&&(c+=" (found",a&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Xa(Ja.INVALID_ARGUMENT,s+e+c)}function Jp(e,t){return e.some(e=>e.isEqual(t))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xp{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new hp(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Zp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(em("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Zp extends Xp{data(){return super.data()}}function em(e,t){return"string"==typeof t?Qp(e,t):t instanceof Tp?t._internalPath:t._delegate._internalPath}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tm(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Xa(Ja.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class nm{}class rm extends nm{}function im(e,t,...n){let r=[];t instanceof nm&&r.push(t),r=r.concat(n),function(e){const t=e.filter(e=>e instanceof sm).length,n=e.filter(e=>e instanceof am).length;if(t>1||t>0&&n>0)throw new Xa(Ja.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)e=i._apply(e);return e}class am extends rm{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new am(e,t,n)}_apply(e){const t=this._parse(e);return hm(e._query,t),new up(e.firestore,e.converter,_c(e._query,t))}_parse(e){const t=Op(e.firestore),n=function(e,t,n,r,i,a,o){let s;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new Xa(Ja.INVALID_ARGUMENT,`Invalid Query. You can't perform '${a}' queries on documentId().`);if("in"===a||"not-in"===a){um(o,a);const t=[];for(const n of o)t.push(lm(r,e,n));s={arrayValue:{values:t}}}else s=lm(r,e,o)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||um(o,a),s=function(e,t,n,r=!1){return qp(n,e.Cc(r?4:3,t))}(n,t,o,"in"===a||"not-in"===a);return Qs.create(i,a,s)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function om(e,t,n){const r=t,i=em("where",e);return am._create(i,r,n)}class sm extends nm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new sm(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:Ys.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)hm(n,i),n=_c(n,i)}(e._query,t),new up(e.firestore,e.converter,_c(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class cm extends rm{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new cm(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Xa(Ja.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Xa(Ja.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Gs(t,n)}(e._query,this._field,this._direction);return new up(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new fc(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function dm(e,t="asc"){const n=t,r=em("orderBy",e);return cm._create(r,n)}function lm(e,t,n){if("string"==typeof(n=M(n))){if(""===n)throw new Xa(Ja.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!yc(t)&&-1!==n.indexOf("/"))throw new Xa(Ja.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(vo.fromString(n));if(!Io.isDocumentKey(r))throw new Xa(Ja.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Rs(e,new Io(r))}if(n instanceof hp)return Rs(e,n._key);throw new Xa(Ja.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Co(n)}.`)}function um(e,t){if(!Array.isArray(e)||0===e.length)throw new Xa(Ja.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function hm(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Xa(Ja.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Xa(Ja.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class pm{convertValue(e,t="none"){switch(Ts(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ss(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(cs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Wa(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Qo(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){const t=e.fields?.[Es].arrayValue?.values?.map(e=>ss(e.doubleValue));return new Ap(t)}convertGeoPoint(e){return new kp(ss(e.latitude),ss(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=ms(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(fs(e));default:return null}}convertTimestamp(e){const t=os(e);return new Oo(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=vo.fromString(e);Qa(gl(n),9688,{name:e});const r=new ys(n.get(1),n.get(3)),i=new Io(n.popFirst(5));return r.isEqual(t)||za(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mm(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class fm{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class gm extends Xp{constructor(e,t,n,r,i,a){super(e,t,n,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new wm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(em("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Xa(Ja.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=gm._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}gm._jsonSchemaVersion="firestore/documentSnapshot/1.0",gm._jsonSchema={type:Do("string",gm._jsonSchemaVersion),bundleSource:Do("string","DocumentSnapshot"),bundleName:Do("string"),bundle:Do("string")};class wm extends gm{data(e={}){return super.data(e)}}class ym{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new fm(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new wm(this._firestore,this._userDataWriter,n.key,n,new fm(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Xa(Ja.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new wm(e._firestore,e._userDataWriter,n.doc.key,n.doc,new fm(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new wm(e._firestore,e._userDataWriter,t.doc.key,t.doc,new fm(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,a=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),a=n.indexOf(t.doc.key)),{type:vm(t.type),doc:r,oldIndex:i,newIndex:a}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Xa(Ja.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ym._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=lo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function vm(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Wa(61501,{type:e})}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bm(e){e=xo(e,hp);const t=xo(e.firestore,bp);return function(e,t,n={}){const r=new Za;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const a=new Jh({next:s=>{a.Nu(),t.enqueueAndForget(()=>hh(e,o));const c=s.docs.has(n);!c&&s.fromCache?i.reject(new Xa(Ja.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&s.fromCache&&r&&"server"===r.source?i.reject(new Xa(Ja.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new yh(gc(n.path),a,{includeMetadataChanges:!0,qa:!0});return uh(e,o)}(await rp(e),e.asyncQueue,t,n,r)),r.promise}(Ip(t),e._key).then(n=>xm(t,e,n))}ym._jsonSchemaVersion="firestore/querySnapshot/1.0",ym._jsonSchema={type:Do("string",ym._jsonSchemaVersion),bundleSource:Do("string","QuerySnapshot"),bundleName:Do("string"),bundle:Do("string")};class _m extends pm{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ep(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new hp(this.firestore,null,t)}}function Im(e){e=xo(e,up);const t=xo(e.firestore,bp),n=Ip(t),r=new _m(t);return tm(e._query),function(e,t,n={}){const r=new Za;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const a=new Jh({next:n=>{a.Nu(),t.enqueueAndForget(()=>hh(e,o)),n.fromCache&&"server"===r.source?i.reject(new Xa(Ja.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new yh(n,a,{includeMetadataChanges:!0,qa:!0});return uh(e,o)}(await rp(e),e.asyncQueue,t,n,r)),r.promise}(n,e._query).then(n=>new ym(t,r,e,n))}function Em(e,t,n){e=xo(e,hp);const r=xo(e.firestore,bp),i=mm(e.converter,t,n);return Cm(r,[Lp(Op(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,ad.none())])}function Tm(e,t,n,...r){e=xo(e,hp);const i=xo(e.firestore,bp),a=Op(i);let o;return o="string"==typeof(t=M(t))||t instanceof Tp?$p(a,"updateDoc",e._key,t,n,r):jp(a,"updateDoc",e._key,t),Cm(i,[o.toMutation(e._key,ad.exists(!0))])}function Sm(e){return Cm(xo(e.firestore,bp),[new yd(e._key,ad.none())])}function km(e,t){const n=xo(e.firestore,bp),r=fp(e),i=mm(e.converter,t);return Cm(n,[Lp(Op(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,ad.exists(!1))]).then(()=>r)}function Am(e,...t){e=M(e);let n={includeMetadataChanges:!1,source:"default"},r=0;"object"!=typeof t[r]||vp(t[r])||(n=t[r++]);const i={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(vp(t[r])){const e=t[r];t[r]=e.next?.bind(e),t[r+1]=e.error?.bind(e),t[r+2]=e.complete?.bind(e)}let a,o,s;if(e instanceof hp)o=xo(e.firestore,bp),s=gc(e._key.path),a={next:n=>{t[r]&&t[r](xm(o,e,n))},error:t[r+1],complete:t[r+2]};else{const n=xo(e,up);o=xo(n.firestore,bp),s=n._query;const i=new _m(o);a={next:e=>{t[r]&&t[r](new ym(o,i,n,e))},error:t[r+1],complete:t[r+2]},tm(e._query)}return function(e,t,n,r){const i=new Jh(r),a=new yh(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>uh(await rp(e),a)),()=>{i.Nu(),e.asyncQueue.enqueueAndForget(async()=>hh(await rp(e),a))}}(Ip(o),s,i,a)}function Cm(e,t){return function(e,t){const n=new Za;return e.asyncQueue.enqueueAndForget(async()=>Ph(await function(e){return np(e).then(e=>e.syncEngine)}(e),t,n)),n.promise}(Ip(e),t)}function xm(e,t,n){const r=n.docs.get(t._key),i=new _m(e);return new gm(e,i,t._key,r,new fm(n.hasPendingWrites,n.fromCache),t.converter)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Op(e)}set(e,t,n){this._verifyNotCommitted();const r=Pm(e,this._firestore),i=mm(r.converter,t,n),a=Lp(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,ad.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=Pm(e,this._firestore);let a;return a="string"==typeof(t=M(t))||t instanceof Tp?$p(this._dataReader,"WriteBatch.update",i._key,t,n,r):jp(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,ad.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Pm(e,this._firestore);return this._mutations=this._mutations.concat(new yd(t._key,ad.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Xa(Ja.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Pm(e,t){if((e=M(e)).firestore!==t)throw new Xa(Ja.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function Nm(){return new Vp("serverTimestamp")}function Rm(...e){return new Fp("arrayUnion",e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Om(e){return Ip(e=xo(e,bp)),new Dm(e,t=>Cm(e,t))}!function(e,t=!0){Ba=Le,De(new U("firestore",(e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),a=new bp(new ro(e.getProvider("auth-internal")),new so(i,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Xa(Ja.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ys(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:t,...r},a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),Ve(Ua,Va,e),Ve(Ua,Va,"esm2020")}();const Lm=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:pm,Bytes:Ep,CollectionReference:pp,DocumentReference:hp,DocumentSnapshot:gm,FieldPath:Tp,FieldValue:Sp,Firestore:bp,FirestoreError:Xa,GeoPoint:kp,Query:up,QueryCompositeFilterConstraint:sm,QueryConstraint:rm,QueryDocumentSnapshot:wm,QueryFieldFilterConstraint:am,QueryOrderByConstraint:cm,QuerySnapshot:ym,SnapshotMetadata:fm,Timestamp:Oo,VectorValue:Ap,WriteBatch:Dm,_AutoId:lo,_ByteString:is,_DatabaseId:ys,_DocumentKey:Io,_EmptyAuthCredentialsProvider:to,_FieldPath:_o,_cast:xo,_logWarn:Ha,_validateIsNotUsedTogether:To,addDoc:km,arrayRemove:function(...e){return new Bp("arrayRemove",e)},arrayUnion:Rm,collection:mp,connectFirestoreEmulator:lp,deleteDoc:Sm,doc:fp,ensureFirestoreConfigured:Ip,executeWrite:Cm,getDoc:bm,getDocs:Im,getFirestore:_p,onSnapshot:Am,orderBy:dm,query:im,serverTimestamp:Nm,setDoc:Em,updateDoc:Tm,where:om,writeBatch:Om},Symbol.toStringTag,{value:"Module"})),Mm="@firebase/installations",Um="0.6.19",Vm=1e4,Fm=`w:${Um}`,Bm="FIS_v2",jm=36e5,$m=new k("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function qm(e){return e instanceof S&&e.code.includes("request-failed")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zm({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function Hm(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Gm(e,t){const n=(await t.json()).error;return $m.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Wm({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Km(e,{refreshToken:t}){const n=Wm(e);return n.append("Authorization",function(e){return`${Bm} ${e}`}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)),n}async function Qm(e){const t=await e();return t.status>=500&&t.status<600?e():t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ym(e){return new Promise(t=>{setTimeout(t,e)})}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Jm=/^[cdef][\w-]{21}$/;function Xm(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){const t=(n=e,btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_"));var n;return t.substr(0,22)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e);return Jm.test(t)?t:""}catch{return""}}function Zm(e){return`${e.appName}!${e.appId}`}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ef=new Map;function tf(e,t){const n=Zm(e);nf(n,t),function(e,t){const n=function(){!rf&&"BroadcastChannel"in self&&(rf=new BroadcastChannel("[Firebase] FID Change"),rf.onmessage=e=>{nf(e.data.key,e.data.fid)});return rf}();n&&n.postMessage({key:e,fid:t});0===ef.size&&rf&&(rf.close(),rf=null)}(n,t)}function nf(e,t){const n=ef.get(e);if(n)for(const r of n)r(t)}let rf=null;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const af="firebase-installations-store";let of=null;function sf(){return of||(of=e("firebase-installations-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(af)}})),of}async function cf(e,t){const n=Zm(e),r=(await sf()).transaction(af,"readwrite"),i=r.objectStore(af),a=await i.get(n);return await i.put(t,n),await r.done,a&&a.fid===t.fid||tf(e,t.fid),t}async function df(e){const t=Zm(e),n=(await sf()).transaction(af,"readwrite");await n.objectStore(af).delete(t),await n.done}async function lf(e,t){const n=Zm(e),r=(await sf()).transaction(af,"readwrite"),i=r.objectStore(af),a=await i.get(n),o=t(a);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||a&&a.fid===o.fid||tf(e,o.fid),o}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uf(e){let t;const n=await lf(e.appConfig,n=>{const r=function(e){const t=e||{fid:Xm(),registrationStatus:0};return mf(t)}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){return{installationEntry:t,registrationPromise:Promise.reject($m.create("app-offline"))}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=zm(e),i=Wm(e),a=t.getImmediate({optional:!0});if(a){const e=await a.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:Bm,appId:e.appId,sdkVersion:Fm},s={method:"POST",headers:i,body:JSON.stringify(o)},c=await Qm(()=>fetch(r,s));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:Hm(e.authToken)}}throw await Gm("Create Installation",c)}(e,t);return cf(e.appConfig,n)}catch(n){throw qm(n)&&409===n.customData.serverCode?await df(e.appConfig):await cf(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:hf(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry});return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function hf(e){let t=await pf(e.appConfig);for(;1===t.registrationStatus;)await Ym(100),t=await pf(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await uf(e);return n||t}return t}function pf(e){return lf(e,e=>{if(!e)throw $m.create("installation-not-found");return mf(e)})}function mf(e){return 1===(t=e).registrationStatus&&t.registrationTime+Vm<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}async function ff({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${zm(e)}/${t}/authTokens:generate`}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,n),i=Km(e,n),a=t.getImmediate({optional:!0});if(a){const e=await a.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:Fm,appId:e.appId}},s={method:"POST",headers:i,body:JSON.stringify(o)},c=await Qm(()=>fetch(r,s));if(c.ok){return Hm(await c.json())}throw await Gm("Generate Auth Token",c)}async function gf(e,t=!1){let n;const r=await lf(e.appConfig,r=>{if(!yf(r))throw $m.create("not-registered");const i=r.authToken;if(!t&&function(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+jm}(e)}(i))return r;if(1===i.requestStatus)return n=async function(e,t){let n=await wf(e.appConfig);for(;1===n.authToken.requestStatus;)await Ym(100),n=await wf(e.appConfig);const r=n.authToken;return 0===r.requestStatus?gf(e,t):r}(e,t),r;{if(!navigator.onLine)throw $m.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return{...e,authToken:t}}(r);return n=async function(e,t){try{const n=await ff(e,t),r={...t,authToken:n};return await cf(e.appConfig,r),n}catch(n){if(!qm(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n={...t,authToken:{requestStatus:0}};await cf(e.appConfig,n)}else await df(e.appConfig);throw n}}(e,t),t}});return n?await n:r.authToken}function wf(e){return lf(e,e=>{if(!yf(e))throw $m.create("not-registered");const t=e.authToken;return 1===(n=t).requestStatus&&n.requestTime+Vm<Date.now()?{...e,authToken:{requestStatus:0}}:e;var n;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */})}function yf(e){return void 0!==e&&2===e.registrationStatus}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function vf(e,t=!1){const n=e;await async function(e){const{registrationPromise:t}=await uf(e);t&&await t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n);return(await gf(n,t)).token}function bf(e){return $m.create("missing-app-config-values",{valueName:e})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _f="installations",If=e=>{const t=Pe(e.getProvider("app").getImmediate(),_f).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await uf(t);return r?r.catch(console.error):gf(t).catch(console.error),n.fid}(t),getToken:e=>vf(t,e)}};De(new U(_f,e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw bf("App Configuration");if(!e.name)throw bf("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw bf(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:Pe(t,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),De(new U("installations-internal",If,"PRIVATE")),Ve(Mm,Um),Ve(Mm,Um,"esm2020");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ef="analytics",Tf="https://www.googletagmanager.com/gtag/js",Sf=new W("@firebase/analytics"),kf=new k("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Af(e){if(!e.startsWith(Tf)){const t=kf.create("invalid-gtag-resource",{gtagURL:e});return Sf.warn(t.message),""}return e}function Cf(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function xf(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}("firebase-js-sdk-policy",{createScriptURL:Af}),r=document.createElement("script"),i=`${Tf}?l=${e}&id=${t}`;r.src=n?n?.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function Df(e,t,n,r){return async function(i,...a){try{if("event"===i){const[r,i]=a;await async function(e,t,n,r,i){try{let a=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await Cf(n);for(const n of e){const e=r.find(e=>e.measurementId===n),i=e&&t[e.appId];if(!i){a=[];break}a.push(i)}}0===a.length&&(a=Object.values(t)),await Promise.all(a),e("event",r,i||{})}catch(a){Sf.error(a)}}(e,t,n,r,i)}else if("config"===i){const[i,o]=a;await async function(e,t,n,r,i,a){const o=r[i];try{if(o)await t[o];else{const e=(await Cf(n)).find(e=>e.measurementId===i);e&&await t[e.appId]}}catch(s){Sf.error(s)}e("config",i,a)}(e,t,n,r,i,o)}else if("consent"===i){const[t,n]=a;e("consent",t,n)}else if("get"===i){const[t,n,r]=a;e("get",t,n,r)}else if("set"===i){const[t]=a;e("set",t)}else e(i,...a)}catch(o){Sf.error(o)}}}const Pf=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Nf(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Rf(e,t=Pf,n){const{appId:r,apiKey:i,measurementId:a}=e.options;if(!r)throw kf.create("no-app-id");if(!i){if(a)return{measurementId:a,appId:r};throw kf.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},s=new Lf;return setTimeout(async()=>{s.abort()},6e4),Of({appId:r,apiKey:i,measurementId:a},o,s,t)}async function Of(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=Pf){const{appId:a,measurementId:o}=e;try{await function(e,t){return new Promise((n,r)=>{const i=Math.max(t-Date.now(),0),a=setTimeout(n,i);e.addEventListener(()=>{clearTimeout(a),r(kf.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(r,t)}catch(s){if(o)return Sf.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${s?.message}]`),{appId:a,measurementId:o};throw s}try{const t=await async function(e){const{appId:t,apiKey:n}=e,r={method:"GET",headers:Nf(n)},i="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",t),a=await fetch(i,r);if(200!==a.status&&304!==a.status){let e="";try{const t=await a.json();t.error?.message&&(e=t.error.message)}catch(o){}throw kf.create("config-fetch-failed",{httpStatus:a.status,responseMessage:e})}return a.json()}(e);return i.deleteThrottleMetadata(a),t}catch(s){const t=s;if(!function(e){if(!(e instanceof S&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(t)){if(i.deleteThrottleMetadata(a),o)return Sf.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${t?.message}]`),{appId:a,measurementId:o};throw s}const c=503===Number(t?.customData?.httpStatus)?L(n,i.intervalMillis,30):L(n,i.intervalMillis),d={throttleEndTimeMillis:Date.now()+c,backoffCount:n+1};return i.setThrottleMetadata(a,d),Sf.debug(`Calling attemptFetch again in ${c} millis`),Of(e,d,r,i)}}class Lf{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Mf(e,t,n,r,i,a,o){const s=Rf(e);s.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&Sf.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>Sf.error(e)),t.push(s);const c=
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(){if(!E())return Sf.warn(kf.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await T()}catch(e){return Sf.warn(kf.create("indexeddb-unavailable",{errorInfo:e?.toString()}).message),!1}return!0}().then(e=>e?r.getId():void 0),[d,l]=await Promise.all([s,c]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(Tf)&&n.src.includes(e))return n;return null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)(a)||xf(a,d.measurementId),i("js",new Date);const u=o?.config??{};return u.origin="firebase",u.update=!0,null!=l&&(u.firebase_id=l),i("config",d.measurementId,u),d.measurementId}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(e){this.app=e}_delete(){return delete Vf[this.app.options.appId],Promise.resolve()}}let Vf={},Ff=[];const Bf={};let jf,$f,qf="dataLayer",zf=!1;function Hf(){const e=[];if(_()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=kf.create("invalid-analytics-context",{errorInfo:t});Sf.warn(n.message)}}function Gf(e,t,n){Hf();const r=e.options.appId;if(!r)throw kf.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw kf.create("no-api-key");Sf.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Vf[r])throw kf.create("already-exists",{id:r});if(!zf){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(qf);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let a=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(a=window[i]),window[i]=Df(a,e,t,n),{gtagCore:a,wrappedGtag:window[i]}}(Vf,Ff,Bf,qf,"gtag");$f=e,jf=t,zf=!0}Vf[r]=Mf(e,Ff,Bf,t,jf,qf,n);return new Uf(e)}const Wf="@firebase/analytics",Kf="0.10.18";De(new U(Ef,(e,{options:t})=>Gf(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),De(new U("analytics-internal",function(e){try{const t=e.getProvider(Ef).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=M(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,{...r,send_to:i})}}($f,Vf[e.app.options.appId],t,n,r).catch(e=>Sf.error(e))}(t,e,n,r)}}catch(t){throw kf.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),Ve(Wf,Kf),Ve(Wf,Kf,"esm2020");const Qf={},Yf={apiKey:Qf?.VITE_FIREBASE_API_KEY||"AIzaSyCbBmmxn4Qj4CU6ymfG4MY5VGqCPSo13HY",authDomain:Qf?.VITE_FIREBASE_AUTH_DOMAIN||"controle-financeiro-b98ec.firebaseapp.com",projectId:Qf?.VITE_FIREBASE_PROJECT_ID||"controle-financeiro-b98ec",storageBucket:Qf?.VITE_FIREBASE_STORAGE_BUCKET||"controle-financeiro-b98ec.firebasestorage.app",messagingSenderId:Qf?.VITE_FIREBASE_MESSAGING_SENDER_ID||"418109336597",appId:Qf?.VITE_FIREBASE_APP_ID||"1:418109336597:web:871b262a76e57455ebb21c",measurementId:Qf?.VITE_FIREBASE_MEASUREMENT_ID||"G-7RW2F269V6"};{const e=["apiKey","authDomain","projectId","appId"].filter(e=>!Yf[e]);if(e.length>0)throw new Error(`Firebase configuration incomplete. Missing: ${e.join(", ")}`)}const Jf=Me(Yf),Xf=Ia(Jf),Zf=_p(Jf);let eg=null;try{eg=function(e=Ue()){const t=Pe(e=M(e),Ef);return t.isInitialized()?t.getImmediate():function(e,t={}){const n=Pe(e,Ef);if(n.isInitialized()){const e=n.getImmediate();if(C(t,n.getOptions()))return e;throw kf.create("already-initialized")}return n.initialize({options:t})}(e)}(Jf)}catch{}const tg=Dr(Xf,qr).then(()=>{}).catch(e=>{}),ng=Object.freeze(Object.defineProperty({__proto__:null,get analytics(){return eg},app:Jf,auth:Xf,authReady:tg,db:Zf},Symbol.toStringTag,{value:"Module"})),rg="transactions";function ig(e){return{id:e.id,...e.data()}}function ag(e){try{if(e&&"function"==typeof e.toDate)return e.toDate();if(e&&"object"==typeof e&&"seconds"in e)return new Date(1e3*e.seconds);if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e)return new Date(e)}catch{}return new Date(0)}async function og({budgetId:e,userId:t}={}){const n=mp(Zf,rg),r=[];e&&r.push(om("budgetId","==",e)),t&&r.push(om("userId","==",t));const i=r.length?im(n,...r):im(n),a=(await Im(i)).docs.map(ig);return a.sort((e,t)=>ag(t.createdAt)-ag(e.createdAt)),a}async function sg(e){const t=fp(Zf,rg,e),n=await bm(t);return n.exists()?ig(n):null}async function cg(e){const t=Nm(),n={...e};void 0!==n.valor&&null!==n.valor&&(n.valor=Number(n.valor)),n.createdAt||(n.createdAt=t),n.updatedAt||(n.updatedAt=t);return{id:(await km(mp(Zf,rg),n)).id}}async function dg(e,t){const n=fp(Zf,rg,e),r={...t,updatedAt:Nm()};void 0!==r.valor&&null!==r.valor&&(r.valor=Number(r.valor)),await Tm(n,r)}async function lg(e){const t=fp(Zf,rg,e);await Sm(t)}async function ug({userId:e,budgetId:t,rec:n,createdDate:r,parcelaAtual:i}){const a={userId:e,budgetId:t,descricao:n.descricao,valor:Number(n.valor??0),categoriaId:n.categoriaId,tipo:"despesa",createdAt:Oo.fromDate(r),recorrenteId:n.id,recorrenteNome:n.descricao,parcelaAtual:i??null,parcelasTotal:n.parcelasTotal??null};return{id:(await km(mp(Zf,rg),a)).id}}function hg({budgetId:e,userId:t},n){const r=mp(Zf,rg),i=[];e&&i.push(om("budgetId","==",e));return Am(i.length?im(r,...i):im(r),e=>{const t=e.docs.map(ig).sort((e,t)=>ag(t.createdAt)-ag(e.createdAt));n(t)})}const pg=Object.freeze(Object.defineProperty({__proto__:null,create:cg,createFromRecurring:ug,getById:sg,list:og,listenToChanges:hg,remove:lg,update:dg},Symbol.toStringTag,{value:"Module"}));const mg=new class{constructor(){this.listeners=new Map}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.off(e,t)}off(e,t){const n=this.listeners.get(e);n&&(n.delete(t),0===n.size&&this.listeners.delete(e))}emit(e,t){const n=this.listeners.get(e);if(n)for(const i of n)try{i(t)}catch(r){}}clear(){this.listeners.clear()}getListenerCount(e){const t=this.listeners.get(e);return t?t.size:0}hasListeners(e){return this.listeners.has(e)&&this.listeners.get(e).size>0}once(e,t){const n=r=>{t(r),this.off(e,n)};this.on(e,n)}};function fg(e={}){let t={...e};const n=new Set;return{getState:function(){return t},setState:function(e){const r=t;t={...t,...e};for(const{selector:i,cb:a,last:o}of n){const e=i?i(t):t;if(e!==o.value){o.value=e;try{a(e,r)}catch{}}}},subscribe:function(e,r){const i={selector:e,cb:r,last:{value:e?e(t):t}};return n.add(i),()=>n.delete(i)}}}const gg=fg({transactions:[],loading:!1,error:null});let wg=new Map;async function yg(e,t){try{gg.setState({loading:!0,error:null});const n={budgetId:e};let r=await og(n);try{if((!r||0===r.length)&&"undefined"!=typeof window){const n=t||window.appState?.currentUser?.uid,i=window.appState?.budgets||[],a=Array.isArray(i)&&i.length>1;if(n){const t=await og({userId:n});r=a?(t||[]).filter(t=>t.budgetId===e):(t||[]).filter(t=>!t.budgetId||t.budgetId===e)}}}catch{}gg.setState({transactions:r,loading:!1});try{"undefined"!=typeof window&&(window.appState=window.appState||{},window.appState.transactions=r)}catch{}return r}catch(n){throw gg.setState({error:n.message,loading:!1}),n}}function vg(e,t){const n=`${e}-${t}`;if(wg.has(n))return;const r=hg({budgetId:e,userId:t},t=>{gg.setState({transactions:t}),mg.emit("transactions:updated",{budgetId:e,transactions:t})});wg.set(n,r)}function bg(){wg.forEach(e=>e()),wg.clear()}async function _g(e){try{const r=window.appState.currentUser;if(!r)throw new Error("Usuário não autenticado");const i=window.appState.currentBudget;if(!i)throw new Error("Orçamento não selecionado");const a={...e,userId:r.uid,budgetId:i.id},{id:o}=await cg(a);try{if("undefined"!=typeof window&&"function"==typeof window.sendTransactionNotification)await window.sendTransactionNotification(i.id,r.uid,{...a,id:o});else{const{sendTransactionNotification:e}=await n(async()=>{const{sendTransactionNotification:e}=await Promise.resolve().then(()=>Ow);return{sendTransactionNotification:e}},void 0);await e(i.id,r.uid,{...a,id:o})}}catch(t){}window.checkLimitesCategoria&&window.checkLimitesCategoria();{const e="undefined"!=typeof window?window:null;e&&e.forceUIUpdate&&setTimeout(()=>{try{e.forceUIUpdate&&e.forceUIUpdate()}catch{}},100)}const{Snackbar:s}=await n(async()=>{const{Snackbar:e}=await Promise.resolve().then(()=>ww);return{Snackbar:e}},void 0);return"function"==typeof s?.show?s.show("Transação adicionada com sucesso!","success"):"function"==typeof s?s({message:"Transação adicionada com sucesso!",type:"success"}):window?.Snackbar?.show&&window.Snackbar.show("Transação adicionada com sucesso!","success"),o}catch(r){try{const{Snackbar:e}=await n(async()=>{const{Snackbar:e}=await Promise.resolve().then(()=>ww);return{Snackbar:e}},void 0);"function"==typeof e?.show?e.show("Erro ao adicionar transação","error"):"function"==typeof e?e({message:"Erro ao adicionar transação",type:"error"}):window?.Snackbar?.show&&window.Snackbar.show("Erro ao adicionar transação","error")}catch{}throw r}}async function Ig(e,t){try{let i=null;try{i=await sg(e)}catch{}await dg(e,{...t});try{const r=window.appState.currentUser,a=window.appState.currentBudget?.id;if(a&&r?.uid){const o={};if(i){const e=e=>Object.prototype.hasOwnProperty.call(t,e);e("valor")&&i.valor!==t.valor&&(o.valor={from:i.valor,to:t.valor}),e("descricao")&&i.descricao!==t.descricao&&(o.descricao={from:i.descricao,to:t.descricao}),e("categoriaId")&&i.categoriaId!==t.categoriaId&&(o.categoriaId={from:i.categoriaId,to:t.categoriaId}),e("tipo")&&i.tipo!==t.tipo&&(o.tipo={from:i.tipo,to:t.tipo})}const s={id:e,...t,prev:i?{descricao:i.descricao,valor:i.valor,categoriaId:i.categoriaId,tipo:i.tipo}:null,changeSet:o};if("undefined"!=typeof window&&"function"==typeof window.sendTransactionUpdatedNotification)await window.sendTransactionUpdatedNotification(a,r.uid,s);else{const{sendTransactionUpdatedNotification:e}=await n(async()=>{const{sendTransactionUpdatedNotification:e}=await Promise.resolve().then(()=>Ow);return{sendTransactionUpdatedNotification:e}},void 0);await e(a,r.uid,s)}}}catch(r){}window.checkLimitesCategoria&&window.checkLimitesCategoria();{const e="undefined"!=typeof window?window:null;e&&e.forceUIUpdate&&setTimeout(()=>{try{e.forceUIUpdate&&e.forceUIUpdate()}catch{}},100)}const{Snackbar:a}=await n(async()=>{const{Snackbar:e}=await Promise.resolve().then(()=>ww);return{Snackbar:e}},void 0);"function"==typeof a?.show?a.show("Transação atualizada com sucesso!","success"):"function"==typeof a?a({message:"Transação atualizada com sucesso!",type:"success"}):window?.Snackbar?.show&&window.Snackbar.show("Transação atualizada com sucesso!","success")}catch(i){try{const{Snackbar:e}=await n(async()=>{const{Snackbar:e}=await Promise.resolve().then(()=>ww);return{Snackbar:e}},void 0);"function"==typeof e?.show?e.show("Erro ao atualizar transação","error"):"function"==typeof e?e({message:"Erro ao atualizar transação",type:"error"}):window?.Snackbar?.show&&window.Snackbar.show("Erro ao atualizar transação","error")}catch{}throw i}}async function Eg(e){try{let i=null;try{const t=await sg(e);t&&(i=t)}catch(t){}await lg(e);try{if("undefined"!=typeof window){const t=Array.isArray(window.appState?.transactions)?window.appState.transactions.slice():[],n=t.findIndex(t=>t.id===e);-1!==n&&(t.splice(n,1),window.appState.transactions=t,mg.emit("transactions:updated",{transactions:t}))}}catch{}try{const t=window.appState.currentUser,r=i?.budgetId||window.appState.currentBudget?.id;if(r&&t?.uid){const a=i||{id:e};if("undefined"!=typeof window&&"function"==typeof window.sendTransactionDeletedNotification)await window.sendTransactionDeletedNotification(r,t.uid,a);else{const{sendTransactionDeletedNotification:e}=await n(async()=>{const{sendTransactionDeletedNotification:e}=await Promise.resolve().then(()=>Ow);return{sendTransactionDeletedNotification:e}},void 0);await e(r,t.uid,a)}}}catch(r){}window.checkLimitesCategoria&&window.checkLimitesCategoria();{const e="undefined"!=typeof window?window:null;e&&e.forceUIUpdate&&setTimeout(()=>{try{e.forceUIUpdate&&e.forceUIUpdate()}catch{}},100)}const{Snackbar:a}=await n(async()=>{const{Snackbar:e}=await Promise.resolve().then(()=>ww);return{Snackbar:e}},void 0),o={label:"Desfazer",onClick:async()=>{try{if(!i)return;const{id:e}=await cg(i);try{if("undefined"!=typeof window){const t=Array.isArray(window.appState?.transactions)?window.appState.transactions.slice():[];t.unshift({...i,id:e}),window.appState.transactions=t,mg.emit("transactions:updated",{transactions:t})}}catch{}a.show("Exclusão desfeita","success")}catch(e){a.show("Não foi possível desfazer","error")}}};"function"==typeof a?.show?a.show("Transação excluída","success",5e3,o):"function"==typeof a?a({message:"Transação excluída",type:"success",duration:5e3,action:o}):window?.Snackbar?.show&&window.Snackbar.show("Transação excluída","success")}catch(i){try{const{Snackbar:e}=await n(async()=>{const{Snackbar:e}=await Promise.resolve().then(()=>ww);return{Snackbar:e}},void 0);"function"==typeof e?.show?e.show("Erro ao deletar transação","error"):"function"==typeof e?e({message:"Erro ao deletar transação",type:"error"}):window?.Snackbar?.show&&window.Snackbar.show("Erro ao deletar transação","error")}catch{}throw i}}const Tg=Object.freeze(Object.defineProperty({__proto__:null,addTransaction:async function(e){try{const n=await cg(e);mg.emit("transaction:added",n);try{const t=e.budgetId||window.appState?.currentBudget?.id,n=e.userId||window.appState?.currentUser?.uid;t&&n&&"function"==typeof window.loadTransactions&&(await window.loadTransactions(),mg.emit("transactions:updated",{budgetId:t,transactions:window.appState.transactions||[]}))}catch(t){}return n}catch(n){throw mg.emit("error:transaction",n),n}},addTransactionWithNotifications:_g,createFromRecurring:async function(e){try{const t=await ug(e);return mg.emit("transaction:recurring:applied",t),t}catch(t){throw mg.emit("error:transaction",t),t}},deleteTransaction:async function(e){try{await lg(e),mg.emit("transaction:deleted",{id:e})}catch(t){throw mg.emit("error:transaction",t),t}},deleteTransactionWithNotifications:Eg,loadTransactions:yg,startTransactionsListener:vg,stopAllListeners:bg,stopTransactionsListener:function(e,t){const n=`${e}-${t}`,r=wg.get(n);r&&(r(),wg.delete(n))},transactionsStore:gg,updateTransaction:async function(e,t){try{await dg(e,t),mg.emit("transaction:updated",{id:e,data:t})}catch(n){throw mg.emit("error:transaction",n),n}},updateTransactionWithNotifications:Ig},Symbol.toStringTag,{value:"Module"})),Sg="categories";async function kg(e){if(!e)return null;const t=fp(Zf,Sg,e),n=await bm(t);return n.exists()?{id:n.id,...n.data()}:null}async function Ag(e={}){const t=mp(Zf,Sg),n=[];e.budgetId&&n.push(om("budgetId","==",e.budgetId)),e.userId&&n.push(om("userId","==",e.userId));const r=n.length?im(t,...n):im(t),i=(await Im(r)).docs.map(e=>({id:e.id,...e.data()}));return i.sort((e,t)=>(e.nome||"").localeCompare(t.nome||"")),i}async function Cg(e){const t=mp(Zf,Sg);return(await km(t,e)).id}async function xg(e,t){const n=fp(Zf,Sg,e);return await Tm(n,t),!0}async function Dg(e){const t=fp(Zf,Sg,e);return await Sm(t),!0}function Pg(e,t){return Am(im(mp(Zf,Sg),om("budgetId","==",e),dm("nome")),e=>{const n=e.docs.map(e=>({id:e.id,...e.data()}));t(n)})}const Ng=Object.freeze(Object.defineProperty({__proto__:null,create:Cg,getById:kg,list:Ag,listenToChanges:Pg,remove:Dg,update:xg},Symbol.toStringTag,{value:"Module"})),Rg=fg({categories:[],loading:!1,error:null});let Og=new Map;async function Lg(e){try{Rg.setState({loading:!0,error:null});let t=await Ag({budgetId:e});try{if((!t||0===t.length)&&"undefined"!=typeof window){const n=window.appState?.currentUser?.uid,r=window.appState?.budgets||[],i=Array.isArray(r)&&r.length>1;if(n){const r=await Ag({userId:n});t=i?(r||[]).filter(t=>t.budgetId===e):(r||[]).filter(t=>!t.budgetId||t.budgetId===e)}}}catch{}Rg.setState({categories:t,loading:!1});try{"undefined"!=typeof window&&(window.appState=window.appState||{},window.appState.categories=t)}catch{}return t}catch(t){throw Rg.setState({error:t.message,loading:!1}),t}}function Mg(e){if(Og.has(e))return;const t=Pg(e,t=>{Rg.setState({categories:t}),mg.emit("categories:updated",{budgetId:e,categories:t})});Og.set(e,t)}function Ug(){Og.forEach(e=>e()),Og.clear()}const Vg=Object.freeze(Object.defineProperty({__proto__:null,categoriesStore:Rg,createCategory:async function(e){try{const r={...e};try{const e=r.budgetId||("undefined"!=typeof window?window?.appState?.currentBudget?.id:void 0),t=r.userId||("undefined"!=typeof window?window?.appState?.currentUser?.uid:void 0);e&&(r.budgetId=e),t&&(r.userId=t)}catch{}const i=await Cg(r),a={id:i,...r};mg.emit("category:created",a);try{const e=Rg.getState().categories||[];if(!e.some(e=>e.id===i)){const t=[...e,a];t.sort((e,t)=>(e.nome||"").localeCompare(t.nome||"")),Rg.setState({categories:t})}if("undefined"!=typeof window){window.appState=window.appState||{};const e=Array.isArray(window.appState.categories)?window.appState.categories:[];if(!e.some(e=>e.id===i)){const t=[...e,a];t.sort((e,t)=>(e.nome||"").localeCompare(t.nome||"")),window.appState.categories=t}}}catch{}try{const e=a.budgetId||("undefined"!=typeof window?window?.appState?.currentBudget?.id:void 0),t=a.userId||("undefined"!=typeof window?window?.appState?.currentUser?.uid:void 0);if(e&&t){const{sendCategoryChangeNotification:r}=await n(async()=>{const{sendCategoryChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendCategoryChangeNotification:e}},void 0);await r(e,t,a,"category_added")}}catch(t){}return a}catch(r){throw mg.emit("error:category",r),r}},deleteCategory:async function(e){try{let r=null;try{r=await(kg?.(e))}catch{}await Dg(e),mg.emit("category:deleted",{id:e});try{const t=r?.budgetId||("undefined"!=typeof window?window?.appState?.currentBudget?.id:void 0),i=r?.userId||("undefined"!=typeof window?window?.appState?.currentUser?.uid:void 0);if(t&&i){const{sendCategoryChangeNotification:a}=await n(async()=>{const{sendCategoryChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendCategoryChangeNotification:e}},void 0),o=r?{id:e,...r}:{id:e};await a(t,i,o,"category_deleted",r||null)}}catch(t){}}catch(r){throw mg.emit("error:category",r),r}},loadCategories:Lg,startCategoriesListener:Mg,stopAllListeners:Ug,stopCategoriesListener:function(e){const t=Og.get(e);t&&(t(),Og.delete(e))},updateCategory:async function(e,t){try{let i=null;try{i=await(kg?.(e))}catch{}await xg(e,t),mg.emit("category:updated",{id:e,data:t});try{const r=t?.budgetId||i?.budgetId||("undefined"!=typeof window?window?.appState?.currentBudget?.id:void 0),a=t?.userId||i?.userId||("undefined"!=typeof window?window?.appState?.currentUser?.uid:void 0);if(r&&a){const o={id:e,...i,...t},{sendCategoryChangeNotification:s}=await n(async()=>{const{sendCategoryChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendCategoryChangeNotification:e}},void 0);await s(r,a,o,"category_updated",i||null)}}catch(r){}}catch(i){throw mg.emit("error:category",i),i}}},Symbol.toStringTag,{value:"Module"})),Fg="recorrentes";async function Bg(e){const t=im(mp(Zf,Fg),om("budgetId","==",e));return(await Im(t)).docs.map(e=>({id:e.id,...e.data()}))}async function jg(e){const t=im(mp(Zf,Fg),om("userId","==",e));return(await Im(t)).docs.map(e=>({id:e.id,...e.data()}))}async function $g(e){const t=await bm(fp(Zf,Fg,e));return t.exists()?{id:t.id,...t.data()}:null}const qg="logAplicacoes";function zg(e,t){let n=Number(e),r=Number(t);if(!Number.isFinite(n)||!Number.isFinite(r))return null;for(;r<1;)r+=12,n-=1;for(;r>12;)r-=12,n+=1;return{year:n,month:r}}function Hg(e,t=null,n=null){if(!e?.parcelasTotal||e.parcelasTotal<=1)return null;try{const r=new Date(e.dataInicio);let i;if("number"==typeof t&&"number"==typeof n){const e=zg(t,n);e&&(i=new Date(e.year,e.month-1,1))}i||(i=new Date);let a=12*(i.getFullYear()-r.getFullYear())+(i.getMonth()-r.getMonth());try{const t=r.getFullYear(),n=r.getMonth()+1,o=zg(i.getFullYear(),i.getMonth()+1),s=o&&(o.year>t||o.year===t&&o.month>n);!1===e?.efetivarMesAtual&&s&&(a-=1)}catch{}let o=a+1;return o>e.parcelasTotal&&(o=e.parcelasTotal),o<1&&(o=1),o}catch(r){return 1}}function Gg(e,t=[],n=null,r=null){if(!n||!r){const e=new Date;n=e.getFullYear(),r=e.getMonth()+1}const i=zg(n,r)||{year:n,month:r},{year:a,month:o}=i,s=t.some(t=>{if(!t.recorrenteId||t.recorrenteId!==e.id)return!1;let n;if(t.createdAt&&"object"==typeof t.createdAt&&t.createdAt.seconds)n=new Date(1e3*t.createdAt.seconds);else{if(!t.createdAt)return!1;n=new Date(t.createdAt)}return n.getFullYear()===a&&n.getMonth()+1===o});let c=Hg(e,a,o);const d=zg(a,o+1)||{year:a,month:o},l=zg(a,o-1)||{year:a,month:o};let u=Hg(e,d.year,d.month),h=Hg(e,l.year,l.month);try{const n=t.filter(t=>t.recorrenteId===e.id&&t.createdAt).map(e=>e.createdAt?.toDate?e.createdAt.toDate():new Date(e.createdAt)).sort((e,t)=>e-t);if(n.length>0&&e.dataInicio){const t=n[0],r=new Date(e.dataInicio),i=zg(r.getFullYear(),r.getMonth()+1),a=zg(t.getFullYear(),t.getMonth()+1);if(i&&a){const t=12*(a.year-i.year)+(a.month-i.month);if(t>0){const n=n=>{if(null==n)return n;const r=e.parcelasTotal||n;return Math.max(1,Math.min(r,n-t))};c=n(c),u=n(u),h=n(h)}}}}catch{}let p=!1,m=!1;try{if(e?.parcelasTotal&&e.dataInicio){const t=new Date(e.dataInicio),n=new Date(a,o-1,1);let r=12*(n.getFullYear()-t.getFullYear())+(n.getMonth()-t.getMonth());const i=t.getFullYear(),s=t.getMonth()+1,c=a>i||a===i&&o>s,d=a===i&&o===s;!1===e?.efetivarMesAtual&&(c||d)&&(r-=1);const l=r+1;p=l>e.parcelasTotal,m=l<1}}catch{}return{foiEfetivadaEsteMes:s,parcelaAtual:c,proximaParcela:u,ultimaParcela:h,totalParcelas:e.parcelasTotal,temParcelas:e.parcelasTotal&&e.parcelasTotal>1,ativa:!1!==e.ativa,aposUltimaParcela:p,antesDaPrimeiraParcela:m}}async function Wg(e){return Bg(e)}async function Kg(e,t,r){const i={...r,userId:e,budgetId:t,ativa:!0,createdAt:new Date,parcelasRestantes:r.parcelasRestantes??null,parcelasTotal:r.parcelasTotal??null,efetivarMesAtual:r.efetivarMesAtual??!1},a=await(o=i,km(mp(Zf,Fg),o));var o;try{const{sendRecorrenteChangeNotification:r}=await n(async()=>{const{sendRecorrenteChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendRecorrenteChangeNotification:e}},void 0);await r(t,e,i,"new_recorrente")}catch(s){}return a.id||a}async function Qg(e,t,r){let i=null;try{const e=await $g(t);e&&(i={nome:e.nome,valor:e.valor,frequencia:e.frequencia,categoria:e.categoria,descricao:e.descricao,parcelasRestantes:e.parcelasRestantes,parcelasTotal:e.parcelasTotal})}catch(a){}await function(e,t){return Tm(fp(Zf,Fg,e),t)}(t,{...r,updatedAt:new Date});try{const{sendRecorrenteChangeNotification:a}=await n(async()=>{const{sendRecorrenteChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendRecorrenteChangeNotification:e}},void 0),o=r.budgetId||("undefined"!=typeof window?window?.appState?.currentBudget?.id:void 0);if(o){const n={...r,id:t};await a(o,e,n,"updated_recorrente",i)}}catch(a){}}async function Yg(e,t){let r=null;try{r=await $g(t)}catch(i){}if(await function(e){return Sm(fp(Zf,Fg,e))}(t),r)try{const{sendRecorrenteChangeNotification:t}=await n(async()=>{const{sendRecorrenteChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendRecorrenteChangeNotification:e}},void 0),i=r.budgetId||("undefined"!=typeof window?window?.appState?.currentBudget?.id:void 0);i&&await t(i,e,r,"deleted_recorrente")}catch(i){}}async function Jg(e,t,r=!1,i=null,a=null){const o=new Date,s=Number.isFinite(a)?a:o.getMonth()+1,c=Number.isFinite(i)?i:o.getFullYear(),d=(await Wg(t)).filter(e=>!0===e.ativa),l=await async function(e,t,n){try{let r=window?.appState?.transactions;return Array.isArray(r)&&0!==r.length||(r=await og({budgetId:e})),r.filter(e=>{const r=e.createdAt;if(!r)return!1;const i=r?.toDate?r.toDate():new Date(r);return i.getFullYear()===t&&i.getMonth()+1===n})}catch(r){return[]}}(t,c,s);let u=0,h=0;const p=c===o.getFullYear()&&s===o.getMonth()+1?o.getDate():31;for(const n of d){if(!Xg(n,c,s,p))continue;Zg(l,n,c,s)||(null!==n.parcelasRestantes&&n.parcelasRestantes<=0||(r?(await ew(n,e,t,c,s),u++):h++))}try{if("undefined"!=typeof localStorage&&"true"===localStorage.getItem("noti_recurring_reminders")&&Array.isArray(d)){const{sendRecorrenteReminderNotification:r}=await n(async()=>{const{sendRecorrenteReminderNotification:e}=await Promise.resolve().then(()=>Ow);return{sendRecorrenteReminderNotification:e}},void 0);for(const n of d){Zg(l,n,c,s)||await r(t,e,n)}}}catch(m){}try{if("undefined"!=typeof localStorage&&"true"===localStorage.getItem("noti_weekly_summary")){const{sendWeeklySummaryNotification:r}=await n(async()=>{const{sendWeeklySummaryNotification:e}=await Promise.resolve().then(()=>Ow);return{sendWeeklySummaryNotification:e}},void 0),i={resumo:`Resumo semanal: ${u} recorrentes aplicadas, ${h} pendentes.`,periodo:`${String(s).padStart(2,"0")}/${c}`};await r(t,e,i)}}catch(m){}return{aplicadas:u,pendentes:h,total:d.length}}function Xg(e,t,n,r=null){if(!e.dataInicio)return!0;try{const[i,a,o]=String(e.dataInicio).split("-").map(Number),s=new Date(i,a-1,o),c=s.getFullYear(),d=s.getMonth()+1,l=s.getDate();if(t<c||t===c&&n<d)return!1;if(t===c&&n===d){if((Number.isFinite(r)?r:(new Date).getDate())<l)return!1}let u=12*(t-c)+(n-d);if(!e.efetivarMesAtual&&(t>c||t===c&&n>d)&&(u-=1),null!==e.parcelasTotal&&void 0!==e.parcelasTotal){if(u+1>e.parcelasTotal)return!1}return!(null!==e.parcelasRestantes&&void 0!==e.parcelasRestantes&&e.parcelasRestantes<=0)}catch(i){return!0}}function Zg(e,t,n,r){try{return e.some(e=>{if(e.recorrenteId&&t.id&&e.recorrenteId===t.id)return!0;if(t.descricao&&e.descricao===t.descricao){const i=Hg(t,n,r),a=null!==t.parcelasTotal&&void 0!==t.parcelasTotal,o=void 0!==e.parcelasTotal&&null!==e.parcelasTotal||void 0!==e.parcelaAtual&&null!==e.parcelaAtual;if(a){if(e.parcelasTotal===t.parcelasTotal&&e.parcelaAtual===i)return!0}else if(!o||1===e.parcelasTotal)return!0}return!1})}catch(i){return!1}}async function ew(e,t,r,i,a){const o=e.diaLancamento||1,s=new Date(i,a,0).getDate(),c=Math.max(1,Math.min(s,Number(o))),d=new Date(i,a-1,c),l=Hg(e,i,a),{id:u}=await ug({userId:t,budgetId:r,rec:e,createdDate:d,parcelaAtual:l});try{const i=t,a=r||("undefined"!=typeof window?window?.appState?.currentBudget?.id:void 0);if(a&&i){const{sendTransactionNotification:t}=await n(async()=>{const{sendTransactionNotification:e}=await Promise.resolve().then(()=>Ow);return{sendTransactionNotification:e}},void 0),r={id:u,descricao:e.descricao,valor:e.valor,categoriaId:e.categoriaId||null,tipo:e.tipo||"despesa",recorrenteId:e.id,recorrenteParcelaAtual:l??null,recorrenteParcelasTotal:e.parcelasTotal??null};await t(a,i,r)}}catch(h){}if(null!==e.parcelasRestantes&&void 0!==e.parcelasRestantes){const n=Math.max(0,e.parcelasRestantes-1);n<=0?await Qg(t,e.id,{parcelasRestantes:0,ativa:!1}):await Qg(t,e.id,{parcelasRestantes:n})}try{if((null===e.parcelasRestantes||void 0===e.parcelasRestantes)&&null!==e.parcelasTotal&&void 0!==e.parcelasTotal){(e.parcelasTotal<=1||(l??Number.POSITIVE_INFINITY)>=e.parcelasTotal)&&await Qg(t,e.id,{ativa:!1})}}catch(h){}await async function({userId:e,mesAno:t,transacaoId:n,transacaoData:r}){const i={userId:e,mesAno:t,recorrenteId:r.recorrenteId,descricao:r.descricao,valor:r.valor,dataAplicacao:Nm(),aplicacaoImediata:!1};n&&(i.transacaoId=n),await km(mp(Zf,qg),i)}({userId:t,mesAno:`${i}-${String(a).padStart(2,"0")}`,transacaoId:u,transacaoData:{recorrenteId:e.id,descricao:e.descricao,valor:e.valor}})}async function tw(e){const t=new Date;return async function(e,t){const n=im(mp(Zf,qg),om("userId","==",e),om("dataAplicacao","<",t)),r=await Im(n);let i=0;for(const a of r.docs)await Sm(fp(Zf,qg,a.id)),i++;return i}(e,new Date(t.getFullYear()-1,t.getMonth(),t.getDate()))}async function nw(){try{const t=window.appState?.currentUser?.uid,n=window.appState?.currentBudget?.id;if(!t||!n)return[];let r=[];try{n&&(r=await Bg(n)),r&&0!==r.length||(r=await jg(t))}catch(e){r=await jg(t)}return window.appState||(window.appState={}),window.appState.recorrentes=r,r}catch(t){return[]}}const rw=Object.freeze(Object.defineProperty({__proto__:null,addRecorrente:Kg,aplicarRecorrentesDoMes:Jg,calcularParcelaRecorrente:Hg,calcularStatusRecorrente:Gg,deleteRecorrente:Yg,getRecorrentesDoOrcamento:Wg,getRecorrentesDoUsuario:async function(e){return e?jg(e):[]},limparLogsAntigos:tw,loadRecorrentes:nw,updateRecorrente:Qg},Symbol.toStringTag,{value:"Module"}));function iw({title:e="",content:t="",onClose:n=null}){const r=document.getElementById("app-modal");r&&r.remove();const i=document.createElement("div");i.id="app-modal",i.className="modal fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",i.style.cssText="\n    position: fixed !important;\n    top: 0 !important;\n    left: 0 !important;\n    right: 0 !important;\n    bottom: 0 !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    z-index: 9999 !important;\n    background: rgba(0, 0, 0, 0.4) !important;\n  ";let a=!1;i.onclick=e=>{e.target!==i||a||(a=!0,e.stopPropagation(),e.preventDefault(),n?n():i.remove(),window.toggleFABOnModal&&window.toggleFABOnModal())};const o=document.createElement("div");o.className="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-md w-full relative",o.style.cssText="\n    max-width: 90vw !important;\n    max-height: 90vh !important;\n    overflow-y: auto !important;\n    margin: auto !important;\n    transform: none !important;\n  ",o.innerHTML=`\n    <button class="absolute top-2 right-2 text-gray-400 hover:text-gray-700 dark:text-gray-200 text-2xl" aria-label="Fechar" id="modal-close-btn">&times;</button>\n    <h2 class="text-xl font-bold mb-4">${e}</h2>\n    <div class="modal-body">${t}</div>\n  `,i.appendChild(o),document.body.appendChild(i),o.querySelector("#modal-close-btn").onclick=e=>{a||(a=!0,e.stopPropagation(),e.preventDefault(),n?n():i.remove(),window.toggleFABOnModal&&window.toggleFABOnModal())},window.toggleFABOnModal&&window.toggleFABOnModal();try{"undefined"!=typeof window&&"function"!=typeof window.closeModal&&(window.closeModal=function(){try{const e=document.getElementById("app-modal")||i;e&&e.parentNode&&e.parentNode.removeChild(e)}catch{}if(window.toggleFABOnModal)try{window.toggleFABOnModal()}catch{}})}catch{}return i}const aw=Object.freeze(Object.defineProperty({__proto__:null,Modal:iw},Symbol.toStringTag,{value:"Module"})),ow="snackbar_prefs_v1",sw={defaultDuration:3e3,bottom:80,position:"bottom",align:"center",hoverPause:!0,maxQueue:5,cooldownMs:500};function cw(e,t){const n=Number(e);return Number.isFinite(n)?n:t}function dw(e){const t=e||{},n={...sw};var r,i;return"defaultDuration"in t&&(n.defaultDuration=Math.max(500,cw(t.defaultDuration,sw.defaultDuration))),"bottom"in t&&(n.bottom=Math.max(0,cw(t.bottom,sw.bottom))),"string"!=typeof t.position||"top"!==t.position&&"bottom"!==t.position||(n.position=t.position),"string"!=typeof t.align||"left"!==t.align&&"center"!==t.align&&"right"!==t.align||(n.align=t.align),"hoverPause"in t&&(n.hoverPause=(r=t.hoverPause,i=sw.hoverPause,"boolean"==typeof r?r:"true"===r||"false"!==r&&i)),"maxQueue"in t&&(n.maxQueue=Math.max(1,cw(t.maxQueue,sw.maxQueue))),"cooldownMs"in t&&(n.cooldownMs=Math.max(0,cw(t.cooldownMs,sw.cooldownMs))),n}function lw(){try{const e=localStorage.getItem(ow);if(!e)return{...sw};return dw(JSON.parse(e))}catch{return{...sw}}}function uw(e){try{const t=dw(e);mg.emit("snackbar:configure",t);try{"undefined"!=typeof window&&window.Snackbar&&"function"==typeof window.Snackbar.configure&&window.Snackbar.configure(t)}catch{}return t}catch{return dw(e)}}function hw(){const e=lw();return uw(e),e}"undefined"!=typeof window&&(window.__snackbarPrefs={STORAGE_KEY:ow,defaults:sw,loadPrefs:lw,savePrefs:function(e){try{const t=dw(e);return localStorage.setItem(ow,JSON.stringify(t)),t}catch{return dw(e)}},applyPrefs:uw,initFromStorage:hw});var pw={};const mw=new class{constructor(){this.queue=[],this.isShowing=!1,this.defaultDuration=3e3,this.bottomOffset=80,this.position="bottom",this.align="center",this.hoverPause=!0,this._currentTimeout=null,this._currentEl=null,this._restoreFocusEl=null;try{this.reducedMotion="undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)")?.matches}catch{this.reducedMotion=!1}try{const e="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"";/jsdom/i.test(e)&&(this.reducedMotion=!0)}catch{}try{"undefined"!=typeof process&&pw&&(pw.VITEST||pw.JEST_WORKER_ID)&&(this.reducedMotion=!0)}catch{}this.reducedMotion&&(this.hoverPause=!1),this.maxQueue=5,this._lastShownSig=null,this._lastShownAt=0,this._lastShownMap=new Map,this.cooldownMs=500,this._stats={totalShown:0,byType:Object.create(null),last:null}}show(e,t="info",n=null,r){const i={message:e,type:t,duration:n||this.defaultDuration,action:r&&"object"==typeof r?r:null},a=`${i.type}|${i.message}`,o=this.queue[this.queue.length-1];if(!o||`${o.type}|${o.message}`!==a)if(this._currentEl&&this._currentEl.getAttribute("data-snackbar-sig")===a)try{this.incrementCurrentCount()}catch{}else{try{const e=Date.now();if(e-(this._lastShownMap.get(a)||0)<(0|this.cooldownMs))return;this._lastShownMap.set(a,e)}catch{}this.queue.length>=this.maxQueue&&this.queue.shift(),this.queue.push(i);try{this._stats.totalShown+=1,this._stats.byType[t]=(this._stats.byType[t]||0)+1,this._stats.last={type:t,message:e}}catch{}this.processQueue()}}call(e){"string"==typeof e?this.show(e,"info"):"object"==typeof e&&this.show(e.message||"Notificação",e.type||"info",e.duration)}processQueue(){if(this.isShowing||0===this.queue.length)return;this.isShowing=!0;const e=this.queue.shift();this.createSnackbar(e)}createSnackbar(e){const{message:t,type:n,duration:r,action:i}=e;this.removeExistingSnackbars();const a=document.createElement("div");a.className=this.getSnackbarClasses(n),a.classList.add("snackbar"),a.setAttribute("data-snackbar","1"),a.setAttribute("data-pos",this.position),a.setAttribute("data-align",this.align);const o="error"===n||"warning"===n;a.setAttribute("role",o?"alert":"status"),a.setAttribute("aria-live",o?"assertive":"polite"),a.setAttribute("aria-atomic","true"),a.innerHTML=this.getSnackbarContent(t,n,i),a.classList.add(`snackbar-${n}`),this.applyThemeStyles(a,n),a.style.zIndex="99999";try{const e=`${this.bottomOffset}px`;"top"===this.position?(a.style.top=`calc(${e} + env(safe-area-inset-top, 0px))`,a.style.bottom=""):(a.style.bottom=`calc(${e} + env(safe-area-inset-bottom, 0px))`,a.style.top=""),"left"===this.align?(a.style.left="16px",a.style.right="",a.style.transform="none"):"right"===this.align?(a.style.right="16px",a.style.left="",a.style.transform="none"):(a.style.left="50%",a.style.right="",a.style.transform="translateX(-50%)")}catch{}try{this._restoreFocusEl=document.activeElement instanceof HTMLElement?document.activeElement:null}catch{this._restoreFocusEl=null}document.body.appendChild(a),this.setupEventListeners(a,i);const s=()=>a.classList.add("snackbar-show");this.reducedMotion?a.classList.add("snackbar-show"):requestAnimationFrame(s);const c=()=>{this.clearDismissTimer();const e=Math.max(10,0|r);this._currentTimeout=setTimeout(()=>{this.removeSnackbar(a)},this.reducedMotion?Math.min(200,e):e)};this._currentEl=a;try{const e=`${n}|${t}`;a.setAttribute("data-snackbar-sig",e)}catch{}c(),this.hoverPause&&(a.addEventListener("mouseenter",()=>this.clearDismissTimer()),a.addEventListener("mouseleave",()=>c()),a.addEventListener("focusin",()=>this.clearDismissTimer()),a.addEventListener("focusout",()=>c())),this.reducedMotion||setTimeout(()=>{const e=a.querySelector(".snackbar-action"),t=a.querySelector(".snackbar-close");e?e.focus?.():t&&t.focus?.()},10)}getCurrentTheme(){return document.documentElement.classList.contains("dark")?"dark":"light"}getCurrentThemeColor(){return localStorage.getItem("themeColor")||document.documentElement.getAttribute("data-theme-color")||"blue"}applyThemeStyles(e,t){const n=this.getCurrentTheme(),r={blue:{primary:"#3B82F6",secondary:"#1E40AF",light:"#DBEAFE"},green:{primary:"#10B981",secondary:"#059669",light:"#D1FAE5"},purple:{primary:"#8B5CF6",secondary:"#7C3AED",light:"#EDE9FE"},orange:{primary:"#F59E0B",secondary:"#D97706",light:"#FEF3C7"}},i=r[this.getCurrentThemeColor()]||r.blue,a=(e=>{switch(e){case"success":case"info":default:return"dark"===n?{bg:i.primary,color:"#ffffff",border:i.secondary}:{bg:i.secondary,color:"#ffffff",border:i.primary};case"error":return"dark"===n?{bg:"#ef4444",color:"#ffffff",border:"#dc2626"}:{bg:"#dc2626",color:"#ffffff",border:"#b91c1c"};case"warning":return"dark"===n?{bg:"#f59e0b",color:"#1f2937",border:"#d97706"}:{bg:"#d97706",color:"#ffffff",border:"#b45309"}}})(t),o="dark"===n?"0.4":"0.3";e.style.backgroundColor=a.bg,e.style.color=a.color,e.style.border=`1px solid ${a.border}`,e.style.boxShadow=`0 4px 12px rgba(${a.bg.replace("#","").match(/.{2}/g).map(e=>parseInt(e,16)).join(", ")}, ${o})`,setTimeout(()=>{const t=e.querySelector(".snackbar-close");t&&(t.style.color=a.color)},10)}getSnackbarClasses(e){return["fixed","left-1/2","transform","-translate-x-1/2","px-4","py-3","rounded-xl","shadow-xl","max-w-sm","w-full","mx-4","opacity-0","translate-y-4","transition-all","duration-300","ease-out","backdrop-blur-md"].join(" ")}getSnackbarContent(e,t,n){const r={success:"✓",error:"✕",warning:"!",info:"i",default:"•"},i=e=>{try{return String(e).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}catch{return String(e||"")}},a=i(e),o=n&&n.label?i(n.label):"",s=n&&n.label?`<button class="snackbar-action ml-2 text-xs underline opacity-80 hover:opacity-100 transition-opacity" aria-label="${o}">${o}</button>`:"";return`\n      <div class="flex items-center gap-2">\n        <span class="text-sm font-medium opacity-80">${r[t]||r.default}</span>\n        <span class="flex-1 text-sm">${a}</span>\n        <span class="snackbar-count hidden text-xs font-medium px-1.5 py-0.5 rounded bg-white/20">×1</span>\n        ${s}\n        <button class="snackbar-close" aria-label="Fechar notificação" title="Fechar (ou pressione Esc)">\n          <span class="text-base font-medium">×</span>\n        </button>\n      </div>\n    `}removeExistingSnackbars(){document.querySelectorAll('[data-snackbar="1"]').forEach(e=>{this.removeSnackbar(e)})}incrementCurrentCount(){if(!this._currentEl)return;const e=this._currentEl.querySelector(".snackbar-count");if(!e)return;const t=(parseInt((e.textContent||"1").replace(/[^0-9]/g,""),10)||1)+1;e.textContent=`×${t}`,e.classList.remove("hidden");if(this._currentEl.querySelector(".flex-1")){const e=this._currentEl.getAttribute("role")||"status";this._currentEl.setAttribute("aria-live","alert"===e?"assertive":"polite"),this._currentEl.setAttribute("aria-atomic","true")}}removeSnackbar(e){if(!e||!e.parentNode)return;e.classList.remove("snackbar-show"),e.classList.add("snackbar-hide");const t=this.reducedMotion?50:300;setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),this.clearDismissTimer(),this._currentEl=null,this.isShowing=!1,this._lastShownAt=Date.now(),this._lastShownSig=null;try{this._restoreFocusEl&&document.contains(this._restoreFocusEl)&&this._restoreFocusEl.focus?.()}catch{}this.processQueue()},t)}setupEventListeners(e,t){const n=e.querySelector(".snackbar-close");n&&(n.addEventListener("click",()=>{this.removeSnackbar(e)}),e.addEventListener("keydown",t=>{"Escape"===t.key&&this.removeSnackbar(e)}));const r=e.querySelector(".snackbar-action");r&&(r.addEventListener("click",()=>{this.removeSnackbar(e);try{t&&"function"==typeof t.onClick&&t.onClick()}catch{}}),r.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),r.click())})),e.addEventListener("click",t=>{t.target===e&&this.removeSnackbar(e)})}clearDismissTimer(){this._currentTimeout&&(clearTimeout(this._currentTimeout),this._currentTimeout=null)}closeCurrent(){this._currentEl&&this.removeSnackbar(this._currentEl)}clearQueue(){this.queue=[]}getStats(){try{return JSON.parse(JSON.stringify(this._stats))}catch{return{totalShown:0,byType:{},last:null}}}resetStats(){this._stats={totalShown:0,byType:Object.create(null),last:null}}};function fw(e){"string"==typeof e?mw.show(e,"info"):"object"==typeof e&&mw.show(e.message,e.type||"info",e.duration,e.action)}function gw(){try{if(!mg||"function"!=typeof mg.on)return;try{if(mg.hasListeners&&mg.hasListeners("snackbar:show"))return}catch{}mg.on("snackbar:show",e=>{try{if(!e)return;if("string"==typeof e)return void mw.show(e,"info");const{message:t,type:n="info",duration:r,action:i}=e;mw.show(t,n,r,i)}catch{}}),mg.on("snackbar:configure",e=>{try{fw.configure(e||{})}catch{}}),mg.on("snackbar:clear",()=>{try{mw.clearQueue(),mw.closeCurrent()}catch{}}),mg.on("snackbar:dismiss",()=>{try{mw.closeCurrent()}catch{}}),mg.on("snackbar:closeCurrent",()=>{try{mw.closeCurrent()}catch{}}),mg.on("snackbar:position",e=>{try{if(!e||"object"!=typeof e)return;"string"==typeof e.position&&(mw.position=e.position),"string"==typeof e.align&&(mw.align=e.align),"number"==typeof e.bottom&&(mw.bottomOffset=e.bottom)}catch{}}),["success","error","warning","info"].forEach(e=>{try{mg.on(`snackbar:${e}`,t=>{try{if(!t)return;if("string"==typeof t)return void mw.show(t,e);const{message:n,duration:r,action:i}=t;mw.show(n,e,r,i)}catch{}})}catch{}})}catch{}}fw.show=(e,t="info",n,r)=>{mw.show(e,t,n,r)},fw.success=(e,t)=>{mw.show(e,"success",t)},fw.error=(e,t)=>{mw.show(e,"error",t)},fw.warning=(e,t)=>{mw.show(e,"warning",t)},fw.info=(e,t)=>{mw.show(e,"info",t)},fw.configure=(e={})=>{"number"==typeof e.defaultDuration&&(mw.defaultDuration=e.defaultDuration),"number"==typeof e.bottom&&(mw.bottomOffset=e.bottom),"string"==typeof e.position&&(mw.position=e.position),"string"==typeof e.align&&(mw.align=e.align),"boolean"==typeof e.hoverPause&&(mw.hoverPause=e.hoverPause),"number"==typeof e.maxQueue&&(mw.maxQueue=Math.max(1,0|e.maxQueue)),"number"==typeof e.cooldownMs&&(mw.cooldownMs=Math.max(0,0|e.cooldownMs));try{mw.clearDismissTimer(),mw.isShowing=!1,mw._currentEl=null,mw._restoreFocusEl=null,mw.queue=[];const e=document?.querySelectorAll?.('[data-snackbar="1"]');e&&e.forEach(e=>e.parentNode&&e.parentNode.removeChild(e))}catch{}try{gw()}catch{}},fw.updateSettings=(e={})=>{"number"==typeof e.duration&&(mw.defaultDuration=e.duration),"number"==typeof e.distance&&(mw.bottomOffset=e.distance),"string"==typeof e.position&&(mw.position="inferior"===e.position?"bottom":"superior"===e.position?"top":e.position),"string"==typeof e.align&&(mw.align="centro"===e.align?"center":"esquerda"===e.align?"left":"direita"===e.align?"right":e.align),"number"==typeof e.maxQueue&&(mw.maxQueue=Math.max(1,0|e.maxQueue)),"number"==typeof e.antispam&&(mw.cooldownMs=Math.max(0,0|e.antispam)),"boolean"==typeof e.pauseOnHover&&(mw.hoverPause=e.pauseOnHover)},fw.clearQueue=()=>{mw.clearQueue()},fw.closeCurrent=()=>{mw.closeCurrent()},fw.__getStatsForTest=()=>mw.getStats(),fw.__resetStatsForTest=()=>mw.resetStats();try{gw()}catch{}try{"undefined"==typeof window||window.Snackbar||(window.Snackbar=fw)}catch{}fw.close=()=>mw.closeCurrent(),fw.clearQueue=()=>mw.clearQueue(),"undefined"!=typeof window&&(window.Snackbar=fw,window.SnackbarInstance=mw),fw.emit=e=>{try{if(!e)return;"string"==typeof e?fw.show(e,"info"):"object"==typeof e&&fw.show(e.message||"Notificação",e.type||"info",e.duration,e.action)}catch{}try{mg.emit("snackbar:show",e)}catch{}};try{hw()}catch{}const ww=Object.freeze(Object.defineProperty({__proto__:null,Snackbar:fw},Symbol.toStringTag,{value:"Module"}));function yw(e={}){const t=!!e&&Object.keys(e).length>0;try{const r=iw({title:t?"Editar Categoria":"Nova Categoria",content:`\n      <form id="category-form" class="space-y-4">\n        <div>\n          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">\n            Nome\n          </label>\n          <input \n            type="text" \n            id="nome" \n            name="nome" \n            value="${e.nome||""}"\n            class="u-input w-full"\n            placeholder="Ex: Alimentação, Transporte..."\n            required\n          />\n        </div>\n        \n        <div>\n          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">\n            Tipo\n          </label>\n          <select \n            id="tipo" \n            name="tipo"\n            class="u-input w-full"\n            required\n          >\n            <option value="despesa" ${"despesa"===e.tipo?"selected":""}>Despesa</option>\n            <option value="receita" ${"receita"===e.tipo?"selected":""}>Receita</option>\n          </select>\n        </div>\n        \n        <div>\n          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">\n            Limite Mensal (opcional)\n          </label>\n          <input \n            type="number" \n            id="limite" \n            name="limite" \n            value="${e.limite||""}"\n            step="0.01" \n            min="0"\n            class="u-input w-full"\n            placeholder="0.00"\n          />\n        </div>\n        \n        <div class="flex gap-2 pt-4">\n          <button \n            type="submit" \n            class="flex-1 btn btn-primary"\n          >\n            ${t?"Atualizar":"Adicionar"}\n          </button>\n          <button \n            type="button" \n            onclick="this.closest('.modal').remove()"\n            class="flex-1 btn btn-ghost"\n          >\n            Cancelar\n          </button>\n        </div>\n      </form>\n    `,onClose:()=>r.remove()});document.body.appendChild(r);const i=r.querySelector("#category-form");i.addEventListener("submit",async a=>{a.preventDefault();const o=new FormData(i),s={nome:o.get("nome"),tipo:o.get("tipo"),limite:o.get("limite")?parseFloat(o.get("limite")):null};try{const e=window?.appState?.currentBudget?.id,t=window?.appState?.currentUser?.uid;e&&(s.budgetId=e),t&&(s.userId=t)}catch{}try{const i=await n(()=>Promise.resolve().then(()=>Vg),void 0);t?(await i.updateCategory(e.id,s),fw?.show?.("Categoria atualizada","success")):(await i.createCategory(s),fw?.show?.("Categoria criada","success")),r.remove();try{window.refreshCurrentView?.()}catch{}try{if(window.location.hash.includes("/categories")){const e=await n(()=>import("./CategoriesPage-CbUTxUMT.js"),__vite__mapDeps([0,1,2,3]));await(e.renderCategories?.())}}catch{}}catch(c){if("Operação cancelada pelo usuário"!==c?.message)try{fw.show("Erro ao salvar categoria","error")}catch{}}})}catch(r){window.Snackbar?window.Snackbar.show("Erro ao abrir modal de categoria","error"):alert("Erro ao abrir modal de categoria: "+r.message)}}window.editCategory=function(e){try{const t=window.appState?.categories?.find(t=>t.id===e);t&&yw(t)}catch(t){}},"undefined"!=typeof window&&(window.showAddCategoryModal=yw);const vw=Object.freeze(Object.defineProperty({__proto__:null,default:yw},Symbol.toStringTag,{value:"Module"}));function bw(e={}){const t=!(!e||!e.id&&"edit"!==e._mode);try{const r=e=>{if(!(e instanceof Date)||isNaN(e.getTime()))return"";return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`};let i=null;const a=e.data||e.createdAt;if(a)try{if(a&&"function"==typeof a.toDate)i=a.toDate();else if("string"==typeof a){const e=a.trim(),t=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t)i=new Date(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10));else{const t=new Date(e);isNaN(t.getTime())||(i=t)}}else if("number"==typeof a){const e=new Date(a<1e12?1e3*a:a);isNaN(e.getTime())||(i=e)}else a instanceof Date&&(i=a)}catch{}i||(i=new Date);const o=r(i),s=e=>{try{let t=e?.dataEfetivacao||e?.dataLancamento||e?.data||e?.date||e?.createdAt;if(!t)return null;if(t&&"function"==typeof t.toDate)return t.toDate();if("string"==typeof t){const e=t.trim(),n=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(n)return new Date(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10));const r=new Date(e);return isNaN(r.getTime())?null:r}if("number"==typeof t){const e=new Date(t<1e12?1e3*t:t);return isNaN(e.getTime())?null:e}if(t instanceof Date)return t;const n=new Date(t);return isNaN(n.getTime())?null:n}catch{return null}},c=e=>e?`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`:"",d=e=>{if(!e)return null;const t=String(e).match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t)return new Date(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10));const n=new Date(e);return isNaN(n.getTime())?null:n},l=()=>{try{const e=document.getElementById("data")?.value,t=d(e);if(t)return t}catch{}const e=new Date,t=window.getSelectedPeriod?window.getSelectedPeriod().year:window.appState?.selectedYear||e.getFullYear(),n=window.getSelectedPeriod?window.getSelectedPeriod().month:window.appState?.selectedMonth||e.getMonth()+1;return new Date(t,n-1,1)},u=(e,t)=>{try{if(!e)return 0;const n=c(t);return(Array.isArray(window.appState?.transactions)?window.appState.transactions:[]).filter(t=>t?.categoriaId===e&&"despesa"===t?.tipo).filter(e=>c(s(e))===n).reduce((e,t)=>e+(parseFloat(t?.valor)||0),0)}catch{return 0}},h=t=>{const n=window.appState?.categories||[],r=e.categoriaId||"";return['<option value="">Sem categoria</option>',...n.map(e=>{const n=e.limite?parseFloat(e.limite):0,i=u(e.id,t),a=n>0?` (R$ ${(n-i).toFixed(2)} disponível)`:"";return`<option value="${e.id}" ${r===e.id?"selected":""}>${e.nome}${a}</option>`})].join("")},p=iw({title:t?"Editar Transação":"Nova Transação",content:`\n      <form id="transaction-form" class="space-y-4">\n        <div>\n          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">\n            Descrição\n          </label>\n          <input \n            type="text" \n            id="descricao" \n            name="descricao" \n            value="${e.descricao||""}"\n            class="u-input w-full"\n            placeholder="Ex: Salário, Aluguel, Compras..."\n            required\n          />\n        </div>\n        \n        <div>\n          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">\n            Valor\n          </label>\n          <input \n            type="number" \n            id="valor" \n            name="valor" \n            value="${null!==e.valor&&void 0!==e.valor?e.valor:""}"\n            step="0.01" \n            min="0"\n            class="u-input w-full"\n            placeholder="0.00"\n            required\n          />\n        </div>\n        \n        <div>\n          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">\n            Tipo\n          </label>\n          <select \n            id="tipo" \n            name="tipo"\n            class="u-input w-full"\n            required\n          >\n            <option value="receita" ${"receita"===e.tipo?"selected":""}>Receita</option>\n            <option value="despesa" ${"despesa"===e.tipo?"selected":""}>Despesa</option>\n          </select>\n        </div>\n        \n        <div>\n          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">\n            Categoria\n          </label>\n          <select \n            id="categoriaId" \n            name="categoriaId"\n            class="u-input w-full"\n          >\n            ${h(i)}\n          </select>\n          <div id="categoria-info" class="mt-2 text-sm text-gray-600 dark:text-gray-400 hidden">\n            \x3c!-- Informações da categoria selecionada serão exibidas aqui --\x3e\n          </div>\n        </div>\n        \n        <div>\n          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">\n            Data\n          </label>\n          <input \n            type="date" \n            id="data" \n            name="data" \n            value="${o}"\n            class="u-input w-full"\n            required\n          />\n        </div>\n        \n        <div class="flex gap-2 pt-4">\n          <button \n            type="submit" \n            class="flex-1 btn btn-primary"\n          >\n            ${t?"Atualizar":"Adicionar"}\n          </button>\n          <button \n            type="button" \n            onclick="this.closest('.modal').remove()"\n            class="flex-1 btn btn-ghost"\n          >\n            Cancelar\n          </button>\n        </div>\n      </form>\n    `,onClose:()=>p.remove()});document.body.appendChild(p);const m=p.querySelector("#transaction-form");m.addEventListener("submit",async r=>{r.preventDefault();const i=new FormData(m),a={descricao:i.get("descricao"),valor:parseFloat(i.get("valor")),tipo:i.get("tipo"),categoriaId:i.get("categoriaId")||null,data:i.get("data")};try{if(t){const{updateTransactionWithNotifications:t}=await n(async()=>{const{updateTransactionWithNotifications:e}=await Promise.resolve().then(()=>Tg);return{updateTransactionWithNotifications:e}},void 0);await t(e.id,a),p.remove(),"function"==typeof window.refreshCurrentView&&window.refreshCurrentView()}else{let e=!1;if("function"==typeof window.confirmTransaction)e=await window.confirmTransaction(a);else if("function"==typeof window.showConfirmationModal)e=await new Promise(e=>{window.showConfirmationModal({title:"Adicionar Transação",message:`Tem certeza que deseja adicionar "${a.descricao}" no valor de R$ ${Number(a.valor||0).toFixed(2)}?`,confirmText:"Sim, adicionar",confirmColor:"bg-green-500 hover:bg-green-600",onConfirm:()=>e(!0),onCancel:()=>e(!1)})});else try{const{confirmTransaction:t}=await n(async()=>{const{confirmTransaction:e}=await Promise.resolve().then(()=>Yv);return{confirmTransaction:e}},void 0);e=await t(a)}catch(o){e=confirm(`Adicionar "${a.descricao}" no valor de R$ ${Number(a.valor||0).toFixed(2)}?`)}if(!e)return;p.remove();const{addTransactionWithNotifications:t}=await n(async()=>{const{addTransactionWithNotifications:e}=await Promise.resolve().then(()=>Tg);return{addTransactionWithNotifications:e}},void 0);await t(a),window.Snackbar&&(fw.show?fw.show("Transação adicionada com sucesso","success"):fw({message:"Transação adicionada com sucesso",type:"success"})),"function"==typeof window.refreshCurrentView&&window.refreshCurrentView()}}catch(s){"Operação cancelada pelo usuário"!==s.message&&fw.show("Erro ao salvar transação","error")}});const f=p.querySelector("#categoriaId"),g=p.querySelector("#categoria-info"),w=p.querySelector("#data"),y=()=>{const e=f.value;if(e){const t=window.appState?.categories?.find(t=>t.id===e);if(t){const n=t.limite?parseFloat(t.limite):0,r=l(),i=u(e,r),a=n-i,o=n>0?i/n*100:0;let s="",c="";0===n?(s="Sem limite definido",c="text-gray-500"):a<0?(s=`⚠️ Limite excedido em R$ ${Math.abs(a).toFixed(2)}`,c="text-red-600"):a<.2*n?(s=`⚠️ Quase no limite (${o.toFixed(1)}% usado)`,c="text-yellow-600"):(s=`✓ Dentro do limite (${o.toFixed(1)}% usado)`,c="text-green-600"),g.innerHTML=`\n            <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">\n              <div class="font-medium">${t.nome}</div>\n              <div class="text-xs mt-1">\n                <div>Limite: R$ ${n.toFixed(2)}</div>\n                <div>Gasto: R$ ${i.toFixed(2)}</div>\n                <div>Disponível: R$ ${a.toFixed(2)}</div>\n                <div class="${c} mt-1">${s}</div>\n              </div>\n            </div>\n          `,g.classList.remove("hidden")}}else g.classList.add("hidden")};f.addEventListener("change",y),w.addEventListener("change",()=>{const e=f.value;f.innerHTML=h(l()),f.value=e,y()}),e.categoriaId&&f.dispatchEvent(new Event("change"))}catch(r){window.Snackbar?window.Snackbar.show("Erro ao abrir modal de transação","error"):alert("Erro ao abrir modal de transação: "+r.message)}}window.editTransaction=function(e){const t=window.appState.transactions?.find(t=>t.id===e);t&&bw(t)},"undefined"!=typeof window&&(window.showAddTransactionModal=bw);const _w=Object.freeze(Object.defineProperty({__proto__:null,default:bw},Symbol.toStringTag,{value:"Module"}));const Iw=Object.freeze(Object.defineProperty({__proto__:null,addDespesaRecorrente:Kg,aplicarRecorrentesDoMes:Jg,calcularParcelaRecorrente:Hg,calcularStatusRecorrente:Gg,deleteDespesaRecorrente:Yg,getDespesasRecorrentes:Wg,limparLogsAntigos:tw,updateDespesaRecorrente:Qg},Symbol.toStringTag,{value:"Module"}));window.showAddRecorrenteModal=function(e={}){const t=!!e&&Object.keys(e).length>0,r=iw({title:t?"Editar Despesa Recorrente":"Nova Despesa Recorrente",content:"",onClose:()=>r.remove()}),i=window.appState.currentUser,a=window.appState.currentBudget;if(!i)return void fw({message:"Você precisa estar logado para adicionar recorrentes.",type:"error"});if(!a)return void fw({message:"Selecione um orçamento antes de adicionar recorrentes.",type:"error"});const o=function({onSubmit:e,initialData:t={}}){const n=document.createElement("form");function r(){const e=n.querySelector("#rec-valor"),t=n.querySelector("#rec-parcelas"),r=n.querySelector('input[name="tipo-valor"]:checked'),i=e&&parseFloat(e.value)||0,a=t&&parseInt(t.value)||0,o=r?r.value:"total",s=n.querySelector("#recorrente-valores-info");if(a>1&&i>0)if("total"===o){const e=i/a;s.innerHTML=`<b>Valor total:</b> R$ ${i.toFixed(2)} &nbsp; | &nbsp; <b>Valor por parcela:</b> R$ ${e.toFixed(2)}`}else{const e=i*a;s.innerHTML=`<b>Valor total:</b> R$ ${e.toFixed(2)} &nbsp; | &nbsp; <b>Valor por parcela:</b> R$ ${i.toFixed(2)}`}else s.innerHTML=i>0?`<b>Valor:</b> R$ ${i.toFixed(2)}`:""}return n.className="space-y-4",n.innerHTML=`\n    <div class="form-group">\n      <label class="form-label modal-label">Nome da Despesa Recorrente</label>\n      <input type="text" id="rec-desc" required\n        class="u-input w-full"\n             placeholder="Ex: Aluguel, Netflix, Academia"\n             value="${t.descricao||""}"\n             autocomplete="off"\n             autocorrect="off"\n             autocapitalize="words"\n        style="font-weight: 500; font-size: 16px;">\n    </div>\n    <div class="form-group">\n      <label class="form-label modal-label">Valor da Despesa (R$)</label>\n      <input type="number" id="rec-valor" required step="0.01" min="0"\n        class="u-input w-full"\n             placeholder="0,00"\n             value="${t.valorTotal||t.valor||""}"\n             inputmode="decimal"\n             autocomplete="off"\n        style="font-weight: 500; font-size: 16px;">\n    </div>\n    <div>\n      <label class="modal-label">Tipo do Valor Informado</label>\n      <div class="flex gap-4">\n        <label class="flex items-center gap-2 cursor-pointer radio-label">\n          <input type="radio" name="tipo-valor" value="total" \n                 class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500" \n                 ${t.valorTotal&&!t.valor||!t.valorTotal&&!t.valor?"checked":""}>\n          <span class="radio-text">Valor total (soma de todas as parcelas)</span>\n        </label>\n        <label class="flex items-center gap-2 cursor-pointer radio-label">\n          <input type="radio" name="tipo-valor" value="parcela" \n                 class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500" \n                 ${t.valor&&!t.valorTotal?"checked":""}>\n          <span class="radio-text">Valor de cada parcela</span>\n        </label>\n      </div>\n    </div>\n    <div>\n      <label class="modal-label">Categoria da Despesa</label>\n      <select id="rec-categoria" required\n    class="u-input w-full"\n    style="font-weight: 500; font-size: 16px;">\n   <option value="" style="font-weight: 500; padding: 12px; font-size: 14px;">Selecione uma categoria...</option>\n        ${(window.appState.categories||[]).sort((e,t)=>e.nome.localeCompare(t.nome,"pt-BR",{sensitivity:"base"})).map(e=>{const n=new Date,r=n.getFullYear(),i=n.getMonth()+1,a=(window.appState.transactions||[]).filter(t=>{if(t.categoriaId!==e.id||t.tipo!==e.tipo)return!1;let n;n=t.createdAt&&"object"==typeof t.createdAt&&t.createdAt.seconds?new Date(1e3*t.createdAt.seconds):new Date(t.createdAt);const a=n.getFullYear(),o=n.getMonth()+1;return a===r&&o===i}).reduce((e,t)=>e+parseFloat(t.valor),0),o=parseFloat(e.limite||0),s="receita"===e.tipo?a:o-a;let c=e.nome;return o>0&&(c+=` - Limite: R$ ${o.toFixed(2)}`,"despesa"===e.tipo?c+=` (Disponível: R$ ${Math.max(0,s).toFixed(2)})`:c+=` (Recebido: R$ ${a.toFixed(2)})`),`<option value="${e.id}" ${t.categoriaId===e.id?"selected":""} style="font-weight: 500; padding: 8px;">${c}</option>`}).join("")}\n      </select>\n    </div>\n    <div>\n      <label class="modal-label">Data de Início da Recorrência</label>\n      <input type="date" id="rec-data" required\n        class="u-input w-full"\n             value="${t.dataInicio||(new Date).toISOString().split("T")[0]}"\n        style="font-weight: 500;">\n    </div>\n    <div>\n      <label class="modal-label">Número de Parcelas (deixe vazio para infinito)</label>\n      <input type="number" id="rec-parcelas" min="0"\n        class="u-input w-full"\n             placeholder="Ex: 12 para 1 ano, 24 para 2 anos"\n             value="${t.parcelasRestantes||""}"\n        style="font-weight: 500;">\n    </div>\n    <div id="recorrente-valores-info" class="text-xs text-gray-600 modal-info"></div>\n    <div class="flex items-center gap-2">\n      <input type="checkbox" id="rec-efetivar" \n             class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500 focus:ring-2" \n             ${t.efetivarMesAtual?"checked":""} />\n      <label for="rec-efetivar" class="checkbox-label">Criar transação para este mês automaticamente</label>\n    </div>\n    <div class="flex justify-end space-x-3 pt-4">\n  <button type="button" onclick="(window.closeModal ? window.closeModal() : (document.getElementById('app-modal')?.remove()))" class="btn btn-ghost btn-sm">Cancelar</button>\n  <button type="submit" class="btn btn-primary btn-sm">Salvar</button>\n    </div>\n  `,n.querySelector("#rec-valor").addEventListener("input",r),n.querySelector("#rec-parcelas").addEventListener("input",r),n.querySelectorAll('input[name="tipo-valor"]').forEach(e=>{e.addEventListener("change",r)}),setTimeout(()=>{if(r(),!n.querySelector('input[name="tipo-valor"]:checked')){const e=n.querySelector('input[name="tipo-valor"][value="total"]');if(e){e.checked=!0;try{const t="undefined"!=typeof document&&"function"==typeof document.createEvent?(()=>{const e=document.createEvent("HTMLEvents");return e.initEvent("change",!0,!1),e})():null;t&&e.dispatchEvent(t)}catch{}}}const e=n.querySelector("#rec-efetivar");if(e){const n=!0===t.efetivarMesAtual||"true"===t.efetivarMesAtual;e.checked=n}},100),n.addEventListener("submit",async t=>{t.preventDefault();const r=parseFloat(n.querySelector("#rec-valor").value);let i=n.querySelector("#rec-parcelas").value?parseInt(n.querySelector("#rec-parcelas").value):null;null!==i&&i<1&&(i=null);const a=n.querySelector('input[name="tipo-valor"]:checked').value;let o=r,s=r;i&&i>1?"total"===a?(o=+(r/i).toFixed(2),s=+(o.toFixed(2)*i).toFixed(2)):(o=+r.toFixed(2),s=+(o*i).toFixed(2)):(o=+r.toFixed(2),s=+r.toFixed(2));const c=n.querySelector("#rec-efetivar"),d=c?c.checked:null,l={descricao:n.querySelector("#rec-desc").value,valor:o,valorTotal:s,categoriaId:n.querySelector("#rec-categoria").value,dataInicio:n.querySelector("#rec-data").value,parcelasRestantes:i,parcelasTotal:i,ativa:!0,efetivarMesAtual:d};try{await e(l)}catch(u){throw u}}),n}({initialData:e,onSubmit:async o=>{try{if(o.efetivarMesAtual,document.querySelector(".fab")?.classList.add("hidden"),t&&e.id)await Qg(i.uid,e.id,o);else{const e=await Kg(i.uid,a.id,o);if(o.efetivarMesAtual){const t=new Date,r=t.getMonth()+1,d=t.getFullYear(),{db:l}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>mb);return{db:e}},void 0),u=mp(l,"transactions"),h=await Im(im(u,om("userId","==",i.uid),om("recorrenteId","==",e)));if(!h.docs.some(e=>{const t=e.data(),n=t.createdAt&&t.createdAt.toDate?t.createdAt.toDate():t.createdAt?new Date(t.createdAt):null;return n&&n.getMonth()+1===r&&n.getFullYear()===d})){let u=null,h=1;try{const{createFromRecurring:s}=await n(async()=>{const{createFromRecurring:e}=await Promise.resolve().then(()=>pg);return{createFromRecurring:e}},void 0),{calcularParcelaRecorrente:c}=await n(async()=>{const{calcularParcelaRecorrente:e}=await Promise.resolve().then(()=>rw);return{calcularParcelaRecorrente:e}},void 0),l={id:e,descricao:o.descricao,valor:o.valor,categoriaId:o.categoriaId,parcelasTotal:o.parcelasTotal,parcelasRestantes:o.parcelasRestantes,dataInicio:o.dataInicio||t.toISOString().split("T")[0]},p=c(l,d,r);h=p&&!isNaN(p)?p:1;const{id:m}=await s({userId:i.uid,budgetId:a.id,rec:l,createdDate:t,parcelaAtual:h});u=m}catch(s){const n={userId:i.uid,budgetId:a.id,descricao:o.descricao,valor:o.valor,categoriaId:o.categoriaId,tipo:"despesa",createdAt:t,recorrenteId:e,recorrenteNome:o.descricao};u=(await km(mp(l,"transactions"),n)).id}try{const{sendTransactionNotification:t}=await n(async()=>{const{sendTransactionNotification:e}=await Promise.resolve().then(()=>Ow);return{sendTransactionNotification:e}},void 0),r={id:u,descricao:o.descricao,valor:o.valor,categoriaId:o.categoriaId,tipo:"despesa",recorrenteId:e,recorrenteParcelaAtual:h??null,recorrenteParcelasTotal:o.parcelasTotal??null};await t(a.id,i.uid,r)}catch(c){}try{await km(mp(l,"logAplicacoes"),{userId:i.uid,mesAno:`${d}-${String(r).padStart(2,"0")}`,recorrenteId:e,descricao:o.descricao,valor:o.valor,dataAplicacao:t,transacaoId:u,aplicacaoImediata:!0})}catch(s){}}}}await new Promise(e=>setTimeout(e,200));try{const{loadRecorrentes:e}=await n(async()=>{const{loadRecorrentes:e}=await Promise.resolve().then(()=>rw);return{loadRecorrentes:e}},void 0);await e()}catch(d){"function"==typeof window.loadRecorrentes&&await window.loadRecorrentes()}r.remove(),fw({message:t?"Despesa recorrente editada!":"Despesa recorrente salva!",type:"success"});try{const{loadRecorrentes:e}=await n(async()=>{const{loadRecorrentes:e}=await Promise.resolve().then(()=>rw);return{loadRecorrentes:e}},void 0);await e()}catch(l){}if(window.location.hash.includes("/recorrentes"))try{const{renderRecorrentes:e}=await n(async()=>{const{renderRecorrentes:e}=await import("./RecorrentesPage-BviOzZF0.js");return{renderRecorrentes:e}},__vite__mapDeps([4,1,2]));await e()}catch(d){}setTimeout(async()=>{if(document.querySelector(".fab")?.classList.remove("hidden"),t&&e.id&&"function"==typeof window.recalcularTransacoesRecorrente)try{await window.recalcularTransacoesRecorrente(e.id,o)}catch(l){}try{const{loadRecorrentes:e}=await n(async()=>{const{loadRecorrentes:e}=await Promise.resolve().then(()=>rw);return{loadRecorrentes:e}},void 0);await e()}catch(l){"function"==typeof window.loadRecorrentes&&await window.loadRecorrentes()}try{const{loadTransactions:e}=await n(async()=>{const{loadTransactions:e}=await Promise.resolve().then(()=>Tg);return{loadTransactions:e}},void 0),t=window.appState?.currentBudget?.id,r=window.appState?.currentUser?.uid;await e(t,r)}catch(l){"function"==typeof window.loadTransactions&&await window.loadTransactions()}try{const{loadCategories:e}=await n(async()=>{const{loadCategories:e}=await Promise.resolve().then(()=>Vg);return{loadCategories:e}},void 0),t=window.appState?.currentBudget?.id;await e(t)}catch(l){"function"==typeof window.loadCategories&&await window.loadCategories()}if(window.location.hash.includes("/recorrentes"))try{const{renderRecorrentes:e}=await n(async()=>{const{renderRecorrentes:e}=await import("./RecorrentesPage-BviOzZF0.js");return{renderRecorrentes:e}},__vite__mapDeps([4,1,2]));await e()}catch(d){"function"==typeof window._renderRecorrentes&&window._renderRecorrentes()}else if(window.location.hash.includes("/dashboard"))try{"function"==typeof window.renderDashboard&&window.renderDashboard()}catch{}else if(window.location.hash.includes("/transactions"))try{"function"==typeof window.renderTransactions&&window.renderTransactions()}catch{}document.dispatchEvent(new CustomEvent("recorrente-adicionada",{detail:{isEdicao:t,dados:o,timestamp:Date.now()}})),document.dispatchEvent(new CustomEvent("dados-atualizados",{detail:{tipo:"recorrente",acao:t?"editar":"criar",timestamp:Date.now()}})),setTimeout(async()=>{if(window.location.hash.includes("/recorrentes"))try{const{renderRecorrentes:e}=await n(async()=>{const{renderRecorrentes:e}=await import("./RecorrentesPage-BviOzZF0.js");return{renderRecorrentes:e}},__vite__mapDeps([4,1,2]));await e()}catch(d){}},500)},100)}catch(l){document.querySelector(".fab")?.classList.remove("hidden"),fw({message:"Erro ao salvar recorrente",type:"error"})}}}),s=r.querySelector(".modal-body");s?s.appendChild(o):r.appendChild(o),document.body.appendChild(r)},window.editRecorrente=async function(e){try{const t=window.appState.recorrentes?.find(t=>t.id===e);if(!t)return void fw({message:"Recorrente não encontrada",type:"error"});window.showAddRecorrenteModal(t)}catch(t){fw({message:"Erro ao editar recorrente",type:"error"})}},window.deleteRecorrente=async function(e){try{const t=window.appState.recorrentes?.find(t=>t.id===e);if(!t)return void fw({message:"Recorrente não encontrada",type:"error"});if(!confirm(`Deseja realmente excluir a recorrente "${t.descricao||t.nome}"?`))return;const r=window.appState.currentUser;if(!r)return void fw({message:"Você precisa estar logado",type:"error"});const{deleteDespesaRecorrente:i}=await n(async()=>{const{deleteDespesaRecorrente:e}=await Promise.resolve().then(()=>Iw);return{deleteDespesaRecorrente:e}},void 0);await i(r.uid,e),fw({message:"Recorrente excluída com sucesso!",type:"success"})}catch(t){fw({message:"Erro ao excluir recorrente",type:"error"})}},window.showHistoricoRecorrente=async function(e){try{const t=window.appState.recorrentes?.find(t=>t.id===e);if(!t)return void fw({message:"Recorrente não encontrada",type:"error"});const n=(window.appState.transactions||[]).filter(t=>t.recorrenteId===e);n.sort((e,t)=>{const n=e.createdAt?.toDate?e.createdAt.toDate():new Date(e.createdAt);return(t.createdAt?.toDate?t.createdAt.toDate():new Date(t.createdAt))-n});const r=iw({title:`📊 Histórico: ${t.descricao||t.nome}`,content:"",onClose:()=>r.remove()}),i=r.querySelector(".modal-body");if(0===n.length)i.innerHTML='\n        <div class="text-center py-12">\n          <div class="text-6xl mb-4">📭</div>\n          <p class="text-gray-600 dark:text-gray-400 text-lg">Nenhuma transação encontrada para esta recorrente</p>\n          <p class="text-sm text-gray-500 dark:text-gray-500 mt-2">As transações aparecerão aqui quando forem efetivadas</p>\n        </div>\n      ';else{const e=e=>(e?.toDate?e.toDate():new Date(e)).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"}),t=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),r=n.map(n=>{const r=e(n.createdAt),i=t(n.valor||0),a="receita"===n.tipo?"💰":"💸",o="receita"===n.tipo?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400";return`\n          <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">\n            <div class="flex items-center gap-3">\n              <span class="text-2xl">${a}</span>\n              <div>\n                <div class="font-semibold text-gray-900 dark:text-gray-100">${n.descricao||"Sem descrição"}</div>\n                <div class="text-sm text-gray-500 dark:text-gray-400">${r}</div>\n              </div>\n            </div>\n            <div class="text-right">\n              <div class="font-bold ${o} text-lg">${i}</div>\n              ${n.parcela?`<div class="text-xs text-gray-500 dark:text-gray-400">Parcela ${n.parcela}</div>`:""}\n            </div>\n          </div>\n        `}).join("");i.innerHTML=`\n        <div class="space-y-3 max-h-96 overflow-y-auto">\n          <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 mb-4">\n            <div class="flex items-center justify-between">\n              <div>\n                <div class="text-sm text-gray-600 dark:text-gray-400">Total de transações</div>\n                <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">${n.length}</div>\n              </div>\n              <div>\n                <div class="text-sm text-gray-600 dark:text-gray-400">Valor total</div>\n                <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">${t(n.reduce((e,t)=>e+(t.valor||0),0))}</div>\n              </div>\n            </div>\n          </div>\n          ${r}\n        </div>\n      `}document.body.appendChild(r)}catch(t){fw({message:"Erro ao carregar histórico",type:"error"})}};const Ew=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Tw{constructor(){this.isDarkMode=!1,this.observer=null,this.lastLogTime=0,this.init()}init(){this.checkDarkMode(),this.setupMutationObserver(),this.injectDarkTitleCSS(),setTimeout(()=>{this.checkDarkMode(),this.isDarkMode&&this.fixDarkTitlesAggressive()},500),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{this.checkDarkMode(),this.fixDarkTitlesAggressive()});new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"class"===e.attributeName&&(this.checkDarkMode(),this.isDarkMode&&this.fixDarkTitlesAggressive())})}).observe(document.body,{attributes:!0,attributeFilter:["class"]}),this.forceDarkModeStyles()}checkDarkMode(){const e=document.documentElement.classList.contains("dark"),t=document.body.classList.contains("dark"),n=window.matchMedia("(prefers-color-scheme: dark)").matches,r=document.body.classList.contains("theme-dark"),i=null!==document.querySelector('.theme-dark, .dark-theme, [data-theme="dark"]');this.isDarkMode=n||e||t||r||i}setupMutationObserver(){let e=!1;new MutationObserver(t=>{if(e)return;let n=!1;t.forEach(e=>{"attributes"===e.type&&"style"===e.attributeName||("childList"===e.type||"attributes"===e.type&&"class"===e.attributeName)&&(n=!0)}),n&&(e=!0,setTimeout(()=>{this.forceDarkModeStyles(),e=!1},100))}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class"]})}forceDarkModeStyles(){if(!this.isDarkMode)return;(!this.lastLogTime||Date.now()-this.lastLogTime>5e3)&&(this.lastLogTime=Date.now()),this.fixDarkTitlesAggressive();document.querySelectorAll('.dark .bg-white:not([class*="dark:"]), .dark .bg-gray-50:not([class*="dark:"]), .dark .bg-gray-100:not([class*="dark:"])').forEach(e=>{const t=window.getComputedStyle(e);"rgb(255, 255, 255)"!==t.backgroundColor&&"rgb(249, 250, 251)"!==t.backgroundColor&&"rgb(243, 244, 246)"!==t.backgroundColor||(e.style.setProperty("background-color","#2d3748","important"),e.style.setProperty("border-color","#4a5568","important"))}),this.forceButtonStylesIntelligent()}forceButtonStylesIntelligent(){if(!this.isDarkMode)return;const e=document.querySelectorAll('.dark button:not([class*="dark:"]):not([id^="fab-"]):not(#fab-main)');e.forEach(e=>{const t=window.getComputedStyle(e).backgroundColor;"rgb(255, 255, 255)"!==t&&"rgb(243, 244, 246)"!==t&&"rgb(249, 250, 251)"!==t||(e.style.setProperty("background-color","#4a5568","important"),e.style.setProperty("color","#ffffff","important"))}),this.forceColorThemeButtonsIntelligent()}forceColorThemeButtonsIntelligent(){if(!this.isDarkMode)return;const e=document.querySelectorAll(".dark .color-theme-btn");e.forEach(e=>{switch(e.getAttribute("data-theme")){case"blue":e.style.backgroundColor&&"rgb(255, 255, 255)"!==e.style.backgroundColor||(e.style.setProperty("background-color","#3b82f6","important"),e.style.setProperty("border-color","#3b82f6","important"));break;case"green":e.style.backgroundColor&&"rgb(255, 255, 255)"!==e.style.backgroundColor||(e.style.setProperty("background-color","#10b981","important"),e.style.setProperty("border-color","#10b981","important"));break;case"purple":e.style.backgroundColor&&"rgb(255, 255, 255)"!==e.style.backgroundColor||(e.style.setProperty("background-color","#8b5cf6","important"),e.style.setProperty("border-color","#8b5cf6","important"));break;case"orange":e.style.backgroundColor&&"rgb(255, 255, 255)"!==e.style.backgroundColor||(e.style.setProperty("background-color","#f59e0b","important"),e.style.setProperty("border-color","#f59e0b","important"))}0})}fixDarkTitles(){if(!this.isDarkMode)return;const e=document.querySelectorAll('.dark h1, .dark h2, .dark h3, .dark h4, .dark h5, .dark h6, .dark .card-title, .dark [class*="font-bold"], .dark [class*="font-semibold"]');e.forEach(e=>{const t=window.getComputedStyle(e).color;"rgb(0, 0, 0)"!==t&&"rgb(31, 41, 55)"!==t&&"rgb(55, 65, 81)"!==t&&"rgb(75, 85, 99)"!==t&&"rgb(107, 114, 128)"!==t&&"rgb(17, 24, 39)"!==t&&"rgb(31, 41, 55)"!==t||e.style.setProperty("color","#f9fafb","important")});document.querySelectorAll(".dark .text-lg, .dark .text-xl, .dark .text-2xl, .dark .text-3xl").forEach(e=>{const t=window.getComputedStyle(e).color;"rgb(0, 0, 0)"!==t&&"rgb(31, 41, 55)"!==t&&"rgb(55, 65, 81)"!==t||e.style.setProperty("color","#f9fafb","important")})}fixDarkTitlesAggressive(){if(!this.isDarkMode)return;const e=document.querySelectorAll('\n      h1, h2, h3, h4, h5, h6,\n      .card-title,\n      .section-title,\n      [class*="font-bold"],\n      [class*="font-semibold"],\n      [class*="text-lg"],\n      [class*="text-xl"],\n      [class*="text-2xl"],\n      [class*="text-3xl"],\n      .text-gray-900,\n      .text-gray-800,\n      .text-gray-700,\n      .text-gray-600\n    ');e.forEach(e=>{e.style.setProperty("color","#ffffff","important")});document.querySelectorAll(".card-header *, .card-body h1, .card-body h2, .card-body h3").forEach(e=>{e.style.setProperty("color","#ffffff","important")})}injectDarkTitleCSS(){const e=document.getElementById("dark-title-enforcer");e&&e.remove();const t=document.createElement("style");t.id="dark-title-enforcer",t.textContent='\n      /* FORÇA TÍTULOS BRANCOS - FUNCIONA COM CLASSE .dark OU MODO SISTEMA */\n      @media (prefers-color-scheme: dark) {\n        h1, h2, h3, h4, h5, h6,\n        .card-title, .section-title,\n        [class*="font-bold"], [class*="font-semibold"],\n        [class*="text-lg"], [class*="text-xl"], [class*="text-2xl"], [class*="text-3xl"],\n        .text-gray-900, .text-gray-800, .text-gray-700, .text-gray-600 {\n          color: #ffffff !important;\n        }\n        \n        /* FORÇA TÍTULOS EM CARDS ESPECÍFICOS */\n        .card-header h1, .card-header h2, .card-header h3,\n        .card-body h1, .card-body h2, .card-body h3,\n        .bg-white h1, .bg-white h2, .bg-white h3,\n        .bg-gray-50 h1, .bg-gray-50 h2, .bg-gray-50 h3 {\n          color: #ffffff !important;\n        }\n      }\n      \n      /* TAMBÉM funciona com classe .dark (backup) */\n      .dark h1, .dark h2, .dark h3, .dark h4, .dark h5, .dark h6,\n      .dark .card-title, .dark .section-title,\n      .dark [class*="font-bold"], .dark [class*="font-semibold"],\n      .dark [class*="text-lg"], .dark [class*="text-xl"], .dark [class*="text-2xl"], .dark [class*="text-3xl"],\n      .dark .text-gray-900, .dark .text-gray-800, .dark .text-gray-700, .dark .text-gray-600 {\n        color: #ffffff !important;\n      }\n    ',document.head.appendChild(t)}destroy(){this.observer&&this.observer.disconnect()}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new Tw}):new Tw,setTimeout(()=>{document.body.classList.contains("dark")&&new Tw},1e3);class Sw{constructor(){this.isNative=window.Capacitor?.isNativePlatform(),this.plugin=window.Capacitor?.Plugins?.BiometricAuth}async isAvailable(){if(!this.isNative)return{isAvailable:!1,biometryType:"none",reason:"Funciona apenas no APK nativo"};if(!this.plugin)return{isAvailable:!1,biometryType:"none",reason:"Plugin não encontrado"};try{return await this.plugin.isAvailable()}catch(e){return{isAvailable:!1,biometryType:"none",reason:e.message||"Erro desconhecido"}}}async authenticate(e={}){if(!this.isNative||!this.plugin)return{success:!1,error:"Biometria nativa não disponível"};const t={title:"Autenticação Biométrica",subtitle:"Confirme sua identidade",description:"",negativeButtonText:"Cancelar",...e};try{return await this.plugin.authenticate(t)}catch(n){return{success:!1,error:n.message||"Erro na autenticação"}}}saveCredentials(e,t){if(this.isNative)try{localStorage.setItem("biometric_userId",e),localStorage.setItem("biometric_userInfo",JSON.stringify(t))}catch(n){}}loadCredentials(){if(!this.isNative)return null;try{const e=localStorage.getItem("biometric_userId"),t=localStorage.getItem("biometric_userInfo");if(e&&t)return{userId:e,userInfo:JSON.parse(t)}}catch(e){}return null}clearCredentials(){if(this.isNative)try{localStorage.removeItem("biometric_userId"),localStorage.removeItem("biometric_userInfo"),localStorage.removeItem("biometric_enabled")}catch(e){}}hasCredentials(){return!!this.isNative&&!!localStorage.getItem("biometric_userId")}}async function kw(e,t,r){try{const{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),{getById:a}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),o=await a(e);if(!o)return;if(!o.usuariosPermitidos||0===o.usuariosPermitidos.length)return;const s=await Rw(t),c=s?.displayName||s?.email||"Usuário";let d="Sem categoria",l=null,u=null;if(r.categoriaId){const{getById:e}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>Ng);return{getById:e}},void 0),t=await e(r.categoriaId);t&&(d=t.nome,l=t.tipo??null,u=t.limite??null)}const h={budgetId:e,budgetName:o.nome||"Orçamento",senderUid:t,senderName:c,transactionId:r.id,transactionDescricao:r.descricao,transactionValor:r.valor,transactionCategoria:d,transactionTipo:r.tipo||"despesa",transactionCategoriaTipo:l,transactionCategoriaLimite:u,recorrenteId:r.recorrenteId??null,recorrenteParcelaAtual:r.recorrenteParcelaAtual??null,recorrenteParcelasTotal:r.recorrenteParcelasTotal??null,createdAt:i(),read:!1,type:"new_transaction"},p=[...o.usuariosPermitidos||[]];o.userId&&!p.includes(o.userId)&&p.push(o.userId),o.criadoPor&&!p.includes(o.criadoPor)&&p.push(o.criadoPor);const m=p.filter((e,n)=>!!e&&p.indexOf(e)===n&&e!==t),{create:f}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),g=m.map(async e=>{try{await f({...h,recipientUid:e})}catch(t){}});await Promise.all(g)}catch(i){}}async function Aw(e,t,r){try{const{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),{getById:a}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),o=await a(e);if(!o)return;if(!o.usuariosPermitidos||0===o.usuariosPermitidos.length)return;const s=await Rw(t),c=s?.displayName||s?.email||"Usuário";let d="Sem categoria",l=null,u=null;if(r?.categoriaId){const{getById:e}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>Ng);return{getById:e}},void 0),t=await e(r.categoriaId);t&&(d=t.nome,l=t.tipo??null,u=t.limite??null)}const h={budgetId:e,budgetName:o.nome||"Orçamento",senderUid:t,senderName:c,transactionId:r?.id??null,transactionDescricao:r?.descricao??null,transactionValor:r?.valor??null,transactionCategoria:d,transactionTipo:r?.tipo||"despesa",transactionCategoriaTipo:l,transactionCategoriaLimite:u,createdAt:i(),read:!1,type:"deleted_transaction"},p=[...o.usuariosPermitidos||[]];o.userId&&!p.includes(o.userId)&&p.push(o.userId),o.criadoPor&&!p.includes(o.criadoPor)&&p.push(o.criadoPor);const m=p.filter((e,n)=>!!e&&p.indexOf(e)===n&&e!==t),{create:f}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),g=m.map(async e=>{try{await f({...h,recipientUid:e})}catch(t){}});await Promise.all(g)}catch(i){}}async function Cw(e,t,r){try{const{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),{getById:a}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),o=await a(e);if(!o)return;if(!o.usuariosPermitidos||0===o.usuariosPermitidos.length)return;const s=await Rw(t),c=s?.displayName||s?.email||"Usuário";let d="Sem categoria",l=null,u=null,h=null;if(r?.categoriaId){const{getById:e}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>Ng);return{getById:e}},void 0),t=await e(r.categoriaId);t&&(d=t.nome,l=t.tipo??null,u=t.limite??null)}if(r?.prev?.categoriaId)try{const{getById:e}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>Ng);return{getById:e}},void 0),t=await e(r.prev.categoriaId);t?.nome&&(h=t.nome)}catch{}const p={},m=r?.changeSet||{};m.valor&&m.valor.from!==m.valor.to&&(p.valor={from:m.valor.from,to:m.valor.to}),m.descricao&&m.descricao.from!==m.descricao.to&&(p.descricao={from:m.descricao.from,to:m.descricao.to}),m.tipo&&m.tipo.from!==m.tipo.to&&(p.tipo={from:m.tipo.from,to:m.tipo.to}),m.categoriaId&&m.categoriaId.from!==m.categoriaId.to&&(p.categoria={from:h||r.prev?.categoriaId||null,to:d||m.categoriaId.to});const f={budgetId:e,budgetName:o.nome||"Orçamento",senderUid:t,senderName:c,transactionId:r?.id??null,transactionDescricao:r?.descricao??null,transactionValor:r?.valor??null,transactionCategoria:d,transactionTipo:r?.tipo||"despesa",transactionCategoriaTipo:l,transactionCategoriaLimite:u,changes:p,prev:r?.prev?{descricao:r.prev.descricao??null,valor:r.prev.valor??null,categoria:h??null,tipo:r.prev.tipo??null}:null,createdAt:i(),read:!1,type:"updated_transaction"},g=[...o.usuariosPermitidos||[]];o.userId&&!g.includes(o.userId)&&g.push(o.userId),o.criadoPor&&!g.includes(o.criadoPor)&&g.push(o.criadoPor);const w=g.filter((e,n)=>!!e&&g.indexOf(e)===n&&e!==t),{create:y}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0);await Promise.all(w.map(async e=>{try{await y({...f,recipientUid:e})}catch(t){}}))}catch(i){}}async function xw(e,t,r,i,a=null){try{const{serverTimestamp:s}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),{getById:c}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),d=await c(e);if(!d)return;if(!d.usuariosPermitidos||0===d.usuariosPermitidos.length)return;const l=await Rw(t),u=l?.displayName||l?.email||"Usuário",h={};a&&(a.nome!==r?.nome&&(h.nome={from:a.nome??null,to:r?.nome??null}),a.valor!==r?.valor&&(h.valor={from:a.valor??null,to:r?.valor??null}),a.frequencia!==r?.frequencia&&(h.frequencia={from:a.frequencia??null,to:r?.frequencia??null}),a.categoria!==r?.categoria&&(h.categoria={from:a.categoria??null,to:r?.categoria??null}),a.descricao!==r?.descricao&&(h.descricao={from:a.descricao??null,to:r?.descricao??null}),a.parcelasRestantes!==r?.parcelasRestantes&&(h.parcelasRestantes={from:a.parcelasRestantes??null,to:r?.parcelasRestantes??null}),a.parcelasTotal!==r?.parcelasTotal&&(h.parcelasTotal={from:a.parcelasTotal??null,to:r?.parcelasTotal??null}));const p={budgetId:e,budgetName:d.nome||"Orçamento",senderUid:t,senderName:u,recorrenteId:r?.id??null,recorrenteNome:r?.nome??null,recorrenteValor:r?.valor??null,recorrenteFrequencia:r?.frequencia??null,recorrenteCategoria:r?.categoria??null,recorrenteDescricao:r?.descricao??null,recorrenteParcelasRestantes:r?.parcelasRestantes??null,recorrenteParcelasTotal:r?.parcelasTotal??null,changes:h,prev:a?{nome:a.nome??null,valor:a.valor??null,frequencia:a.frequencia??null,categoria:a.categoria??null,descricao:a.descricao??null,parcelasRestantes:a.parcelasRestantes??null,parcelasTotal:a.parcelasTotal??null}:null,type:i,createdAt:s(),read:!1},{create:m}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),f=d.usuariosPermitidos.filter(e=>e!==t);if(0===f.length)try{await m({...p,recipientUid:t})}catch(o){}else await Promise.all(f.map(async e=>{try{await m({...p,recipientUid:e})}catch(o){}}))}catch(s){}}async function Dw(e,t,r,i,a=null){try{const{serverTimestamp:o}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),{getById:s}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),c=await s(e);if(!c)return;if(!c.usuariosPermitidos||0===c.usuariosPermitidos.length)return;const d=await Rw(t),l=d?.displayName||d?.email||"Usuário",u={};a&&(a.nome!==r?.nome&&(u.nome={from:a.nome??null,to:r?.nome??null}),a.tipo!==r?.tipo&&(u.tipo={from:a.tipo??null,to:r?.tipo??null}),a.limite!==r?.limite&&(u.limite={from:a.limite??null,to:r?.limite??null}),a.descricao!==r?.descricao&&(u.descricao={from:a.descricao??null,to:r?.descricao??null}),a.cor!==r?.cor&&(u.cor={from:a.cor??null,to:r?.cor??null}));const h={budgetId:e,budgetName:c.nome||"Orçamento",senderUid:t,senderName:l,categoryId:r?.id??null,categoryNome:r?.nome??null,categoryTipo:r?.tipo??null,categoryLimite:r?.limite??null,categoryDescription:r?.descricao??null,categoryColor:r?.cor??null,changes:u,prev:a?{nome:a.nome??null,tipo:a.tipo??null,limite:a.limite??null,descricao:a.descricao??null,cor:a.cor??null}:null,createdAt:o(),read:!1,type:i},p=[...c.usuariosPermitidos||[]];c.userId&&!p.includes(c.userId)&&p.push(c.userId),c.criadoPor&&!p.includes(c.criadoPor)&&p.push(c.criadoPor);const m=p.filter((e,n)=>!!e&&p.indexOf(e)===n&&e!==t),{create:f}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0);await Promise.all(m.map(async e=>{try{await f({...h,recipientUid:e})}catch(t){}}))}catch(o){}}async function Pw(e){try{const{updateDoc:t,doc:r,arrayRemove:i}=await n(async()=>{const{updateDoc:e,doc:t,arrayRemove:n}=await Promise.resolve().then(()=>Lm);return{updateDoc:e,doc:t,arrayRemove:n}},void 0),{db:a}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>ng);return{db:e}},void 0),o=window.appState.currentUser;if(!o)return;const s=r(a,"budgets",e);await t(s,{usuariosPermitidos:i(o.uid)}),window.Snackbar&&window.Snackbar({message:"✅ Saída do orçamento realizada com sucesso",type:"success"})}catch(t){window.Snackbar&&window.Snackbar({message:"❌ Erro ao sair do orçamento",type:"error"})}}async function Nw(e,t){try{const{updateDoc:r,doc:i,arrayRemove:a}=await n(async()=>{const{updateDoc:e,doc:t,arrayRemove:n}=await Promise.resolve().then(()=>Lm);return{updateDoc:e,doc:t,arrayRemove:n}},void 0),{db:o}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>ng);return{db:e}},void 0);if(!window.appState.currentUser)return;const s=i(o,"budgets",e);await r(s,{usuariosPermitidos:a(t)}),window.Snackbar&&window.Snackbar({message:"✅ Usuário removido com sucesso",type:"success"})}catch(r){window.Snackbar&&window.Snackbar({message:"❌ Erro ao remover usuário",type:"error"})}}async function Rw(e){try{const{getDoc:t,doc:r}=await n(async()=>{const{getDoc:e,doc:t}=await Promise.resolve().then(()=>Lm);return{getDoc:e,doc:t}},void 0),{db:i}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>ng);return{db:e}},void 0),a=await t(r(i,"users",e));return a.exists()?a.data():{displayName:"Usuário desconhecido",email:"email@desconhecido.com"}}catch(t){return{displayName:"Erro ao carregar",email:"erro@carregar.com"}}}"undefined"!=typeof window&&(window.nativeBiometric=new Sw);const Ow=Object.freeze(Object.defineProperty({__proto__:null,getUserInfo:Rw,leaveSharedBudget:Pw,removeUserFromBudget:Nw,sendCategoryChangeNotification:Dw,sendRecorrenteChangeNotification:xw,sendRecorrenteReminderNotification:async function(e,t,r){try{const{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),{getById:a}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),o=await a(e);if(!o)return;const s=await Rw(t),c=s?.displayName||s?.email||"Usuário",d=[...o.usuariosPermitidos||[]];o.criadoPor&&!d.includes(o.criadoPor)&&d.push(o.criadoPor);const l=d.filter((e,t)=>!!e&&d.indexOf(e)===t),{create:u}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),h={type:"recorrente_reminder",budgetId:e,budgetName:o.nome||"Orçamento",senderUid:t,senderName:c,recorrenteId:r?.id||null,recorrenteNome:r?.nome||"Recorrente",recorrenteValor:r?.valor||0,recorrenteDescricao:r?.descricao||"",createdAt:i(),read:!1};await Promise.all(l.map(async e=>{try{await u({...h,recipientUid:e})}catch(t){}}))}catch(i){}},sendTestNotificationToOwner:async function(e,t){try{const{serverTimestamp:r}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),{getById:i}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),{create:a}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),o=await i(e);if(!o)throw new Error("Orçamento não encontrado");const s=o.criadoPor||o.userId;if(!s)throw new Error("Dono do orçamento não encontrado");const c=await Rw(t),d=c?.displayName||c?.email||"Usuário";if(s===t){try{window.Snackbar&&window.Snackbar.info?window.Snackbar.info("Você é o dono deste orçamento",2500):mg.emit("snackbar:show",{message:"Você é o dono deste orçamento",type:"info",duration:2500})}catch{}return}const l={type:"test_notification",budgetId:e,budgetName:o.nome||"Orçamento",senderUid:t,senderName:d,message:"Mensagem de teste enviada para o dono do orçamento",createdAt:r(),read:!1,recipientUid:s};await a(l);try{window.Snackbar&&window.Snackbar.success?window.Snackbar.success("Notificação de teste enviada ao dono",2500):mg.emit("snackbar:show",{message:"Notificação de teste enviada ao dono",type:"success",duration:2500})}catch{}}catch(r){try{window.Snackbar&&window.Snackbar.error?window.Snackbar.error("Erro ao enviar teste para dono",2500):mg.emit("snackbar:show",{message:"Erro ao enviar teste para dono",type:"error",duration:2500})}catch{}}},sendTestNotificationToShared:async function(e,t){try{const{serverTimestamp:r}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),{getById:i}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),{create:a}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),o=await i(e);if(!o)throw new Error("Orçamento não encontrado");const s=Array.isArray(o.usuariosPermitidos)?o.usuariosPermitidos.slice():[],c=Array.from(new Set(s.filter(Boolean))).filter(e=>e!==t);if(!c.length){try{window.Snackbar&&window.Snackbar.info?window.Snackbar.info("Nenhum usuário compartilhado para notificar",2500):mg.emit("snackbar:show",{message:"Nenhum usuário compartilhado para notificar",type:"info",duration:2500})}catch{}return}const d=await Rw(t),l=d?.displayName||d?.email||"Usuário";await Promise.all(c.map(n=>a({type:"test_notification",budgetId:e,budgetName:o.nome||"Orçamento",senderUid:t,senderName:l,message:"Mensagem de teste enviada para usuários compartilhados",createdAt:r(),read:!1,recipientUid:n})));try{window.Snackbar&&window.Snackbar.success?window.Snackbar.success("Notificação de teste enviada aos compartilhados",2500):mg.emit("snackbar:show",{message:"Notificação de teste enviada aos compartilhados",type:"success",duration:2500})}catch{}}catch(r){try{window.Snackbar&&window.Snackbar.error?window.Snackbar.error("Erro ao enviar teste para compartilhados",2500):mg.emit("snackbar:show",{message:"Erro ao enviar teste para compartilhados",type:"error",duration:2500})}catch{}}},sendTransactionDeletedNotification:Aw,sendTransactionNotification:kw,sendTransactionUpdatedNotification:Cw,sendWeeklySummaryNotification:async function(e,t,r){try{const{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),{getById:a}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),o=await a(e);if(!o)return;const s=await Rw(t),c=s?.displayName||s?.email||"Usuário",d=[...o.usuariosPermitidos||[]];o.criadoPor&&!d.includes(o.criadoPor)&&d.push(o.criadoPor);const l=d.filter((e,t)=>!!e&&d.indexOf(e)===t),{create:u}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),h={type:"weekly_summary",budgetId:e,budgetName:o.nome||"Orçamento",senderUid:t,senderName:c,resumo:r?.resumo,periodo:r?.periodo,createdAt:i(),read:!1};await Promise.all(l.map(async e=>{try{await u({...h,recipientUid:e})}catch(t){}}))}catch(i){}}},Symbol.toStringTag,{value:"Module"}));function Lw(){if(!window.Snackbar)return;if(!window.SnackbarInstance)return;const e=parseInt(localStorage.getItem("toastDuration"))||3e3,t=parseInt(localStorage.getItem("toastDistance"))||80,n=localStorage.getItem("toastPosition")||"bottom",r=localStorage.getItem("toastAlignment")||localStorage.getItem("toastAlign")||"center",i="inferior"===n?"bottom":"superior"===n?"top":n,a="centro"===r?"center":"esquerda"===r?"left":"direita"===r?"right":r;window.Snackbar.clearQueue&&window.Snackbar.clearQueue(),window.Snackbar.closeCurrent&&window.Snackbar.closeCurrent();document.querySelectorAll('[data-snackbar="1"]').forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)});const o=window.SnackbarInstance;o.defaultDuration=e,o.bottomOffset=t,o.position=i,o.align=a,window.Snackbar.configure&&window.Snackbar.configure({defaultDuration:e,bottom:t,position:i,align:a}),window.Snackbar.info("Teste: Configurações aplicadas!")}function Mw(){window.Snackbar&&window.SnackbarInstance?Lw():setTimeout(Mw,100)}async function Uw(){try{const e=window.appState?.currentUser,t=window.appState?.currentBudget;if(!e?.uid||!t?.id)return;const{create:r}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),a={type:"new_transaction",budgetId:t.id,budgetName:t.nome||"Orçamento",senderUid:e.uid,senderName:e.displayName||e.email||"Usuário",transactionId:"test-transaction-id",transactionDescricao:"Teste de transação",transactionValor:100,transactionTipo:"despesa",transactionCategoria:"Teste",createdAt:i(),read:!1,recipientUid:e.uid},o=await r(a);setTimeout(()=>{(window.appState?.notifications||[]).find(e=>e.id===o)},2e3)}catch(e){}}async function Vw(){try{const e=window.appState?.currentUser,t=window.appState?.currentBudget;if(!e?.uid||!t?.id)return;const{create:r}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),a={type:"updated_recorrente",budgetId:t.id,budgetName:t.nome||"Orçamento",senderUid:e.uid,senderName:e.displayName||e.email||"Usuário",recorrenteId:"test-edit-recorrente-id",recorrenteNome:"Despesa Recorrente Editada",recorrenteValor:200,recorrenteFrequencia:"mensal",recorrenteCategoria:"Teste",recorrenteDescricao:"Esta despesa foi editada",recorrenteParcelasRestantes:3,recorrenteParcelasTotal:6,changes:{valor:{from:150,to:200},parcelasRestantes:{from:5,to:3}},prev:{nome:"Despesa Recorrente Editada",valor:150,frequencia:"mensal",categoria:"Teste",descricao:"Esta despesa foi editada",parcelasRestantes:5,parcelasTotal:6},createdAt:i(),read:!1,recipientUid:e.uid},o=await r(a),s={type:"deleted_recorrente",budgetId:t.id,budgetName:t.nome||"Orçamento",senderUid:e.uid,senderName:e.displayName||e.email||"Usuário",recorrenteId:"test-delete-recorrente-id",recorrenteNome:"Despesa Recorrente Excluída",recorrenteValor:100,recorrenteFrequencia:"mensal",recorrenteCategoria:"Teste",recorrenteDescricao:"Esta despesa foi excluída",recorrenteParcelasRestantes:2,recorrenteParcelasTotal:4,createdAt:i(),read:!1,recipientUid:e.uid},c=await r(s);setTimeout(()=>{const e=window.appState?.notifications||[];e.find(e=>e.id===o),e.find(e=>e.id===c)},3e3)}catch(e){}}async function Fw(){try{window.__notifCtl,window.appState,document.getElementById("notification-modal");try{const{create:e}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:t}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),r={type:"test_notification",budgetId:window.appState?.currentBudget?.id,budgetName:window.appState?.currentBudget?.nome||"Orçamento",senderUid:window.appState?.currentUser?.uid,senderName:window.appState?.currentUser?.displayName||"Usuário",message:"Teste de diagnóstico completo",createdAt:t(),read:!1,recipientUid:window.appState?.currentUser?.uid},i=await e(r);setTimeout(()=>{(window.appState?.notifications||[]).find(e=>e.id===i)},3e3)}catch(e){}try{const{getUserPrefs:e}=await n(async()=>{const{getUserPrefs:e}=await Promise.resolve().then(()=>Ty);return{getUserPrefs:e}},void 0);await e(window.appState?.currentUser?.uid)}catch(t){}["notification_use_modal","notification_toasts_enabled","notification_types_enabled","notification_period_filter"].forEach(e=>{localStorage.getItem(e)})}catch(e){}}async function Bw(){try{if(!window.eventBus)return;let e=!1;const t=t=>{e=!0};window.eventBus.on("test-event",t),window.eventBus.emit("test-event",{message:"Teste do EventBus",timestamp:Date.now()}),setTimeout(()=>{window.eventBus.off("test-event",t)},1e3);const n={id:"test-eventbus-notification",type:"test_notification",message:"Teste do EventBus para notificações",createdAt:new Date,read:!1};window.eventBus.emit("notification:show-modal",n);["notifications:updated","snackbar:show","transactions:updated","categories:updated"].forEach(e=>{try{window.eventBus.emit(e,{test:!0,timestamp:Date.now()})}catch(t){}})}catch(e){}}async function jw(){try{const e=window.appState?.currentUser,t=window.appState?.currentBudget;if(!e?.uid||!t?.id)return;const{create:r}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),a={type:"new_recorrente",budgetId:t.id,budgetName:t.nome||"Orçamento",senderUid:e.uid,senderName:e.displayName||e.email||"Usuário",recorrenteId:"test-recorrente-complete-id",recorrenteNome:"Despesa Recorrente Completa",recorrenteValor:250,recorrenteFrequencia:"mensal",recorrenteCategoria:"Teste Completo",recorrenteDescricao:"Esta é uma despesa recorrente de teste completa",recorrenteParcelasRestantes:8,recorrenteParcelasTotal:12,createdAt:i(),read:!1,recipientUid:e.uid},o=await r(a);setTimeout(()=>{(window.appState?.notifications||[]).find(e=>e.id===o)},3e3)}catch(e){}}async function $w(){try{let e=document.getElementById("notification-modal");if(!e){const{getNotificationModal:t}=await n(async()=>{const{getNotificationModal:e}=await import("./NotificationModal-B7R6h_Eo.js");return{getNotificationModal:e}},__vite__mapDeps([5,2]));e=t()}const t={id:"test-modal-direct",type:"test_notification",message:"Teste direto do modal",createdAt:new Date,read:!1,senderName:"Sistema de Teste",budgetName:"Orçamento de Teste"};if(e){const{getNotificationModal:e}=await n(async()=>{const{getNotificationModal:e}=await import("./NotificationModal-B7R6h_Eo.js");return{getNotificationModal:e}},__vite__mapDeps([5,2])),r=e();r&&"function"==typeof r.show&&(r.show(t),setTimeout(()=>{document.getElementById("notification-modal")},1e3))}window.eventBus&&(window.eventBus.emit("notification:show-modal",t),setTimeout(()=>{document.getElementById("notification-modal")},1e3))}catch(e){}}async function qw(){try{window.__notifCtl,window.appState,document.getElementById("notification-modal");try{const{create:e}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:t}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),r={type:"test_notification",budgetId:window.appState?.currentBudget?.id,budgetName:window.appState?.currentBudget?.nome||"Orçamento",senderUid:window.appState?.currentUser?.uid,senderName:window.appState?.currentUser?.displayName||"Usuário",message:"Teste de diagnóstico completo do sistema",createdAt:t(),read:!1,recipientUid:window.appState?.currentUser?.uid},i=await e(r);setTimeout(()=>{(window.appState?.notifications||[]).find(e=>e.id===i)},3e3)}catch(e){}if(window.eventBus){let e=!1;const t=t=>{e=!0};window.eventBus.on("test-complete-system",t),window.eventBus.emit("test-complete-system",{message:"Teste do sistema completo",timestamp:Date.now()}),setTimeout(()=>{window.eventBus.off("test-complete-system",t)},1e3);const n={id:"test-complete-system-notification",type:"test_notification",message:"Teste do sistema completo",createdAt:new Date,read:!1,senderName:"Sistema de Teste",budgetName:"Orçamento de Teste"};window.eventBus.emit("notification:show-modal",n)}try{const{getUserPrefs:e}=await n(async()=>{const{getUserPrefs:e}=await Promise.resolve().then(()=>Ty);return{getUserPrefs:e}},void 0);await e(window.appState?.currentUser?.uid)}catch(t){}["notification_use_modal","notification_toasts_enabled","notification_types_enabled","notification_period_filter"].forEach(e=>{localStorage.getItem(e)})}catch(e){}}async function zw(){try{const t=window.appState?.currentUser,r=window.appState?.currentBudget;if(!t||!r)return;try{const{sendCategoryChangeNotification:e}=await n(async()=>{const{sendCategoryChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendCategoryChangeNotification:e}},void 0),i={id:"test-category-"+Date.now(),nome:"Categoria de Teste",descricao:"Descrição da categoria de teste",cor:"#ff0000",tipo:"expense",limite:1e3,budgetId:r.id,userId:t.uid};await e(r.id,t.uid,i,"category_added")}catch(e){}try{const{sendRecorrenteChangeNotification:e}=await n(async()=>{const{sendRecorrenteChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendRecorrenteChangeNotification:e}},void 0),i={id:"test-recorrente-"+Date.now(),nome:"Recorrente de Teste",valor:500,frequencia:"mensal",categoria:"Alimentação",descricao:"Descrição do recorrente de teste",parcelasRestantes:10,parcelasTotal:12,budgetId:r.id,userId:t.uid};await e(r.id,t.uid,i,"new_recorrente")}catch(e){}if(setTimeout(()=>{const e=(window.appState?.notifications||[]).filter(e=>"category_added"===e.type||"new_recorrente"===e.type).slice(-2);e.forEach(e=>{}),e.length},3e3),window.eventBus){const e={id:"test-modal-recurring-category",type:"category_added",message:"Teste de modal para categoria",createdAt:new Date,read:!1,senderName:"Sistema de Teste",budgetName:r.nome,categoryNome:"Categoria de Teste",categoryDescricao:"Descrição da categoria",categoryCor:"#ff0000",categoryTipo:"expense",categoryLimite:1e3};window.eventBus.emit("notification:show-modal",e),setTimeout(()=>{const e=document.getElementById("notification-modal");e&&e.style.display},1e3)}}catch(e){}}async function Hw(){try{const t=window.appState?.currentUser,r=window.appState?.currentBudget;if(!t||!r)return;try{const{sendCategoryChangeNotification:e,sendRecorrenteChangeNotification:t}=await n(async()=>{const{sendCategoryChangeNotification:e,sendRecorrenteChangeNotification:t}=await Promise.resolve().then(()=>Ow);return{sendCategoryChangeNotification:e,sendRecorrenteChangeNotification:t}},void 0)}catch(e){return}try{const{create:e}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),a={type:"test_direct_firebase",budgetId:r.id,budgetName:r.nome,senderUid:t.uid,senderName:t.displayName||"Usuário",message:"Teste direto no Firebase",createdAt:i(),read:!1,recipientUid:t.uid},o=await e(a);setTimeout(()=>{(window.appState?.notifications||[]).find(e=>e.id===o)},2e3)}catch(e){}try{const{sendCategoryChangeNotification:e}=await n(async()=>{const{sendCategoryChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendCategoryChangeNotification:e}},void 0),i={id:"test-category-detailed-"+Date.now(),nome:"Categoria Detalhada",descricao:"Descrição da categoria detalhada",cor:"#00ff00",tipo:"expense",limite:2e3,budgetId:r.id,userId:t.uid};await e(r.id,t.uid,i,"category_added")}catch(e){}try{const{sendRecorrenteChangeNotification:e}=await n(async()=>{const{sendRecorrenteChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendRecorrenteChangeNotification:e}},void 0),i={id:"test-recorrente-detailed-"+Date.now(),nome:"Recorrente Detalhado",valor:750,frequencia:"mensal",categoria:"Alimentação",descricao:"Descrição do recorrente detalhado",parcelasRestantes:8,parcelasTotal:10,budgetId:r.id,userId:t.uid};await e(r.id,t.uid,i,"new_recorrente")}catch(e){}if(setTimeout(()=>{const e=(window.appState?.notifications||[]).filter(e=>"test_direct_firebase"===e.type||"category_added"===e.type||"new_recorrente"===e.type);e.forEach(e=>{}),e.length},5e3),window.eventBus){let e=!1;const t=t=>{e=!0};window.eventBus.on("test-detailed-notification",t),window.eventBus.emit("test-detailed-notification",{message:"Teste detalhado",timestamp:Date.now()}),setTimeout(()=>{window.eventBus.off("test-detailed-notification",t)},1e3)}}catch(e){}}async function Gw(){try{const t=window.appState?.currentUser,r=window.appState?.currentBudget;if(!t||!r)return;try{const{sendCategoryChangeNotification:e}=await n(async()=>{const{sendCategoryChangeNotification:e}=await Promise.resolve().then(()=>Ow);return{sendCategoryChangeNotification:e}},void 0),i={id:"test-category-desc-"+Date.now(),nome:"Categoria com Descrição",descricao:"Esta é uma descrição de teste para verificar se aparece no modal",cor:"#ff6b6b",tipo:"expense",limite:1500,budgetId:r.id,userId:t.uid};await e(r.id,t.uid,i,"category_added")}catch(e){}setTimeout(()=>{const e=window.appState?.notifications||[],t=e.find(e=>"category_added"===e.type&&"Categoria com Descrição"===e.categoryNome);t?window.eventBus&&window.eventBus.emit("notification:show-modal",t):e.forEach(e=>{e.type})},3e3)}catch(e){}}async function Ww(){try{localStorage.getItem("notification_use_modal"),window.__notifCtl,window.appState;if(window.eventBus){let e=!1;const t=t=>{e=!0};window.eventBus.on("test-modal-not-appearing",t),window.eventBus.emit("test-modal-not-appearing",{message:"Teste do modal não aparecendo",timestamp:Date.now()}),setTimeout(()=>{window.eventBus.off("test-modal-not-appearing",t)},1e3);const n={id:"test-modal-not-appearing",type:"test_notification",message:"Teste do modal não aparecendo",createdAt:new Date,read:!1,senderName:"Sistema de Teste",budgetName:"Orçamento de Teste"};window.eventBus.emit("notification:show-modal",n),setTimeout(()=>{const e=document.getElementById("notification-modal");e&&e.style.display},2e3)}try{const{create:e}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:t}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),r={type:"test_notification",budgetId:window.appState?.currentBudget?.id,budgetName:window.appState?.currentBudget?.nome||"Orçamento",senderUid:window.appState?.currentUser?.uid,senderName:window.appState?.currentUser?.displayName||"Usuário",message:"Teste do modal não aparecendo",createdAt:t(),read:!1,recipientUid:window.appState?.currentUser?.uid},i=await e(r);setTimeout(()=>{(window.appState?.notifications||[]).find(e=>e.id===i)},3e3)}catch(e){}}catch(e){}}window.loadTransactions=async function(){const e=window.appState?.currentBudget?.id,t=window.appState?.currentUser?.uid;return yg(e,t)},window.loadCategories=async function(){const e=window.appState?.currentBudget?.id;return window.appState,Lg(e)},window.loadRecorrentes=async function(){return nw()},window.showAddCategoryModal=yw,window.showAddTransactionModal=bw,window.sendTransactionNotification=kw,window.sendTransactionUpdatedNotification=Cw,window.sendTransactionDeletedNotification=Aw,window.sendCategoryChangeNotification=Dw,window.sendRecorrenteChangeNotification=xw,window.sendTransactionNotification=kw,window.sendTransactionUpdatedNotification=Cw,window.sendTransactionDeletedNotification=Aw,window.sendCategoryChangeNotification=Dw,window.sendRecorrenteChangeNotification=xw,window.applySimpleSnackbarConfig=Lw,window.testSimpleSnackbarConfig=function(){Lw(),setTimeout(()=>{window.Snackbar.success("Teste SUCCESS!")},100),setTimeout(()=>{window.Snackbar.warning("Teste WARNING!")},200)},window.resetSimpleSnackbarConfig=function(){localStorage.setItem("toastDuration","3000"),localStorage.setItem("toastDistance","80"),localStorage.setItem("toastPosition","bottom"),localStorage.setItem("toastAlignment","center"),Lw(),window.Snackbar.info("Configurações resetadas!")},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Mw):Mw(),window.debugNotificationSystem=async function(){try{const e=window.appState?.currentUser,t=window.appState?.currentBudget;window.appState;if(!e?.uid)return;if(!t?.id)return;const{getById:r}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),i=await r(t.id),{create:a}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:o}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),s=i?.criadoPor||i?.userId,c={type:"test_notification",budgetId:t.id,budgetName:t.nome||"Orçamento",senderUid:e.uid,senderName:e.displayName||e.email||"Usuário",message:`Notificação de teste para debug - Enviada para dono: ${s}`,createdAt:o(),read:!1,recipientUid:s};await a(c);setTimeout(async()=>{const{listByRecipient:t}=await n(async()=>{const{listByRecipient:e}=await Promise.resolve().then(()=>hy);return{listByRecipient:e}},void 0),{listenByRecipient:r}=(await t(e.uid),await n(async()=>{const{listenByRecipient:e}=await Promise.resolve().then(()=>hy);return{listenByRecipient:e}},void 0)),i=r(e.uid,e=>{i()})},2e3)}catch(e){}},window.debugSharedNotificationTest=async function(){try{const e=window.appState?.currentUser,t=window.appState?.currentBudget;if(!e?.uid||!t?.id)return;const{getById:r}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),{sendTestNotificationToShared:i}=(await r(t.id),await n(async()=>{const{sendTestNotificationToShared:e}=await Promise.resolve().then(()=>Ow);return{sendTestNotificationToShared:e}},void 0));await i(t.id,e.uid)}catch(e){}},window.debugCheckOtherUserNotifications=async function(){try{const e=window.appState?.currentBudget;if(!e?.id)return;const{getById:t}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0),r=await t(e.id),{listByRecipient:i}=await n(async()=>{const{listByRecipient:e}=await Promise.resolve().then(()=>hy);return{listByRecipient:e}},void 0),a=r?.criadoPor||r?.userId;if(a){await i(a)}const o=r?.usuariosPermitidos||[];for(const n of o)if(n&&n!==a){await i(n)}}catch(e){}},window.debugTestModal=async function(){try{let e=document.getElementById("notification-modal");const{getNotificationModal:t}=await n(async()=>{const{getNotificationModal:e}=await import("./NotificationModal-B7R6h_Eo.js");return{getNotificationModal:e}},__vite__mapDeps([5,2])),r=t();if(e=document.getElementById("notification-modal"),e){const e={id:"test-modal-"+Date.now(),type:"test_notification",message:"Teste manual do modal de notificação!",details:"Este é um teste para verificar se o modal está funcionando.",read:!1,createdAt:{toDate:()=>new Date}};r.show(e),setTimeout(()=>{const e=document.getElementById("notification-modal");if(e){window.getComputedStyle(e),e.getBoundingClientRect()}},100)}else if(r.createModalHTML(),e=document.getElementById("notification-modal"),e){const e={id:"test-modal-"+Date.now(),type:"test_notification",message:"Teste manual do modal de notificação (forçado)!",details:"Modal foi criado manualmente para teste.",read:!1,createdAt:{toDate:()=>new Date}};r.show(e)}}catch(e){}},window.debugNotificationState=function(){const e={currentUser:window.appState?.currentUser?.uid,currentBudget:window.appState?.currentBudget?.id,notifications:window.appState?.notifications?.length||0,notificationModal:!!document.getElementById("notification-modal"),eventBus:!!window.eventBus,snackbar:!!window.Snackbar},t=(window.__notifUpdatesListenerBound,window.__notificationModalListenerBound,window.appState?.notifications||[]);if(t.filter(e=>!e.read&&!e.archivedAt).length,t.length>0){t[0]}return e},window.debugCreateTestNotification=async function(){try{const e=window.appState?.currentUser,t=window.appState?.currentBudget;if(!e?.uid||!t?.id)return;const{create:r}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),a={type:"test_notification",budgetId:t.id,budgetName:t.nome||"Orçamento",senderUid:e.uid,senderName:e.displayName||e.email||"Usuário",message:`Teste manual criado em ${(new Date).toLocaleString("pt-BR")}`,details:"Esta é uma notificação de teste criada manualmente para verificar se o sistema está funcionando.",createdAt:i(),read:!1,recipientUid:e.uid},o=await r(a);setTimeout(()=>{(window.appState?.notifications||[]).find(e=>e.id===o)},2e3)}catch(e){}},window.debugCreateRecorrenteNotification=async function(){try{const e=window.appState?.currentUser,t=window.appState?.currentBudget;if(!e?.uid||!t?.id)return;const{create:r}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),a={type:"new_recorrente",budgetId:t.id,budgetName:t.nome||"Orçamento",senderUid:e.uid,senderName:e.displayName||e.email||"Usuário",recorrenteId:"test-recorrente-id",recorrenteNome:"Teste de Despesa Recorrente",recorrenteValor:150,recorrenteFrequencia:"Mensal",recorrenteCategoria:"Teste",recorrenteDescricao:"Esta é uma despesa recorrente de teste",recorrenteParcelasRestantes:5,recorrenteParcelasTotal:12,createdAt:i(),read:!1,recipientUid:e.uid},o=await r(a);setTimeout(()=>{(window.appState?.notifications||[]).find(e=>e.id===o)},2e3)}catch(e){}},window.debugModalStatus=async function(){const e=document.getElementById("notification-modal");if(e){window.getComputedStyle(e),e.getBoundingClientRect()}return{modalExists:!!e,listenerActive:window.__notificationModalListenerBound,eventBusAvailable:!!window.eventBus}},window.debugTestRecorrenteIntegration=async function(){try{const e=window.appState?.currentUser,t=window.appState?.currentBudget;if(!e?.uid||!t?.id)return;const{addRecorrente:r,updateRecorrente:i,deleteRecorrente:a}=await n(async()=>{const{addRecorrente:e,updateRecorrente:t,deleteRecorrente:n}=await Promise.resolve().then(()=>rw);return{addRecorrente:e,updateRecorrente:t,deleteRecorrente:n}},void 0),o={nome:"Teste de Integração",valor:200,frequencia:"Mensal",categoria:"Teste",descricao:"Despesa recorrente para testar integração de notificações",parcelasTotal:12,parcelasRestantes:12,efetivarMesAtual:!1},s=await r(e.uid,t.id,o);await new Promise(e=>setTimeout(e,2e3));const c={...o,valor:250,nome:"Teste de Integração Atualizado",budgetId:t.id};await i(e.uid,s,c),await new Promise(e=>setTimeout(e,2e3)),await a(e.uid,s)}catch(e){}},window.debugTestModalDirect=async function(){try{const{getNotificationModal:e}=await n(async()=>{const{getNotificationModal:e}=await import("./NotificationModal-B7R6h_Eo.js");return{getNotificationModal:e}},__vite__mapDeps([5,2])),t=e();if(t){const e={id:"test-modal-direct",type:"test_notification",message:"Teste direto do modal",details:"Este é um teste direto do modal de notificações",createdAt:new Date,read:!1,senderName:"Sistema de Debug",budgetName:"Orçamento de Teste"};t.show(e),setTimeout(()=>{const e=document.getElementById("notification-modal");if(e){window.getComputedStyle(e),e.getBoundingClientRect()}},1e3)}}catch(e){}},window.debugTestEventBus=async function(){try{if(!window.eventBus)return;const e={id:"test-eventbus",type:"test_notification",message:"Teste via EventBus",details:"Este é um teste via EventBus",createdAt:new Date,read:!1,senderName:"Sistema de Debug",budgetName:"Orçamento de Teste"};window.eventBus.emit("notification:show-modal",e)}catch(e){}},window.debugCreateCategoryNotification=async function(){try{const e=window.appState?.currentUser,t=window.appState?.currentBudget;if(!e?.uid||!t?.id)return;const{create:r}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),a={type:"category_added",budgetId:t.id,budgetName:t.nome||"Orçamento",senderUid:e.uid,senderName:e.displayName||e.email||"Usuário",categoryId:"test-category-id",categoryNome:"Categoria de Teste",categoryTipo:"despesa",categoryLimite:500,categoryDescription:"Esta é uma categoria de teste com descrição",categoryColor:"#3b82f6",createdAt:i(),read:!1,recipientUid:e.uid},o=await r(a);setTimeout(()=>{(window.appState?.notifications||[]).find(e=>e.id===o)},2e3)}catch(e){}},window.debugCheckNotificationSystem=async function(){try{window.__notifCtl;const t=window.appState?.currentUser?.uid;if(t)try{const{getUserPrefs:e}=await n(async()=>{const{getUserPrefs:e}=await Promise.resolve().then(()=>Ty);return{getUserPrefs:e}},void 0);await e(t)}catch(e){}document.getElementById("notification-modal");const{create:r}=await n(async()=>{const{create:e}=await Promise.resolve().then(()=>hy);return{create:e}},void 0),{serverTimestamp:i}=await n(async()=>{const{serverTimestamp:e}=await Promise.resolve().then(()=>Lm);return{serverTimestamp:e}},void 0),a={type:"test_notification",budgetId:window.appState?.currentBudget?.id,budgetName:window.appState?.currentBudget?.nome||"Orçamento",senderUid:window.appState?.currentUser?.uid,senderName:window.appState?.currentUser?.displayName||"Usuário",message:"Teste de sistema de notificações",createdAt:i(),read:!1,recipientUid:window.appState?.currentUser?.uid},o=await r(a);setTimeout(()=>{(window.appState?.notifications||[]).find(e=>e.id===o)},3e3)}catch(t){}},window.debugTestTransactionNotification=Uw,window.debugTestRecurringEditDelete=Vw,window.debugFullNotificationDiagnosis=Fw,window.debugTestEventBusSystem=Bw,window.debugTestRecurringNotificationComplete=jw,window.debugTestModalDirectly=$w,window.debugCompleteSystemDiagnosis=qw,window.debugTestRecurringAndCategoryNotifications=zw,window.debugDetailedNotificationTest=Hw,window.debugCategoryDescriptionIssue=Gw,window.debugModalNotAppearing=Ww,"undefined"!=typeof window&&(window.debugEventBusAndModal=async function(){if(window.eventBus&&"function"==typeof window.eventBus.emit){const e={id:"test-"+Date.now(),type:"new_transaction",message:"Teste de EventBus",transactionDescricao:"Teste de transação",transactionValor:100.5,createdAt:new Date,read:!1};window.eventBus.emit("notification:show-modal",e)}},window.debugProductionModal=async function(){document.getElementById("notification-modal"),document.querySelector('link[href*="notification-modal"]')||document.querySelector("style[data-notification-modal]");try{const{getNotificationModal:e}=await n(async()=>{const{getNotificationModal:e}=await import("./NotificationModal-B7R6h_Eo.js");return{getNotificationModal:e}},__vite__mapDeps([5,2]));e()}catch(e){}if(window.eventBus){const e={id:"test-production-"+Date.now(),type:"test_notification",message:"Teste de Produção",createdAt:new Date,read:!1};window.eventBus.emit("notification:show-modal",e),setTimeout(()=>{document.getElementById("notification-modal")},1e3)}},window.debugTestModalDirectly=$w,window.debugFullNotificationDiagnosis=Fw,window.debugCompleteSystemDiagnosis=qw,window.debugDetailedNotificationTest=Hw,window.debugTestRecurringAndCategoryNotifications=zw,window.debugTestEventBusSystem=Bw,window.debugTestRecurringNotificationComplete=jw,window.debugTestTransactionNotification=Uw,window.debugTestRecurringEditDelete=Vw,window.debugCategoryDescriptionIssue=Gw,window.debugModalNotAppearing=Ww,window.debugModalWhenNotificationsArrive=async function(){try{if(void 0===window.eventBus)return;window.__notificationModalListenerBound;const{getNotificationModal:e}=await n(async()=>{const{getNotificationModal:e}=await import("./NotificationModal-B7R6h_Eo.js");return{getNotificationModal:e}},__vite__mapDeps([5,2])),t=(e(),document.getElementById("notification-modal"),document.querySelector('link[href*="notification-modal.css"]'),{id:"test-"+Date.now(),type:"test_notification",message:"Teste de modal quando notificações chegam",createdAt:new Date,read:!1});window.eventBus.emit("notification:show-modal",t),setTimeout(()=>{const e=document.getElementById("notification-modal");e&&window.getComputedStyle(e)},1e3)}catch(e){}},window.debugCatchUpSystem=async function(){try{const{getCatchUpNotifications:e}=await n(async()=>{const{getCatchUpNotifications:e}=await Promise.resolve().then(()=>xy);return{getCatchUpNotifications:e}},void 0),t=e(),r=t.getCurrentUserId();if(!r)return;const{getNotificationsRepo:i}=await n(async()=>{const{getNotificationsRepo:e}=await Promise.resolve().then(()=>hy);return{getNotificationsRepo:e}},void 0),a=i();await a.getUnreadNotifications(r),await t.checkPendingNotifications();const o=document.querySelector(".catch-up-modal-overlay");o&&window.getComputedStyle(o)}catch(e){}},window.debugTestEventBusNotifications=function(){try{if("undefined"!=typeof window&&window.eventBus){const e={id:"test-eventbus-"+Date.now(),type:"transaction",title:"Teste EventBus",message:"Esta é uma notificação de teste via EventBus.",timestamp:new Date,read:!1,data:{transactionId:"test-eventbus-transaction"}};window.eventBus.emit("notification:show-modal",e)}}catch(e){}},window.debugTestRealTransactionNotification=function(){try{if("undefined"!=typeof window&&window.eventBus){const e={id:"real-transaction-"+Date.now(),type:"new_transaction",budgetId:window.appState?.currentBudget?.id||"test-budget",budgetName:window.appState?.currentBudget?.nome||"Teste",recipientUid:window.appState?.currentUser?.uid||"test-user",senderUid:window.appState?.currentUser?.uid||"test-user",title:"Nova Transação",message:"Uma nova transação foi adicionada ao orçamento.",createdAt:new Date,read:!1,data:{transactionId:"real-transaction-"+Date.now(),amount:100,description:"Teste de transação real"}};window.eventBus.emit("notification:show-modal",e)}}catch(e){}},window.debugCheckNotificationSystemStatus=function(){try{window.__notifCtl,"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(e=>{})}catch(e){}});const Kw="notifications";function Qw(e){return{id:e.id,...e.data()}}function Yw(e){const t=e=>e?.toDate?e.toDate():e?.seconds?new Date(1e3*e.seconds):e?new Date(e):new Date(0);return e.sort((e,n)=>t(n.createdAt)-t(e.createdAt))}async function Jw(e,t=50){if(!e)return[];const n=im(mp(Zf,Kw),om("recipientUid","==",e));let r=(await Im(n)).docs.map(Qw);return r=Yw(r).slice(0,t),r}async function Xw(e,t,r=50){if(!e||"function"!=typeof t)return()=>{};const{db:i}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>ng);return{db:e}},void 0);return Am(im(mp(i,Kw),om("recipientUid","==",e)),e=>{let n=[];e.forEach(e=>n.push(Qw(e))),n=Yw(n).slice(0,r),t(n)})}async function Zw(e){const{db:t}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>ng);return{db:e}},void 0);return(await km(mp(t,Kw),e)).id}async function ey(e){if(!e)return;const{db:t}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>ng);return{db:e}},void 0);await Tm(fp(t,Kw,e),{read:!0})}async function ty(e=[]){if(!Array.isArray(e)||0===e.length)return;const{db:t}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>ng);return{db:e}},void 0),r=Om(t);e.forEach(e=>{r.update(fp(t,Kw,e),{read:!0})}),await r.commit()}async function ny(e=[]){if(!Array.isArray(e)||0===e.length)return;const{db:t}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>ng);return{db:e}},void 0),r=Om(t);e.forEach(e=>{r.delete(fp(t,Kw,e))}),await r.commit()}async function ry(e){e&&await ny([e])}async function iy(e,t=!0){e&&await Tm(fp(Zf,Kw,e),{pinned:!!t})}async function ay(e=[],t=!0){if(!Array.isArray(e)||0===e.length)return;const n=Om(Zf);e.forEach(e=>{n.update(fp(Zf,Kw,e),{pinned:!!t})}),await n.commit()}async function oy(e,t=!0){if(!e)return;const n=t?{archivedAt:(new Date).toISOString()}:{archivedAt:null};await Tm(fp(Zf,Kw,e),n)}async function sy(e=[]){if(!Array.isArray(e)||0===e.length)return;const t=Om(Zf),n=(new Date).toISOString();e.forEach(e=>{t.update(fp(Zf,Kw,e),{archivedAt:n})}),await t.commit()}async function cy(e,t=50){if(!e)return[];const{db:r}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>ng);return{db:e}},void 0),i=im(mp(r,Kw),om("recipientUid","==",e),om("read","==",!1));let a=(await Im(i)).docs.map(Qw);return a=Yw(a).slice(0,t),a}class dy{async listByRecipient(e,t=50){return Jw(e,t)}async listenByRecipient(e,t,n=50){return Xw(e,t,n)}async create(e){return Zw(e)}async markAsRead(e){return ey(e)}async markManyAsRead(e){return ty(e)}async deleteMany(e){return ny(e)}async deleteOne(e){return ry(e)}async pin(e,t=!0){return iy(e,t)}async pinMany(e,t=!0){return ay(e,t)}async archive(e,t=!0){return oy(e,t)}async archiveMany(e){return sy(e)}async getUnreadNotifications(e,t=50){return cy(e,t)}}let ly=null;function uy(){return ly||(ly=new dy),ly}const hy=Object.freeze(Object.defineProperty({__proto__:null,archive:oy,archiveMany:sy,create:Zw,deleteMany:ny,deleteOne:ry,getNotificationsRepo:uy,getUnreadNotifications:cy,listByRecipient:Jw,listenByRecipient:Xw,markAsRead:ey,markManyAsRead:ty,pin:iy,pinMany:ay},Symbol.toStringTag,{value:"Module"}));function py(e){try{if(!e)return 0;if("function"==typeof e.toDate)return e.toDate().getTime();if(e.seconds)return 1e3*e.seconds;const t=new Date(e);return Number.isFinite(t.getTime())?t.getTime():0}catch{return 0}}function my(){try{const e=localStorage.getItem("notif_toasts_enabled");return null===e||"true"===e}catch{return!0}}function fy(e,t){try{if(!my())return!1;const n=t?.type,r=t?.budgetId;if(!n||!r)return!0;const i=e?.byBudget?.[r];if(!i)return!0;return!1!==(i.allow||{})[n]}catch{return!0}}function gy(e){try{const t=e?.type||"",n=e?.budgetName?` (${e.budgetName})`:"";return"new_transaction"===t?`Nova transação${n}: ${e.transactionDescricao||""}`:"updated_transaction"===t?`Transação atualizada${n}: ${e.transactionDescricao||""}`:"deleted_transaction"===t?`Transação excluída${n}: ${e.transactionDescricao||""}`:"category_added"===t?`Categoria criada${n}: ${e.categoryNome||""}`:"category_updated"===t?`Categoria atualizada${n}: ${e.categoryNome||""}`:"category_deleted"===t?`Categoria excluída${n}: ${e.categoryNome||""}`:"test_notification"===t?`Teste de notificação${n}: ${e.message||""}`:`Nova atividade${n}`}catch{return"Nova atividade"}}async function wy(e){const t=function(){const e=window;return e.__notifCtl||(e.__notifCtl={unsub:null,uid:null,lastSeenAt:0,lastIds:new Set}),e.__notifCtl}();if(!e)return()=>{};if(t.unsub&&t.uid===e)return t.unsub;if(t.unsub)try{t.unsub()}catch{}const{listenByRecipient:r}=await n(async()=>{const{listenByRecipient:e}=await Promise.resolve().then(()=>hy);return{listenByRecipient:e}},void 0);t.uid=e,t.lastIds=new Set(Array.isArray(window.appState?.notifications)?window.appState.notifications.map(e=>e.id):[]),t.lastSeenAt=Math.max(0,...Array.isArray(window.appState?.notifications)?window.appState.notifications.map(e=>py(e.createdAt)):[0]);const i=await async function(e){try{const{getByUser:t}=await n(async()=>{const{getByUser:e}=await import("./userSettingsRepo-DAw0TtCo.js");return{getByUser:e}},__vite__mapDeps([6,2])),r=await t(e);return r?.notificationPrefs||{}}catch{return{}}}(e);return t.unsub=r(e,e=>{window.appState=window.appState||{},window.appState.notifications=e;e.filter(e=>!e.read&&!e.archivedAt).length;try{mg.emit("notifications:updated",e)}catch{}if(my())try{for(const r of e){const e=py(r.createdAt);if(!t.lastIds.has(r.id)&&e>=t.lastSeenAt){if(!fy(i,r))continue;if("false"!==localStorage.getItem("notification_use_modal"))try{mg.emit("notification:show-modal",r)}catch(n){const e=gy(r);mg.emit("snackbar:show",{message:e,type:"info",duration:3500,action:{label:"Ver",onClick:()=>{try{window.location.hash="#/notifications"}catch{}}}})}else{const e=gy(r);try{mg.emit("snackbar:show",{message:e,type:"info",duration:3500,action:{label:"Ver",onClick:()=>{try{window.location.hash="#/notifications"}catch{}}}})}catch{try{window.Snackbar?.({message:e,type:"info",duration:3500})}catch{}}}}}}catch{}t.lastIds=new Set(e.map(e=>e.id)),t.lastSeenAt=Math.max(0,...e.map(e=>py(e.createdAt)))},100),t.unsub}async function yy(){const e=(Array.isArray(window.appState?.notifications)?window.appState.notifications:[]).filter(e=>!e.read).map(e=>e.id);if(!e.length)return;const{markManyAsRead:t}=await n(async()=>{const{markManyAsRead:e}=await Promise.resolve().then(()=>hy);return{markManyAsRead:e}},void 0);await t(e)}async function vy(){const e=(Array.isArray(window.appState?.notifications)?window.appState.notifications:[]).filter(e=>e.read).map(e=>e.id);if(!e.length)return;const{deleteMany:t}=await n(async()=>{const{deleteMany:e}=await Promise.resolve().then(()=>hy);return{deleteMany:e}},void 0);await t(e)}async function by(e){if(!e)return;const{markAsRead:t}=await n(async()=>{const{markAsRead:e}=await Promise.resolve().then(()=>hy);return{markAsRead:e}},void 0);await t(e)}async function _y(e,t=!0){if(!e)return;const{pin:r}=await n(async()=>{const{pin:e}=await Promise.resolve().then(()=>hy);return{pin:e}},void 0);await r(e,t);try{mg.emit("snackbar:show",{message:t?"Notificação fixada":"Notificação desfixada",type:"success",duration:1800})}catch{}}async function Iy(e,t=!0){if(!e)return;const{archive:r}=await n(async()=>{const{archive:e}=await Promise.resolve().then(()=>hy);return{archive:e}},void 0);await r(e,t);try{mg.emit("snackbar:show",{message:t?"Notificação arquivada":"Notificação restaurada",type:"info",duration:1800})}catch{}}async function Ey(){const e=(Array.isArray(window.appState?.notifications)?window.appState.notifications:[]).filter(e=>e.read&&!e.archivedAt).map(e=>e.id);if(!e.length)return;const{archiveMany:t}=await n(async()=>{const{archiveMany:e}=await Promise.resolve().then(()=>hy);return{archiveMany:e}},void 0);await t(e);try{mg.emit("snackbar:show",{message:"Notificações lidas arquivadas",type:"info",duration:2e3})}catch{}}const Ty=Object.freeze(Object.defineProperty({__proto__:null,__isToastAllowedForTest:fy,archiveAllRead:Ey,archiveOne:Iy,deleteAllRead:vy,markAllAsRead:yy,markOneAsRead:by,pinOne:_y,startNotificationsFor:wy},Symbol.toStringTag,{value:"Module"}));class Sy{constructor(){this.isChecking=!1,this.lastCheckTime=null,this.pendingNotifications=[],this.catchUpModal=null}async init(){}isNotificationModalActive(){const e=document.getElementById("notification-modal");if(!e)return!1;const t=window.getComputedStyle(e),n=e.classList.contains("notification-modal-show");return"none"!==t.display&&"0"!==t.opacity&&"hidden"!==t.visibility&&"auto"!==t.zIndex&&n}async checkPendingNotifications(){if(!this.isChecking&&!this.isNotificationModalActive()&&(await new Promise(e=>setTimeout(e,2e3)),!this.isNotificationModalActive())){this.isChecking=!0;try{const e=this.getCurrentUserId();if(!e)return;const t=uy(),n=await t.getUnreadNotifications(e);n.length>0?(this.pendingNotifications=n,await this.showCatchUpModal()):this.pendingNotifications=[]}catch(e){}finally{this.isChecking=!1,this.lastCheckTime=new Date}}}async showCatchUpModal(){if(!this.pendingNotifications||0===this.pendingNotifications.length)return;this.catchUpModal&&this.catchUpModal.remove();const e=this.createCatchUpModal();document.body.appendChild(e),this.catchUpModal=e,setTimeout(()=>{e.classList.add("catch-up-modal-show")},100),setTimeout(()=>{this.closeCatchUpModal()},3e4)}createCatchUpModal(){const e=document.body.classList.contains("dark")||document.documentElement.classList.contains("dark")||window.matchMedia("(prefers-color-scheme: dark)").matches,t=e?"#1f2937":"white",n=e?"#f9fafb":"#111827",r=e?"#374151":"#e5e7eb",i=e?"#3b82f6":"#2563eb",a=document.createElement("div");return a.className="catch-up-modal-overlay",a.innerHTML=`\n      <div class="catch-up-modal-container" style="\n        background: ${t};\n        color: ${n};\n        border: 1px solid ${r};\n        border-radius: 16px;\n        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);\n        max-width: 500px;\n        width: 90%;\n        max-height: 80vh;\n        overflow: hidden;\n        transform: scale(0.9) translateY(20px);\n        opacity: 0;\n        transition: all 0.3s ease;\n      ">\n        <div class="catch-up-modal-header" style="\n          padding: 20px 24px 16px;\n          border-bottom: 1px solid ${r};\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n        ">\n          <div style="display: flex; align-items: center; gap: 12px;">\n            <div style="\n              width: 40px;\n              height: 40px;\n              background: ${i};\n              border-radius: 50%;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              color: white;\n              font-size: 18px;\n              font-weight: bold;\n            ">\n              ${this.pendingNotifications.length}\n            </div>\n            <div>\n              <h3 style="\n                margin: 0;\n                font-size: 18px;\n                font-weight: 600;\n                color: ${n};\n              ">\n                Notificações Pendentes\n              </h3>\n              <p style="\n                margin: 4px 0 0;\n                font-size: 14px;\n                color: ${e?"#9ca3af":"#6b7280"};\n              ">\n                Você tem ${this.pendingNotifications.length} notificação${this.pendingNotifications.length>1?"ões":""} não lida${this.pendingNotifications.length>1?"s":""}\n              </p>\n            </div>\n          </div>\n          <button id="catch-up-modal-close" style="\n            background: none;\n            border: none;\n            color: ${e?"#9ca3af":"#6b7280"};\n            font-size: 24px;\n            cursor: pointer;\n            padding: 4px;\n            border-radius: 4px;\n            transition: all 0.2s ease;\n          " title="Fechar">\n            ×\n          </button>\n        </div>\n\n        <div class="catch-up-modal-content" style="\n          padding: 16px 24px;\n          max-height: 400px;\n          overflow-y: auto;\n        ">\n          ${this.pendingNotifications.map(t=>`\n            <div class="catch-up-notification-item" style="\n              padding: 16px;\n              background: ${e?"#374151":"#f9fafb"};\n              border-radius: 12px;\n              margin-bottom: 12px;\n              border: 1px solid ${e?"#4b5563":"#e5e7eb"};\n              transition: all 0.2s ease;\n            ">\n              <div style="display: flex; align-items: flex-start; gap: 12px;">\n                <div style="\n                  width: 32px;\n                  height: 32px;\n                  background: ${this.getNotificationColor(t.type)};\n                  border-radius: 50%;\n                  display: flex;\n                  align-items: center;\n                  justify-content: center;\n                  color: white;\n                  font-size: 14px;\n                  font-weight: bold;\n                  flex-shrink: 0;\n                ">\n                  ${this.getNotificationIcon(t.type)}\n                </div>\n                <div style="flex: 1; min-width: 0;">\n                  <h4 style="\n                    margin: 0 0 4px;\n                    font-size: 14px;\n                    font-weight: 600;\n                    color: ${n};\n                  ">\n                    ${this.getNotificationTitle(t.type)}\n                  </h4>\n                  <p style="\n                    margin: 0 0 8px;\n                    font-size: 13px;\n                    color: ${e?"#d1d5db":"#374151"};\n                    line-height: 1.4;\n                  ">\n                    ${t.message||this.getDefaultMessage(t.type)}\n                  </p>\n                  <div style="\n                    display: flex;\n                    align-items: center;\n                    justify-content: space-between;\n                    font-size: 12px;\n                    color: ${e?"#9ca3af":"#6b7280"};\n                  ">\n                    <span>${this.formatDate(t.createdAt)}</span>\n                    <span>${t.budgetName||"Orçamento"}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          `).join("")}\n        </div>\n\n        <div class="catch-up-modal-footer" style="\n          padding: 16px 24px 20px;\n          border-top: 1px solid ${r};\n          display: flex;\n          gap: 12px;\n          justify-content: flex-end;\n        ">\n          <button id="catch-up-modal-mark-all-read" style="\n            background: ${i};\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            font-size: 14px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n          ">\n            Marcar Todas como Lidas\n          </button>\n          <button id="catch-up-modal-view-all" style="\n            background: ${e?"#374151":"#f3f4f6"};\n            color: ${n};\n            border: 1px solid ${r};\n            padding: 10px 20px;\n            border-radius: 8px;\n            font-size: 14px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n          ">\n            Ver Todas\n          </button>\n        </div>\n      </div>\n    `,this.addCatchUpModalStyles(),this.bindCatchUpModalEvents(a),a}addCatchUpModalStyles(){if(document.getElementById("catch-up-modal-styles"))return;const e=document.createElement("style");e.id="catch-up-modal-styles",e.textContent="\n      .catch-up-modal-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.6);\n        backdrop-filter: blur(4px);\n        z-index: 9999;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 20px;\n        opacity: 0;\n        visibility: hidden;\n        transition: opacity 0.3s ease, visibility 0.3s ease;\n      }\n\n      .catch-up-modal-overlay.catch-up-modal-show {\n        opacity: 1;\n        visibility: visible;\n      }\n\n      .catch-up-modal-overlay.catch-up-modal-show .catch-up-modal-container {\n        transform: scale(1) translateY(0);\n        opacity: 1;\n      }\n\n      .catch-up-notification-item:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n      }\n\n      #catch-up-modal-close:hover {\n        background: rgba(0, 0, 0, 0.1);\n        color: #ef4444;\n      }\n\n      #catch-up-modal-mark-all-read:hover {\n        background: #1d4ed8;\n        transform: translateY(-1px);\n      }\n\n      #catch-up-modal-view-all:hover {\n        background: #e5e7eb;\n        transform: translateY(-1px);\n      }\n\n      .catch-up-modal-content::-webkit-scrollbar {\n        width: 6px;\n      }\n\n      .catch-up-modal-content::-webkit-scrollbar-track {\n        background: transparent;\n      }\n\n      .catch-up-modal-content::-webkit-scrollbar-thumb {\n        background: rgba(0, 0, 0, 0.2);\n        border-radius: 3px;\n      }\n\n      .catch-up-modal-content::-webkit-scrollbar-thumb:hover {\n        background: rgba(0, 0, 0, 0.3);\n      }\n    ",document.head.appendChild(e)}bindCatchUpModalEvents(e){const t=e.querySelector("#catch-up-modal-close"),n=e.querySelector("#catch-up-modal-mark-all-read"),r=e.querySelector("#catch-up-modal-view-all"),i=e;t&&t.addEventListener("click",()=>this.closeCatchUpModal()),i&&i.addEventListener("click",e=>{e.target===i&&this.closeCatchUpModal()}),n&&n.addEventListener("click",()=>this.markAllAsRead()),r&&r.addEventListener("click",()=>this.viewAllNotifications()),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.catchUpModal&&this.closeCatchUpModal()})}closeCatchUpModal(){this.catchUpModal&&(this.catchUpModal.classList.remove("catch-up-modal-show"),setTimeout(()=>{this.catchUpModal&&(this.catchUpModal.remove(),this.catchUpModal=null)},300))}async markAllAsRead(){try{const e=uy();this.getCurrentUserId();for(const t of this.pendingNotifications)await e.markAsRead(t.id);this.closeCatchUpModal(),window.Snackbar&&window.Snackbar.show("Todas as notificações foram marcadas como lidas","success")}catch(e){}}viewAllNotifications(){this.closeCatchUpModal(),window.location.hash="#/notifications"}setupRouteListener(){window.addEventListener("hashchange",()=>{setTimeout(()=>{this.checkPendingNotifications()},5e3)})}getCurrentUserId(){return window.appState?.user?.uid?window.appState.user.uid:window.currentUser?.uid?window.currentUser.uid:window.firebase?.auth?.currentUser?.uid?window.firebase.auth.currentUser.uid:null}getNotificationColor(e){return{transaction_created:"#10b981",transaction_updated:"#f59e0b",transaction_deleted:"#ef4444",category_created:"#8b5cf6",category_updated:"#f59e0b",category_deleted:"#ef4444",recurring_created:"#06b6d4",recurring_updated:"#f59e0b",recurring_deleted:"#ef4444",budget_shared:"#3b82f6",budget_unshared:"#6b7280",test_notification:"#8b5cf6"}[e]||"#6b7280"}getNotificationIcon(e){return{transaction_created:"💰",transaction_updated:"✏️",transaction_deleted:"🗑️",category_created:"📁",category_updated:"✏️",category_deleted:"🗑️",recurring_created:"🔄",recurring_updated:"✏️",recurring_deleted:"🗑️",budget_shared:"👥",budget_unshared:"👤",test_notification:"🧪"}[e]||"📢"}getNotificationTitle(e){return{transaction_created:"Nova Transação",transaction_updated:"Transação Atualizada",transaction_deleted:"Transação Excluída",category_created:"Nova Categoria",category_updated:"Categoria Atualizada",category_deleted:"Categoria Excluída",recurring_created:"Nova Recorrente",recurring_updated:"Recorrente Atualizada",recurring_deleted:"Recorrente Excluída",budget_shared:"Orçamento Compartilhado",budget_unshared:"Orçamento Descompartilhado",test_notification:"Notificação de Teste"}[e]||"Notificação"}getDefaultMessage(e){return{transaction_created:"Uma nova transação foi criada",transaction_updated:"Uma transação foi atualizada",transaction_deleted:"Uma transação foi excluída",category_created:"Uma nova categoria foi criada",category_updated:"Uma categoria foi atualizada",category_deleted:"Uma categoria foi excluída",recurring_created:"Uma nova transação recorrente foi criada",recurring_updated:"Uma transação recorrente foi atualizada",recurring_deleted:"Uma transação recorrente foi excluída",budget_shared:"Um orçamento foi compartilhado com você",budget_unshared:"Um orçamento foi descompartilhado",test_notification:"Esta é uma notificação de teste"}[e]||"Nova notificação disponível"}formatDate(e){if(!e)return"Agora";const t=new Date,n=new Date(e),r=Math.floor((t-n)/6e4);return r<1?"Agora":r<60?`${r}min atrás`:r<1440?`${Math.floor(r/60)}h atrás`:`${Math.floor(r/1440)}d atrás`}}let ky=null;function Ay(){return ky||(ky=new Sy),ky}async function Cy(){const e=Ay();return await e.init(),e}"undefined"!=typeof window&&(window.getCatchUpNotifications=Ay,window.initCatchUpNotifications=Cy);const xy=Object.freeze(Object.defineProperty({__proto__:null,getCatchUpNotifications:Ay,initCatchUpNotifications:Cy},Symbol.toStringTag,{value:"Module"})),Dy="app_cache_version",Py="v4.43.0";async function Ny(){try{const e=localStorage.getItem(Dy);e!==Py&&(await Ry(),Oy(),localStorage.setItem(Dy,Py),e&&setTimeout(()=>{window.location.reload()},1e3))}catch(e){}}async function Ry(){try{if("caches"in window){const e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}}catch(e){}}function Oy(){try{const e=[],t=["notification_use_modal","notification_toasts_enabled","sw_version","app_state","user_preferences"];for(let n=0;n<localStorage.length;n++){const r=localStorage.key(n);r&&t.some(e=>r.includes(e))&&e.push(r)}e.forEach(e=>{localStorage.removeItem(e)})}catch(e){}}"undefined"!=typeof window&&(window.clearCache=async function(){try{await Ry(),Oy(),localStorage.removeItem(Dy),window.location.reload()}catch(e){}},window.checkCache=Ny,window.checkSW=async function(){try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistration();return!!e&&(e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"}),!0)}return!1}catch(e){return!1}});window.permissionManager=new class{constructor(){this.isCapacitor=window.Capacitor&&window.Capacitor.isNativePlatform(),this.permissions={microphone:!1,notifications:!1,camera:!1}}async init(){this.isCapacitor&&(await this.checkPermissions(),await this.requestRequiredPermissions())}async checkPermissions(){if(this.isCapacitor)try{if(navigator.permissions){const e=await navigator.permissions.query({name:"microphone"});this.permissions.microphone="granted"===e.state}Notification&&(this.permissions.notifications="granted"===Notification.permission)}catch(e){}}async requestRequiredPermissions(){if(!this.isCapacitor)return await this.requestWebPermissions();try{await this.requestMicrophonePermission(),await this.requestNotificationPermission()}catch(e){}}async requestMicrophonePermission(){try{if(window.Capacitor&&window.Capacitor.Plugins.Device){const e=await navigator.mediaDevices.getUserMedia({audio:!0});if(e)return this.permissions.microphone=!0,e.getTracks().forEach(e=>e.stop()),!0}else{const e=await navigator.mediaDevices.getUserMedia({audio:!0});if(e)return this.permissions.microphone=!0,e.getTracks().forEach(e=>e.stop()),!0}return this.permissions.microphone=!1,!1}catch(e){return this.permissions.microphone=!1,!1}}async requestNotificationPermission(){try{if(Notification){const e=await Notification.requestPermission();this.permissions.notifications="granted"===e}}catch(e){this.permissions.notifications=!1}}async requestWebPermissions(){try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});if(e&&(this.permissions.microphone=!0,e.getTracks().forEach(e=>e.stop())),Notification){const e=await Notification.requestPermission();this.permissions.notifications="granted"===e}}catch(e){}}hasAllPermissions(){return this.permissions.microphone&&this.permissions.notifications}showPermissionDialog(){document.body.insertAdjacentHTML("beforeend",'\n            <div id="permission-dialog" style="\n                position: fixed; top: 0; left: 0; right: 0; bottom: 0; \n                background: rgba(0,0,0,0.8); z-index: 10000; \n                display: flex; align-items: center; justify-content: center;\n            ">\n                <div style="\n                    background: white; padding: 20px; border-radius: 8px; \n                    max-width: 400px; text-align: center; margin: 20px;\n                ">\n                    <h3 style="color: #1f2937; margin-bottom: 15px;">🔐 Permissões Necessárias</h3>\n                    <p style="color: #6b7280; margin-bottom: 20px;">\n                        Para usar o reconhecimento de voz e receber notificações, \n                        precisamos das seguintes permissões:\n                    </p>\n                    <div style="text-align: left; margin-bottom: 20px;">\n                        <p style="margin: 5px 0;"><strong>🎤 Microfone:</strong> Para reconhecimento de voz</p>\n                        <p style="margin: 5px 0;"><strong>🔔 Notificações:</strong> Para alertas e lembretes</p>\n                    </div>\n                    <button onclick="window.permissionManager.requestRequiredPermissions().then(() => document.getElementById(\'permission-dialog\').remove())" \n                            style="\n                                background: #3b82f6; color: white; border: none; \n                                padding: 10px 20px; border-radius: 5px; cursor: pointer;\n                            ">\n                        Conceder Permissões\n                    </button>\n                    <button onclick="document.getElementById(\'permission-dialog\').remove()" \n                            style="\n                                background: #6b7280; color: white; border: none; \n                                padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px;\n                            ">\n                        Cancelar\n                    </button>\n                </div>\n            </div>\n        ')}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.permissionManager.init()}):window.permissionManager.init();const Ly=new class{constructor(){this.isDev=!1,this.isDebug=!1,this.enabled=this.isDev||this.isDebug,this.levels={ERROR:0,WARN:1,INFO:2,DEBUG:3},this.currentLevel=this.isDev?this.levels.DEBUG:this.levels.ERROR}_shouldLog(e){return this.enabled&&e<=this.currentLevel}_formatMessage(e,t,...n){return[`[${(new Date).toISOString()}] [${e}]`,t,...n]}error(e,...t){this._shouldLog(this.levels.ERROR)}warn(e,...t){this._shouldLog(this.levels.WARN)}info(e,...t){this._shouldLog(this.levels.INFO)}debug(e,...t){this._shouldLog(this.levels.DEBUG)}auth(e,...t){this.debug(`[AUTH] ${e}`,...t)}firebase(e,...t){this.debug(`[FIREBASE] ${e}`,...t)}ui(e,...t){this.debug(`[UI] ${e}`,...t)}performance(e,...t){this.debug(`[PERF] ${e}`,...t)}critical(e,...t){}setLevel(e){"string"==typeof e&&(e=this.levels[e.toUpperCase()]),void 0!==e&&e>=0&&e<=3&&(this.currentLevel=e,this.debug(`Logger level set to: ${Object.keys(this.levels)[e]}`))}getLevel(){return this.currentLevel}};function My(){const e="true"===localStorage.getItem("compactMode"),t="true"===localStorage.getItem("microMode"),n="true"===localStorage.getItem("nanoMode"),r=document.querySelector(".app-container"),i=document.body;i.classList.remove("compact-mode","micro-mode","nano-mode"),r&&r.classList.remove("compact-mode","micro-mode","nano-mode"),n?(i.classList.add("compact-mode","micro-mode","nano-mode"),r&&r.classList.add("compact-mode","micro-mode","nano-mode")):t?(i.classList.add("compact-mode","micro-mode"),r&&r.classList.add("compact-mode","micro-mode")):e&&(i.classList.add("compact-mode"),r&&r.classList.add("compact-mode"))}function Uy(e,t="info"){mg.emit("snackbar:show",{message:e,type:t})}function Vy(e){window.location.hash!==`#${e}`&&(window.location.hash=e)}const Fy={user:null,currentBudget:null,transactions:[],categories:[],recorrentes:[],selectedYear:(new Date).getFullYear(),selectedMonth:(new Date).getMonth()+1,setUser(e){this.user=e,mg.emit("user:changed",e)},setCurrentBudget(e){this.currentBudget=e,mg.emit("budget:changed",e)},setTransactions(e){this.transactions=e,mg.emit("transactions:changed",e)},setCategories(e){this.categories=e,mg.emit("categories:changed",e)},setRecorrentes(e){this.recorrentes=e,mg.emit("recorrentes:changed",e)},setSelectedPeriod(e,t){this.selectedYear=e,this.selectedMonth=t,mg.emit("period:changed",{year:e,month:t})}};function By(){try{if("undefined"!=typeof window&&window.appState&&window.appState.selectedYear&&window.appState.selectedMonth)return{year:window.appState.selectedYear,month:window.appState.selectedMonth}}catch{}try{const e="undefined"!=typeof localStorage?localStorage.getItem("selectedYM"):null;if(e){const t=String(e).match(/^(\d{4})-(\d{2})$/);if(t){const e=parseInt(t[1],10),n=parseInt(t[2],10);if(e>1900&&n>=1&&n<=12)return{year:e,month:n}}}}catch{}return{year:Fy.selectedYear,month:Fy.selectedMonth}}function jy(e,t){try{if("undefined"!=typeof window){window.appState=window.appState||Fy,window.appState.selectedYear=e,window.appState.selectedMonth=t;try{localStorage.setItem("selectedYM",`${e}-${String(t).padStart(2,"0")}`)}catch{}try{const n=window.location.hash||"",r=n.split("?")[0]||"#/dashboard",i=`${e}-${String(t).padStart(2,"0")}`,a=/[?&]ym=\d{4}-\d{2}/.test(n),o=a?(n.match(/ym=(\d{4}-\d{2})/)||[])[1]:null;if(!a||o!==i){const e=`${r}?ym=${i}`;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.includes("jsdom"))window.location.hash=e;else{const t=new URL(window.location.href);t.hash=e,window.history&&window.history.replaceState?window.history.replaceState(null,"",t.toString()):window.location.hash=e}}}catch{}}}catch{}Fy.setSelectedPeriod(e,t)}const $y={showAddTransactionModal:async e=>{try{const{showTransactionModal:t}=await n(async()=>{const{showTransactionModal:e}=await import("./TransactionModalShim-G20isjrn.js");return{showTransactionModal:e}},[]);if(await t(e||{}))return;mg.emit("modal:show",{type:"transaction",data:e,title:"Nova Transação"})}catch(t){mg.emit("modal:show",{type:"transaction",data:e,title:"Nova Transação"})}},showAddRecorrenteModal:e=>{mg.emit("modal:show",{type:"recorrente",data:e,title:"Nova Recorrente"})},closeModal:()=>{try{const e=document.getElementById("app-modal")||document.querySelector("#app-modal, .modal");if(e&&e.parentNode&&e.parentNode.removeChild(e),window.toggleFABOnModal)try{window.toggleFABOnModal()}catch{}}catch{}try{mg.emit("modal:hide")}catch{}}};"undefined"!=typeof window&&(window.getSelectedPeriod=By,window.setSelectedPeriod=jy,window.showAddTransactionModal=async e=>{try{const{showTransactionModal:t}=await n(async()=>{const{showTransactionModal:e}=await import("./TransactionModalShim-G20isjrn.js");return{showTransactionModal:e}},[]);if(await t(e||{}))return;mg.emit("modal:show",{type:"transaction",data:e,title:"Nova Transação"})}catch(t){mg.emit("modal:show",{type:"transaction",data:e,title:"Nova Transação"})}},"function"!=typeof window.showAddRecorrenteModal&&(window.showAddRecorrenteModal=$y.showAddRecorrenteModal),window.closeModal=$y.closeModal,window.appState=Fy);const qy=Object.freeze(Object.defineProperty({__proto__:null,applyCompactMode:My,debounce:function(e,t){let n;return function(...r){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...r)},t)}},ensureHashHasYm:function(e,t){try{const n=window.location.hash||"",r=n.split("?")[0]||"#/dashboard",i=`${e}-${String(t).padStart(2,"0")}`,a=n.match(/ym=(\d{4}-\d{2})/);if(!a||a[1]!==i){const e=`${r}?ym=${i}`;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.includes("jsdom"))window.location.hash=e;else{const t=new URL(window.location.href);t.hash=e,window.history&&window.history.replaceState?window.history.replaceState(null,"",t.toString()):window.location.hash=e}}}catch{}},formatCurrency:function(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e||0)},formatDate:function(e){return e?new Date(e).toLocaleDateString("pt-BR"):""},formatDateTime:function(e){return e?new Date(e).toLocaleString("pt-BR"):""},getSelectedPeriod:By,getStorageItem:function(e,t=null){try{const n=localStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}},globalFunctions:$y,globalState:Fy,hideModal:function(){mg.emit("modal:hide")},isValidAmount:function(e){return!isNaN(e)&&parseFloat(e)>0},isValidEmail:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},navigateTo:Vy,parseYmFromHash:function(){try{const e=("undefined"!=typeof window&&window.location.hash||"").match(/ym=(\d{4})-(\d{2})/);if(e){const t=parseInt(e[1],10),n=parseInt(e[2],10);if(t>1900&&n>=1&&n<=12)return{year:t,month:n}}}catch{}return null},scrollToTop:function(e=!0){try{const t=[];try{const e=document.getElementById("app-content");e&&t.push(e);const n=document.querySelector(".tab-content");n&&t.push(n);const r=document.querySelector(".content-spacing");r&&t.push(r)}catch{}for(const e of t)try{"function"==typeof e.scrollTo&&e.scrollTo({top:0,left:0,behavior:"auto"}),e.scrollTop=0,e.scrollLeft=0}catch{}if(e&&"undefined"!=typeof document){try{document.documentElement.scrollTop=0}catch{}try{document.body.scrollTop=0}catch{}}if(e&&"undefined"!=typeof window&&"function"==typeof window.scrollTo)try{window.scrollTo({top:0,left:0,behavior:"auto"})}catch{}}catch{}},setSelectedPeriod:jy,setStorageItem:function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(n){}},showModal:function(e,t={}){mg.emit("modal:show",{content:e,options:t})},showNotification:function(e,t="info",n=3e3){mg.emit("notification:show",{message:e,type:t,duration:n})},showSnackbar:Uy,throttle:function(e,t){let n;return function(){const r=arguments,i=this;n||(e.apply(i,r),n=!0,setTimeout(()=>n=!1,t))}},updatePageTitle:function(e){try{const t={"/":"Dashboard","/dashboard":"Dashboard","/transactions":"Transações","/categories":"Categorias","/analytics":"Análises","/recorrentes":"Recorrentes","/notifications":"Notificações","/settings":"Configurações"}[e]||"Dashboard";document.title=`Financeiro • ${t}`;const n=document.querySelector(".tab-title-highlight");if(n&&!n.textContent.includes(t)){const e=n.textContent.split(" ")[0];n.textContent=`${e} ${t}`}}catch{}}},Symbol.toStringTag,{value:"Module"}));const zy=fg({user:null,loading:!0,error:null});function Hy(){return new Promise(e=>{const t=()=>Rr(Xf,t=>{zy.setState({user:t,loading:!1}),mg.emit("auth:changed",t),t&&Gy(t).catch(()=>{}),e(t||null),n()});let n;tg.then(()=>{n=t()}).catch(()=>{n=t()})})}async function Gy(e){try{if(!e||!e.uid)return;const{doc:t,getDoc:r,setDoc:i,updateDoc:a,serverTimestamp:o}=await n(async()=>{const{doc:e,getDoc:t,setDoc:n,updateDoc:r,serverTimestamp:i}=await Promise.resolve().then(()=>Lm);return{doc:e,getDoc:t,setDoc:n,updateDoc:r,serverTimestamp:i}},void 0),{db:s}=await n(async()=>{const{db:e}=await Promise.resolve().then(()=>ng);return{db:e}},void 0),c=t(s,"users",e.uid),d=await r(c),l={uid:e.uid,email:e.email||null,emailLower:e.email?String(e.email).toLowerCase():null,displayName:e.displayName||null,photoURL:e.photoURL||null,providers:Array.isArray(e.providerData)?e.providerData.map(e=>e?.providerId).filter(Boolean):[],lastLoginAt:o()};d.exists()?await a(c,l):await i(c,{...l,createdAt:o()},{merge:!0})}catch(t){}}const Wy=Object.freeze(Object.defineProperty({__proto__:null,authStore:zy,ensureUserProfile:Gy,waitForAuth:Hy},Symbol.toStringTag,{value:"Module"})),Ky="budgets";async function Qy(e={}){const t=mp(Zf,Ky),n=[];e.userId&&n.push(om("userId","==",e.userId));const r=n.length?im(t,...n):t;return(await Im(r)).docs.map(e=>({id:e.id,...e.data()}))}async function Yy(e){return await Qy({userId:e})}async function Jy(e){const t=im(mp(Zf,Ky),om("usuariosPermitidos","array-contains",e));return(await Im(t)).docs.map(e=>({id:e.id,...e.data()}))}async function Xy(e){const t=mp(Zf,Ky);return(await km(t,e)).id}async function Zy(e,t){const n=fp(Zf,Ky,e);return await Tm(n,t),!0}async function ev(e){const t=fp(Zf,Ky,e);return await Sm(t),!0}function tv(e,t){return Am(im(mp(Zf,Ky),om("userId","==",e)),e=>{const n=e=>e?.toDate?e.toDate():e?.seconds?new Date(1e3*e.seconds):e?new Date(e):new Date(0),r=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>n(t.createdAt)-n(e.createdAt));t(r)})}const nv=Object.freeze(Object.defineProperty({__proto__:null,create:Xy,getById:async function(e){if(!e)return null;const t=fp(Zf,Ky,e),n=await bm(t);return n.exists()?{id:n.id,...n.data()}:null},list:Qy,listOwn:Yy,listShared:Jy,listenToChanges:tv,remove:ev,update:Zy},Symbol.toStringTag,{value:"Module"})),rv=fg({budgets:[],currentBudget:null,loading:!1,error:null});let iv=new Map;async function av(e){try{rv.setState({loading:!0,error:null});const[t,n]=await Promise.all([Yy(e),Jy(e)]),r=(t,n)=>(t||[]).map(t=>({...t,isOwner:"boolean"==typeof t.isOwner?t.isOwner:t.userId===e})),i=r(t,!0),a=r(n,!1),o=new Map;[...i,...a].forEach(t=>{const n=o.get(t.id);n?t.isOwner&&!n.isOwner&&t.userId===e&&o.set(t.id,t):o.set(t.id,t)});const s=e=>e?.toDate?e.toDate():e?.seconds?new Date(1e3*e.seconds):e?new Date(e):new Date(0),c=Array.from(o.values()).sort((e,t)=>s(t.createdAt)-s(e.createdAt));return rv.setState({budgets:c,loading:!1}),"undefined"!=typeof window&&(window.appState=window.appState||{},window.appState.budgets=c),c}catch(t){throw rv.setState({error:t.message,loading:!1}),t}}function ov(e){if(iv.has(e))return;const t=tv(e,e=>{rv.setState({budgets:e}),mg.emit("budgets:updated",{budgets:e})});iv.set(e,t)}function sv(e){rv.setState({currentBudget:e}),mg.emit("budget:changed",e);try{e?.id&&localStorage.setItem("currentBudgetId",e.id)}catch{}}async function cv(e){try{const t=await Xy(e);return mg.emit("budget:created",t),t}catch(t){throw mg.emit("error:budget",t),t}}function dv(){iv.forEach(e=>e()),iv.clear()}async function lv(e){const{getById:t}=await n(async()=>{const{getById:e}=await Promise.resolve().then(()=>nv);return{getById:e}},void 0);return t(e)}const uv=Object.freeze(Object.defineProperty({__proto__:null,budgetsStore:rv,createBudget:cv,deleteBudget:async function(e,t){try{await ev(e),mg.emit("budget:deleted",{id:e})}catch(n){throw mg.emit("error:budget",n),n}},ensureBudgetPersistence:function(e){if(!e||!e.id)return!1;try{return localStorage.setItem("currentBudgetId",e.id),window.appState&&(window.appState.currentBudget=e),mg.emit("budget:changed",e),!0}catch(t){return!1}},getById:lv,loadSharedBudgets:async function(e){try{return await Jy(e)}catch(t){throw mg.emit("error:budget",t),t}},loadUserBudgets:av,restoreBudgetFromStorage:async function(e){try{const e=localStorage.getItem("currentBudgetId");if(!e)return null;const t=await lv(e);return t?(sv(t),t):(localStorage.removeItem("currentBudgetId"),null)}catch(t){return null}},selectDefaultBudget:async function(e){try{const n=await av(e);if(n&&n.length>0){let e=n[0];try{const t=localStorage.getItem("currentBudgetId");if(t){const r=n.find(e=>e.id===t);r&&(e=r)}}catch(t){}return sv(e),window.appState&&(window.appState.currentBudget=e),e}{const t={nome:"Orçamento Principal",descricao:"Orçamento padrão criado automaticamente",userId:e,tipo:"pessoal",createdAt:new Date,usuariosPermitidos:[e]},n=await cv(t),r=await lv(n);if(r)return sv(r),window.appState&&(window.appState.currentBudget=r),r}return null}catch(n){throw n}},setCurrentBudget:sv,setCurrentBudgetGlobal:function(e){sv(e),window.appState&&(window.appState.currentBudget=e);try{e?.id&&localStorage.setItem("currentBudgetId",e.id)}catch{}return e},startBudgetsListener:ov,stopAllListeners:dv,stopBudgetsListener:function(e){const t=iv.get(e);t&&(t(),iv.delete(e))},updateBudget:async function(e,t){try{await Zy(e,t),mg.emit("budget:updated",{id:e,data:t})}catch(n){throw mg.emit("error:budget",n),n}}},Symbol.toStringTag,{value:"Module"}));async function hv(e=!1){const t=(e,t="info")=>{try{window.Snackbar?.({message:e,type:t})}catch{}};if(e)return t("🔄 Iniciando atualização completa (hard refresh)…","info"),void(await pv());if(t("Procurando atualizações…","info"),!("serviceWorker"in navigator))return void t("Service Worker indisponível","warning");const n=await navigator.serviceWorker.getRegistration();if(!n)return void t("Registro do Service Worker não encontrado","warning");let r=!1;const i=()=>{if(!r){r=!0;try{window.location.reload()}catch{}}};navigator.serviceWorker.addEventListener("controllerchange",i,{once:!0});try{await n.update()}catch(o){}const a=e=>new Promise(r=>{if(!e)return r(!1);const a=()=>{if("installed"===e.state){try{n.waiting?.postMessage({type:"SKIP_WAITING"})}catch{}t("Atualização encontrada. Aplicando…","info"),setTimeout(i,4e3),r(!0)}};e.addEventListener("statechange",a),"installed"===e.state&&a(),setTimeout(()=>r(!1),5e3)});if(n.waiting){try{n.waiting.postMessage({type:"SKIP_WAITING"})}catch{}t("Atualização encontrada. Aplicando…","info"),setTimeout(i,4e3)}else{if(!(await a(n.installing))){const e=new Promise(e=>{let t=!1;const r=async()=>{t||(t=!0,n.removeEventListener("updatefound",r),await a(n.installing),e(!0))};n.addEventListener("updatefound",r),setTimeout(()=>{t||(n.removeEventListener("updatefound",r),e(!1))},3e3)});if(!(await e)){try{n.active?.postMessage?.({type:"UPDATE_CONTENT"})}catch{}t("Atualizando conteúdo…","info"),setTimeout(i,500)}}}try{const e=Date.now();localStorage?.setItem?.("sw_last_check",String(e));const t=document.getElementById("sw-last-check");t&&(t.textContent=new Date(e).toLocaleString()),setTimeout(()=>{window.updateSwStatus&&window.updateSwStatus()},10)}catch{}}async function pv(){const e=(e,t="info")=>{try{window.Snackbar?.({message:e,type:t})}catch{}};try{if(e("🧹 Limpando cache e dados…","info"),"undefined"!=typeof caches&&caches.keys){const e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}if("serviceWorker"in navigator){const e=await navigator.serviceWorker.getRegistration();e&&await e.unregister()}const t={};["user","currentBudget","theme","language"].forEach(e=>{const n=localStorage.getItem(e);n&&(t[e]=n)}),localStorage.clear(),Object.entries(t).forEach(([e,t])=>{localStorage.setItem(e,t)}),sessionStorage.clear(),e("✅ Limpeza concluída. Recarregando aplicação…","success"),setTimeout(()=>{window.location.reload(!0)},1500)}catch(t){e("❌ Erro durante limpeza. Recarregando mesmo assim…","warning"),setTimeout(()=>{window.location.reload(!0)},1e3)}}async function mv(){try{if("undefined"!=typeof caches&&caches.keys){const e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}try{navigator.serviceWorker?.controller?.postMessage?.({action:"clearCache"})}catch{}window.Snackbar?.({message:"Cache offline limpo. Recarregue se necessário.",type:"success"})}catch(e){window.Snackbar?.({message:"Falha ao limpar cache",type:"error"})}}"undefined"!=typeof window&&(window.showAddTransactionModal=bw,window.Snackbar=fw),"undefined"!=typeof window&&Ny().then(()=>{}).catch(e=>{}),"undefined"!=typeof window&&(window.eventBus=mg),"undefined"!=typeof window&&window.eventBus&&"function"==typeof window.eventBus.on&&(window.__notificationModalListenerBound||(window.__notificationModalListenerBound=!0,window.eventBus.on("notification:show-modal",async e=>{try{const{getNotificationModal:t}=await n(async()=>{const{getNotificationModal:e}=await import("./NotificationModal-B7R6h_Eo.js");return{getNotificationModal:e}},__vite__mapDeps([5,2])),r=t();r&&r.show(e)}catch(t){}}))),"undefined"!=typeof window&&window.eventBus&&"function"==typeof window.eventBus.on&&(window.eventBus.on("transactions:updated",(e={})=>{Array.isArray(e.transactions)&&(window.appState=window.appState||{},window.appState.transactions=e.transactions);if("#/transactions"===(window.location.hash||"").split("?")[0]&&"function"==typeof window.renderTransactions)try{window.renderTransactions()}catch(t){}}),window.eventBus.on("categories:updated",(e={})=>{Array.isArray(e.categories)&&(window.appState=window.appState||{},window.appState.categories=e.categories)}));const fv="undefined"!=typeof window&&"BroadcastChannel"in window?new window.BroadcastChannel("financeiro-sync"):null;function gv(e,t,n=!1){if(n)wv({type:e,payload:t});else if(wv({type:e,payload:t}),fv)fv.postMessage({type:e,payload:t});else try{localStorage.setItem("financeiro-sync-event",JSON.stringify({type:e,payload:t,ts:Date.now()})),setTimeout(()=>localStorage.removeItem("financeiro-sync-event"),100)}catch{}}function wv({type:e,payload:t}){"transactions:updated"===e&&mg.emit("transactions:updated",{...t,__syncRemote:!0}),"categories:updated"===e&&mg.emit("categories:updated",{...t,__syncRemote:!0})}fv?fv.onmessage=e=>{e?.data&&gv(e.data.type,e.data.payload,!0)}:window.addEventListener("storage",e=>{if("financeiro-sync-event"===e.key&&e.newValue)try{const t=JSON.parse(e.newValue);gv(t.type,t.payload,!0)}catch{}});const yv={user:null,currentBudget:null,transactions:[],categories:[],recorrentes:[],loading:!1,error:null};async function vv(){try{await n(()=>import("./networkHandler-Dd825SpE.js"),[]);const{default:e}=await n(async()=>{const{default:e}=await import("./networkPatch-BJWxLaAG.js");return{default:e}},[]);e.initialize()}catch(e){}try{window.checkForUpdates=hv,window.clearAppCaches=mv,window.performHardRefresh=pv;if(window.Capacitor&&window.Capacitor.isNativePlatform&&window.Capacitor.isNativePlatform())try{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>{e.unregister()})}),"caches"in window&&caches.keys().then(e=>{e.forEach(e=>{caches.delete(e)})})}catch(t){}else try{!function({path:e="/service-worker.js",onNewVersion:t}={}){"serviceWorker"in navigator&&(window.__swUpdateState={awaitingActivation:!1},navigator.serviceWorker.register(e).then(e=>{const n=()=>{try{if(e.waiting)e.waiting.postMessage({type:"SKIP_WAITING"});else if(e.installing){const t=e.installing;t.addEventListener("statechange",()=>{"installed"===t.state&&e.waiting&&e.waiting.postMessage({type:"SKIP_WAITING"})})}else navigator.serviceWorker?.controller&&navigator.serviceWorker.controller.postMessage({type:"SKIP_WAITING"})}catch{}};e.waiting&&(window.__swUpdateState.awaitingActivation=!0,t&&t({skipWaiting:n})),e.addEventListener("updatefound",function(){const r=e.installing;r&&r.addEventListener("statechange",()=>{"installed"===r.state&&navigator.serviceWorker.controller&&(window.__swUpdateState.awaitingActivation=!0,"function"==typeof t?t({skipWaiting:n}):setTimeout(()=>n(),3e3))})})}).catch(e=>{}))}({onNewVersion:({skipWaiting:e})=>{try{const t=()=>e();"function"==typeof window.Snackbar?window.Snackbar({message:"Nova versão disponível. Toque para atualizar.",type:"info",action:{label:"Atualizar",handler:t},duration:1e4}):confirm("Nova versão disponível. Atualizar agora?")&&t()}catch{}}}),function({onReload:e}={}){if(!navigator.serviceWorker)return;let t=!1;const n=()=>{t||(t=!0,"function"==typeof e?e():window.location.reload())};navigator.serviceWorker.addEventListener("controllerchange",()=>{n()}),setTimeout(()=>{window.__swUpdateState?.awaitingActivation&&n()},4e3)}()}catch(t){Ly.warn("Falha ao iniciar fluxo de SW update:",t)}let r=null;try{const e=Hy(),t=new Promise(e=>{setTimeout(()=>{e(null)},2e3)});r=await Promise.race([e,t])}catch(e){Ly.warn("❌ [Bootstrap] Erro ao aguardar autenticação:",e),r=null}r||(window.appState&&window.appState.currentUser?(r=window.appState.currentUser,Ly.info("Usuário encontrado no estado global:",r.email)):Ly.warn("Usuário não autenticado — seguindo com modo limitado")),yv.user=r;try{"undefined"!=typeof window&&(window.appState=window.appState||{},window.appState.currentUser=r||null)}catch{}if(r){Ly.info("Usuário autenticado:",r.uid);try{const e=document.querySelector(".app-container"),t=document.getElementById("login-page"),n=document.getElementById("loading-page");e&&(e.style.display="flex"),t&&(t.style.display="none"),n&&(n.style.display="none")}catch{}try{const{default:e}=await n(async()=>{const{default:e}=await import("./resilientClient-DTyPV8Bx.js");return{default:e}},__vite__mapDeps([7,8,2])),{default:r}=await n(async()=>{const{default:e}=await import("./ResilientAuthService-zFN0-MN9.js");return{default:e}},__vite__mapDeps([9,8]));try{await e.initialize()}catch(t){}try{const{auth:e}=await n(async()=>{const{auth:e}=await Promise.resolve().then(()=>ng);return{auth:e}},void 0);await r.initialize(e)}catch(t){}}catch(e){}}else Ly.info("Sem usuário autenticado");if(r){try{const n=async function(n){try{const e=await av(n);if(e.length>0){let r=e[0];try{const t=localStorage.getItem("currentBudgetId");if(t){const n=e.find(e=>e.id===t);n?(r=n,Ly.info("Orçamento restaurado na inicialização:",r.nome)):Ly.warn("Orçamento salvo não encontrado, usando primeiro disponível")}}catch(t){Ly.warn("Erro ao restaurar orçamento do localStorage:",t)}yv.currentBudget=r;try{"undefined"!=typeof window&&(window.appState=window.appState||{},window.appState.currentBudget=r)}catch{}sv(r);const[i,a]=await Promise.all([yg(r.id,n),Lg(r.id)]);yv.transactions=i,yv.categories=a;try{gv("transactions:updated",{budgetId:r.id,transactions:i})}catch{}try{gv("categories:updated",{budgetId:r.id,categories:a})}catch{}}Ly.info("Dados iniciais carregados")}catch(e){throw Ly.error("Erro ao carregar dados iniciais:",e),e}}(r.uid),i=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Timeout ao carregar dados iniciais"))},1e4)});await Promise.race([n,i])}catch(t){Ly.warn("❌ [Bootstrap] Falha ao carregar dados iniciais:",t?.message||t);try{window?.Snackbar&&window.Snackbar({message:"Falha ao carregar dados. Tentando continuar...",type:"warning"})}catch{}}try{bv(r.uid)}catch(t){Ly.warn("❌ [Bootstrap] Falha ao iniciar listeners:",t?.message||t)}}Ly.info("Configurando listeners de eventos..."),mg.on("notification:show",({message:e,type:t})=>{Ly.info(`Notificação [${t}]: ${e}`)}),mg.on("modal:show",async(e={})=>{try{const{content:i,options:a={},title:o,type:s,data:c}=e,d=o||s||(i?"[conteúdo HTML]":"sem conteúdo");if(Ly.info("Modal solicitado:",d),i){const e=iw({title:a.title||o||"Informação",content:i,onClose:()=>e.remove()});return void document.body.appendChild(e)}if("transaction"===s){if("function"==typeof window.showAddTransactionModal)return void window.showAddTransactionModal(c||{});try{if(await n(()=>Promise.resolve().then(()=>_w),void 0),"function"==typeof window.showAddTransactionModal)return void window.showAddTransactionModal(c||{})}catch(t){}}if("category"===s)try{const{default:e}=await n(async()=>{const{default:e}=await Promise.resolve().then(()=>vw);return{default:e}},void 0);return"function"!=typeof window.showAddCategoryModal&&(window.showAddCategoryModal=e),void e(c||{})}catch(t){}if("recorrente"===s)try{if(window._processingRecorrenteModal)return;if(window._processingRecorrenteModal=!0,window._processingRecorrenteModal=!1,"function"==typeof window.showAddRecorrenteModal)return window.showAddRecorrenteModal(c);{try{const e=(await n(async()=>{const{default:e}=await Promise.resolve().then(()=>Ew);return{default:e}},void 0)).default;if(e)return e(c)}catch(r){}const{Snackbar:e}=await n(async()=>{const{Snackbar:e}=await Promise.resolve().then(()=>ww);return{Snackbar:e}},void 0);return void e({message:"Erro ao carregar modal de recorrente",type:"error"})}}catch(t){window._processingRecorrenteModal=!1}Uy("Não foi possível abrir o modal solicitado","error")}catch(i){Ly.error("Falha ao processar modal:show",i),Uy("Erro ao abrir modal","error")}}),mg.on("modal:hide",()=>{Ly.info("Modal escondido")}),mg.on("snackbar:show",({message:e,type:t})=>{Ly.info(`Snackbar [${t}]: ${e}`)}),mg.on("transaction:added",e=>{Ly.info("Transação adicionada:",e.id),Uy("Transação adicionada com sucesso","success")}),mg.on("transaction:updated",({id:e})=>{Ly.info("Transação atualizada:",e),Uy("Transação atualizada com sucesso","success")}),mg.on("transaction:deleted",({id:e})=>{Ly.info("Transação removida:",e),Uy("Transação removida com sucesso","success")}),mg.on("budget:created",e=>{Ly.info("Orçamento criado:",e.id),Uy("Orçamento criado com sucesso","success")}),mg.on("budget:updated",({id:e})=>{Ly.info("Orçamento atualizado:",e),Uy("Orçamento atualizado com sucesso","success")}),mg.on("budget:deleted",({id:e})=>{Ly.info("Orçamento removido:",e),Uy("Orçamento removido com sucesso","success")}),mg.on("category:created",e=>{try{const t="string"==typeof e?e:e?.id;Ly.info("Categoria criada:",t||"[sem id]")}catch{Ly.warn("Evento category:created com payload inesperado:",e)}Uy("Categoria criada com sucesso","success")}),mg.on("category:updated",({id:e})=>{Ly.info("Categoria atualizada:",e),Uy("Categoria atualizada com sucesso","success")}),mg.on("category:deleted",({id:e})=>{Ly.info("Categoria removida:",e),Uy("Categoria removida com sucesso","success")}),mg.on("transaction:recurring:applied",e=>{Ly.info("Recorrente aplicada:",e.id),Uy("Despesa recorrente aplicada","info")}),mg.on("error:transaction",e=>{Ly.error("Erro em transação:",e),Uy("Erro ao processar transação","error")}),mg.on("error:budget",e=>{Ly.error("Erro em orçamento:",e),Uy("Erro ao processar orçamento","error")}),mg.on("error:category",e=>{Ly.error("Erro em categoria:",e),Uy("Erro ao processar categoria","error")}),mg.on("auth:login",e=>{Ly.info("Usuário logado:",e.uid),Uy("Login realizado com sucesso","success")}),mg.on("auth:logout",()=>{Ly.info("Usuário deslogado"),Uy("Logout realizado","info")}),mg.on("auth:error",e=>{Ly.error("Erro de autenticação:",e),Uy("Erro de autenticação","error")}),mg.on("app:ready",e=>{Ly.info("Aplicação pronta:",e)}),mg.on("app:error",e=>{Ly.error("Erro na aplicação:",e),Uy("Erro ao carregar aplicação","error")}),Ly.info("Listeners de eventos configurados"),mg.on("budget:changed",e=>{yv.currentBudget=e;try{"undefined"!=typeof window&&(window.appState=window.appState||{},window.appState.currentBudget=e||null)}catch{}Ly.info("Orçamento alterado:",e?.id);try{if(e?.id){try{bg()}catch{}try{Ug()}catch{}yv.transactions=[],yv.categories=[];try{"undefined"!=typeof window&&(window.appState.transactions=[],window.appState.categories=[])}catch{}const r=yv.user?.uid;Promise.all([yg(e.id,r),Lg(e.id)]).then(async([t,i])=>{yv.transactions=t,yv.categories=i;try{mg.emit("transactions:updated",{budgetId:e.id,transactions:t})}catch{}try{mg.emit("categories:updated",{budgetId:e.id,categories:i})}catch{}try{vg(e.id,r)}catch{}try{Mg(e.id)}catch{}try{Vy("/dashboard")}catch{try{window.location.hash="#/dashboard"}catch{}}try{const{scrollToTop:e}=await n(async()=>{const{scrollToTop:e}=await Promise.resolve().then(()=>qy);return{scrollToTop:e}},void 0);e()}catch{}try{"function"==typeof window.renderDashboard&&window.renderDashboard()}catch{}}).catch(e=>Ly.warn("Falha ao recarregar dados no budget:changed:",e)),async function(e){try{const r=yv?.user?.uid||yv?.currentUser?.uid;if(!r||!e)return;const i=new Date,a=`legacyfix:${r}:${e}:${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`;if("done"===localStorage.getItem(a))return;try{const e=await n(()=>import("./fixers-CXVIOlxj.js"),__vite__mapDeps([10,2]));await e.corrigirTudoSemBudget({silent:!0})}catch(t){}localStorage.setItem(a,"done")}catch(t){}}(e.id)}}catch{}}),mg.on("transactions:updated",(e={})=>{try{const t=e.budgetId??yv.currentBudget?.id,n=e.transactions??yv.transactions;t&&yv.currentBudget?.id===t&&Array.isArray(n)&&(yv.transactions=n),e.__syncRemote||gv("transactions:updated",e)}catch(t){Ly.warn("transactions:updated handler skipped:",t)}}),mg.on("categories:updated",(e={})=>{try{const t=e.budgetId??yv.currentBudget?.id,n=e.categories??yv.categories;t&&yv.currentBudget?.id===t&&Array.isArray(n)&&(yv.categories=n),e.__syncRemote||gv("categories:updated",e)}catch(t){Ly.warn("categories:updated handler skipped:",t)}}),mg.on("error:transaction",e=>{Ly.error("Erro em transação:",e)}),mg.on("error:budget",e=>{Ly.error("Erro em orçamento:",e)}),mg.on("error:category",e=>{Ly.error("Erro em categoria:",e)}),Ly.info("Aplicação inicializada com sucesso"),mg.emit("app:ready",yv)}catch(e){Ly.error("Erro ao inicializar aplicação:",e),yv.error=e.message,mg.emit("app:error",e)}}async function bv(e){if(yv.currentBudget){const n=yv.currentBudget.id;try{await tg,Ly.info("Firebase Auth pronto, iniciando listeners...")}catch(t){Ly.warn("Erro ao aguardar authReady:",t?.message||t)}try{ov(e)}catch(t){Ly.warn("Listener budgets falhou:",t?.message||t)}try{vg(n,e)}catch(t){Ly.warn("Listener transactions falhou:",t?.message||t)}try{Mg(n)}catch(t){Ly.warn("Listener categories falhou:",t?.message||t)}try{wy(e),Ly.info("Listener de notificações iniciado")}catch(t){Ly.warn("Listener notifications falhou:",t?.message||t)}try{await Cy(),Ly.info("Sistema de catch-up de notificações iniciado")}catch(t){Ly.warn("Sistema de catch-up falhou:",t?.message||t)}Ly.info("Listeners em tempo real iniciados")}}async function _v(e){try{if(!e)return;yv.user=e;try{"undefined"!=typeof window&&(window.appState=window.appState||{},window.appState.currentUser=e)}catch{}if(!yv.currentBudget)try{const t=await av(e.uid);if(t.length>0){const e=localStorage.getItem("currentBudgetId");let n=t[0];if(e){const r=t.find(t=>t.id===e);r?(n=r,Ly.info("Orçamento restaurado:",n.nome)):Ly.warn("Orçamento salvo não encontrado, usando primeiro disponível")}yv.currentBudget=n;try{"undefined"!=typeof window&&(window.appState=window.appState||{},window.appState.currentBudget=n)}catch{}sv(n)}}catch(t){Ly.warn("Falha ao carregar orçamentos pós-login:",t?.message||t)}const n=yv.currentBudget?.id;if(n){try{"undefined"!=typeof window&&(window.appState=window.appState||{},window.appState.currentBudget=yv.currentBudget)}catch{}const[t,r]=await Promise.all([yg(n,e.uid),Lg(n)]);yv.transactions=t,yv.categories=r;try{mg.emit("transactions:updated",{budgetId:n,transactions:t})}catch{}try{mg.emit("categories:updated",{budgetId:n,categories:r})}catch{}bv(e.uid)}try{wy(e.uid),Ly.info("Listener de notificações iniciado após login")}catch(t){Ly.warn("Listener notifications falhou após login:",t?.message||t)}try{await Cy(),Ly.info("Sistema de catch-up de notificações iniciado após login")}catch(t){Ly.warn("Sistema de catch-up falhou após login:",t?.message||t)}Ly.info("Realtime ativado após login")}catch(n){Ly.error("Erro ao ativar realtime pós-login:",n)}}function Iv(){Ly.info("Limpando recursos da aplicação..."),dv(),bg(),Ug(),mg.off("budget:changed"),mg.off("transactions:updated"),mg.off("categories:updated"),mg.off("error:transaction"),mg.off("error:budget"),mg.off("error:category"),Ly.info("Limpando listeners de eventos..."),mg.off("notification:show"),mg.off("modal:show"),mg.off("modal:hide"),mg.off("snackbar:show"),mg.off("transaction:added"),mg.off("transaction:updated"),mg.off("transaction:deleted"),mg.off("budget:created"),mg.off("budget:updated"),mg.off("budget:deleted"),mg.off("category:created"),mg.off("category:updated"),mg.off("category:deleted"),mg.off("transaction:recurring:applied"),mg.off("error:transaction"),mg.off("error:budget"),mg.off("error:category"),mg.off("auth:login"),mg.off("auth:logout"),mg.off("auth:error"),mg.off("app:ready"),mg.off("app:error"),Ly.info("Listeners de eventos limpos"),Ly.info("Recursos limpos")}"undefined"!=typeof window&&(window.appState=yv);const Ev=Object.freeze(Object.defineProperty({__proto__:null,activateRealtimeAfterLogin:_v,appState:yv,cleanup:Iv,initializeApp:vv},Symbol.toStringTag,{value:"Module"}));function Tv(){return window.Snackbar&&"function"==typeof window.Snackbar?{success:e=>{try{window.Snackbar({message:e,type:"success",duration:3e3})}catch(t){alert("✅ "+e)}},error:e=>{try{window.Snackbar({message:e,type:"error",duration:3e3})}catch(t){alert("❌ "+e)}},info:e=>{try{window.Snackbar({message:e,type:"info",duration:3e3})}catch(t){alert("ℹ️ "+e)}},warning:e=>{try{window.Snackbar({message:e,type:"warning",duration:3e3})}catch(t){alert("⚠️ "+e)}}}:{success:e=>{alert("✅ "+e)},error:e=>{alert("❌ "+e)},info:e=>{alert("ℹ️ "+e)},warning:e=>{alert("⚠️ "+e)}}}function Sv(){if("function"==typeof window.applySimpleSnackbarConfig)window.applySimpleSnackbarConfig();else{const e=document.createElement("script");e.src="/src/js/config/simple-snackbar-config.js",e.onload=()=>{"function"==typeof window.applySimpleSnackbarConfig&&window.applySimpleSnackbarConfig()},document.head.appendChild(e)}}function kv(e){if(e){document.body.classList.add("compact-mode"),document.body.setAttribute("data-compact-mode","enabled");const e=localStorage.getItem("compactMode");e&&(document.body.classList.add(`${e}-mode`),document.body.setAttribute("data-compact-size",e))}else document.body.classList.remove("compact-mode","micro-mode","nano-mode"),document.body.removeAttribute("data-compact-mode"),document.body.removeAttribute("data-compact-size")}function Av(e){document.body.classList.remove("micro-mode","nano-mode"),e&&"normal"!==e?(document.body.classList.add(`${e}-mode`),document.body.setAttribute("data-compact-size",e),localStorage.setItem("compactMode",e)):(document.body.removeAttribute("data-compact-size"),localStorage.removeItem("compactMode"))}async function Cv(){return n(()=>import("./settings.service-y0DMkajC.js"),__vite__mapDeps([11,2]))}function xv(){const e=document.getElementById("update-modal-modern");e&&e.remove(),document.body.insertAdjacentHTML("beforeend",'\n    <div id="update-modal-modern" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">\n      <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl">\n        \x3c!-- Header --\x3e\n        <div class="text-center p-6 border-b border-gray-200 dark:border-gray-700">\n          <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">\n            <span class="text-3xl text-white">🆕</span>\n          </div>\n          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Atualização Disponível</h2>\n          <p class="text-gray-600 dark:text-gray-400 text-sm">Uma nova versão está pronta para ser instalada</p>\n        </div>\n\n        \x3c!-- Content --\x3e\n        <div class="p-6 space-y-4">\n          \x3c!-- Atualização --\x3e\n          <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 p-4 rounded-xl border border-green-200 dark:border-green-700">\n            <div class="flex items-center gap-3 mb-3">\n              <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-lg text-white">🔄</span>\n              </div>\n              <h3 class="font-semibold text-green-800 dark:text-green-200">Nova Versão</h3>\n            </div>\n            <p class="text-sm text-green-700 dark:text-green-300 mb-3">\n              Uma nova versão do aplicativo está disponível com melhorias e correções.\n            </p>\n          </div>\n\n          \x3c!-- Novidades --\x3e\n          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 p-4 rounded-xl border border-blue-200 dark:border-blue-700">\n            <div class="flex items-center gap-3 mb-3">\n              <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-lg text-white">✨</span>\n              </div>\n              <h3 class="font-semibold text-blue-800 dark:text-blue-200">O que há de novo</h3>\n            </div>\n            <div class="space-y-2 text-sm text-blue-700 dark:text-blue-300">\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                <span class="font-medium">⚡</span> Melhorias de performance\n              </div>\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                <span class="font-medium">🐛</span> Correções de bugs\n              </div>\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                <span class="font-medium">🎯</span> Novas funcionalidades\n              </div>\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                <span class="font-medium">🔒</span> Otimizações de segurança\n              </div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Footer --\x3e\n        <div class="p-6 border-t border-gray-200 dark:border-gray-700 flex gap-3">\n          <button id="update-now-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md">\n            🔄 Atualizar Agora\n          </button>\n          <button id="update-later-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md">\n            ⏰ Mais Tarde\n          </button>\n        </div>\n      </div>\n    </div>\n  ');const t=document.getElementById("update-modal-modern"),n=document.getElementById("update-now-btn"),r=document.getElementById("update-later-btn");function i(){t&&t.remove()}n&&n.addEventListener("click",()=>{window.location.reload()}),r&&r.addEventListener("click",i),t&&t.addEventListener("click",e=>{e.target===t&&i()})}window.acceptInvitation=async function(e){if(e)try{(await Cv()).acceptBudgetInvitation(e),Tv().success("Convite aceito"),window.dispatchEvent(new CustomEvent("invitation:changed"))}catch{Tv().error("Falha ao aceitar convite")}},window.declineInvitation=async function(e){if(e)try{(await Cv()).declineBudgetInvitation(e),Tv().info("Convite recusado"),window.dispatchEvent(new CustomEvent("invitation:changed"))}catch{Tv().error("Falha ao recusar convite")}},window.cancelSentInvitation=async function(e){if(e)try{(await Cv()).cancelSentInvitation(e),Tv().info("Convite cancelado"),window.dispatchEvent(new CustomEvent("invitation:changed"))}catch{Tv().error("Erro ao cancelar")}},window.removeUserFromBudget=async function(e){try{const{appState:t}=window;if(!t?.currentBudget?.id)throw new Error("Orçamento inválido");if(!e)return;if(!confirm("Remover este usuário do orçamento?"))return;(await Cv()).removeUserFromBudget(t.currentBudget.id,e),Tv().success("Usuário removido"),window.dispatchEvent(new CustomEvent("budget:changed"))}catch{Tv().error("Erro ao remover usuário")}},window.updateBudgetName=async function(e){try{const{appState:t}=window,n=(e||"").trim();if(!n)return Tv().warning("Nome vazio");if(!t?.currentBudget?.id)throw new Error("Sem orçamento");(await Cv()).updateBudgetName(t.currentBudget.id,n),Tv().success("Nome atualizado"),window.dispatchEvent(new CustomEvent("budget:changed"))}catch{Tv().error("Erro ao renomear")}},window.enterBudget=async function(e,t){try{if(!e)return Tv().error("ID do orçamento inválido");window.__changingBudget=!0;const t=await n(()=>Promise.resolve().then(()=>uv),void 0),r=await t.getById(e);if(!r)return window.__changingBudget=!1,Tv().error("Orçamento não encontrado");try{window.location.hash="#/dashboard"}catch{}await new Promise(e=>setTimeout(e,50));if(!t.ensureBudgetPersistence(r))return window.__changingBudget=!1,Tv().error("Erro ao salvar seleção do orçamento");Tv().success(`Entrando no orçamento: ${r.nome}`),await new Promise(e=>setTimeout(e,100)),window.__changingBudget=!1}catch(r){window.__changingBudget=!1,Tv().error("Erro ao entrar no orçamento: "+r.message)}},window.toggleThemeColor=function(e){try{if(!e)return;localStorage.setItem("themeColor",e),document.documentElement.setAttribute("data-theme-color",e),Tv().info("Cor aplicada")}catch{}},window.copyAppInfo=function(){try{let e=function(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),Tv().success("Informações do app copiadas!")}catch(n){Tv().error("Erro ao copiar informações")}document.body.removeChild(t)};const t={app:{versao:"4.3.0",swVersao:"v4.2.9",cacheEstatico:"financeiro-static-v4.2.9",cacheDinamico:"financeiro-dynamic-v4.2.9",desenvolvedor:"Igor Bispo",tecnologias:"Firebase, JavaScript, PWA",ultimaAtualizacao:"Setembro 2025"},dispositivo:{userAgent:navigator.userAgent,plataforma:navigator.platform,idioma:navigator.language,online:navigator.onLine},configuracoes:{tema:document.documentElement.classList.contains("dark")?"dark":"light",corTema:localStorage.getItem("themeColor")||"default",animacoes:"false"!==localStorage.getItem("animationsEnabled"),telemetria:"true"===localStorage.getItem("perfTelemetry"),biometria:"true"===localStorage.getItem("biometricAuth"),autoSync:"true"===localStorage.getItem("autoSync"),analytics:"true"===localStorage.getItem("analyticsEnabled")},usuario:{uid:window.appState?.currentUser?.uid||null,email:window.appState?.currentUser?.email||null,ultimaVerificacao:(new Date).toLocaleString("pt-BR")}},n=JSON.stringify(t,null,2);navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n).then(()=>{Tv().success("Informações do app copiadas!")}).catch(t=>{e(n)}):e(n)}catch(e){Tv().error("Falha ao copiar informações")}},window.clearOfflineCache=function(){const e=document.getElementById("clear-cache-modal-modern");e&&e.remove(),document.body.insertAdjacentHTML("beforeend",'\n    <div id="clear-cache-modal-modern" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">\n      <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl">\n        \x3c!-- Header --\x3e\n        <div class="text-center p-6 border-b border-gray-200 dark:border-gray-700">\n          <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-red-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">\n            <span class="text-3xl text-white">🗑️</span>\n          </div>\n          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Limpar Cache Offline</h2>\n          <p class="text-gray-600 dark:text-gray-400 text-sm">Remover dados temporários armazenados</p>\n        </div>\n\n        \x3c!-- Content --\x3e\n        <div class="p-6 space-y-4">\n          \x3c!-- Aviso --\x3e\n          <div class="bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/30 dark:to-orange-900/30 p-4 rounded-xl border border-yellow-200 dark:border-yellow-700">\n            <div class="flex items-center gap-3 mb-3">\n              <div class="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-lg text-white">⚠️</span>\n              </div>\n              <h3 class="font-semibold text-yellow-800 dark:text-yellow-200">Atenção</h3>\n            </div>\n            <p class="text-sm text-yellow-700 dark:text-yellow-300">\n              Isso pode afetar temporariamente a performance do app até que os dados sejam recarregados.\n            </p>\n          </div>\n\n          \x3c!-- O que será removido --\x3e\n          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 p-4 rounded-xl border border-blue-200 dark:border-blue-700">\n            <div class="flex items-center gap-3 mb-3">\n              <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-lg text-white">📦</span>\n              </div>\n              <h3 class="font-semibold text-blue-800 dark:text-blue-200">O que será removido</h3>\n            </div>\n            <div class="space-y-2 text-sm text-blue-700 dark:text-blue-300">\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                <span class="font-medium">💾</span> Caches do Service Worker\n              </div>\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                <span class="font-medium">📁</span> Dados temporários\n              </div>\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                <span class="font-medium">🗄️</span> IndexedDB de cache\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Nota --\x3e\n          <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg border border-green-200 dark:border-green-700">\n            <p class="text-xs text-green-700 dark:text-green-300">\n              <strong>✅ Seus dados estão seguros:</strong> Transações, categorias e orçamentos não serão afetados.\n            </p>\n          </div>\n        </div>\n\n        \x3c!-- Footer --\x3e\n        <div class="p-6 border-t border-gray-200 dark:border-gray-700 flex gap-3">\n          <button id="cancel-clear-cache-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md">\n            Cancelar\n          </button>\n          <button id="confirm-clear-cache-btn" class="flex-1 bg-orange-600 hover:bg-orange-700 text-white font-medium py-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md">\n            Limpar Cache\n          </button>\n        </div>\n      </div>\n    </div>\n  ');const t=document.getElementById("clear-cache-modal-modern"),n=document.getElementById("cancel-clear-cache-btn"),r=document.getElementById("confirm-clear-cache-btn");function i(){t&&t.remove()}n&&n.addEventListener("click",i),r&&r.addEventListener("click",()=>{i(),function(){try{let e=0,t=0;"caches"in window?caches.keys().then(n=>{const r=n.map(t=>caches.delete(t).then(t=>(t&&e++,t)));Promise.all(r).then(()=>{if(Object.keys(localStorage).filter(e=>e.includes("cache")||e.includes("static")||e.includes("dynamic")||e.includes("offline")).forEach(e=>{localStorage.removeItem(e),t++}),"indexedDB"in window)try{indexedDB.deleteDatabase("financeiro-cache")}catch(n){}Tv().success(`Cache limpo! Removidos ${e} caches e ${t} dados locais.`)}).catch(e=>{Tv().error("Erro ao limpar alguns caches")})}):Tv().warning("Cache API não disponível neste navegador")}catch(e){Tv().error("Erro ao limpar cache")}}()}),t&&t.addEventListener("click",e=>{e.target===t&&i()})},window.openHelp=function(){const e=document.getElementById("help-modal-modern");e&&e.remove(),document.body.insertAdjacentHTML("beforeend",'\n    <div id="help-modal-modern" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">\n      <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl">\n        \x3c!-- Header --\x3e\n        <div class="text-center p-6 border-b border-gray-200 dark:border-gray-700">\n          <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">\n            <span class="text-3xl text-white">❓</span>\n          </div>\n          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Ajuda e Suporte</h2>\n          <p class="text-gray-600 dark:text-gray-400 text-sm">Estamos aqui para ajudar você</p>\n        </div>\n\n        \x3c!-- Content --\x3e\n        <div class="p-6 space-y-4">\n          \x3c!-- Canais de Suporte --\x3e\n          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 p-4 rounded-xl border border-blue-200 dark:border-blue-700">\n            <div class="flex items-center gap-3 mb-3">\n              <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-lg text-white">💬</span>\n              </div>\n              <h3 class="font-semibold text-blue-800 dark:text-blue-200">Canais de Suporte</h3>\n            </div>\n            <div class="space-y-2 text-sm">\n              <a href="mailto:suporte@financeiro.app" class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">\n                <span class="text-blue-600 dark:text-blue-400 text-lg">📧</span>\n                <div>\n                  <p class="font-medium text-gray-700 dark:text-gray-300">Email</p>\n                  <p class="text-gray-600 dark:text-gray-400 text-xs">suporte@financeiro.app</p>\n                </div>\n              </a>\n              <a href="https://wa.me/5511999999999" target="_blank" class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">\n                <span class="text-green-600 dark:text-green-400 text-lg">💬</span>\n                <div>\n                  <p class="font-medium text-gray-700 dark:text-gray-300">WhatsApp</p>\n                  <p class="text-gray-600 dark:text-gray-400 text-xs">(11) 99999-9999</p>\n                </div>\n              </a>\n            </div>\n          </div>\n\n          \x3c!-- Perguntas Frequentes --\x3e\n          <div class="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/30 dark:to-pink-900/30 p-4 rounded-xl border border-purple-200 dark:border-purple-700">\n            <div class="flex items-center gap-3 mb-3">\n              <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-lg text-white">📚</span>\n              </div>\n              <h3 class="font-semibold text-purple-800 dark:text-purple-200">Recursos Úteis</h3>\n            </div>\n            <div class="space-y-2 text-sm">\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                <span class="font-medium text-gray-700 dark:text-gray-300">📖</span> Guia de uso completo\n              </div>\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                <span class="font-medium text-gray-700 dark:text-gray-300">🎥</span> Tutoriais em vídeo\n              </div>\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                <span class="font-medium text-gray-700 dark:text-gray-300">💡</span> Dicas e truques\n              </div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Footer --\x3e\n        <div class="p-6 border-t border-gray-200 dark:border-gray-700">\n          <button id="close-help-modal" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md">\n            Fechar\n          </button>\n        </div>\n      </div>\n    </div>\n  ');const t=document.getElementById("help-modal-modern"),n=document.getElementById("close-help-modal");function r(){t&&t.remove()}n&&n.addEventListener("click",r),t&&t.addEventListener("click",e=>{e.target===t&&r()})},window.rateApp=function(){const e=document.getElementById("rate-modal-modern");e&&e.remove(),document.body.insertAdjacentHTML("beforeend",'\n    <div id="rate-modal-modern" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">\n      <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl">\n        \x3c!-- Header --\x3e\n        <div class="text-center p-6 border-b border-gray-200 dark:border-gray-700">\n          <div class="w-16 h-16 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">\n            <span class="text-3xl text-white">⭐</span>\n          </div>\n          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Avaliar Aplicativo</h2>\n          <p class="text-gray-600 dark:text-gray-400 text-sm">Sua opinião é muito importante para nós!</p>\n        </div>\n\n        \x3c!-- Content --\x3e\n        <div class="p-6 space-y-4">\n          \x3c!-- Mensagem --\x3e\n          <div class="bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/30 dark:to-orange-900/30 p-4 rounded-xl border border-yellow-200 dark:border-yellow-700">\n            <div class="flex items-center gap-3 mb-3">\n              <div class="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-lg text-white">💛</span>\n              </div>\n              <h3 class="font-semibold text-yellow-800 dark:text-yellow-200">Gostou do App?</h3>\n            </div>\n            <p class="text-sm text-yellow-700 dark:text-yellow-300">\n              Sua avaliação ajuda outros usuários a descobrir o app e nos motiva a continuar melhorando!\n            </p>\n          </div>\n\n          \x3c!-- Lojas --\x3e\n          <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 p-4 rounded-xl border border-green-200 dark:border-green-700">\n            <div class="flex items-center gap-3 mb-3">\n              <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-lg text-white">🏪</span>\n              </div>\n              <h3 class="font-semibold text-green-800 dark:text-green-200">Onde Avaliar</h3>\n            </div>\n            <div class="space-y-2">\n              <button onclick="window.open(\'https://play.google.com/store/apps/details?id=com.financeiro.app\', \'_blank\')" class="w-full bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">\n                <span class="text-green-600 dark:text-green-400 text-lg">🤖</span>\n                <div class="text-left flex-1">\n                  <p class="font-medium text-gray-700 dark:text-gray-300">Google Play</p>\n                  <p class="text-gray-600 dark:text-gray-400 text-xs">Para dispositivos Android</p>\n                </div>\n                <span class="text-gray-400">→</span>\n              </button>\n              <button onclick="window.open(\'https://apps.apple.com/app/financeiro/id123456789\', \'_blank\')" class="w-full bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm flex items-center gap-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">\n                <span class="text-blue-600 dark:text-blue-400 text-lg">🍎</span>\n                <div class="text-left flex-1">\n                  <p class="font-medium text-gray-700 dark:text-gray-300">App Store</p>\n                  <p class="text-gray-600 dark:text-gray-400 text-xs">Para dispositivos iOS</p>\n                </div>\n                <span class="text-gray-400">→</span>\n              </button>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Footer --\x3e\n        <div class="p-6 border-t border-gray-200 dark:border-gray-700">\n          <button id="close-rate-modal" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md">\n            Fechar\n          </button>\n        </div>\n      </div>\n    </div>\n  ');const t=document.getElementById("rate-modal-modern"),n=document.getElementById("close-rate-modal");function r(){t&&t.remove()}n&&n.addEventListener("click",r),t&&t.addEventListener("click",e=>{e.target===t&&r()})},window.showWhatsNew=async function(){try{let t=function(){s&&s.remove()};const{getLatestChangeLog:r}=await n(async()=>{const{getLatestChangeLog:e}=await import("./changelog-D22KMc1D.js");return{getLatestChangeLog:e}},[]),i=r();if(!i)return void e();const a=`\n      <div id="whats-new-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">\n        <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">\n          ${`\n      <div class="space-y-6">\n        \x3c!-- Header do Modal --\x3e\n        <div class="text-center pb-4 border-b border-gray-200 dark:border-gray-700">\n          <div class="w-16 h-16 bg-gradient-to-br from-violet-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">\n            <span class="text-3xl text-white">🚀</span>\n          </div>\n          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Novidades da Versão</h2>\n          <p class="text-gray-600 dark:text-gray-400">Confira as últimas melhorias e recursos</p>\n        </div>\n\n        \x3c!-- Changelog Principal --\x3e\n        <div class="bg-gradient-to-br from-violet-50 to-purple-100 dark:from-violet-900/30 dark:to-purple-800/20 p-6 rounded-xl border border-violet-200 dark:border-violet-700">\n          <div class="flex items-center gap-3 mb-4">\n            <div class="w-12 h-12 bg-violet-500 rounded-lg flex items-center justify-center shadow-md">\n              <span class="text-xl text-white">✨</span>\n            </div>\n            <div>\n              <h3 class="text-lg font-bold text-violet-800 dark:text-violet-200">${i.title}</h3>\n              <p class="text-sm text-violet-600 dark:text-violet-400">📅 ${i.date}</p>\n            </div>\n          </div>\n          <div class="space-y-3">\n            ${i.items.map(e=>`\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm">\n                <div class="flex items-start gap-3">\n                  <span class="text-violet-500 mt-1">🔹</span>\n                  <span class="text-gray-700 dark:text-gray-300">${e}</span>\n                </div>\n              </div>\n            `).join("")}\n          </div>\n        </div>\n\n        \x3c!-- Dica --\x3e\n        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/20 p-6 rounded-xl border border-blue-200 dark:border-blue-700">\n          <div class="flex items-center gap-3 mb-4">\n            <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center shadow-md">\n              <span class="text-xl text-white">💡</span>\n            </div>\n            <div>\n              <h3 class="text-lg font-bold text-blue-800 dark:text-blue-200">Dica Importante</h3>\n              <p class="text-sm text-blue-600 dark:text-blue-400">Informações sobre esta atualização</p>\n            </div>\n          </div>\n          <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">\n            <p class="text-gray-700 dark:text-gray-300">\n              Esta versão traz headers harmonizados em todas as abas, um modal de alertas interativo no Dashboard e otimizações mobile significativas. \n              O design agora está completamente unificado com melhor aproveitamento do espaço em dispositivos móveis.\n            </p>\n          </div>\n        </div>\n\n        \x3c!-- Ações --\x3e\n        <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/20 p-6 rounded-xl border border-green-200 dark:border-green-700">\n          <div class="flex items-center gap-3 mb-4">\n            <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center shadow-md">\n              <span class="text-xl text-white">🎯</span>\n            </div>\n            <div>\n              <h3 class="text-lg font-bold text-green-800 dark:text-green-200">Próximos Passos</h3>\n              <p class="text-sm text-green-600 dark:text-green-400">Aproveite ao máximo as novas funcionalidades</p>\n            </div>\n          </div>\n          <div class="grid grid-cols-2 gap-3">\n            <button id="go-to-dashboard-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-medium text-sm p-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md flex items-center gap-2">\n              <span>📊</span>\n              <span>Ver Dashboard</span>\n            </button>\n            <button id="understand-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-medium text-sm p-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md flex items-center gap-2">\n              <span>✅</span>\n              <span>Entendi</span>\n            </button>\n          </div>\n        </div>\n      </div>\n    `}\n          \x3c!-- Botão de fechar --\x3e\n          <div class="text-center p-6 border-t border-gray-200 dark:border-gray-700">\n            <button id="close-whats-new-modal" class="bg-gray-500 hover:bg-gray-600 text-white font-medium px-6 py-2 rounded-lg transition-all duration-200">\n              Fechar\n            </button>\n          </div>\n        </div>\n      </div>\n    `,o=document.getElementById("whats-new-modal");o&&o.remove(),document.body.insertAdjacentHTML("beforeend",a);const s=document.getElementById("whats-new-modal"),c=document.getElementById("close-whats-new-modal"),d=document.getElementById("go-to-dashboard-btn"),l=document.getElementById("understand-btn");c&&c.addEventListener("click",t),d&&d.addEventListener("click",()=>{t(),window.location.hash="#/dashboard"}),l&&l.addEventListener("click",t),s&&s.addEventListener("click",e=>{e.target===s&&t()})}catch(t){e()}function e(){alert('🆕 Novidades v4.43.0:\n\n🎨 Headers Harmonizados: Design unificado em todas as abas\n🎯 Seletor de Período Minimalista: Interface clean e compacta\n📱 Otimização Mobile: Espaçamentos melhorados para mobile\n👑 Card Proprietário Melhorado: Layout vertical mais claro\n🚨 Modal de Alertas Clicável: Clique em "Alertas" no Dashboard\n📊 Informações Detalhadas: Gasto, limite e percentual por categoria\n🎨 Interface Moderna: Barras de progresso animadas\n🔧 Eliminação de Redundâncias: Informações duplicadas removidas\n⚡ Event Handlers Precisos: Cliques corrigidos sem falsos positivos\n📋 Seção Resumo Otimizada: Layout mais limpo e organizado\n🚀 Performance Melhorada: Otimizações de cache e renderização')}},window.installApp=function(){try{if(window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone)return void Tv().info("O app já está instalado no seu dispositivo!");if(navigator.userAgent.includes("Chrome")||navigator.userAgent.includes("Edge")||navigator.userAgent.includes("Safari")||navigator.userAgent.includes("Android")||navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("iPad")){let e=function(){i&&i.remove()};const t='\n          <div id="install-app-modal-v105" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">\n            <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl">\n              \x3c!-- Header --\x3e\n              <div class="text-center p-6 border-b border-gray-200 dark:border-gray-700">\n                <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">\n                  <span class="text-3xl text-white">📱</span>\n                </div>\n                <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Instalar Aplicativo</h2>\n                <p class="text-gray-600 dark:text-gray-400 text-sm">Adicione à sua tela inicial para acesso rápido</p>\n              </div>\n\n              \x3c!-- Content --\x3e\n              <div class="p-6 space-y-4">\n                \x3c!-- Como instalar --\x3e\n                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 p-4 rounded-xl border border-blue-200 dark:border-blue-700">\n                  <div class="flex items-center gap-3 mb-3">\n                    <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center shadow-md">\n                      <span class="text-lg text-white">📲</span>\n                    </div>\n                    <h3 class="font-semibold text-blue-800 dark:text-blue-200">Como Instalar</h3>\n                  </div>\n                  <div class="space-y-3 text-sm">\n                    <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm">\n                      <p class="font-medium text-gray-700 dark:text-gray-300 mb-1">🌐 Chrome/Edge (Desktop)</p>\n                      <p class="text-gray-600 dark:text-gray-400 text-xs">Clique no ícone de instalação (➕) na barra de endereços</p>\n                    </div>\n                    <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm">\n                      <p class="font-medium text-gray-700 dark:text-gray-300 mb-1">🤖 Android</p>\n                      <p class="text-gray-600 dark:text-gray-400 text-xs">Menu (⋮) → "Instalar app" ou "Adicionar à tela inicial"</p>\n                    </div>\n                    <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm">\n                      <p class="font-medium text-gray-700 dark:text-gray-300 mb-1">🍎 Safari (iOS)</p>\n                      <p class="text-gray-600 dark:text-gray-400 text-xs">Compartilhar (⎙) → "Adicionar à Tela Inicial"</p>\n                    </div>\n                  </div>\n                </div>\n\n                \x3c!-- Benefícios --\x3e\n                <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 p-4 rounded-xl border border-green-200 dark:border-green-700">\n                  <div class="flex items-center gap-3 mb-3">\n                    <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center shadow-md">\n                      <span class="text-lg text-white">✨</span>\n                    </div>\n                    <h3 class="font-semibold text-green-800 dark:text-green-200">Benefícios</h3>\n                  </div>\n                  <div class="grid grid-cols-2 gap-2 text-xs">\n                    <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                      <span class="text-green-600 dark:text-green-400">🚀</span>\n                      <p class="text-gray-700 dark:text-gray-300 font-medium mt-1">Acesso Rápido</p>\n                    </div>\n                    <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                      <span class="text-blue-600 dark:text-blue-400">📡</span>\n                      <p class="text-gray-700 dark:text-gray-300 font-medium mt-1">Funciona Offline</p>\n                    </div>\n                    <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                      <span class="text-purple-600 dark:text-purple-400">🔔</span>\n                      <p class="text-gray-700 dark:text-gray-300 font-medium mt-1">Notificações</p>\n                    </div>\n                    <div class="bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm">\n                      <span class="text-orange-600 dark:text-orange-400">⚡</span>\n                      <p class="text-gray-700 dark:text-gray-300 font-medium mt-1">Performance</p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              \x3c!-- Footer --\x3e\n              <div class="p-6 border-t border-gray-200 dark:border-gray-700">\n                <button id="close-install-modal" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-medium py-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md">\n                  Entendi\n                </button>\n              </div>\n            </div>\n          </div>\n        ',n=document.getElementById("install-app-modal"),r=document.getElementById("install-app-modal-v105");n&&n.remove(),r&&r.remove(),document.body.insertAdjacentHTML("beforeend",t);const i=document.getElementById("install-app-modal-v105"),a=document.getElementById("close-install-modal");a&&a.addEventListener("click",e),i&&i.addEventListener("click",t=>{t.target===i&&e()})}else Tv().warning("Instalação não disponível neste navegador")}catch(e){Tv().error("Erro no processo de instalação")}},document.addEventListener("click",e=>{const t=e.target;if(t.closest("#fab-container-main")||"fab-main"===t.id||t.id?.startsWith("fab-"))return;let r=null;if("SPAN"!==t.tagName&&"SVG"!==t.tagName&&"PATH"!==t.tagName||!t.closest("button")?"BUTTON"===t.tagName&&(r=t):r=t.closest("button"),r){if(r.classList.contains("confirm-modal-confirm")||r.classList.contains("confirm-modal-cancel"))return;if("fab-main"===r.id||r.id?.startsWith("fab-")||r.closest("#fab-container-main"))return;const e=r.getAttribute("onclick");if(e)try{new Function(e).call(r)}catch(f){}}if(t.id,(t.textContent?.includes("🌙")||t.textContent?.includes("☀️"))&&"SPAN"===t.tagName&&t.parentElement?.classList?.contains("theme-toggle-btn")){const e=t.parentElement,n=document.documentElement.classList.contains("dark");if(n){document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light");const t=e.querySelector("span");t&&(t.textContent="🌙")}else{document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark");const t=e.querySelector("span");t&&(t.textContent="☀️")}return void(window.snk&&window.snk().success("Tema alterado para "+(n?"claro":"escuro")))}const i=t.textContent?.includes("Backup completo")||t.textContent?.includes("Importar Dados")||t.textContent?.includes("Limpar Dados")||t.textContent?.includes("Exportar Dados")||t.textContent?.includes("Restaurar backup")||t.textContent?.includes("Remover tudo")||t.textContent?.includes("Enviar Convite")||t.textContent?.includes("📤 Enviar")||t.textContent?.includes("Aceitar")||t.textContent?.includes("Recusar")||"export-data-btn"===t.id||"import-data-btn"===t.id||"share-budget-btn"===t.id||t.classList?.contains("accept-invitation-btn")||t.classList?.contains("decline-invitation-btn")||"clear-data-btn"===t.id||"btn-logout"===t.id||"limit-alerts-toggle"===t.id||"recurring-reminders-toggle"===t.id||"weekly-summary-toggle"===t.id||"toast-hover-pause"===t.id||"apply-toast-settings"===t.id||"reset-toast-settings"===t.id||"test-toast"===t.id||"debug-snackbar"===t.id||"test-direct"===t.id||"debug-complete"===t.id||"test-console"===t.id||"test-compact"===t.id||"test-days-chunk"===t.id||"test-animations"===t.id||"compact-mode-toggle"===t.id||"animations-toggle"===t.id||"performance-telemetry-toggle"===t.id||"biometric-auth-toggle"===t.id||"auto-sync-toggle"===t.id||"analytics-toggle"===t.id||"view-performance-events"===t.id||"save-days-chunk"===t.id||"reset-days-chunk"===t.id||"check-updates-btn"===t.id||t.closest("#check-updates-btn")||"help-support-btn"===t.id||t.closest("#help-support-btn")||"toggle-theme-btn"===t.id||t.classList?.contains("theme-toggle-btn")||t.classList?.contains("enter-budget-button")||t.classList?.contains("copy-budget-id-btn")||t.classList?.contains("delete-budget-btn")||t.classList?.contains("leave-budget-btn")||"enter-budget-button"===t.id||"enter-text"===t.id||t.classList?.contains("color-theme-btn")||t.classList?.contains("compact-size-btn")||t.textContent?.includes("Copiar Informações")||t.textContent?.includes("Limpar Cache Offline")||t.textContent?.includes("O que mudou")||t.textContent?.includes("Instalar App")||t.textContent?.includes("Copiar ID")||t.textContent?.includes("Excluir")||"Entrar"===t.textContent?.trim()||"Sair"===t.textContent?.trim()||"test-notifications-btn"===t.id||"install-app-btn"===t.id||t.textContent?.includes("Testar Notificações");if("btn-logout"===t.id||t.textContent?.trim(),"btn-logout"===t.id||"Sair"===t.textContent?.trim())return e.preventDefault(),e.stopPropagation(),void(confirm("Tem certeza que deseja sair? Você será deslogado do aplicativo.")?(Tv().info("Fazendo logout..."),"function"==typeof window.logout?window.logout():n(()=>import("./AuthService-DCnUDsIo.js"),__vite__mapDeps([12,2])).then(e=>{e.logout()}).catch(e=>{n(()=>Promise.resolve().then(()=>Ta),void 0).then(async({signOut:e})=>{try{const{auth:t}=await n(async()=>{const{auth:e}=await Promise.resolve().then(()=>ng);return{auth:e}},void 0);await e(t),Tv().success("Logout realizado com sucesso"),window.location.reload()}catch(t){Tv().error("Erro ao fazer logout")}}).catch(e=>{Tv().error("Erro: Sistema de autenticação não disponível")})})):Tv().info("Logout cancelado"));if(!i)return;if("checkbox"===t.type)return void setTimeout(()=>{!function(e){const t=e.checked;switch(e.id){case"limit-alerts-toggle":localStorage.setItem("noti_limit_alerts",t),Tv().success("Alertas de limite "+(t?"ativados":"desativados"));break;case"recurring-reminders-toggle":localStorage.setItem("noti_recurring_reminders",t),Tv().success("Lembretes recorrentes "+(t?"ativados":"desativados"));break;case"weekly-summary-toggle":localStorage.setItem("noti_weekly_summary",t),Tv().success("Resumo semanal "+(t?"ativado":"desativado"));break;case"toast-hover-pause":localStorage.setItem("toast_hover_pause",t),Sv(),Tv().success("Pausar toast no hover "+(t?"ativado":"desativado"));break;case"compact-mode-toggle":localStorage.setItem("compactModeEnabled",t),kv(t),Tv().success("Modo compacto "+(t?"ativado":"desativado"));break;case"animations-toggle":localStorage.setItem("animationsEnabled",t.toString()),t?document.body.classList.remove("no-animations"):document.body.classList.add("no-animations"),document.body.classList.contains("no-animations"),Tv().success("Animações "+(t?"ativadas":"desativadas"));break;case"performance-telemetry-toggle":localStorage.setItem("perfTelemetry",t.toString()),n(()=>import("./perf--GZdtUOV.js"),[]).then(e=>{e.setEnabled(t)}).catch(e=>{}),Tv().success("Telemetria de performance "+(t?"ativada":"desativada"));break;case"biometric-auth-toggle":t?window.nativeBiometric?window.nativeBiometric.isAvailable().then(t=>{if(t.isAvailable){const n=window.appState?.currentUser;if(n){window.nativeBiometric.saveCredentials(n.uid,{uid:n.uid,email:n.email,displayName:n.displayName,photoURL:n.photoURL}),localStorage.setItem("biometricAuth","true");const e="face-fingerprint"===t.biometryType?"Face ID ou Impressão Digital":"fingerprint"===t.biometryType?"Impressão Digital":"Biometria";Tv().success(`✅ ${e} ativado! Use para login rápido.`)}else e.checked=!1,Tv().error("❌ Faça login primeiro para ativar biometria")}else e.checked=!1,Tv().warning(`⚠️ ${t.reason}`)}).catch(t=>{e.checked=!1,Tv().error("❌ Erro ao verificar biometria")}):(e.checked=!1,Tv().warning("⚠️ Biometria não disponível (apenas no APK)")):(window.nativeBiometric&&window.nativeBiometric.clearCredentials(),localStorage.setItem("biometricAuth","false"),Tv().info("🔒 Autenticação biométrica desativada"));break;case"auto-sync-toggle":localStorage.setItem("autoSync",t.toString()),t?Tv().success("Sincronização automática ativada - dados serão sincronizados automaticamente"):Tv().info("Sincronização automática desativada - sincronização manual necessária");break;case"analytics-toggle":localStorage.setItem("analyticsEnabled",t.toString()),t?Tv().success("Analytics ativado - dados de uso serão coletados localmente"):Tv().info("Analytics desativado - nenhum dado de uso será coletado")}}(t)},0);e.preventDefault(),e.stopPropagation();const a=t.closest("[data-accept-inv]");if(a)return void window.acceptInvitation(a.getAttribute("data-accept-inv"));const o=t.closest("[data-decline-inv]");if(o)return void window.declineInvitation(o.getAttribute("data-decline-inv"));const s=t.closest("[data-cancel-inv]");if(s)return void window.cancelSentInvitation(s.getAttribute("data-cancel-inv"));const c=t.closest("[data-remove-user]");if(c)return void window.removeUserFromBudget(c.getAttribute("data-remove-user"));const d=t.closest(".enter-budget-button")||t.closest("#enter-budget-button");if(d){const e=d.getAttribute("data-budget-id"),t=d.getAttribute("data-budget-name");return void(e?window.enterBudget(e,t):Tv().error("Erro: ID do orçamento não encontrado"))}const l=t.closest(".copy-budget-id-btn");if(l){const e=l.getAttribute("data-budget-id");return void(e?window.copyBudgetId(e):Tv().error("Erro: ID do orçamento não encontrado"))}const u=t.closest(".delete-budget-btn");if(u){const e=u.getAttribute("data-budget-id"),t=u.getAttribute("data-budget-name");return void(e?window.deleteBudgetFromSettings(e,t):Tv().error("Erro: ID do orçamento não encontrado"))}const h=t.closest(".leave-budget-btn");if(h){const e=h.getAttribute("data-budget-id"),t=h.getAttribute("data-budget-name");return void(e?window.leaveBudget(e,t):Tv().error("Erro: ID do orçamento não encontrado"))}if("enter-budget-button"===t.id){const e=t.getAttribute("data-budget-id"),n=t.getAttribute("data-budget-name");return void(e?window.enterBudget(e,n):Tv().error("Erro: ID do orçamento não encontrado"))}if("Entrar"===t.textContent?.trim()||"enter-text"===t.id){const e=t.closest("button")||t.closest(".enter-budget-button")||t.closest("#enter-budget-button");if(e){const t=e.getAttribute("data-budget-id"),n=e.getAttribute("data-budget-name");t?window.enterBudget(t,n):Tv().error("Erro: ID do orçamento não encontrado")}else Tv().error("Erro: Botão pai não encontrado");return}const p=t.closest(".color-theme-btn");if(p){const e=p.getAttribute("data-theme");return void(e&&window.toggleThemeColor(e))}const m=t.closest(".compact-size-btn");if(m){const e=m.getAttribute("data-size");return void(e&&(Av(e),Tv().success(`Tamanho compacto: ${e}`)))}if("apply-toast-settings"===t.id){const e=document.getElementById("limit-alerts-toggle")?.checked||!1,t=document.getElementById("recurring-reminders-toggle")?.checked||!1,n=document.getElementById("weekly-summary-toggle")?.checked||!1,r=document.getElementById("toast-hover-pause")?.checked||!1;return localStorage.setItem("noti_limit_alerts",e),localStorage.setItem("noti_recurring_reminders",t),localStorage.setItem("noti_weekly_summary",n),localStorage.setItem("toast_hover_pause",r),Sv(),setTimeout(()=>{Sv()},100),setTimeout(()=>{if(window.Snackbar&&window.Snackbar.__getStatsForTest){window.Snackbar.__getStatsForTest()}},200),void Tv().success("Configurações de notificação aplicadas")}if("reset-toast-settings"===t.id)return document.getElementById("limit-alerts-toggle").checked=!0,document.getElementById("recurring-reminders-toggle").checked=!0,document.getElementById("weekly-summary-toggle").checked=!1,document.getElementById("toast-hover-pause").checked=!0,"function"==typeof window.resetSimpleSnackbarConfig&&window.resetSimpleSnackbarConfig(),void Tv().info("Configurações restauradas para o padrão");if("test-toast"===t.id)return void("function"==typeof window.testSimpleSnackbarConfig?window.testSimpleSnackbarConfig():Tv().info("Teste INFO - Sistema antigo!"));if("debug-snackbar"===t.id)return void(window.Snackbar?(window.Snackbar.info("Teste direto - INFO"),setTimeout(()=>{window.Snackbar.success("Teste direto - SUCCESS")},100),setTimeout(()=>{window.Snackbar.warning("Teste direto - WARNING")},200)):alert("ERRO: window.Snackbar não está disponível!"));if("test-direct"===t.id)return window.Snackbar&&window.Snackbar.info("Teste 1: INFO básico"),void(window.SnackbarInstance&&(window.SnackbarInstance.defaultDuration=5e3,window.SnackbarInstance.position="top",window.SnackbarInstance.align="right",setTimeout(()=>{window.Snackbar.success("Teste 2: SUCCESS com configurações modificadas")},100)));if("debug-complete"===t.id){const e=document.createElement("script");return e.src="/src/js/config/debug-snackbar.js",e.onload=()=>{"function"==typeof window.debugSnackbarSystem&&window.debugSnackbarSystem()},void document.head.appendChild(e)}if("test-console"===t.id)return localStorage.setItem("toastDuration","5000"),localStorage.setItem("toastPosition","top"),localStorage.setItem("toastAlignment","right"),void(window.SnackbarInstance&&(window.SnackbarInstance.defaultDuration=5e3,window.SnackbarInstance.position="top",window.SnackbarInstance.align="right",window.Snackbar.info("Teste final: Configurações aplicadas!")));if("test-compact"===t.id){return kv(!document.body.classList.contains("compact-mode")),setTimeout(()=>{Av("micro")},1e3),setTimeout(()=>{Av("nano")},2e3),void setTimeout(()=>{kv(!1)},3e3)}if("test-animations"===t.id){const e=document.body.classList.contains("no-animations");return e?(document.body.classList.remove("no-animations"),localStorage.setItem("animationsEnabled","true"),Tv().success("Animações ativadas para teste!"),setTimeout(()=>{Nv()},500)):(document.body.classList.add("no-animations"),localStorage.setItem("animationsEnabled","false"),Tv().info("Animações desativadas para teste!"),setTimeout(()=>{Nv()},500)),void setTimeout(()=>{e?(document.body.classList.add("no-animations"),localStorage.setItem("animationsEnabled","false")):(document.body.classList.remove("no-animations"),localStorage.setItem("animationsEnabled","true")),Tv().info("Estado das animações restaurado!")},3e3)}if("test-days-chunk"===t.id){const e=document.getElementById("days-chunk-size");if(e){const t=["","12","16","25","automático"];let n=0;const r=()=>{if(n<t.length){const i=t[n];e.value=i;const a=new Event("input",{bubbles:!0});e.dispatchEvent(a),n++,setTimeout(r,1e3)}else Tv().info("Teste do tamanho do bloco concluído!")};r()}else Tv().error("Erro: Campo de entrada não encontrado");return}if("save-days-chunk"===t.id){const e=document.getElementById("days-chunk-size");if(e){const t=e.value.trim();if(""===t||"automático"===t.toLowerCase())localStorage.removeItem("txChunkSize"),Tv().success("Modo automático ativado - sistema ajustará automaticamente");else{const e=parseInt(t);if(isNaN(e)||e<6||e>40)return void Tv().error("Valor inválido! Use um número entre 6 e 40 (recomendado 10-16)");localStorage.setItem("txChunkSize",e.toString()),Tv().success(`Tamanho do bloco definido para ${e} grupos de dias`)}}else Tv().error("Erro: Campo de entrada não encontrado");return}if("reset-days-chunk"===t.id){const e=document.getElementById("days-chunk-size");return void(e?(e.value="",localStorage.removeItem("txChunkSize"),Tv().info("Configuração restaurada para o padrão (automático)")):Tv().error("Erro: Campo de entrada não encontrado"))}if(t.closest("#whats-new-btn"))window.showWhatsNew();else if("whats-new-btn"!==t.id&&"whats-new"!==t.id)if("copy-info-btn"!==t.id)if("clear-cache-btn"!==t.id)if("install-app-btn"!==t.id)if(t.closest('[data-action="backup"]'))Tv().info("Funcionalidade de backup em desenvolvimento");else if(t.closest('[data-action="import"]'))Tv().info("Funcionalidade de importação em desenvolvimento");else if("export-data-btn"===t.id||t.closest("#export-data-btn")){Tv().info("Preparando exportação de dados...");try{const{currentUser:e,currentBudget:t}=window.appState||{};if(!e||!t)return void Tv().error("Usuário ou orçamento não encontrado");const n={metadata:{exportedAt:(new Date).toISOString(),version:"v4.40.0",userId:e.uid,budgetId:t.id,budgetName:t.nome},budget:t,transactions:window.appState?.transactions||[],categories:window.appState?.categories||[],recorrentes:window.appState?.recorrentes||[]},r=JSON.stringify(n,null,2),i=new Blob([r],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(i),a.download=`backup-${t.nome}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),Tv().success("Backup exportado com sucesso!")}catch(g){Tv().error("Erro ao exportar dados")}}else{if("import-data-btn"===t.id||t.closest("#import-data-btn")){const e=document.createElement("input");return e.type="file",e.accept=".json",e.onchange=async e=>{const t=e.target.files[0];if(t)try{let e=function(){a&&a.remove()};Tv().info("Lendo arquivo de backup...");const n=await t.text(),r=JSON.parse(n);if(!(r.metadata&&r.budget&&r.transactions&&r.categories))return void Tv().error("Arquivo de backup inválido");const i=`\n            <div id="import-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">\n              <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full p-6 shadow-2xl">\n                <div class="text-center mb-6">\n                  <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">\n                    <span class="text-3xl text-white">📥</span>\n                  </div>\n                  <h2 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-2">Confirmar Importação</h2>\n                  <p class="text-gray-600 dark:text-gray-400">Deseja importar os dados do backup?</p>\n                </div>\n                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg mb-6">\n                  <h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">📊 Dados encontrados:</h3>\n                  <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-1">\n                    <li>• <strong>Orçamento:</strong> ${r.budget.nome}</li>\n                    <li>• <strong>Transações:</strong> ${r.transactions.length} itens</li>\n                    <li>• <strong>Categorias:</strong> ${r.categories.length} itens</li>\n                    <li>• <strong>Recorrentes:</strong> ${r.recorrentes.length} itens</li>\n                    <li>• <strong>Data do backup:</strong> ${new Date(r.metadata.exportedAt).toLocaleDateString("pt-BR")}</li>\n                  </ul>\n                </div>\n                <div class="flex gap-3">\n                  <button id="cancel-import" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 rounded-lg transition-all duration-200">\n                    Cancelar\n                  </button>\n                  <button id="confirm-import" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-medium py-2 rounded-lg transition-all duration-200">\n                    Importar\n                  </button>\n                </div>\n              </div>\n            </div>\n          `;document.body.insertAdjacentHTML("beforeend",i);const a=document.getElementById("import-confirm-modal"),o=document.getElementById("cancel-import"),s=document.getElementById("confirm-import");o&&o.addEventListener("click",e),s&&s.addEventListener("click",()=>{e(),Tv().warning("Funcionalidade de importação em desenvolvimento")}),a&&a.addEventListener("click",t=>{t.target===a&&e()})}catch(g){Tv().error("Erro ao ler arquivo de backup")}},void e.click()}if("clear-data-btn"===t.id||t.closest("#clear-data-btn")){let e=function(){n&&n.remove()};const t='\n        <div id="clear-data-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">\n          <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-md w-full p-6 shadow-2xl">\n            <div class="text-center mb-6">\n              <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">\n                <span class="text-3xl text-white">⚠️</span>\n              </div>\n              <h2 class="text-xl font-bold text-red-800 dark:text-red-200 mb-2">Limpar Todos os Dados</h2>\n              <p class="text-gray-600 dark:text-gray-400">Esta ação é irreversível!</p>\n            </div>\n            <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg mb-6 border border-red-200 dark:border-red-700">\n              <h3 class="font-semibold text-red-800 dark:text-red-200 mb-2">🚨 Dados que serão removidos:</h3>\n              <ul class="text-sm text-red-700 dark:text-red-300 space-y-1">\n                <li>• Todas as transações</li>\n                <li>• Todas as categorias</li>\n                <li>• Todas as despesas recorrentes</li>\n                <li>• Configurações do orçamento</li>\n                <li>• Dados de compartilhamento</li>\n              </ul>\n            </div>\n            <div class="bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-lg mb-6 border border-yellow-200 dark:border-yellow-700">\n              <p class="text-xs text-yellow-700 dark:text-yellow-300">\n                <strong>💡 Dica:</strong> Faça um backup usando "Exportar Dados" antes de limpar.\n              </p>\n            </div>\n            <div class="flex gap-3">\n              <button id="cancel-clear" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 rounded-lg transition-all duration-200">\n                Cancelar\n              </button>\n              <button id="confirm-clear" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-medium py-2 rounded-lg transition-all duration-200">\n                Limpar Tudo\n              </button>\n            </div>\n          </div>\n        </div>\n      ';document.body.insertAdjacentHTML("beforeend",t);const n=document.getElementById("clear-data-modal"),r=document.getElementById("cancel-clear"),i=document.getElementById("confirm-clear");return r&&r.addEventListener("click",e),i&&i.addEventListener("click",()=>{e(),Tv().warning("Funcionalidade de limpeza de dados em desenvolvimento")}),void(n&&n.addEventListener("click",t=>{t.target===n&&e()}))}if(t.textContent?.includes("Backup completo"))Tv().info("Funcionalidade de backup em desenvolvimento");else if(t.textContent?.includes("Importar Dados"))Tv().info("Funcionalidade de importação em desenvolvimento");else{if(t.textContent?.includes("Verificar Atualizações"))return Tv().info("Verificando atualizações..."),void("serviceWorker"in navigator?navigator.serviceWorker.getRegistration().then(e=>{e?e.waiting?xv():e.installing?Tv().info("Atualização em andamento..."):e.update().then(()=>{e.waiting?xv():Tv().success("Você já está usando a versão mais recente!")}).catch(e=>{Tv().error("Erro ao verificar atualizações")}):Tv().info("Nenhum Service Worker encontrado")}).catch(e=>{Tv().error("Erro ao verificar atualizações")}):Tv().warning("Seu navegador não suporta atualizações automáticas"));if("help-support-btn"===t.id||t.closest("#help-support-btn")){let e=function(){r&&r.remove()};const t=`\n        <div id="help-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">\n          <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">\n            ${'\n        <div class="space-y-6">\n          \x3c!-- Header do Modal --\x3e\n          <div class="text-center pb-4 border-b border-gray-200 dark:border-gray-700">\n            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">\n              <span class="text-3xl text-white">🆘</span>\n            </div>\n            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">Central de Ajuda</h2>\n            <p class="text-gray-600 dark:text-gray-400">Estamos aqui para ajudar você!</p>\n          </div>\n\n          \x3c!-- Contato Direto --\x3e\n          <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/20 p-6 rounded-xl border border-blue-200 dark:border-blue-700">\n            <div class="flex items-center gap-3 mb-4">\n              <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-xl text-white">📞</span>\n              </div>\n              <div>\n                <h3 class="text-lg font-bold text-blue-800 dark:text-blue-200">Contato Direto</h3>\n                <p class="text-sm text-blue-600 dark:text-blue-400">Fale conosco para suporte personalizado</p>\n              </div>\n            </div>\n            <div class="space-y-3">\n              <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg shadow-sm">\n                <span class="text-xl">📧</span>\n                <div>\n                  <div class="font-semibold text-gray-800 dark:text-gray-200">Email</div>\n                  <div class="text-blue-600 dark:text-blue-400">igormbispo@hotmail.com</div>\n                </div>\n              </div>\n              <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg shadow-sm">\n                <span class="text-xl">📱</span>\n                <div>\n                  <div class="font-semibold text-gray-800 dark:text-gray-200">WhatsApp</div>\n                  <div class="text-green-600 dark:text-green-400">(71) 99200-3106</div>\n                </div>\n              </div>\n              <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg shadow-sm">\n                <span class="text-xl">🕒</span>\n                <div>\n                  <div class="font-semibold text-gray-800 dark:text-gray-200">Horário de Atendimento</div>\n                  <div class="text-gray-600 dark:text-gray-400">Segunda a Sexta, 9h às 18h</div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- FAQ --\x3e\n          <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/20 p-6 rounded-xl border border-green-200 dark:border-green-700">\n            <div class="flex items-center gap-3 mb-4">\n              <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-xl text-white">❓</span>\n              </div>\n              <div>\n                <h3 class="text-lg font-bold text-green-800 dark:text-green-200">Perguntas Frequentes</h3>\n                <p class="text-sm text-green-600 dark:text-green-400">Respostas rápidas para dúvidas comuns</p>\n              </div>\n            </div>\n            <div class="space-y-3">\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm">\n                <div class="font-semibold text-gray-800 dark:text-gray-200 mb-1">💾 Como fazer backup dos dados?</div>\n                <div class="text-sm text-gray-600 dark:text-gray-400">Use "Exportar Dados" na seção Dados e Privacidade</div>\n              </div>\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm">\n                <div class="font-semibold text-gray-800 dark:text-gray-200 mb-1">🔄 Como sincronizar entre dispositivos?</div>\n                <div class="text-sm text-gray-600 dark:text-gray-400">Faça login com a mesma conta Google em todos os dispositivos</div>\n              </div>\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm">\n                <div class="font-semibold text-gray-800 dark:text-gray-200 mb-1">🔔 Como configurar notificações?</div>\n                <div class="text-sm text-gray-600 dark:text-gray-400">Acesse a seção Notificações nas configurações</div>\n              </div>\n              <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm">\n                <div class="font-semibold text-gray-800 dark:text-gray-200 mb-1">📱 Como usar offline?</div>\n                <div class="text-sm text-gray-600 dark:text-gray-400">O app funciona offline automaticamente após o primeiro acesso</div>\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Ações Rápidas --\x3e\n          <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/30 dark:to-purple-800/20 p-6 rounded-xl border border-purple-200 dark:border-purple-700">\n            <div class="flex items-center gap-3 mb-4">\n              <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center shadow-md">\n                <span class="text-xl text-white">⚡</span>\n              </div>\n              <div>\n                <h3 class="text-lg font-bold text-purple-800 dark:text-purple-200">Ações Rápidas</h3>\n                <p class="text-sm text-purple-600 dark:text-purple-400">Ferramentas úteis para resolver problemas</p>\n              </div>\n            </div>\n            <div class="grid grid-cols-2 gap-3">\n              <button onclick="window.location.reload()" class="bg-blue-500 hover:bg-blue-600 text-white font-medium text-sm p-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md flex items-center gap-2">\n                <span>🔄</span>\n                <span>Recarregar App</span>\n              </button>\n              <button onclick="if(window.clearOfflineCache) window.clearOfflineCache()" class="bg-orange-500 hover:bg-orange-600 text-white font-medium text-sm p-3 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md flex items-center gap-2">\n                <span>🗑️</span>\n                <span>Limpar Cache</span>\n              </button>\n            </div>\n          </div>\n        </div>\n      '}\n            \x3c!-- Botão de fechar --\x3e\n            <div class="text-center p-6 border-t border-gray-200 dark:border-gray-700">\n              <button id="close-help-modal" class="bg-gray-500 hover:bg-gray-600 text-white font-medium px-6 py-2 rounded-lg transition-all duration-200">\n                Fechar\n              </button>\n            </div>\n          </div>\n        </div>\n      `,n=document.getElementById("help-modal");n&&n.remove(),document.body.insertAdjacentHTML("beforeend",t);const r=document.getElementById("help-modal"),i=document.getElementById("close-help-modal");return i&&i.addEventListener("click",e),void(r&&r.addEventListener("click",t=>{t.target===r&&e()}))}if(t.textContent?.includes("Avaliar App")){if(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){const e=navigator.userAgent.toLowerCase();e.includes("android")?(window.open("https://play.google.com/store/apps/details?id=com.servotech.financeiro","_blank"),Tv().success("Redirecionando para Google Play...")):e.includes("iphone")||e.includes("ipad")?(window.open("https://apps.apple.com/app/financeiro-servotech/id123456789","_blank"),Tv().success("Redirecionando para App Store...")):Tv().info("Avalie o app na loja de aplicativos do seu dispositivo!")}else{const e='\n          <div class="space-y-4">\n            <div class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">\n              <h3 class="font-semibold text-yellow-800 dark:text-yellow-200 mb-2">⭐ Avalie o App</h3>\n              <p class="text-sm text-yellow-700 dark:text-yellow-300 mb-3">\n                Sua avaliação é muito importante para nós! Ajude outros usuários a descobrir o app.\n              </p>\n              <div class="flex gap-2">\n                <button onclick="window.open(\'https://play.google.com/store/apps/details?id=com.servotech.financeiro\', \'_blank\')" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">\n                  Google Play\n                </button>\n                <button onclick="window.open(\'https://apps.apple.com/app/financeiro-servotech/id123456789\', \'_blank\')" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">\n                  App Store\n                </button>\n              </div>\n            </div>\n          </div>\n        ';window.Modal?window.Modal({title:"⭐ Avaliar App",content:e}):alert("Avalie o app:\n\nGoogle Play: https://play.google.com/store/apps/details?id=com.servotech.financeiro\nApp Store: https://apps.apple.com/app/financeiro-servotech/id123456789")}return}if(t.textContent?.includes("Copiar Informações"))window.copyAppInfo();else if(t.textContent?.includes("Limpar Cache Offline"))window.clearOfflineCache();else if(t.textContent?.includes("O que mudou"))try{window.showWhatsNew(),Tv().success('Abrindo "O que mudou"...')}catch(g){Tv().error('Erro ao abrir "O que mudou"')}else if("O que mudou"===t.textContent?.trim()||t.textContent?.includes("O que mudou")||"whats-new"===t.getAttribute("data-action")||t.classList?.contains("whats-new-btn"))try{window.showWhatsNew()}catch(g){Tv().error('Erro ao abrir "O que mudou"')}else if(t.textContent?.includes("Instalar App"))window.installApp();else if("view-performance-events"!==t.id){if("toggle-theme-btn"===t.id||t.classList?.contains("theme-toggle-btn")||t.closest(".theme-toggle-btn")){const e=document.documentElement.classList.contains("dark"),n=t.closest(".theme-toggle-btn")||t;if(e){document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light");const e=n.querySelector("span");e&&(e.textContent="🌙")}else{document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark");const e=n.querySelector("span");e&&(e.textContent="☀️")}return void Tv().success("Tema alterado para "+(e?"claro":"escuro"))}if(t.classList?.contains("color-theme-btn")){const e=t.getAttribute("data-theme");return void(e&&(localStorage.setItem("colorTheme",e),document.body.setAttribute("data-color-theme",e),Tv().success(`Tema de cor alterado para ${e}`)))}if(t.classList?.contains("compact-size-btn")){const e=t.getAttribute("data-size");return void(e&&(Av(e),Tv().success(`Tamanho compacto: ${e}`)))}if("check-updates-btn"===t.id||t.closest("#check-updates-btn")){let t=function(){i&&i.remove();const e=document.getElementById("update-modal");e&&e.remove()};e.preventDefault(),e.stopPropagation();const n=document.getElementById("update-modal");n&&n.remove();const r='\n        <div id="update-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">\n          <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">\n            <div class="text-center mb-6">\n              <div class="text-4xl mb-3">🔄</div>\n              <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">\n                Escolha o tipo de atualização\n              </h3>\n            </div>\n            \n            <div class="space-y-3 mb-6">\n              <button id="normal-update-btn" class="w-full p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors">\n                <div class="flex items-center gap-3">\n                  <div class="text-2xl">✅</div>\n                  <div class="text-left">\n                    <div class="font-medium text-blue-800 dark:text-blue-200">Verificação Normal</div>\n                    <div class="text-xs text-blue-600 dark:text-blue-400">Recomendado</div>\n                  </div>\n                </div>\n              </button>\n              \n              <button id="hard-refresh-btn" class="w-full p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-700 rounded-lg hover:bg-orange-100 dark:hover:bg-orange-900/30 transition-colors">\n                <div class="flex items-center gap-3">\n                  <div class="text-2xl">🧹</div>\n                  <div class="text-left">\n                    <div class="font-medium text-orange-800 dark:text-orange-200">Hard Refresh Completo</div>\n                    <div class="text-xs text-orange-600 dark:text-orange-400">Limpa cache e dados</div>\n                  </div>\n                </div>\n              </button>\n            </div>\n            \n            <div class="text-center">\n              <button id="cancel-update-btn" class="text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">\n                Cancelar\n              </button>\n            </div>\n          </div>\n        </div>\n      ';document.body.insertAdjacentHTML("beforeend",r);const i=document.getElementById("update-modal"),a=document.getElementById("normal-update-btn"),o=document.getElementById("hard-refresh-btn"),s=document.getElementById("cancel-update-btn");return a&&a.addEventListener("click",()=>{t(),"function"==typeof window.checkForUpdates?window.checkForUpdates(!1):location.reload()}),o&&o.addEventListener("click",()=>{t(),"function"==typeof window.performHardRefresh?window.performHardRefresh():location.reload(!0)}),s&&s.addEventListener("click",t),void(i&&i.addEventListener("click",e=>{e.target===i&&t()}))}if("rate-app-btn"!==t.id)if("install-app-btn"!==t.id)if("copy-info-btn"!==t.id){if("share-budget-btn"===t.id||t.textContent?.includes("Enviar Convite")||t.textContent?.includes("📤 Enviar")){const e=t.closest("form");return void(e&&async function(e){try{const t=e.querySelector('input[name="inviteEmail"], input[type="email"]'),n=t?.value?.trim();if(!n)return void Tv().warning("Informe um email");const{appState:r}=window;if(!r?.currentBudget?.id)return void Tv().error("Nenhum orçamento ativo");if(!r?.currentUser)return void Tv().error("Precisa estar autenticado");await(await Cv()).inviteUserToBudget(r.currentBudget.id,n,r.currentUser),Tv().success("Convite enviado"),t.value="",window.dispatchEvent(new CustomEvent("invitation:changed"))}catch(t){Tv().error(t?.message||"Erro ao convidar")}}(e))}if(t.classList?.contains("accept-invitation-btn")||t.textContent?.includes("Aceitar")){const e=t.getAttribute("data-invite-id");return void(e&&async function(e){try{const{appState:t}=window;if(!t?.currentUser)return void Tv().error("Precisa estar autenticado");await(await Cv()).acceptBudgetInvitation(e),Tv().success("Convite aceito com sucesso!"),window.dispatchEvent(new CustomEvent("invitation:changed"));try{const{loadUserBudgets:e}=await n(async()=>{const{loadUserBudgets:e}=await Promise.resolve().then(()=>uv);return{loadUserBudgets:e}},void 0);await e(t.currentUser.uid)}catch(g){}setTimeout(()=>{window.location.reload()},1e3)}catch(t){Tv().error(t?.message||"Erro ao aceitar convite")}}(e))}if(t.classList?.contains("decline-invitation-btn")||t.textContent?.includes("Recusar")){const e=t.getAttribute("data-invite-id");return void(e&&async function(e){try{const{appState:t}=window;if(!t?.currentUser)return void Tv().error("Precisa estar autenticado");await(await Cv()).declineBudgetInvitation(e),Tv().success("Convite recusado"),window.dispatchEvent(new CustomEvent("invitation:changed")),setTimeout(()=>{window.location.reload()},1e3)}catch(t){Tv().error(t?.message||"Erro ao recusar convite")}}(e))}if("test-notifications-btn"===t.id||t.textContent?.includes("Testar Notificações")){try{window.Snackbar&&window.Snackbar.show&&window.Snackbar.show("Teste direto do Snackbar!","success",5e3),Tv().success("Teste de notificação de sucesso!")}catch(g){}return setTimeout(()=>{try{Tv().info("Teste de notificação de informação!")}catch(g){}},1e3),setTimeout(()=>{try{Tv().warning("Teste de notificação de aviso!")}catch(g){}},2e3),void setTimeout(()=>{try{Tv().error("Teste de notificação de erro!")}catch(g){}},3e3)}"clear-cache-btn"!==t.id||Tv().info("Limpando cache offline...")}else Tv().info("Copiando informações do app...");else Tv().info("Instalação do app em desenvolvimento");else Tv().info("Avaliação do app em desenvolvimento")}else n(()=>import("./perf--GZdtUOV.js"),[]).then(e=>{const t=e.getLog();if(0===t.length)return void Tv().info("Nenhum evento de performance coletado ainda. Ative a telemetria e use o app para coletar dados.");const n=t.reduce((e,t)=>(e[t.event]=(e[t.event]||0)+1,e),{}),r=document.createElement("div");r.style.cssText="\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background: rgba(0,0,0,0.5);\n          z-index: 10000;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        ";const i=document.createElement("div");i.style.cssText="\n          background: white;\n          padding: 20px;\n          border-radius: 8px;\n          max-width: 80%;\n          max-height: 80%;\n          overflow: auto;\n        ",i.innerHTML=`\n          <h3>Eventos de Performance (${t.length})</h3>\n          <p><strong>Resumo:</strong></p>\n          <ul>\n            ${Object.entries(n).map(([e,t])=>`<li>${e}: ${t} ocorrências</li>`).join("")}\n          </ul>\n          <p><strong>Últimos 10 eventos:</strong></p>\n          <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; max-height: 300px;">\n${t.slice(0,10).map(e=>`${new Date(e.ts).toLocaleTimeString()} - ${e.event}${e.duration?` (${e.duration}ms)`:""}`).join("\n")}\n          </pre>\n          <button onclick="this.closest('.perf-modal').remove()" style="margin-top: 10px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">\n            Fechar\n          </button>\n        `,r.className="perf-modal",r.appendChild(i),document.body.appendChild(r),r.addEventListener("click",e=>{e.target===r&&r.remove()}),Tv().success(`Mostrando ${t.length} eventos de performance`)}).catch(e=>{Tv().error("Erro ao carregar eventos de performance")})}}else window.installApp();else window.clearOfflineCache();else window.copyAppInfo();else window.showWhatsNew()},{capture:!0});let Dv=new Map;function Pv(){"true"===localStorage.getItem("compactModeEnabled")&&kv(!0);const e=localStorage.getItem("compactMode");e&&Av(e);"false"===localStorage.getItem("animationsEnabled")?document.body.classList.add("no-animations"):document.body.classList.remove("no-animations");"true"===localStorage.getItem("perfTelemetry")&&n(()=>import("./perf--GZdtUOV.js"),[]).then(e=>{e.setEnabled(!0)}).catch(e=>{});localStorage.getItem("biometricAuth"),localStorage.getItem("autoSync"),localStorage.getItem("analyticsEnabled");const t=document.getElementById("days-chunk-size");if(t){const e=localStorage.getItem("txChunkSize");t.value=e||""}}function Nv(){const e=document.createElement("div");e.id="animation-test-element",e.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 100px;\n    height: 100px;\n    background: linear-gradient(45deg, #3b82f6, #8b5cf6);\n    border-radius: 50%;\n    z-index: 10000;\n    transition: all 0.5s ease;\n    animation: pulse 1s infinite;\n  ",document.body.appendChild(e),setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(1.5)",e.style.background="linear-gradient(45deg, #ef4444, #f59e0b)"},500),setTimeout(()=>{e.style.transform="translate(-50%, -50%) scale(0.5)",e.style.background="linear-gradient(45deg, #10b981, #06b6d4)"},1e3),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},2e3)}function Rv(e){try{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();const n=document.execCommand("copy");if(document.body.removeChild(t),!n)throw new Error("execCommand falhou");window.Snackbar&&window.Snackbar.show("ID do orçamento copiado!","success",2e3)}catch(t){window.Snackbar&&window.Snackbar.show("Erro ao copiar ID. Tente selecionar manualmente.","error",3e3)}}document.addEventListener("input",e=>{const t=e.target;Dv.has(t.id)&&clearTimeout(Dv.get(t.id));const n=setTimeout(()=>{if("toast-duration"===t.id){const e=parseInt(t.value)||500;localStorage.setItem("toastDuration",e),Sv()}if("toast-distance"===t.id){const e=parseInt(t.value)||80;localStorage.setItem("toastDistance",e),Sv()}if("toast-max-queue"===t.id){const e=parseInt(t.value)||5;localStorage.setItem("toastMaxQueue",e),Sv()}if("toast-anti-spam"===t.id){const e=parseInt(t.value)||500;localStorage.setItem("toastAntiSpam",e),Sv()}if("toast-offset"===t.id){const e=parseInt(t.value)||80;localStorage.setItem("toastOffset",e),Sv()}if("toast-cooldown"===t.id){const e=parseInt(t.value)||500;localStorage.setItem("toastCooldown",e),Sv()}Dv.delete(t.id)},1e3);Dv.set(t.id,n)}),document.addEventListener("blur",e=>{const t=e.target;if(Dv.has(t.id)&&(clearTimeout(Dv.get(t.id)),Dv.delete(t.id)),"toast-duration"===t.id){const e=parseInt(t.value)||500;localStorage.setItem("toastDuration",e),Sv()}if("toast-distance"===t.id){const e=parseInt(t.value)||80;localStorage.setItem("toastDistance",e),Sv()}if("toast-max-queue"===t.id){const e=parseInt(t.value)||5;localStorage.setItem("toastMaxQueue",e),Sv()}if("toast-anti-spam"===t.id){const e=parseInt(t.value)||500;localStorage.setItem("toastAntiSpam",e),Sv()}if("toast-offset"===t.id){const e=parseInt(t.value)||80;localStorage.setItem("toastOffset",e),Sv()}if("toast-cooldown"===t.id){const e=parseInt(t.value)||500;localStorage.setItem("toastCooldown",e),Sv()}},!0),document.addEventListener("change",e=>{const t=e.target;if("toast-position"===t.id){const e=t.value||"bottom";localStorage.setItem("toastPosition",e),Sv(),Tv().success(`Posição alterada para ${e}`)}if("toast-alignment"===t.id){const e=t.value||"center";localStorage.setItem("toastAlignment",e),Sv(),Tv().success(`Alinhamento alterado para ${e}`)}if("toast-align"===t.id){const e=t.value||"center";localStorage.setItem("toastAlign",e),Sv(),Tv().success(`Alinhamento alterado para ${e}`)}}),window.attachDynamicHandlers=function(e=document){},window.setupGlobalHandlers=function(){},document.addEventListener("input",e=>{if("days-chunk-size"===e.target.id){const t=e.target,n=t.value.trim();if(""!==n&&"automático"!==n.toLowerCase()){const e=parseInt(n);isNaN(e)||e<6||e>40?(t.style.borderColor="#ef4444",t.title="Valor inválido! Use um número entre 6 e 40 (recomendado 10-16)"):(t.style.borderColor="#10b981",t.title=`Carregará ${e} grupos de dias por vez`)}else t.style.borderColor="",t.title="Modo automático - sistema ajustará automaticamente"}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Pv):Pv(),window.copyBudgetId=function(e){if(e)try{navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>{window.Snackbar&&window.Snackbar.show("ID do orçamento copiado!","success",2e3)}).catch(t=>{Rv(e)}):Rv(e)}catch(t){Rv(e)}else window.Snackbar&&window.Snackbar.show("Erro: ID do orçamento não encontrado","error",3e3)},window.deleteBudgetFromSettings=function(e,t){if(!e)return void(window.Snackbar&&window.Snackbar.show("Erro: ID do orçamento não encontrado","error",3e3));const r=t||"este orçamento";if(!confirm(`⚠️ ATENÇÃO: Esta ação é IRREVERSÍVEL!\n\nVocê está prestes a excluir "${r}" permanentemente.\n\nIsso irá:\n• Deletar TODAS as transações\n• Deletar TODAS as categorias\n• Deletar TODOS os dados do orçamento\n• Remover acesso de todos os usuários\n\nTem certeza que deseja continuar?`))return void(window.Snackbar&&window.Snackbar.show("Exclusão cancelada","info",2e3));confirm(`🚨 ÚLTIMA CONFIRMAÇÃO 🚨\n\nVocê tem ABSOLUTA CERTEZA que quer excluir "${r}"?\n\nDigite "EXCLUIR" para confirmar:`)?async function(e,t){try{window.Snackbar&&window.Snackbar.show("Excluindo orçamento...","info",5e3);const{deleteBudget:r}=await n(async()=>{const{deleteBudget:e}=await Promise.resolve().then(()=>uv);return{deleteBudget:e}},void 0);await r(e),window.Snackbar&&window.Snackbar.show(`Orçamento "${t}" excluído com sucesso!`,"success",3e3),setTimeout(()=>{window.location.hash.startsWith("#/settings")&&window.location.reload()},2e3)}catch(r){let e="Erro ao excluir orçamento";r.message&&(e+=": "+r.message),window.Snackbar&&window.Snackbar.show(e,"error",5e3)}}(e,r):window.Snackbar&&window.Snackbar.show("Exclusão cancelada","info",2e3)},window.leaveBudget=function(e,t){if(!e)return void(window.Snackbar&&window.Snackbar.show("Erro: ID do orçamento não encontrado","error",3e3));const r=t||"este orçamento";confirm(`Você tem certeza que deseja sair do orçamento "${r}"?\n\nVocê perderá acesso a todos os dados deste orçamento.`)?async function(e,t){try{window.Snackbar&&window.Snackbar.show("Saindo do orçamento...","info",3e3);const{leaveBudget:r}=await n(async()=>{const{leaveBudget:e}=await Promise.resolve().then(()=>uv);return{leaveBudget:e}},void 0);await r(e),window.Snackbar&&window.Snackbar.show(`Você saiu do orçamento "${t}"`,"success",3e3),setTimeout(()=>{window.location.hash.startsWith("#/settings")&&window.location.reload()},2e3)}catch(r){let e="Erro ao sair do orçamento";r.message&&(e+=": "+r.message),window.Snackbar&&window.Snackbar.show(e,"error",5e3)}}(e,r):window.Snackbar&&window.Snackbar.show("Saída cancelada","info",2e3)};let Ov=!1;function Lv(){return window.appState?.currentUser||window.appState?.user||null}function Mv(){return window.appState?.currentBudget||null}async function Uv(e){try{const r=Lv(),i=Mv();if(!r||!i)return;try{const t=await n(()=>Promise.resolve().then(()=>Ow),void 0);t&&"function"==typeof t.sendRecorrenteReminderNotification?await t.sendRecorrenteReminderNotification(i.id,r.uid,e):window.Snackbar&&"function"==typeof window.Snackbar.show&&window.Snackbar.show(`🔄 Lembrete: ${e.nome||"Despesa recorrente"} - R$ ${e.valor||0}`,"warning",5e3)}catch(t){window.Snackbar&&"function"==typeof window.Snackbar.show&&window.Snackbar.show(`🔄 Lembrete: ${e.nome||"Despesa recorrente"} - R$ ${e.valor||0}`,"warning",5e3)}}catch(r){}}function Vv(e){try{return n(()=>Promise.resolve().then(()=>rw),void 0).then(t=>{const n=window.appState?.transactions||[];return t.calcularStatusRecorrente(e,n)})}catch{return Promise.resolve(null)}}async function Fv(){if("true"!==localStorage.getItem("noti_recurring_reminders"))return;const e=window.appState?.recorrentes||[];if(!Mv()||0===e.length)return;const t=function(e=new Date){return e.toISOString().split("T")[0]}();for(const r of e){if(!r?.id||!1===r.ativa)continue;const e=`recorrenteReminder:lastSent:${r.id}:${t}`;if(!localStorage.getItem(e))try{const t=await Vv(r);t&&!1===t.foiEfetivadaEsteMes&&(await Uv(r),localStorage.setItem(e,Date.now().toString()))}catch(n){}}}async function Bv(){if("true"!==localStorage.getItem("noti_weekly_summary"))return;const e=Mv(),t=Lv();if(!e||!t)return;const r=new Date;if(1!==r.getDay()||r.getHours()<8)return;const i=function(e=new Date){const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),n=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-n);const r=new Date(Date.UTC(t.getUTCFullYear(),0,1)),i=Math.ceil(((t-r)/864e5+1)/7);return`${t.getUTCFullYear()}-W${String(i).padStart(2,"0")}`}(new Date(r.getTime()-6048e5)),a=`weeklySummary:lastSent:${e.id}:${i}`;if(localStorage.getItem(a))return;const o=function(){const e=window.appState?.transactions||[];if(!Array.isArray(e)||0===e.length)return null;const t=new Date,n=(t.getDay()+6)%7,r=new Date(t);r.setHours(0,0,0,0),r.setDate(r.getDate()-n);const i=new Date(r);i.setDate(i.getDate()-7);const a=new Date(i);a.setDate(a.getDate()+6),a.setHours(23,59,59,999);const o=e.filter(e=>{let t;if(e.createdAt?.seconds)t=new Date(1e3*e.createdAt.seconds);else{if(!e.createdAt)return!1;t=new Date(e.createdAt)}return t>=i&&t<=a});if(0===o.length)return null;let s=0,c=0;return o.forEach(e=>{const t=Number(e.valor)||0;"receita"===e.tipo?c+=t:s+=t}),{resumo:`Semana anterior: Receitas R$ ${c.toFixed(2)} | Despesas R$ ${s.toFixed(2)} | Saldo R$ ${(c-s).toFixed(2)}`,periodo:`${i.toLocaleDateString("pt-BR")} - ${a.toLocaleDateString("pt-BR")}`}}();o&&(await async function(e){try{const r=Lv(),i=Mv();if(!r||!i)return;try{const t=await n(()=>Promise.resolve().then(()=>Ow),void 0);t&&"function"==typeof t.sendWeeklySummaryNotification?await t.sendWeeklySummaryNotification(i.id,r.uid,e):window.Snackbar&&"function"==typeof window.Snackbar.show&&window.Snackbar.show(`📊 ${e.resumo}`,"info",5e3)}catch(t){window.Snackbar&&"function"==typeof window.Snackbar.show&&window.Snackbar.show(`📊 ${e.resumo}`,"info",5e3)}}catch(r){}}(o),localStorage.setItem(a,Date.now().toString()))}async function jv(){try{await Fv()}catch{}try{await Bv()}catch{}}function $v(){setTimeout(jv,2e3)}function qv(){Ov||(Ov=!0,window.__notificationIntervalsSetup||(window.__notificationIntervalsSetup=!0,setInterval(jv,36e5),setTimeout(jv,8e3)),mg.on("transactions:updated",$v),mg.on("recorrentes:updated",$v))}setTimeout(()=>{try{qv()}catch{}},5e3),window.initializeNotificationSchedulers=qv;class zv{constructor(){this.modal=null,this.resolve=null,this.reject=null}show(e){return new Promise((t,n)=>{this.resolve=t,this.reject=n,this.createModal(e)})}createModal(e){const{title:t="Confirmação",message:n="Tem certeza que deseja continuar?",confirmText:r="Confirmar",cancelText:i="Cancelar",type:a="info",icon:o=null}=e;this.removeModal();const s=document.createElement("div");s.className="confirm-modal-overlay",s.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.5);\n      backdrop-filter: blur(4px);\n      z-index: 10000;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 20px;\n      opacity: 0;\n      transition: opacity 0.2s ease;\n    ",this.modal=document.createElement("div"),this.modal.className="confirm-modal",this.modal.style.cssText="\n      background: white;\n      border-radius: 16px;\n      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n      max-width: 400px;\n      width: 100%;\n      max-height: 90vh;\n      overflow: hidden;\n      transform: scale(0.95);\n      transition: transform 0.2s ease;\n    ";const c={info:{primary:"#3B82F6",bg:"#EFF6FF",icon:"ℹ️"},success:{primary:"#10B981",bg:"#ECFDF5",icon:"✅"},warning:{primary:"#F59E0B",bg:"#FFFBEB",icon:"⚠️"},danger:{primary:"#EF4444",bg:"#FEF2F2",icon:"❌"}},d=c[a]||c.info,l=o||d.icon;this.modal.innerHTML=`\n      <div style="padding: 24px;">\n        \x3c!-- Header --\x3e\n        <div style="display: flex; align-items: center; margin-bottom: 16px;">\n          <div style="\n            width: 48px;\n            height: 48px;\n            border-radius: 12px;\n            background: ${d.bg};\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            margin-right: 16px;\n            flex-shrink: 0;\n          ">\n            ${l}\n          </div>\n          <div style="flex: 1;">\n            <h3 style="\n              margin: 0;\n              font-size: 18px;\n              font-weight: 600;\n              color: #1F2937;\n              line-height: 1.4;\n            ">${t}</h3>\n          </div>\n        </div>\n\n        \x3c!-- Message --\x3e\n        <div style="\n          margin-bottom: 24px;\n          color: #6B7280;\n          font-size: 14px;\n          line-height: 1.5;\n        ">${n}</div>\n\n        \x3c!-- Actions --\x3e\n        <div style="\n          display: flex;\n          gap: 12px;\n          justify-content: flex-end;\n        ">\n          <button class="confirm-modal-cancel" style="\n            padding: 10px 20px;\n            border: 1px solid #D1D5DB;\n            border-radius: 8px;\n            background: white;\n            color: #374151;\n            font-size: 14px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            min-width: 80px;\n          ">${i}</button>\n          <button class="confirm-modal-confirm" style="\n            padding: 10px 20px;\n            border: none;\n            border-radius: 8px;\n            background: ${d.primary};\n            color: white;\n            font-size: 14px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            min-width: 80px;\n          ">${r}</button>\n        </div>\n      </div>\n    `,s.appendChild(this.modal),document.body.appendChild(s),requestAnimationFrame(()=>{s.style.opacity="1",this.modal.style.transform="scale(1)"});const u=this.modal.querySelector(".confirm-modal-cancel"),h=this.modal.querySelector(".confirm-modal-confirm"),p=()=>{this.close(!1)},m=()=>{this.close(!0)},f=e=>{e.target===s&&this.close(!1)},g=e=>{"Escape"===e.key?this.close(!1):"Enter"===e.key&&this.close(!0)};u.addEventListener("click",p),h.addEventListener("click",m),s.addEventListener("click",f),document.addEventListener("keydown",g),setTimeout(()=>h.focus(),100),this.listeners={cancel:p,confirm:m,overlay:f,keydown:g}}close(e){if(!this.modal)return;this.modal.parentElement.style.opacity="0",this.modal.style.transform="scale(0.95)",setTimeout(()=>{this.removeModal(),this.resolve?.(e)},200)}removeModal(){if(this.modal){const e=this.modal.parentElement;if(e){const t=this.modal.querySelector(".confirm-modal-cancel"),n=this.modal.querySelector(".confirm-modal-confirm");t&&this.listeners?.cancel&&t.removeEventListener("click",this.listeners.cancel),n&&this.listeners?.confirm&&n.removeEventListener("click",this.listeners.confirm),e&&this.listeners?.overlay&&e.removeEventListener("click",this.listeners.overlay),this.listeners?.keydown&&document.removeEventListener("keydown",this.listeners.keydown),document.body.removeChild(e)}this.modal=null,this.listeners=null}}}const Hv=new zv;function Gv(e){return Hv.show(e)}function Wv(e){const{descricao:t,valor:n}=e;return Gv({title:"Adicionar Transação",message:`Tem certeza que deseja adicionar "${t}" no valor de ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)}?`,confirmText:"Adicionar",cancelText:"Cancelar",type:"success",icon:"💰"})}function Kv(e,t="item"){return Gv({title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir "${e}"? Esta ação não pode ser desfeita.`,confirmText:"Excluir",cancelText:"Cancelar",type:"danger",icon:"🗑️"})}function Qv(e,t="item"){return Gv({title:"Salvar Alterações",message:`Tem certeza que deseja salvar as alterações em "${e}"?`,confirmText:"Salvar",cancelText:"Cancelar",type:"info",icon:"💾"})}"undefined"!=typeof window&&(window.ConfirmModal=zv,window.confirmModal=Hv,window.confirm=Gv,window.confirmTransaction=Wv,window.confirmDelete=Kv,window.confirmUpdate=Qv);const Yv=Object.freeze(Object.defineProperty({__proto__:null,ConfirmModal:zv,confirm:Gv,confirmDelete:Kv,confirmModal:Hv,confirmTransaction:Wv,confirmUpdate:Qv},Symbol.toStringTag,{value:"Module"}));const Jv={"/":()=>n(()=>import("./index-DT_9SM3O.js"),__vite__mapDeps([13,1,2,14,3,15,0,16,5,4,17,12])).then(e=>({default:e.renderDashboard})),"/dashboard":()=>n(()=>import("./index-DT_9SM3O.js"),__vite__mapDeps([13,1,2,14,3,15,0,16,5,4,17,12])).then(e=>({default:e.renderDashboard})),"/transactions":()=>n(()=>import("./TransactionsPage-Bz69yW2z.js"),__vite__mapDeps([14,1,2,3,15])),"/categories":()=>n(()=>import("./CategoriesPage-CbUTxUMT.js"),__vite__mapDeps([0,1,2,3])),"/recorrentes":()=>n(()=>import("./index-DT_9SM3O.js"),__vite__mapDeps([13,1,2,14,3,15,0,16,5,4,17,12])).then(e=>({default:e.renderRecorrentes})),"/analytics":()=>n(()=>import("./AnalyticsPage-BuldFbzh.js"),__vite__mapDeps([18,2])),"/notifications":()=>n(()=>import("./NotificationsPage-LRJ1uuMq.js"),__vite__mapDeps([16,1,2,5])),"/settings":()=>n(()=>import("./SettingsPage-YyPZEyRR.js"),__vite__mapDeps([19,2]))};async function Xv(e){try{const r=(e||"/").split("?")[0]||"/",i="/"===r?"/dashboard":r,a=document.getElementById("app-content");if(Jv[i]){const e=await Jv[i]();let r=null;if("function"==typeof e?r=e:e&&"function"==typeof e.default?r=e.default:e&&"function"==typeof e.render?r=e.render:e&&"function"==typeof e.renderNotifications&&(r=e.renderNotifications),"function"==typeof r){await r(a);try{const{scrollToTop:e}=await n(async()=>{const{scrollToTop:e}=await Promise.resolve().then(()=>qy);return{scrollToTop:e}},void 0);e()}catch{}try{const{renderFAB:e}=await n(async()=>{const{renderFAB:e}=await import("./index-DT_9SM3O.js");return{renderFAB:e}},__vite__mapDeps([13,1,2,14,3,15,0,16,5,4,17,12]));e()}catch(t){}try{const{renderBottomNav:e}=await n(async()=>{const{renderBottomNav:e}=await import("./index-DT_9SM3O.js");return{renderBottomNav:e}},__vite__mapDeps([13,1,2,14,3,15,0,16,5,4,17,12]));e("/"===i?"/dashboard":i)}catch(t){}try{const{SwipeNavigation:e}=await n(async()=>{const{SwipeNavigation:e}=await import("./SwipeTabs-BhQQUjaZ.js");return{SwipeNavigation:e}},[]);if(window.swipeNavigation){try{window.swipeNavigation.updateCurrentTabIndex()}catch{}try{window.swipeNavigation.updateSwipeIndicator()}catch{}}else window.swipeNavigation=new e}catch(t){}}}else if(Jv["/dashboard"]){const e=await Jv["/dashboard"](),r=e&&(e.default||e.render)||e;await r(a);try{const{scrollToTop:e}=await n(async()=>{const{scrollToTop:e}=await Promise.resolve().then(()=>qy);return{scrollToTop:e}},void 0);e()}catch{}try{const{renderBottomNav:e}=await n(async()=>{const{renderBottomNav:e}=await import("./index-DT_9SM3O.js");return{renderBottomNav:e}},__vite__mapDeps([13,1,2,14,3,15,0,16,5,4,17,12]));e("/dashboard")}catch(t){}try{const{SwipeNavigation:e}=await n(async()=>{const{SwipeNavigation:e}=await import("./SwipeTabs-BhQQUjaZ.js");return{SwipeNavigation:e}},[]);if(window.swipeNavigation){try{window.swipeNavigation.updateCurrentTabIndex()}catch{}try{window.swipeNavigation.updateSwipeIndicator()}catch{}}else window.swipeNavigation=new e}catch(t){}}}catch(r){try{const e=document.getElementById("app-content");if(Jv["/dashboard"]){const r=await Jv["/dashboard"](),i=r&&(r.default||r.render)||r;await i(e);try{const{scrollToTop:e}=await n(async()=>{const{scrollToTop:e}=await Promise.resolve().then(()=>qy);return{scrollToTop:e}},void 0);e()}catch{}try{const{renderBottomNav:e}=await n(async()=>{const{renderBottomNav:e}=await import("./index-DT_9SM3O.js");return{renderBottomNav:e}},__vite__mapDeps([13,1,2,14,3,15,0,16,5,4,17,12]));e("/dashboard")}catch(t){}try{const{SwipeNavigation:e}=await n(async()=>{const{SwipeNavigation:e}=await import("./SwipeTabs-BhQQUjaZ.js");return{SwipeNavigation:e}},[]);if(window.swipeNavigation){try{window.swipeNavigation.updateCurrentTabIndex()}catch{}try{window.swipeNavigation.updateSwipeIndicator()}catch{}}else window.swipeNavigation=new e}catch(t){}}}catch(i){}}}const Zv=Object.freeze(Object.defineProperty({__proto__:null,renderPage:Xv,routes:Jv},Symbol.toStringTag,{value:"Module"}));function eb(){if("undefined"==typeof document)return;const e=document.getElementById("theme-toggle-btn");e?window.__themeToggleWired||(window.__themeToggleWired=!0,e.addEventListener("click",()=>{tb()}),ib()):ib()}function tb(){try{const e="light"===(localStorage.getItem("theme")||"light")?"dark":"light";localStorage.setItem("theme",e),nb(e),mg.emit("theme:changed",e),ab(e)}catch(e){}}function nb(e){try{const t=document.documentElement;"dark"===e?(t.classList.add("dark"),t.classList.remove("light")):(t.classList.add("light"),t.classList.remove("dark")),document.body.className=document.body.className.replace(/theme-\w+/g,"").trim(),document.body.classList.add(`theme-${e}`),function(){try{document.querySelectorAll('[class*="dark:"]').forEach(e=>{e.offsetHeight});document.querySelectorAll([".u-card",".u-btn",".u-input",".tab-container",".tab-header",".tab-content",".modal-content",".bottom-nav",".card-resumo",".list-item"].join(", ")).forEach(e=>{e.offsetHeight});const e=document.createElement("style");e.textContent="\n      :root.dark {\n        --bg-primary: #1f2937 !important;\n        --bg-secondary: #111827 !important;\n        --text-primary: #f9fafb !important;\n        --text-secondary: #d1d5db !important;\n        --border-color: #374151 !important;\n      }\n      :root.light {\n        --bg-primary: #ffffff !important;\n        --bg-secondary: #f9fafb !important;\n        --text-primary: #111827 !important;\n        --text-secondary: #6b7280 !important;\n        --border-color: #e5e7eb !important;\n      }\n    ";const t=document.getElementById("force-theme-style");t&&t.remove(),e.id="force-theme-style",document.head.appendChild(e)}catch(e){}}()}catch(t){}}function rb(){try{return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch(e){return"light"}}function ib(){try{const e=localStorage.getItem("theme"),t=rb(),n=e||t;nb(n),ab(n)}catch(e){}}function ab(e){try{const t=document.getElementById("theme-toggle-btn");if(!t)return;const n=t.querySelector(".theme-icon");n&&(n.textContent="dark"===e?"☀️":"🌙",n.setAttribute("title","dark"===e?"Mudar para modo claro":"Mudar para modo escuro"))}catch(t){}}function ob(){try{"true"===localStorage.getItem("compactMode")?document.body.classList.add("compact-mode"):document.body.classList.remove("compact-mode")}catch(e){}}function sb(){try{const e=!("true"===localStorage.getItem("compactMode"));localStorage.setItem("compactMode",e.toString()),ob(),mg.emit("compactMode:changed",e)}catch(e){}}function cb(){return localStorage.getItem("theme")||"light"}function db(){return"true"===localStorage.getItem("compactMode")}function lb(){try{localStorage.removeItem("theme"),ib()}catch(e){}}function ub(){try{ib(),ob(),function(){try{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{if(!localStorage.getItem("theme")){const t=e.matches?"dark":"light";nb(t),ab(t)}};e.addEventListener?e.addEventListener("change",t):e.addListener(t)}catch(e){}}(),"undefined"!=typeof window&&(window.debugTheme={getCurrentTheme:cb,resetThemeToSystem:lb,applyCurrentTheme:ib,detectSystemPreference:rb})}catch(e){}}const hb=Object.freeze(Object.defineProperty({__proto__:null,applyCompactMode:ob,applyCurrentTheme:ib,applyTheme:nb,applyThemeSettings:ub,getCurrentCompactMode:db,getCurrentTheme:cb,resetThemeToSystem:lb,setupThemeToggle:eb,toggleCompactMode:sb,toggleTheme:tb},Symbol.toStringTag,{value:"Module"})),pb={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};document.addEventListener("DOMContentLoaded",async()=>{try{Ly.info("DOM carregado, iniciando aplicação..."),await async function(){const e=window.Capacitor?.isNativePlatform();if(!e)return!1;try{const{getRedirectResult:e,onAuthStateChanged:r}=await n(async()=>{const{getRedirectResult:e,onAuthStateChanged:t}=await Promise.resolve().then(()=>Ta);return{getRedirectResult:e,onAuthStateChanged:t}},void 0),{auth:i}=await n(async()=>{const{auth:e}=await Promise.resolve().then(()=>ng);return{auth:e}},void 0),{ensureUserProfile:a}=await n(async()=>{const{ensureUserProfile:e}=await Promise.resolve().then(()=>Wy);return{ensureUserProfile:e}},void 0),{activateRealtimeAfterLogin:o}=await n(async()=>{const{activateRealtimeAfterLogin:e}=await Promise.resolve().then(()=>Ev);return{activateRealtimeAfterLogin:e}},void 0),s=await e(i);if(s&&s.user)try{localStorage.removeItem("authInProgress"),localStorage.removeItem("authTimestamp"),await a(s.user),window.appState=window.appState||{},window.appState.currentUser=s.user,await o(s.user),window.location.hash="#/dashboard";const e=document.getElementById("login-page"),t=document.querySelector(".app-container"),n=document.getElementById("loading-page");return e&&(e.style.display="none"),n&&(n.style.display="none"),t&&(t.style.display="flex"),!0}catch(t){throw t}return new Promise(e=>{const t=r(i,async n=>{t(),n?(await o(n),e(!0)):e(!1)})})}catch(r){return!1}}();try{pb&&(e="warn",Ly.setLevel(e))}catch{}try{const e=document.getElementById("voice-modal");e&&(e.style.display="none",e.style.pointerEvents="none",e.style.background="rgba(0, 0, 0, 0)",e.style.backdropFilter="blur(0px)")}catch{}try{document.body.classList.add("mobile-ui")}catch{}try{ub()}catch(t){Ly.warn("Falha ao aplicar configurações de tema iniciais:",t)}try{const e=(window.location.hash||"").split("?")[0];e&&"#"!==e&&"#/"!==e||(window.location.hash="#/dashboard")}catch{}try{const{setupLoginButton:e,checkAuthState:t}=await n(async()=>{const{setupLoginButton:e,checkAuthState:t}=await import("./index-DT_9SM3O.js");return{setupLoginButton:e,checkAuthState:t}},__vite__mapDeps([13,1,2,14,3,15,0,16,5,4,17,12]));e();const r=t(),i=new Promise(e=>{setTimeout(()=>{e(!1)},3e3)});await Promise.race([r,i])}catch(r){Ly.warn("Falha ao configurar login/estado de auth:",r)}const o=async function(){try{await vv();try{(()=>{const e=(window.location.hash||"").split("?")[0];e&&"#"!==e&&"#/"!==e||(window.location.hash="#/dashboard")})()}catch{}async function t(){const e=((window.location.hash||"").split("?")[0].replace("#","")||"/").trim();try{const{scrollToTop:e}=await n(async()=>{const{scrollToTop:e}=await Promise.resolve().then(()=>qy);return{scrollToTop:e}},void 0);e(!0)}catch{}try{const e=await n(()=>Promise.resolve().then(()=>qy),void 0),t=e.parseYmFromHash(),r=e.getSelectedPeriod();!t||t.year===r.year&&t.month===r.month?t||e.ensureHashHasYm(r.year,r.month):e.setSelectedPeriod(t.year,t.month)}catch{}try{await Xv(e)}catch(t){Ly.error("route error",t)}}window.addEventListener("hashchange",()=>{t()}),t();try{"undefined"!=typeof history&&"scrollRestoration"in history&&(history.scrollRestoration="manual")}catch{}window.addEventListener("beforeunload",Iv),Ly.info("Aplicação bootstrapada com sucesso")}catch(e){Ly.error("Erro no bootstrap:",e)}}(),s=new Promise(e=>{setTimeout(()=>{e()},15e3)});await Promise.race([o,s]);try{if("undefined"!=typeof window&&window.Capacitor&&window.Capacitor.isNativePlatform&&window.Capacitor.isNativePlatform()&&window.Capacitor.Plugins&&window.Capacitor.Plugins.SplashScreen)try{await window.Capacitor.Plugins.SplashScreen.hide({fadeOutDuration:200})}catch(i){}}catch(a){}try{window.showLoading&&window.showLoading(!1)}catch(t){}try{eb()}catch(t){Ly.warn("Falha ao configurar toggle de tema pós-bootstrap:",t)}}catch(o){Ly.error("Erro fatal ao inicializar aplicação:",o),document.body.innerHTML=`\n      <div style="padding: 2rem; text-align: center; color: #ef4444;">\n        <h1>Erro ao carregar aplicação</h1>\n        <p>${o.message}</p>\n        <button onclick="location.reload()" style="padding: 0.5rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 0.5rem; cursor: pointer;">\n          Tentar novamente\n        </button>\n      </div>\n    `}var e}),window.addEventListener("online",()=>{Ly.info("Aplicação online"),document.body.classList.remove("offline")}),window.addEventListener("offline",()=>{Ly.info("Aplicação offline"),document.body.classList.add("offline")}),My();try{window.deferredPrompt=null,window.addEventListener("beforeinstallprompt",e=>{try{e.preventDefault()}catch{}try{window.deferredPrompt=e}catch{}try{window.updateInstallButton&&window.updateInstallButton()}catch{}}),window.addEventListener("appinstalled",()=>{try{window.deferredPrompt=null}catch{}try{window.Snackbar?.({message:"App instalado com sucesso",type:"success"})}catch{}try{window.updateInstallButton&&window.updateInstallButton()}catch{}}),"function"!=typeof window.installApp&&(window.installApp=async function(){try{const e=window.deferredPrompt;if(!e)return window.Snackbar?.({message:"Instalação não disponível neste momento",type:"warning"}),!1;e.prompt();const t=await e.userChoice.catch(()=>({outcome:"dismissed"}));t&&"accepted"===t.outcome?window.Snackbar?.({message:"Instalação iniciada",type:"success"}):window.Snackbar?.({message:"Instalação cancelada",type:"info"});try{window.deferredPrompt=null}catch{}try{window.updateInstallButton&&window.updateInstallButton()}catch{}return"accepted"===t?.outcome}catch(e){return window.Snackbar?.({message:"Falha ao solicitar instalação",type:"error"}),!1}})}catch{}!function(){async function e(t,r=3){const{activateRealtimeAfterLogin:i}=await n(async()=>{const{activateRealtimeAfterLogin:e}=await Promise.resolve().then(()=>Ev);return{activateRealtimeAfterLogin:e}},void 0);for(let n=0;n<r;n++)try{return void(await i(t))}catch(a){n===r-1?setTimeout(()=>{e(t,r)},5e3):await new Promise(e=>setTimeout(e,2e3))}}document.addEventListener("click",function(e){"google-login-btn"===e.target.id||e.target.closest("#google-login-btn")},!0),async function(){try{const{auth:t}=await n(async()=>{const{auth:e}=await Promise.resolve().then(()=>ng);return{auth:e}},void 0);if(await new Promise(e=>setTimeout(e,1e3)),t.currentUser){const r=t.currentUser;if(r.isAnonymous)return;window.appState&&(window.appState.currentUser=r),mg&&mg.emit("auth:login",r);const{activateRealtimeAfterLogin:i}=await n(async()=>{const{activateRealtimeAfterLogin:e}=await Promise.resolve().then(()=>Ev);return{activateRealtimeAfterLogin:e}},void 0);e(r);const a=window.location.hash;if("#/"===a||""===a){const{navigateToDashboard:e}=await n(async()=>{const{navigateToDashboard:e}=await Promise.resolve().then(()=>Zv);return{navigateToDashboard:e}},void 0);e()}}}catch(t){}}(),async function(){try{const{auth:e}=await n(async()=>{const{auth:e}=await Promise.resolve().then(()=>ng);return{auth:e}},void 0),{getRedirectResult:t}=await n(async()=>{const{getRedirectResult:e}=await Promise.resolve().then(()=>Ta);return{getRedirectResult:e}},void 0),r=await t(e);r&&r.user&&window.Snackbar&&window.Snackbar({message:`Bem-vindo, ${r.user.displayName||r.user.email}!`,type:"success"})}catch(e){}}();const t=()=>{if(!(window.Capacitor&&window.Capacitor.isNativePlatform&&window.Capacitor.isNativePlatform()))return;const e=document.getElementById("google-login-btn"),r=document.getElementById("guest-btn");if(e||r){if(e){const t=e.cloneNode(!0);e.replaceWith(t);const r=document.getElementById("google-login-btn");r.disabled=!1,r.style.pointerEvents="auto",r.style.cursor="pointer",r.style.borderBottom="3px solid #10b981",r.addEventListener("click",async function(e){try{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation()}catch(i){}r.disabled=!0;const t=r.innerHTML;r.innerHTML="<span>⏳</span> Conectando com Google...";try{const{GoogleAuth:e}=window.Capacitor.Plugins;if(!e)throw new Error("Plugin GoogleAuth não encontrado");const{auth:t}=await n(async()=>{const{auth:e}=await Promise.resolve().then(()=>ng);return{auth:e}},void 0);if(t.currentUser&&t.currentUser.isAnonymous){const{signOut:e}=await n(async()=>{const{signOut:e}=await Promise.resolve().then(()=>Ta);return{signOut:e}},void 0);await e(t),await new Promise(e=>setTimeout(e,500))}const r=await e.signIn(),{GoogleAuthProvider:i,signInWithCredential:a}=await n(async()=>{const{GoogleAuthProvider:e,signInWithCredential:t}=await Promise.resolve().then(()=>Ta);return{GoogleAuthProvider:e,signInWithCredential:t}},void 0),o=i.credential(r.authentication.idToken),s=(await a(t,o)).user;if(s.isAnonymous)throw new Error("Login resultou em usuário anônimo. Tente novamente.");window.appState&&(window.appState.currentUser=s),mg&&mg.emit("auth:login",s);const{ensureUserProfile:c}=await n(async()=>{const{ensureUserProfile:e}=await Promise.resolve().then(()=>Wy);return{ensureUserProfile:e}},void 0),{activateRealtimeAfterLogin:d}=await n(async()=>{const{activateRealtimeAfterLogin:e}=await Promise.resolve().then(()=>Ev);return{activateRealtimeAfterLogin:e}},void 0);c(s).then(()=>{}).catch(e=>{}),d(s).then(()=>{}).catch(e=>{});const{navigateToDashboard:l}=await n(async()=>{const{navigateToDashboard:e}=await Promise.resolve().then(()=>Zv);return{navigateToDashboard:e}},void 0);l(),window.Snackbar&&window.Snackbar({message:`Bem-vindo de volta, ${s.displayName||s.email}!`,type:"success"})}catch(a){if(r.disabled=!1,r.innerHTML=t,window.Snackbar){let e="Erro ao fazer login com Google";a.message?.includes("popup_closed_by_user")||a.message?.includes("cancelled")?e="Login cancelado. Tente novamente.":a.message?.includes("network")?e="Erro de conexão. Verifique sua internet.":a.message&&(e=`Erro: ${a.message}`),window.Snackbar({message:e,type:"error",duration:5e3})}}},{once:!1}),r.style.borderBottom="3px solid #10b981"}r&&r.addEventListener("click",async function(e){try{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation()}catch{}r.disabled=!0;const t=r.innerHTML;r.innerHTML="<span>⏳</span> Entrando...";try{await async function(){try{const{auth:e}=await n(async()=>{const{auth:e}=await Promise.resolve().then(()=>ng);return{auth:e}},void 0),{signInAnonymously:t}=await n(async()=>{const{signInAnonymously:e}=await Promise.resolve().then(()=>Ta);return{signInAnonymously:e}},void 0),{ensureUserProfile:r}=await n(async()=>{const{ensureUserProfile:e}=await Promise.resolve().then(()=>Wy);return{ensureUserProfile:e}},void 0),{activateRealtimeAfterLogin:i}=await n(async()=>{const{activateRealtimeAfterLogin:e}=await Promise.resolve().then(()=>Ev);return{activateRealtimeAfterLogin:e}},void 0),a=async(n=5)=>{for(let i=0;i<n;i++)try{const n=t(e),r=new Promise((e,t)=>setTimeout(()=>t(new Error("Timeout")),5e3));return await Promise.race([n,r])}catch(r){if(i===n-1)throw r;await new Promise(e=>setTimeout(e,1e3))}},o=(await a()).user;r(o).then(()=>{}).catch(e=>{}),i(o).then(()=>{}).catch(e=>{});const s=document.getElementById("login-page"),c=document.querySelector(".app-container");s&&(s.style.display="none"),c&&(c.style.display="flex"),window.location.hash="#/dashboard",setTimeout(async()=>{try{const{renderPage:e}=await n(async()=>{const{renderPage:e}=await Promise.resolve().then(()=>Zv);return{renderPage:e}},void 0);await e("/dashboard")}catch(e){}},300),window.Snackbar&&window.Snackbar({message:"Bem-vindo! (Login como convidado)",type:"success"})}catch(e){throw e}}()}catch(i){r.disabled=!1,r.innerHTML=t,window.Snackbar&&window.Snackbar({message:"Erro ao fazer login: "+i.message,type:"error"})}})}else setTimeout(t,500)};let r=0;const i=()=>{r++,window.Capacitor?t():r<5&&setTimeout(i,300)};i();try{mg.on("auth:logout",()=>{setTimeout(()=>{t()},500)})}catch(a){}}();const mb=Object.freeze(Object.defineProperty({__proto__:null,get analytics(){return eg},app:Jf,auth:Xf,db:Zf},Symbol.toStringTag,{value:"Module"}));export{ib as $,av as A,Em as B,xi as C,_v as D,or as E,Rr as F,Xn as G,yy as H,vy as I,Ey as J,_y as K,Iy as L,wy as M,_g as N,Ig as O,Eg as P,kw as Q,Aw as R,fw as S,Cw as T,Dw as U,Pw as V,Nw as W,eb as X,tb as Y,nb as Z,n as _,Xf as a,ob as a0,sb as a1,cb as a2,db as a3,ub as a4,Tg as a5,Vg as a6,rw as a7,aw as a8,vw as a9,_w as aa,Ow as ab,hy as ac,Wy as ad,uv as ae,Zv as af,hb as ag,km as b,mp as c,Zf as d,fp as e,Sm as f,bm as g,Im as h,Or as i,Nm as j,mg as k,Ag as l,By as m,nw as n,Am as o,Gg as p,im as q,Jg as r,mr as s,Yg as t,Tm as u,jy as v,om as w,by as x,Rm as y,lv as z};

# üìö API Documentation - Financeiro App

## üèóÔ∏è Arquitetura

O aplicativo foi refatorado para seguir uma arquitetura **feature-first** com separa√ß√£o clara de responsabilidades:

```
src/
‚îú‚îÄ‚îÄ core/           # Funcionalidades essenciais
‚îú‚îÄ‚îÄ features/       # Funcionalidades principais organizadas por dom√≠nio
‚îú‚îÄ‚îÄ ui/            # Componentes de interface reutiliz√°veis
‚îú‚îÄ‚îÄ data/          # Camada de acesso a dados
‚îî‚îÄ‚îÄ app/           # Configura√ß√£o de rotas e inicializa√ß√£o
```

## üîß Core Layer

### EventBus (`@core/events/eventBus.js`)

Sistema centralizado de eventos para comunica√ß√£o entre componentes.

```javascript
import { eventBus, on, off, emit } from '@core/events/eventBus.js';

// Registrar listener
on('transaction:added', (transaction) => {
  console.log('Nova transa√ß√£o:', transaction);
});

// Emitir evento
emit('transaction:added', { id: '1', amount: 100 });

// Remover listener
off('transaction:added', listener);
```

**Eventos dispon√≠veis:**
- `transaction:added` - Nova transa√ß√£o criada
- `transaction:updated` - Transa√ß√£o atualizada
- `transaction:deleted` - Transa√ß√£o removida
- `category:added` - Nova categoria criada
- `category:updated` - Categoria atualizada
- `category:deleted` - Categoria removida
- `budget:changed` - Or√ßamento alterado

### Global Utils (`@core/utils/globalUtils.js`)

Utilit√°rios globais e gerenciamento de estado.

```javascript
import { globalState, globalFunctions, navigateTo } from '@core/utils/globalUtils.js';

// Estado global
globalState.currentUser = user;
globalState.currentBudget = budget;

// Fun√ß√µes globais
globalFunctions.showLoading(true);

// Navega√ß√£o
navigateTo('/dashboard');
```

## üìä Features Layer

### Dashboard (`@features/dashboard/DashboardPage.js`)

P√°gina principal com vis√£o geral das finan√ßas.

```javascript
import { renderDashboard } from '@features/dashboard/DashboardPage.js';

// Renderizar dashboard
await renderDashboard();

// Renderizar com m√™s espec√≠fico
await renderDashboard(2024, 3); // Mar√ßo 2024
```

### Transactions (`@features/transactions/`)

Gerenciamento completo de transa√ß√µes.

#### TransactionsPage.js
```javascript
import { 
  renderTransactions,
  renderAllTransactions,
  renderFilteredTransactions,
  renderTransactionItemHTML
} from '@features/transactions/TransactionsPage.js';

// Renderizar transa√ß√µes
await renderTransactions();

// Renderizar todas as transa√ß√µes
await renderAllTransactions();

// Renderizar transa√ß√µes filtradas
await renderFilteredTransactions(filteredData);

// Renderizar item de transa√ß√£o
const html = renderTransactionItemHTML(transaction);
```

#### service.js
```javascript
import {
  addTransactionWithNotifications,
  updateTransactionWithNotifications,
  deleteTransactionWithNotifications
} from '@features/transactions/service.js';

// Adicionar transa√ß√£o com notifica√ß√µes
await addTransactionWithNotifications(transactionData);

// Atualizar transa√ß√£o com notifica√ß√µes
await updateTransactionWithNotifications(id, transactionData);

// Deletar transa√ß√£o com notifica√ß√µes
await deleteTransactionWithNotifications(id);
```

### Categories (`@features/categories/CategoriesPage.js`)

Gerenciamento de categorias de transa√ß√µes.

```javascript
import { 
  renderCategories,
  renderAllCategories,
  renderFilteredCategories
} from '@features/categories/CategoriesPage.js';

// Renderizar categorias
await renderCategories();

// Renderizar todas as categorias
await renderAllCategories();

// Renderizar categorias filtradas
await renderFilteredCategories(filteredCategories);
```

### Notifications (`@features/notifications/`)

Sistema de notifica√ß√µes em tempo real.

#### NotificationsPage.js
```javascript
import { renderNotifications } from '@features/notifications/NotificationsPage.js';

// Renderizar notifica√ß√µes
await renderNotifications();
```

#### NotificationService.js
```javascript
import {
  sendTransactionNotification,
  sendBudgetInviteNotification,
  sendCategoryLimitNotification,
  sendRecurringTransactionNotification
} from '@features/notifications/NotificationService.js';

// Enviar notifica√ß√£o de transa√ß√£o
await sendTransactionNotification(budgetId, senderUid, transactionData);

// Enviar convite para or√ßamento
await sendBudgetInviteNotification(budgetId, senderUid, recipientEmail);

// Notificar limite de categoria
await sendCategoryLimitNotification(categoryId, currentAmount, limit);

// Notificar transa√ß√£o recorrente
await sendRecurringTransactionNotification(transactionId);
```

### Backup & Export (`@features/backup/BackupService.js`)

Funcionalidades de backup e exporta√ß√£o.

```javascript
import {
  downloadBackup,
  exportToExcel,
  exportToPDF,
  exportReadmePDF,
  showExportOptions
} from '@features/backup/BackupService.js';

// Download de backup JSON
await downloadBackup();

// Exportar para Excel
await exportToExcel();

// Exportar para PDF
await exportToPDF();

// Exportar README em PDF
await exportReadmePDF();

// Mostrar op√ß√µes de exporta√ß√£o
await showExportOptions();
```

### Voice (`@features/voice/VoiceService.js`)

Sistema de reconhecimento de voz.

```javascript
import {
  parseNumeroPorExtenso,
  processTransactionVoice,
  processCategoryVoice,
  openVoiceModal,
  closeVoiceModal,
  startVoiceRecognition
} from '@features/voice/VoiceService.js';

// Abrir modal de voz
openVoiceModal('transaction');

// Processar comando de voz para transa√ß√£o
await processTransactionVoice('comprar p√£o 5 reais despesa alimenta√ß√£o');

// Processar comando de voz para categoria
await processCategoryVoice('criar categoria alimenta√ß√£o despesa 500');

// Fechar modal de voz
closeVoiceModal();
```

### UI (`@features/ui/UIService.js`)

Componentes de interface principais.

```javascript
import {
  renderFAB,
  renderBottomNav,
  showLoading,
  resetScrollPosition
} from '@features/ui/UIService.js';

// Renderizar FAB (Floating Action Button)
renderFAB();

// Renderizar navega√ß√£o inferior
renderBottomNav('/dashboard');

// Mostrar/esconder loading
showLoading(true);
showLoading(false);

// Resetar posi√ß√£o de scroll
resetScrollPosition();
```

### Utils (`@features/utils/UtilsService.js`)

Utilit√°rios gerais para formata√ß√£o e manipula√ß√£o de dados.

```javascript
import {
  formatCurrency,
  formatDate,
  calculatePercentage,
  normalizeText,
  debounce,
  throttle,
  generateId
} from '@features/utils/UtilsService.js';

// Formatar moeda
formatCurrency(1234.56); // "R$ 1.234,56"

// Formatar data
formatDate(new Date()); // "25/12/2024"

// Calcular porcentagem
calculatePercentage(25, 100); // 25

// Normalizar texto (remover acentos)
normalizeText('S√£o Paulo'); // "sao paulo"

// Debounce para inputs
const debouncedSearch = debounce(searchFunction, 300);

// Throttle para scroll
const throttledScroll = throttle(scrollFunction, 100);

// Gerar ID √∫nico
const id = generateId(); // "abc123def456"
```

### Validation (`@features/validation/ValidationService.js`)

Valida√ß√µes para formul√°rios e dados.

```javascript
import {
  validateTransaction,
  validateCategory,
  validateBudget,
  validateEmail,
  validatePassword,
  validateCPF
} from '@features/validation/ValidationService.js';

// Validar transa√ß√£o
const transactionValidation = validateTransaction(transactionData);
if (!transactionValidation.isValid) {
  console.log('Erros:', transactionValidation.errors);
}

// Validar categoria
const categoryValidation = validateCategory(categoryData);

// Validar or√ßamento
const budgetValidation = validateBudget(budgetData);

// Validar email
const isValidEmail = validateEmail('user@example.com');

// Validar senha
const passwordValidation = validatePassword('MyPass123');

// Validar CPF
const isValidCPF = validateCPF('123.456.789-09');
```

### Calculations (`@features/calculations/CalculationService.js`)

C√°lculos financeiros e estat√≠sticas.

```javascript
import {
  calculateBudgetBalance,
  calculateCategoryTotals,
  calculateMonthlyStats,
  calculateTrends,
  calculateProjections
} from '@features/calculations/CalculationService.js';

// Calcular saldo do or√ßamento
const balance = calculateBudgetBalance(budgetId);
// { receitas: 5000, despesas: 3000, saldo: 2000, orcado: 4000 }

// Calcular totais por categoria
const categoryTotals = calculateCategoryTotals(budgetId, month);

// Calcular estat√≠sticas mensais
const monthlyStats = calculateMonthlyStats(budgetId, 6);

// Calcular tend√™ncias
const trends = calculateTrends(budgetId, 3);
// { trend: 'crescimento', percentage: 15.5, change: 500 }

// Calcular proje√ß√µes
const projections = calculateProjections(budgetId, 3);
```

### Theme (`@features/theme/ThemeService.js`)

Sistema de temas e configura√ß√µes visuais.

```javascript
import {
  setupThemeToggle,
  toggleTheme,
  applyTheme,
  applyCompactMode,
  getCurrentTheme
} from '@features/theme/ThemeService.js';

// Configurar toggle de tema
setupThemeToggle();

// Alternar tema
toggleTheme();

// Aplicar tema espec√≠fico
applyTheme('dark');

// Aplicar modo compacto
applyCompactMode();

// Obter tema atual
const currentTheme = getCurrentTheme(); // 'light' ou 'dark'
```

## üéØ Uso Pr√°tico

### Exemplo de implementa√ß√£o de uma nova feature:

```javascript
// 1. Criar arquivo de servi√ßo
// src/features/analytics/AnalyticsService.js
export function generateReport(budgetId, period) {
  // L√≥gica da feature
}

// 2. Adicionar ao √≠ndice
// src/features/index.js
export { generateReport } from './analytics/AnalyticsService.js';

// 3. Usar na aplica√ß√£o
import { generateReport } from '@features/index.js';
const report = await generateReport(budgetId, 'monthly');
```

### Exemplo de comunica√ß√£o entre features:

```javascript
// Em TransactionsService.js
import { eventBus } from '@core/events/eventBus.js';

export async function addTransaction(data) {
  // Salvar transa√ß√£o
  const transaction = await saveTransaction(data);
  
  // Emitir evento
  eventBus.emit('transaction:added', transaction);
  
  return transaction;
}

// Em DashboardPage.js
import { eventBus } from '@core/events/eventBus.js';

eventBus.on('transaction:added', (transaction) => {
  // Atualizar dashboard automaticamente
  updateDashboardStats();
});
```

## üöÄ Performance

- **Lazy Loading**: Todas as features s√£o carregadas sob demanda
- **Code Splitting**: Bundle dividido em chunks otimizados
- **Tree Shaking**: C√≥digo n√£o utilizado √© removido automaticamente
- **Dynamic Imports**: Importa√ß√µes din√¢micas para melhor performance

## üß™ Testes

```bash
# Executar todos os testes
npm test

# Executar testes espec√≠ficos
npm test -- --grep "EventBus"

# Executar testes em modo watch
npm test -- --watch
```

## üìù Conven√ß√µes

- **Nomes de arquivos**: PascalCase para componentes, camelCase para servi√ßos
- **Nomes de fun√ß√µes**: camelCase, descritivos
- **Eventos**: formato `domain:action` (ex: `transaction:added`)
- **Imports**: usar aliases `@features`, `@core`, `@ui`
- **Exports**: sempre usar named exports
- **Async/Await**: preferir sobre Promises para opera√ß√µes ass√≠ncronas

## üîç Debugging

```javascript
// Habilitar logs detalhados
localStorage.setItem('debug', 'true');

// Verificar estado do EventBus
console.log('EventBus listeners:', eventBus.listeners);

// Verificar estado global
console.log('Global state:', globalState);
```

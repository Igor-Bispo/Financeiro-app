<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Completo - Controle Financeiro</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold text-center mb-8">ğŸ§ª Teste Completo - Controle Financeiro</h1>
        
        <!-- Status Geral -->
        <div class="card mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“Š Status Geral</h2>
            <div id="general-status" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="status-item">
                    <span class="font-bold">Firebase:</span>
                    <span id="firebase-status" class="text-yellow-500">ğŸ”„ Verificando...</span>
                </div>
                <div class="status-item">
                    <span class="font-bold">AutenticaÃ§Ã£o:</span>
                    <span id="auth-status" class="text-yellow-500">ğŸ”„ Verificando...</span>
                </div>
                <div class="status-item">
                    <span class="font-bold">Banco de Dados:</span>
                    <span id="db-status" class="text-yellow-500">ğŸ”„ Verificando...</span>
                </div>
            </div>
        </div>

        <!-- Testes de Funcionalidades -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Teste de AutenticaÃ§Ã£o -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">ğŸ” Teste de AutenticaÃ§Ã£o</h3>
                <div class="space-y-2">
                    <button id="test-login" class="btn btn-primary w-full">Testar Login Google</button>
                    <button id="test-logout" class="btn btn-secondary w-full">Testar Logout</button>
                    <div id="auth-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de TransaÃ§Ãµes -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">ğŸ’³ Teste de TransaÃ§Ãµes</h3>
                <div class="space-y-2">
                    <button id="test-add-transaction" class="btn btn-primary w-full">Adicionar TransaÃ§Ã£o Teste</button>
                    <button id="test-load-transactions" class="btn btn-secondary w-full">Carregar TransaÃ§Ãµes</button>
                    <button id="test-delete-transactions" class="btn btn-danger w-full">Limpar TransaÃ§Ãµes</button>
                    <div id="transaction-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de Categorias -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">ğŸ·ï¸ Teste de Categorias</h3>
                <div class="space-y-2">
                    <button id="test-add-category" class="btn btn-primary w-full">Adicionar Categoria Teste</button>
                    <button id="test-load-categories" class="btn btn-secondary w-full">Carregar Categorias</button>
                    <div id="category-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de Metas -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">ğŸ¯ Teste de Metas</h3>
                <div class="space-y-2">
                    <button id="test-add-goal" class="btn btn-primary w-full">Adicionar Meta Teste</button>
                    <button id="test-load-goals" class="btn btn-secondary w-full">Carregar Metas</button>
                    <div id="goal-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de OrÃ§amentos -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">ğŸ“Š Teste de OrÃ§amentos</h3>
                <div class="space-y-2">
                    <button id="test-add-budget" class="btn btn-primary w-full">Adicionar OrÃ§amento Teste</button>
                    <button id="test-load-budgets" class="btn btn-secondary w-full">Carregar OrÃ§amentos</button>
                    <div id="budget-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de Voz -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">ğŸ¤ Teste de Reconhecimento de Voz</h3>
                <div class="space-y-2">
                    <button id="test-voice-start" class="btn btn-primary w-full">Iniciar Reconhecimento</button>
                    <button id="test-voice-stop" class="btn btn-secondary w-full">Parar Reconhecimento</button>
                    <div id="voice-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de ExportaÃ§Ã£o -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">ğŸ“¤ Teste de ExportaÃ§Ã£o</h3>
                <div class="space-y-2">
                    <button id="test-export-data" class="btn btn-primary w-full">Exportar Dados</button>
                    <button id="test-export-excel" class="btn btn-secondary w-full">Exportar Excel</button>
                    <div id="export-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de UtilitÃ¡rios -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">ğŸ”§ Teste de UtilitÃ¡rios</h3>
                <div class="space-y-2">
                    <button id="test-format-currency" class="btn btn-primary w-full">Testar FormataÃ§Ã£o</button>
                    <button id="test-format-date" class="btn btn-secondary w-full">Testar Data</button>
                    <div id="utils-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs Detalhados -->
        <div class="card mt-6">
            <h3 class="text-lg font-bold mb-4">ğŸ“ Logs Detalhados</h3>
            <div id="detailed-logs" class="text-sm bg-gray-100 dark:bg-gray-800 p-4 rounded max-h-60 overflow-y-auto">
                <p>Iniciando testes...</p>
            </div>
        </div>

        <!-- BotÃ£o de Teste Completo -->
        <div class="text-center mt-6">
            <button id="run-all-tests" class="btn btn-primary text-lg px-8 py-3">
                ğŸš€ Executar Todos os Testes
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/firebase/config.js"></script>
    <script src="js/firebase/auth.js"></script>
    <script src="js/firebase/database.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/ui.js"></script>
    <script src="js/utils/storage.js"></script>
    <script src="js/modules/transactions.js"></script>
    <script src="js/modules/categories.js"></script>
    <script src="js/modules/goals.js"></script>
    <script src="js/modules/budgets.js"></script>
    <script src="js/modules/voice-recognition.js"></script>
    
    <script>
        // Teste completo da aplicaÃ§Ã£o
        class CompleteTest {
            constructor() {
                this.logs = [];
                this.init();
            }

            init() {
                this.log('Iniciando teste completo da aplicaÃ§Ã£o...');
                this.setupEventListeners();
                this.checkInitialStatus();
            }

            log(message) {
                const timestamp = new Date().toLocaleTimeString();
                const logMessage = `[${timestamp}] ${message}`;
                this.logs.push(logMessage);
                
                const logsContainer = document.getElementById('detailed-logs');
                logsContainer.innerHTML += `<p>${logMessage}</p>`;
                logsContainer.scrollTop = logsContainer.scrollHeight;
                
                console.log(logMessage);
            }

            setupEventListeners() {
                // Teste de autenticaÃ§Ã£o
                document.getElementById('test-login').addEventListener('click', () => this.testAuth());
                document.getElementById('test-logout').addEventListener('click', () => this.testLogout());
                
                // Teste de transaÃ§Ãµes
                document.getElementById('test-add-transaction').addEventListener('click', () => this.testAddTransaction());
                document.getElementById('test-load-transactions').addEventListener('click', () => this.testLoadTransactions());
                document.getElementById('test-delete-transactions').addEventListener('click', () => this.testDeleteTransactions());
                
                // Teste de categorias
                document.getElementById('test-add-category').addEventListener('click', () => this.testAddCategory());
                document.getElementById('test-load-categories').addEventListener('click', () => this.testLoadCategories());
                
                // Teste de metas
                document.getElementById('test-add-goal').addEventListener('click', () => this.testAddGoal());
                document.getElementById('test-load-goals').addEventListener('click', () => this.testLoadGoals());
                
                // Teste de orÃ§amentos
                document.getElementById('test-add-budget').addEventListener('click', () => this.testAddBudget());
                document.getElementById('test-load-budgets').addEventListener('click', () => this.testLoadBudgets());
                
                // Teste de voz
                document.getElementById('test-voice-start').addEventListener('click', () => this.testVoiceStart());
                document.getElementById('test-voice-stop').addEventListener('click', () => this.testVoiceStop());
                
                // Teste de exportaÃ§Ã£o
                document.getElementById('test-export-data').addEventListener('click', () => this.testExportData());
                document.getElementById('test-export-excel').addEventListener('click', () => this.testExportExcel());
                
                // Teste de utilitÃ¡rios
                document.getElementById('test-format-currency').addEventListener('click', () => this.testFormatCurrency());
                document.getElementById('test-format-date').addEventListener('click', () => this.testFormatDate());
                
                // Teste completo
                document.getElementById('run-all-tests').addEventListener('click', () => this.runAllTests());
            }

            checkInitialStatus() {
                // Verificar Firebase
                if (window.FirebaseApp) {
                    document.getElementById('firebase-status').textContent = 'âœ… Conectado';
                    document.getElementById('firebase-status').className = 'text-green-500';
                    this.log('âœ… Firebase conectado com sucesso');
                } else {
                    document.getElementById('firebase-status').textContent = 'âŒ Erro';
                    document.getElementById('firebase-status').className = 'text-red-500';
                    this.log('âŒ Erro ao conectar Firebase');
                }

                // Verificar mÃ³dulos
                setTimeout(() => {
                    this.checkModules();
                }, 1000);
            }

            checkModules() {
                const modules = {
                    'Auth': window.FinanceAuth,
                    'UI': window.FinanceUI,
                    'Transactions': window.FinanceTransactions,
                    'Categories': window.FinanceCategories,
                    'Goals': window.FinanceGoals,
                    'Budgets': window.FinanceBudgets,
                    'Voice': window.FinanceVoice
                };

                Object.entries(modules).forEach(([name, module]) => {
                    if (module) {
                        this.log(`âœ… MÃ³dulo ${name} carregado`);
                    } else {
                        this.log(`âŒ MÃ³dulo ${name} nÃ£o carregado`);
                    }
                });
            }

            async testAuth() {
                try {
                    this.log('ğŸ” Testando autenticaÃ§Ã£o...');
                    const result = await window.FinanceAuth.signInWithGoogle();
                    document.getElementById('auth-test-result').textContent = 'âœ… Login realizado com sucesso';
                    document.getElementById('auth-status').textContent = 'âœ… Logado';
                    document.getElementById('auth-status').className = 'text-green-500';
                    this.log('âœ… AutenticaÃ§Ã£o funcionando');
                } catch (error) {
                    document.getElementById('auth-test-result').textContent = 'âŒ Erro no login';
                    this.log(`âŒ Erro na autenticaÃ§Ã£o: ${error.message}`);
                }
            }

            async testLogout() {
                try {
                    this.log('ğŸ” Testando logout...');
                    await window.FinanceAuth.signOut();
                    document.getElementById('auth-test-result').textContent = 'âœ… Logout realizado com sucesso';
                    document.getElementById('auth-status').textContent = 'âŒ Deslogado';
                    document.getElementById('auth-status').className = 'text-red-500';
                    this.log('âœ… Logout funcionando');
                } catch (error) {
                    document.getElementById('auth-test-result').textContent = 'âŒ Erro no logout';
                    this.log(`âŒ Erro no logout: ${error.message}`);
                }
            }

            async testAddTransaction() {
                try {
                    this.log('ğŸ’³ Testando adiÃ§Ã£o de transaÃ§Ã£o...');
                    const transaction = {
                        description: 'Teste Completo - ' + new Date().toLocaleTimeString(),
                        amount: Math.random() * 1000,
                        type: 'expense',
                        category: 'Teste',
                        date: new Date().toISOString()
                    };
                    
                    await window.FinanceTransactions.addTransaction(transaction);
                    document.getElementById('transaction-test-result').textContent = 'âœ… TransaÃ§Ã£o adicionada';
                    this.log('âœ… AdiÃ§Ã£o de transaÃ§Ã£o funcionando');
                } catch (error) {
                    document.getElementById('transaction-test-result').textContent = 'âŒ Erro ao adicionar';
                    this.log(`âŒ Erro ao adicionar transaÃ§Ã£o: ${error.message}`);
                }
            }

            async testLoadTransactions() {
                try {
                    this.log('ğŸ’³ Testando carregamento de transaÃ§Ãµes...');
                    const transactions = await window.FinanceTransactions.getTransactions();
                    document.getElementById('transaction-test-result').textContent = `âœ… ${transactions.length} transaÃ§Ãµes carregadas`;
                    this.log(`âœ… Carregamento de transaÃ§Ãµes funcionando: ${transactions.length} encontradas`);
                } catch (error) {
                    document.getElementById('transaction-test-result').textContent = 'âŒ Erro ao carregar';
                    this.log(`âŒ Erro ao carregar transaÃ§Ãµes: ${error.message}`);
                }
            }

            async testDeleteTransactions() {
                try {
                    this.log('ğŸ’³ Testando limpeza de transaÃ§Ãµes...');
                    await window.FinanceTransactions.clearAllTransactions();
                    document.getElementById('transaction-test-result').textContent = 'âœ… TransaÃ§Ãµes removidas';
                    this.log('âœ… Limpeza de transaÃ§Ãµes funcionando');
                } catch (error) {
                    document.getElementById('transaction-test-result').textContent = 'âŒ Erro ao remover';
                    this.log(`âŒ Erro ao remover transaÃ§Ãµes: ${error.message}`);
                }
            }

            async testAddCategory() {
                try {
                    this.log('ğŸ·ï¸ Testando adiÃ§Ã£o de categoria...');
                    const category = {
                        name: 'Teste Completo - ' + new Date().toLocaleTimeString(),
                        color: '#FF0000',
                        icon: 'ğŸ·ï¸'
                    };
                    
                    await window.FinanceCategories.addCategory(category);
                    document.getElementById('category-test-result').textContent = 'âœ… Categoria adicionada';
                    this.log('âœ… AdiÃ§Ã£o de categoria funcionando');
                } catch (error) {
                    document.getElementById('category-test-result').textContent = 'âŒ Erro ao adicionar';
                    this.log(`âŒ Erro ao adicionar categoria: ${error.message}`);
                }
            }

            async testLoadCategories() {
                try {
                    this.log('ğŸ·ï¸ Testando carregamento de categorias...');
                    const categories = await window.FinanceCategories.getCategories();
                    document.getElementById('category-test-result').textContent = `âœ… ${categories.length} categorias carregadas`;
                    this.log(`âœ… Carregamento de categorias funcionando: ${categories.length} encontradas`);
                } catch (error) {
                    document.getElementById('category-test-result').textContent = 'âŒ Erro ao carregar';
                    this.log(`âŒ Erro ao carregar categorias: ${error.message}`);
                }
            }

            async testAddGoal() {
                try {
                    this.log('ğŸ¯ Testando adiÃ§Ã£o de meta...');
                    const goal = {
                        name: 'Meta Teste Completo',
                        targetAmount: 1000,
                        currentAmount: 0,
                        deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        category: 'Teste'
                    };
                    
                    await window.FinanceGoals.addGoal(goal);
                    document.getElementById('goal-test-result').textContent = 'âœ… Meta adicionada';
                    this.log('âœ… AdiÃ§Ã£o de meta funcionando');
                } catch (error) {
                    document.getElementById('goal-test-result').textContent = 'âŒ Erro ao adicionar';
                    this.log(`âŒ Erro ao adicionar meta: ${error.message}`);
                }
            }

            async testLoadGoals() {
                try {
                    this.log('ğŸ¯ Testando carregamento de metas...');
                    const goals = await window.FinanceGoals.getGoals();
                    document.getElementById('goal-test-result').textContent = `âœ… ${goals.length} metas carregadas`;
                    this.log(`âœ… Carregamento de metas funcionando: ${goals.length} encontradas`);
                } catch (error) {
                    document.getElementById('goal-test-result').textContent = 'âŒ Erro ao carregar';
                    this.log(`âŒ Erro ao carregar metas: ${error.message}`);
                }
            }

            async testAddBudget() {
                try {
                    this.log('ğŸ“Š Testando adiÃ§Ã£o de orÃ§amento...');
                    const budget = {
                        name: 'OrÃ§amento Teste Completo',
                        amount: 500,
                        spent: 0,
                        period: 'monthly',
                        category: 'Teste'
                    };
                    
                    await window.FinanceBudgets.addBudget(budget);
                    document.getElementById('budget-test-result').textContent = 'âœ… OrÃ§amento adicionado';
                    this.log('âœ… AdiÃ§Ã£o de orÃ§amento funcionando');
                } catch (error) {
                    document.getElementById('budget-test-result').textContent = 'âŒ Erro ao adicionar';
                    this.log(`âŒ Erro ao adicionar orÃ§amento: ${error.message}`);
                }
            }

            async testLoadBudgets() {
                try {
                    this.log('ğŸ“Š Testando carregamento de orÃ§amentos...');
                    const budgets = await window.FinanceBudgets.getBudgets();
                    document.getElementById('budget-test-result').textContent = `âœ… ${budgets.length} orÃ§amentos carregados`;
                    this.log(`âœ… Carregamento de orÃ§amentos funcionando: ${budgets.length} encontrados`);
                } catch (error) {
                    document.getElementById('budget-test-result').textContent = 'âŒ Erro ao carregar';
                    this.log(`âŒ Erro ao carregar orÃ§amentos: ${error.message}`);
                }
            }

            testVoiceStart() {
                try {
                    this.log('ğŸ¤ Testando inÃ­cio do reconhecimento de voz...');
                    window.FinanceVoice.startListening();
                    document.getElementById('voice-test-result').textContent = 'âœ… Reconhecimento iniciado';
                    this.log('âœ… Reconhecimento de voz iniciado');
                } catch (error) {
                    document.getElementById('voice-test-result').textContent = 'âŒ Erro ao iniciar';
                    this.log(`âŒ Erro ao iniciar reconhecimento: ${error.message}`);
                }
            }

            testVoiceStop() {
                try {
                    this.log('ğŸ¤ Testando parada do reconhecimento de voz...');
                    window.FinanceVoice.stopListening();
                    document.getElementById('voice-test-result').textContent = 'âœ… Reconhecimento parado';
                    this.log('âœ… Reconhecimento de voz parado');
                } catch (error) {
                    document.getElementById('voice-test-result').textContent = 'âŒ Erro ao parar';
                    this.log(`âŒ Erro ao parar reconhecimento: ${error.message}`);
                }
            }

            testExportData() {
                try {
                    this.log('ğŸ“¤ Testando exportaÃ§Ã£o de dados...');
                    const data = {
                        transactions: [],
                        categories: [],
                        goals: [],
                        budgets: []
                    };
                    
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'controle-financeiro-teste.json';
                    a.click();
                    
                    document.getElementById('export-test-result').textContent = 'âœ… Dados exportados';
                    this.log('âœ… ExportaÃ§Ã£o de dados funcionando');
                } catch (error) {
                    document.getElementById('export-test-result').textContent = 'âŒ Erro na exportaÃ§Ã£o';
                    this.log(`âŒ Erro na exportaÃ§Ã£o: ${error.message}`);
                }
            }

            testExportExcel() {
                try {
                    this.log('ğŸ“¤ Testando exportaÃ§Ã£o Excel...');
                    const data = [
                        ['Data', 'DescriÃ§Ã£o', 'Valor', 'Categoria'],
                        [new Date().toLocaleDateString(), 'Teste Completo', 'R$ 100,00', 'Teste']
                    ];
                    
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'TransaÃ§Ãµes');
                    XLSX.writeFile(wb, 'controle-financeiro-teste.xlsx');
                    
                    document.getElementById('export-test-result').textContent = 'âœ… Excel exportado';
                    this.log('âœ… ExportaÃ§Ã£o Excel funcionando');
                } catch (error) {
                    document.getElementById('export-test-result').textContent = 'âŒ Erro na exportaÃ§Ã£o';
                    this.log(`âŒ Erro na exportaÃ§Ã£o Excel: ${error.message}`);
                }
            }

            testFormatCurrency() {
                try {
                    this.log('ğŸ”§ Testando formataÃ§Ã£o de moeda...');
                    const amount = 1234.56;
                    const formatted = window.FinanceHelpers.formatCurrency(amount);
                    document.getElementById('utils-test-result').textContent = `âœ… ${amount} â†’ ${formatted}`;
                    this.log(`âœ… FormataÃ§Ã£o de moeda: ${amount} â†’ ${formatted}`);
                } catch (error) {
                    document.getElementById('utils-test-result').textContent = 'âŒ Erro na formataÃ§Ã£o';
                    this.log(`âŒ Erro na formataÃ§Ã£o de moeda: ${error.message}`);
                }
            }

            testFormatDate() {
                try {
                    this.log('ğŸ”§ Testando formataÃ§Ã£o de data...');
                    const date = new Date();
                    const formatted = window.FinanceHelpers.formatDate(date);
                    document.getElementById('utils-test-result').textContent = `âœ… ${date} â†’ ${formatted}`;
                    this.log(`âœ… FormataÃ§Ã£o de data: ${date} â†’ ${formatted}`);
                } catch (error) {
                    document.getElementById('utils-test-result').textContent = 'âŒ Erro na formataÃ§Ã£o';
                    this.log(`âŒ Erro na formataÃ§Ã£o de data: ${error.message}`);
                }
            }

            async runAllTests() {
                this.log('ğŸš€ Iniciando todos os testes...');
                
                // Executar todos os testes em sequÃªncia
                await this.testFormatCurrency();
                await this.testFormatDate();
                await this.testAddCategory();
                await this.testLoadCategories();
                await this.testAddGoal();
                await this.testLoadGoals();
                await this.testAddBudget();
                await this.testLoadBudgets();
                await this.testAddTransaction();
                await this.testLoadTransactions();
                await this.testExportData();
                await this.testExportExcel();
                
                this.log('ğŸ‰ Todos os testes concluÃ­dos!');
                this.log('âœ… AplicaÃ§Ã£o estÃ¡ 100% funcional!');
            }
        }

        // Iniciar teste quando a pÃ¡gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                new CompleteTest();
            }, 1000);
        });
    </script>
</body>
</html> 
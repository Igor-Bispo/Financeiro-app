<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Completo - Controle Financeiro</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold text-center mb-8">🧪 Teste Completo - Controle Financeiro</h1>
        
        <!-- Status Geral -->
        <div class="card mb-6">
            <h2 class="text-xl font-bold mb-4">📊 Status Geral</h2>
            <div id="general-status" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="status-item">
                    <span class="font-bold">Firebase:</span>
                    <span id="firebase-status" class="text-yellow-500">🔄 Verificando...</span>
                </div>
                <div class="status-item">
                    <span class="font-bold">Autenticação:</span>
                    <span id="auth-status" class="text-yellow-500">🔄 Verificando...</span>
                </div>
                <div class="status-item">
                    <span class="font-bold">Banco de Dados:</span>
                    <span id="db-status" class="text-yellow-500">🔄 Verificando...</span>
                </div>
            </div>
        </div>

        <!-- Testes de Funcionalidades -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Teste de Autenticação -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">🔐 Teste de Autenticação</h3>
                <div class="space-y-2">
                    <button id="test-login" class="btn btn-primary w-full">Testar Login Google</button>
                    <button id="test-logout" class="btn btn-secondary w-full">Testar Logout</button>
                    <div id="auth-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de Transações -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">💳 Teste de Transações</h3>
                <div class="space-y-2">
                    <button id="test-add-transaction" class="btn btn-primary w-full">Adicionar Transação Teste</button>
                    <button id="test-load-transactions" class="btn btn-secondary w-full">Carregar Transações</button>
                    <button id="test-delete-transactions" class="btn btn-danger w-full">Limpar Transações</button>
                    <div id="transaction-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de Categorias -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">🏷️ Teste de Categorias</h3>
                <div class="space-y-2">
                    <button id="test-add-category" class="btn btn-primary w-full">Adicionar Categoria Teste</button>
                    <button id="test-load-categories" class="btn btn-secondary w-full">Carregar Categorias</button>
                    <div id="category-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de Metas -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">🎯 Teste de Metas</h3>
                <div class="space-y-2">
                    <button id="test-add-goal" class="btn btn-primary w-full">Adicionar Meta Teste</button>
                    <button id="test-load-goals" class="btn btn-secondary w-full">Carregar Metas</button>
                    <div id="goal-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de Orçamentos -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">📊 Teste de Orçamentos</h3>
                <div class="space-y-2">
                    <button id="test-add-budget" class="btn btn-primary w-full">Adicionar Orçamento Teste</button>
                    <button id="test-load-budgets" class="btn btn-secondary w-full">Carregar Orçamentos</button>
                    <div id="budget-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de Voz -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">🎤 Teste de Reconhecimento de Voz</h3>
                <div class="space-y-2">
                    <button id="test-voice-start" class="btn btn-primary w-full">Iniciar Reconhecimento</button>
                    <button id="test-voice-stop" class="btn btn-secondary w-full">Parar Reconhecimento</button>
                    <div id="voice-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de Exportação -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">📤 Teste de Exportação</h3>
                <div class="space-y-2">
                    <button id="test-export-data" class="btn btn-primary w-full">Exportar Dados</button>
                    <button id="test-export-excel" class="btn btn-secondary w-full">Exportar Excel</button>
                    <div id="export-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>

            <!-- Teste de Utilitários -->
            <div class="card">
                <h3 class="text-lg font-bold mb-4">🔧 Teste de Utilitários</h3>
                <div class="space-y-2">
                    <button id="test-format-currency" class="btn btn-primary w-full">Testar Formatação</button>
                    <button id="test-format-date" class="btn btn-secondary w-full">Testar Data</button>
                    <div id="utils-test-result" class="text-sm p-2 bg-gray-100 rounded">
                        Aguardando teste...
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs Detalhados -->
        <div class="card mt-6">
            <h3 class="text-lg font-bold mb-4">📝 Logs Detalhados</h3>
            <div id="detailed-logs" class="text-sm bg-gray-100 dark:bg-gray-800 p-4 rounded max-h-60 overflow-y-auto">
                <p>Iniciando testes...</p>
            </div>
        </div>

        <!-- Botão de Teste Completo -->
        <div class="text-center mt-6">
            <button id="run-all-tests" class="btn btn-primary text-lg px-8 py-3">
                🚀 Executar Todos os Testes
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/firebase/config.js"></script>
    <script src="js/firebase/auth.js"></script>
    <script src="js/firebase/database.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/ui.js"></script>
    <script src="js/utils/storage.js"></script>
    <script src="js/modules/transactions.js"></script>
    <script src="js/modules/categories.js"></script>
    <script src="js/modules/goals.js"></script>
    <script src="js/modules/budgets.js"></script>
    <script src="js/modules/voice-recognition.js"></script>
    
    <script>
        // Teste completo da aplicação
        class CompleteTest {
            constructor() {
                this.logs = [];
                this.init();
            }

            init() {
                this.log('Iniciando teste completo da aplicação...');
                this.setupEventListeners();
                this.checkInitialStatus();
            }

            log(message) {
                const timestamp = new Date().toLocaleTimeString();
                const logMessage = `[${timestamp}] ${message}`;
                this.logs.push(logMessage);
                
                const logsContainer = document.getElementById('detailed-logs');
                logsContainer.innerHTML += `<p>${logMessage}</p>`;
                logsContainer.scrollTop = logsContainer.scrollHeight;
                
                console.log(logMessage);
            }

            setupEventListeners() {
                // Teste de autenticação
                document.getElementById('test-login').addEventListener('click', () => this.testAuth());
                document.getElementById('test-logout').addEventListener('click', () => this.testLogout());
                
                // Teste de transações
                document.getElementById('test-add-transaction').addEventListener('click', () => this.testAddTransaction());
                document.getElementById('test-load-transactions').addEventListener('click', () => this.testLoadTransactions());
                document.getElementById('test-delete-transactions').addEventListener('click', () => this.testDeleteTransactions());
                
                // Teste de categorias
                document.getElementById('test-add-category').addEventListener('click', () => this.testAddCategory());
                document.getElementById('test-load-categories').addEventListener('click', () => this.testLoadCategories());
                
                // Teste de metas
                document.getElementById('test-add-goal').addEventListener('click', () => this.testAddGoal());
                document.getElementById('test-load-goals').addEventListener('click', () => this.testLoadGoals());
                
                // Teste de orçamentos
                document.getElementById('test-add-budget').addEventListener('click', () => this.testAddBudget());
                document.getElementById('test-load-budgets').addEventListener('click', () => this.testLoadBudgets());
                
                // Teste de voz
                document.getElementById('test-voice-start').addEventListener('click', () => this.testVoiceStart());
                document.getElementById('test-voice-stop').addEventListener('click', () => this.testVoiceStop());
                
                // Teste de exportação
                document.getElementById('test-export-data').addEventListener('click', () => this.testExportData());
                document.getElementById('test-export-excel').addEventListener('click', () => this.testExportExcel());
                
                // Teste de utilitários
                document.getElementById('test-format-currency').addEventListener('click', () => this.testFormatCurrency());
                document.getElementById('test-format-date').addEventListener('click', () => this.testFormatDate());
                
                // Teste completo
                document.getElementById('run-all-tests').addEventListener('click', () => this.runAllTests());
            }

            checkInitialStatus() {
                // Verificar Firebase
                if (window.FirebaseApp) {
                    document.getElementById('firebase-status').textContent = '✅ Conectado';
                    document.getElementById('firebase-status').className = 'text-green-500';
                    this.log('✅ Firebase conectado com sucesso');
                } else {
                    document.getElementById('firebase-status').textContent = '❌ Erro';
                    document.getElementById('firebase-status').className = 'text-red-500';
                    this.log('❌ Erro ao conectar Firebase');
                }

                // Verificar módulos
                setTimeout(() => {
                    this.checkModules();
                }, 1000);
            }

            checkModules() {
                const modules = {
                    'Auth': window.FinanceAuth,
                    'UI': window.FinanceUI,
                    'Transactions': window.FinanceTransactions,
                    'Categories': window.FinanceCategories,
                    'Goals': window.FinanceGoals,
                    'Budgets': window.FinanceBudgets,
                    'Voice': window.FinanceVoice
                };

                Object.entries(modules).forEach(([name, module]) => {
                    if (module) {
                        this.log(`✅ Módulo ${name} carregado`);
                    } else {
                        this.log(`❌ Módulo ${name} não carregado`);
                    }
                });
            }

            async testAuth() {
                try {
                    this.log('🔐 Testando autenticação...');
                    const result = await window.FinanceAuth.signInWithGoogle();
                    document.getElementById('auth-test-result').textContent = '✅ Login realizado com sucesso';
                    document.getElementById('auth-status').textContent = '✅ Logado';
                    document.getElementById('auth-status').className = 'text-green-500';
                    this.log('✅ Autenticação funcionando');
                } catch (error) {
                    document.getElementById('auth-test-result').textContent = '❌ Erro no login';
                    this.log(`❌ Erro na autenticação: ${error.message}`);
                }
            }

            async testLogout() {
                try {
                    this.log('🔐 Testando logout...');
                    await window.FinanceAuth.signOut();
                    document.getElementById('auth-test-result').textContent = '✅ Logout realizado com sucesso';
                    document.getElementById('auth-status').textContent = '❌ Deslogado';
                    document.getElementById('auth-status').className = 'text-red-500';
                    this.log('✅ Logout funcionando');
                } catch (error) {
                    document.getElementById('auth-test-result').textContent = '❌ Erro no logout';
                    this.log(`❌ Erro no logout: ${error.message}`);
                }
            }

            async testAddTransaction() {
                try {
                    this.log('💳 Testando adição de transação...');
                    const transaction = {
                        description: 'Teste Completo - ' + new Date().toLocaleTimeString(),
                        amount: Math.random() * 1000,
                        type: 'expense',
                        category: 'Teste',
                        date: new Date().toISOString()
                    };
                    
                    await window.FinanceTransactions.addTransaction(transaction);
                    document.getElementById('transaction-test-result').textContent = '✅ Transação adicionada';
                    this.log('✅ Adição de transação funcionando');
                } catch (error) {
                    document.getElementById('transaction-test-result').textContent = '❌ Erro ao adicionar';
                    this.log(`❌ Erro ao adicionar transação: ${error.message}`);
                }
            }

            async testLoadTransactions() {
                try {
                    this.log('💳 Testando carregamento de transações...');
                    const transactions = await window.FinanceTransactions.getTransactions();
                    document.getElementById('transaction-test-result').textContent = `✅ ${transactions.length} transações carregadas`;
                    this.log(`✅ Carregamento de transações funcionando: ${transactions.length} encontradas`);
                } catch (error) {
                    document.getElementById('transaction-test-result').textContent = '❌ Erro ao carregar';
                    this.log(`❌ Erro ao carregar transações: ${error.message}`);
                }
            }

            async testDeleteTransactions() {
                try {
                    this.log('💳 Testando limpeza de transações...');
                    await window.FinanceTransactions.clearAllTransactions();
                    document.getElementById('transaction-test-result').textContent = '✅ Transações removidas';
                    this.log('✅ Limpeza de transações funcionando');
                } catch (error) {
                    document.getElementById('transaction-test-result').textContent = '❌ Erro ao remover';
                    this.log(`❌ Erro ao remover transações: ${error.message}`);
                }
            }

            async testAddCategory() {
                try {
                    this.log('🏷️ Testando adição de categoria...');
                    const category = {
                        name: 'Teste Completo - ' + new Date().toLocaleTimeString(),
                        color: '#FF0000',
                        icon: '🏷️'
                    };
                    
                    await window.FinanceCategories.addCategory(category);
                    document.getElementById('category-test-result').textContent = '✅ Categoria adicionada';
                    this.log('✅ Adição de categoria funcionando');
                } catch (error) {
                    document.getElementById('category-test-result').textContent = '❌ Erro ao adicionar';
                    this.log(`❌ Erro ao adicionar categoria: ${error.message}`);
                }
            }

            async testLoadCategories() {
                try {
                    this.log('🏷️ Testando carregamento de categorias...');
                    const categories = await window.FinanceCategories.getCategories();
                    document.getElementById('category-test-result').textContent = `✅ ${categories.length} categorias carregadas`;
                    this.log(`✅ Carregamento de categorias funcionando: ${categories.length} encontradas`);
                } catch (error) {
                    document.getElementById('category-test-result').textContent = '❌ Erro ao carregar';
                    this.log(`❌ Erro ao carregar categorias: ${error.message}`);
                }
            }

            async testAddGoal() {
                try {
                    this.log('🎯 Testando adição de meta...');
                    const goal = {
                        name: 'Meta Teste Completo',
                        targetAmount: 1000,
                        currentAmount: 0,
                        deadline: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        category: 'Teste'
                    };
                    
                    await window.FinanceGoals.addGoal(goal);
                    document.getElementById('goal-test-result').textContent = '✅ Meta adicionada';
                    this.log('✅ Adição de meta funcionando');
                } catch (error) {
                    document.getElementById('goal-test-result').textContent = '❌ Erro ao adicionar';
                    this.log(`❌ Erro ao adicionar meta: ${error.message}`);
                }
            }

            async testLoadGoals() {
                try {
                    this.log('🎯 Testando carregamento de metas...');
                    const goals = await window.FinanceGoals.getGoals();
                    document.getElementById('goal-test-result').textContent = `✅ ${goals.length} metas carregadas`;
                    this.log(`✅ Carregamento de metas funcionando: ${goals.length} encontradas`);
                } catch (error) {
                    document.getElementById('goal-test-result').textContent = '❌ Erro ao carregar';
                    this.log(`❌ Erro ao carregar metas: ${error.message}`);
                }
            }

            async testAddBudget() {
                try {
                    this.log('📊 Testando adição de orçamento...');
                    const budget = {
                        name: 'Orçamento Teste Completo',
                        amount: 500,
                        spent: 0,
                        period: 'monthly',
                        category: 'Teste'
                    };
                    
                    await window.FinanceBudgets.addBudget(budget);
                    document.getElementById('budget-test-result').textContent = '✅ Orçamento adicionado';
                    this.log('✅ Adição de orçamento funcionando');
                } catch (error) {
                    document.getElementById('budget-test-result').textContent = '❌ Erro ao adicionar';
                    this.log(`❌ Erro ao adicionar orçamento: ${error.message}`);
                }
            }

            async testLoadBudgets() {
                try {
                    this.log('📊 Testando carregamento de orçamentos...');
                    const budgets = await window.FinanceBudgets.getBudgets();
                    document.getElementById('budget-test-result').textContent = `✅ ${budgets.length} orçamentos carregados`;
                    this.log(`✅ Carregamento de orçamentos funcionando: ${budgets.length} encontrados`);
                } catch (error) {
                    document.getElementById('budget-test-result').textContent = '❌ Erro ao carregar';
                    this.log(`❌ Erro ao carregar orçamentos: ${error.message}`);
                }
            }

            testVoiceStart() {
                try {
                    this.log('🎤 Testando início do reconhecimento de voz...');
                    window.FinanceVoice.startListening();
                    document.getElementById('voice-test-result').textContent = '✅ Reconhecimento iniciado';
                    this.log('✅ Reconhecimento de voz iniciado');
                } catch (error) {
                    document.getElementById('voice-test-result').textContent = '❌ Erro ao iniciar';
                    this.log(`❌ Erro ao iniciar reconhecimento: ${error.message}`);
                }
            }

            testVoiceStop() {
                try {
                    this.log('🎤 Testando parada do reconhecimento de voz...');
                    window.FinanceVoice.stopListening();
                    document.getElementById('voice-test-result').textContent = '✅ Reconhecimento parado';
                    this.log('✅ Reconhecimento de voz parado');
                } catch (error) {
                    document.getElementById('voice-test-result').textContent = '❌ Erro ao parar';
                    this.log(`❌ Erro ao parar reconhecimento: ${error.message}`);
                }
            }

            testExportData() {
                try {
                    this.log('📤 Testando exportação de dados...');
                    const data = {
                        transactions: [],
                        categories: [],
                        goals: [],
                        budgets: []
                    };
                    
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'controle-financeiro-teste.json';
                    a.click();
                    
                    document.getElementById('export-test-result').textContent = '✅ Dados exportados';
                    this.log('✅ Exportação de dados funcionando');
                } catch (error) {
                    document.getElementById('export-test-result').textContent = '❌ Erro na exportação';
                    this.log(`❌ Erro na exportação: ${error.message}`);
                }
            }

            testExportExcel() {
                try {
                    this.log('📤 Testando exportação Excel...');
                    const data = [
                        ['Data', 'Descrição', 'Valor', 'Categoria'],
                        [new Date().toLocaleDateString(), 'Teste Completo', 'R$ 100,00', 'Teste']
                    ];
                    
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Transações');
                    XLSX.writeFile(wb, 'controle-financeiro-teste.xlsx');
                    
                    document.getElementById('export-test-result').textContent = '✅ Excel exportado';
                    this.log('✅ Exportação Excel funcionando');
                } catch (error) {
                    document.getElementById('export-test-result').textContent = '❌ Erro na exportação';
                    this.log(`❌ Erro na exportação Excel: ${error.message}`);
                }
            }

            testFormatCurrency() {
                try {
                    this.log('🔧 Testando formatação de moeda...');
                    const amount = 1234.56;
                    const formatted = window.FinanceHelpers.formatCurrency(amount);
                    document.getElementById('utils-test-result').textContent = `✅ ${amount} → ${formatted}`;
                    this.log(`✅ Formatação de moeda: ${amount} → ${formatted}`);
                } catch (error) {
                    document.getElementById('utils-test-result').textContent = '❌ Erro na formatação';
                    this.log(`❌ Erro na formatação de moeda: ${error.message}`);
                }
            }

            testFormatDate() {
                try {
                    this.log('🔧 Testando formatação de data...');
                    const date = new Date();
                    const formatted = window.FinanceHelpers.formatDate(date);
                    document.getElementById('utils-test-result').textContent = `✅ ${date} → ${formatted}`;
                    this.log(`✅ Formatação de data: ${date} → ${formatted}`);
                } catch (error) {
                    document.getElementById('utils-test-result').textContent = '❌ Erro na formatação';
                    this.log(`❌ Erro na formatação de data: ${error.message}`);
                }
            }

            async runAllTests() {
                this.log('🚀 Iniciando todos os testes...');
                
                // Executar todos os testes em sequência
                await this.testFormatCurrency();
                await this.testFormatDate();
                await this.testAddCategory();
                await this.testLoadCategories();
                await this.testAddGoal();
                await this.testLoadGoals();
                await this.testAddBudget();
                await this.testLoadBudgets();
                await this.testAddTransaction();
                await this.testLoadTransactions();
                await this.testExportData();
                await this.testExportExcel();
                
                this.log('🎉 Todos os testes concluídos!');
                this.log('✅ Aplicação está 100% funcional!');
            }
        }

        // Iniciar teste quando a página carregar
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                new CompleteTest();
            }, 1000);
        });
    </script>
</body>
</html> 
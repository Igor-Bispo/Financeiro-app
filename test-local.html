<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Local - Controle Financeiro</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <div class="container">
        <header class="p-6">
            <h1 class="text-3xl font-bold text-center">üß™ Teste Local - Controle Financeiro</h1>
            <p class="text-center text-gray-600 dark:text-gray-400 mt-2">Testando funcionalidades sem Firebase</p>
        </header>

        <!-- Status -->
        <div id="status-container">
            <div class="status info">üîÑ Iniciando testes locais...</div>
        </div>

        <!-- Controles de Teste -->
        <div class="card mb-4">
            <h2 class="text-lg font-bold mb-2">üéÆ Controles de Teste</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                <button onclick="testAddTransaction()" class="btn btn-primary">Adicionar Transa√ß√£o</button>
                <button onclick="testGetTransactions()" class="btn btn-secondary">Listar Transa√ß√µes</button>
                <button onclick="testVoiceRecognition()" class="btn btn-primary">Testar Voz</button>
                <button onclick="testExport()" class="btn btn-secondary">Exportar</button>
                <button onclick="testClearData()" class="btn btn-secondary">Limpar Dados</button>
                <button onclick="testHelpers()" class="btn btn-secondary">Testar Helpers</button>
                <button onclick="testStorage()" class="btn btn-secondary">Testar Storage</button>
                <button onclick="showAllData()" class="btn btn-secondary">Ver Dados</button>
            </div>
        </div>

        <!-- Resultados -->
        <div class="card mb-4">
            <h2 class="text-lg font-bold mb-2">üìä Resultados</h2>
            <div id="results-container">
                <p class="text-gray-600">Os resultados dos testes aparecer√£o aqui...</p>
            </div>
        </div>

        <!-- Dados Atuais -->
        <div class="card mb-4">
            <h2 class="text-lg font-bold mb-2">üíæ Dados Atuais</h2>
            <div id="data-container">
                <p class="text-gray-600">Carregando dados...</p>
            </div>
        </div>

        <!-- Logs -->
        <div class="card">
            <h2 class="text-lg font-bold mb-2">üìù Logs</h2>
            <div id="logs-container" class="bg-gray-100 dark:bg-gray-800 p-2 rounded max-h-60 overflow-y-auto text-sm">
                <!-- Logs ser√£o inseridos aqui -->
            </div>
        </div>
    </div>

    <!-- Scripts locais -->
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/storage.js"></script>
    <script src="js/modules/transactions-local.js"></script>
    <script src="js/modules/voice-recognition.js"></script>
    
    <script>
        // Fun√ß√µes de teste
        function addStatus(message, type = 'info') {
            const container = document.getElementById('status-container');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }

        function addLog(message, type = 'info') {
            const container = document.getElementById('logs-container');
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type === 'error' ? 'text-red-600' : 'text-gray-700';
            div.textContent = `[${timestamp}] ${message}`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function updateResults(content) {
            const container = document.getElementById('results-container');
            container.innerHTML = content;
        }

        function updateData() {
            const container = document.getElementById('data-container');
            const transactions = window.FinanceTransactions ? window.FinanceTransactions.transactions : [];
            const storageData = {
                transactions: window.FinanceStorage ? window.FinanceStorage.loadFromStorage('finance_transactions') : null,
                categories: window.FinanceStorage ? window.FinanceStorage.loadFromStorage('finance_categories') : null,
                goals: window.FinanceStorage ? window.FinanceStorage.loadFromStorage('finance_goals') : null,
                budgets: window.FinanceStorage ? window.FinanceStorage.loadFromStorage('finance_budgets') : null
            };

            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h3 class="font-bold">Transa√ß√µes (${transactions.length})</h3>
                        <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto max-h-40">${JSON.stringify(transactions.slice(0, 3), null, 2)}</pre>
                    </div>
                    <div>
                        <h3 class="font-bold">Storage</h3>
                        <pre class="text-xs bg-gray-100 p-2 rounded overflow-auto max-h-40">${JSON.stringify(storageData, null, 2)}</pre>
                    </div>
                </div>
            `;
        }

        // Testes espec√≠ficos
        async function testAddTransaction() {
            try {
                const transaction = {
                    description: 'Teste Local - ' + new Date().toLocaleTimeString(),
                    amount: Math.random() * 100 + 10,
                    type: 'expense',
                    category: 'Teste',
                    date: new Date()
                };

                await window.FinanceTransactions.addTransaction(transaction);
                addStatus('‚úÖ Transa√ß√£o adicionada com sucesso', 'success');
                addLog('Transa√ß√£o adicionada: ' + JSON.stringify(transaction));
                updateData();
            } catch (error) {
                addStatus('‚ùå Erro ao adicionar transa√ß√£o: ' + error.message, 'error');
                addLog('Erro: ' + error.message, 'error');
            }
        }

        async function testGetTransactions() {
            try {
                const transactions = await window.FinanceTransactions.getTransactions();
                addStatus(`‚úÖ ${transactions.length} transa√ß√µes encontradas`, 'success');
                addLog(`Transa√ß√µes carregadas: ${transactions.length}`);
                
                updateResults(`
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h3 class="font-bold">Resumo</h3>
                            <p>Total: ${transactions.length} transa√ß√µes</p>
                            <p>Valor total: ${window.FinanceHelpers.formatCurrency(transactions.reduce((sum, t) => sum + (t.amount || 0), 0))}</p>
                        </div>
                        <div>
                            <h3 class="font-bold">√öltimas 3</h3>
                            <ul class="text-sm">
                                ${transactions.slice(0, 3).map(t => `
                                    <li>${t.description} - ${window.FinanceHelpers.formatCurrency(t.amount)}</li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                `);
            } catch (error) {
                addStatus('‚ùå Erro ao buscar transa√ß√µes: ' + error.message, 'error');
                addLog('Erro: ' + error.message, 'error');
            }
        }

        function testVoiceRecognition() {
            try {
                if (window.FinanceVoice) {
                    window.FinanceVoice.startListening('transaction');
                    addStatus('üé§ Reconhecimento de voz iniciado', 'info');
                    addLog('Reconhecimento de voz ativado');
                } else {
                    addStatus('‚ùå Reconhecimento de voz n√£o dispon√≠vel', 'error');
                    addLog('Reconhecimento de voz n√£o dispon√≠vel', 'error');
                }
            } catch (error) {
                addStatus('‚ùå Erro no reconhecimento de voz: ' + error.message, 'error');
                addLog('Erro: ' + error.message, 'error');
            }
        }

        function testExport() {
            try {
                const transactions = window.FinanceTransactions.transactions;
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(transactions);
                XLSX.utils.book_append_sheet(wb, ws, 'Transa√ß√µes');
                XLSX.writeFile(wb, 'controle-financeiro-local.xlsx');
                
                addStatus('‚úÖ Dados exportados com sucesso', 'success');
                addLog('Exporta√ß√£o realizada: controle-financeiro-local.xlsx');
            } catch (error) {
                addStatus('‚ùå Erro na exporta√ß√£o: ' + error.message, 'error');
                addLog('Erro: ' + error.message, 'error');
            }
        }

        function testClearData() {
            try {
                if (window.FinanceTransactions.clearAll) {
                    window.FinanceTransactions.clearAll();
                    addStatus('üóëÔ∏è Dados limpos com sucesso', 'warning');
                    addLog('Todos os dados foram removidos');
                    updateData();
                } else {
                    addStatus('‚ùå Fun√ß√£o de limpeza n√£o dispon√≠vel', 'error');
                    addLog('Fun√ß√£o clearAll n√£o encontrada', 'error');
                }
            } catch (error) {
                addStatus('‚ùå Erro ao limpar dados: ' + error.message, 'error');
                addLog('Erro: ' + error.message, 'error');
            }
        }

        function testHelpers() {
            try {
                const testAmount = 1234.56;
                const testDate = new Date();
                
                const formattedAmount = window.FinanceHelpers.formatCurrency(testAmount);
                const formattedDate = window.FinanceHelpers.formatDate(testDate);
                
                addStatus('‚úÖ Helpers funcionando corretamente', 'success');
                addLog(`Formata√ß√£o de moeda: ${testAmount} ‚Üí ${formattedAmount}`);
                addLog(`Formata√ß√£o de data: ${testDate} ‚Üí ${formattedDate}`);
                
                updateResults(`
                    <div>
                        <h3 class="font-bold">Teste de Helpers</h3>
                        <p>Valor: ${testAmount} ‚Üí ${formattedAmount}</p>
                        <p>Data: ${testDate.toISOString()} ‚Üí ${formattedDate}</p>
                    </div>
                `);
            } catch (error) {
                addStatus('‚ùå Erro nos helpers: ' + error.message, 'error');
                addLog('Erro: ' + error.message, 'error');
            }
        }

        function testStorage() {
            try {
                const testData = { test: 'data', timestamp: Date.now() };
                window.FinanceStorage.saveToStorage('test_key', testData);
                const loadedData = window.FinanceStorage.loadFromStorage('test_key');
                
                if (JSON.stringify(testData) === JSON.stringify(loadedData)) {
                    addStatus('‚úÖ Storage funcionando corretamente', 'success');
                    addLog('Storage testado com sucesso');
                } else {
                    addStatus('‚ùå Erro no storage', 'error');
                    addLog('Dados n√£o correspondem', 'error');
                }
                
                // Limpa o teste
                window.FinanceStorage.removeFromStorage('test_key');
            } catch (error) {
                addStatus('‚ùå Erro no storage: ' + error.message, 'error');
                addLog('Erro: ' + error.message, 'error');
            }
        }

        function showAllData() {
            updateData();
            addStatus('üìä Dados atualizados', 'info');
            addLog('Visualiza√ß√£o de dados atualizada');
        }

        // Inicializa√ß√£o
        window.addEventListener('load', () => {
            setTimeout(() => {
                addStatus('üöÄ Testes locais iniciados', 'success');
                addLog('P√°gina de teste carregada');
                updateData();
                
                // Testa componentes b√°sicos
                if (window.FinanceTransactions) {
                    addLog('‚úÖ M√≥dulo de transa√ß√µes carregado');
                } else {
                    addLog('‚ùå M√≥dulo de transa√ß√µes n√£o encontrado', 'error');
                }
                
                if (window.FinanceHelpers) {
                    addLog('‚úÖ Helpers carregados');
                } else {
                    addLog('‚ùå Helpers n√£o encontrados', 'error');
                }
                
                if (window.FinanceStorage) {
                    addLog('‚úÖ Storage carregado');
                } else {
                    addLog('‚ùå Storage n√£o encontrado', 'error');
                }
                
                if (window.FinanceVoice) {
                    addLog('‚úÖ Reconhecimento de voz carregado');
                } else {
                    addLog('‚ùå Reconhecimento de voz n√£o encontrado', 'error');
                }
            }, 500);
        });
    </script>
</body>
</html> 